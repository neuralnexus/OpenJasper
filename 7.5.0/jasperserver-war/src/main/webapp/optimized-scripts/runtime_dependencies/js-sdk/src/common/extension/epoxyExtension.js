define(["require","exports","module","backbone.epoxy","backbone","../component/colorPicker/react/ColorSelectorWrapper","underscore","../component/colorPicker/util/colorConvertUtil"],function(t,e,n){function i(t,e){var n=t.data("bind"),i=new RegExp(e+":(\\w*)\\(?(\\w*)?\\)?");return n?l.last(l.compact(n.match(i))):t.data("bindAttribute")}function o(t){return v(t)?t():(f(t)&&(t=l.clone(t),l.each(t,function(e,n){t[n]=o(e)})),t)}var a=t("backbone.epoxy"),r=t("backbone"),c=t("../component/colorPicker/react/ColorSelectorWrapper"),l=t("underscore"),d=t("../component/colorPicker/util/colorConvertUtil"),s={optionText:"label",optionValue:"value",optionClass:"className"},u=function(t){return t instanceof r.Collection},h=function(t){return t instanceof r.Model},v=l.isFunction,f=l.isObject;a.binding.addHandler("optionsWithAdditionalProperties",{init:function(t,e,n,i){this.e=i.optionsEmpty,this.d=i.optionsDefault,this.v=i.value},set:function(t,e){var n=this,i=o(n.e),a=o(n.d),r=o(n.v),c=u(e)?e.models:e,d=c.length,s=!0,h="";d||a||!i?(a&&(c=[a].concat(c)),l.each(c,function(t,e){h+=n.opt(t,d)})):(h+=n.opt(i,d),s=!1),t.html(h).prop("disabled",!s).val(r),t[0].selectedIndex<0&&t.children().length&&(t[0].selectedIndex=0);var v=t.val();n.v&&!l.isEqual(r,v)&&n.v(v)},opt:function(t,e){var n,i=t,o=t,a=t,r=s.optionText,c=s.optionValue,l=s.optionClass;return f(t)&&(i=h(t)?t.get(r):t[r],o=h(t)?t.get(c):t[c],a=h(t)?t.get(l):t[l]),n=a?'class="'+a+'"':"",['<option value="',o,'"',n,">",i,"</option>"].join("")}}),a.binding.addHandler("validationErrorClass",{init:function(t,e,n,o){this.attr=i(t,"validationErrorClass");var a=this.view.model;this._onAttrValidated=function(e,n,i){t[i?"addClass":"removeClass"]("error")},a.on("validate:"+this.attr,this._onAttrValidated)},get:function(t,e,n){return t.val()},set:function(t,e){t.val(e)},clean:function(){this.view.model.off("validate:"+this.attr,this._onAttrValidated)}}),a.binding.addHandler("validationErrorText",{init:function(t,e,n,o){this.attr=i(t,"validationErrorText");var a=this.view.model;this._onAttrValidated=function(e,n,i){t.text(i||"")},a.on("validate:"+this.attr,this._onAttrValidated)},get:function(t,e,n){return t.val()},set:function(t,e){t.val(e)},clean:function(){this.view.model.off("validate:"+this.attr,this._onAttrValidated)}}),a.binding.addFilter("escapeCharacters",{get:function(t){return l.escape(t)},set:function(t){return l.unescape(t)}}),a.binding.addHandler("colorpicker",{init:function(t,e,n,o){var a=this,r=!!t.data("showTransparentInput"),l=i(t,"colorpicker"),d=this._getColorSelectorState(e);this.colorPicker=new c(t[0],{showTransparentPreset:r,color:d.color,label:d.label,onColorChange:function(t){n[l](a._convertColorForModel(t))}})},get:function(t,e,n){return t.val()},set:function(t,e){var n=this._getColorSelectorState(e);this.colorPicker.setState(n)},clean:function(){this.colorPicker.remove()},_getColorSelectorState:function(t){var e=d.rgba2NoAlphaHex(t),n=e;return d.isRgbTransparent(t)&&(e="TRANSP",n="transparent"),{label:e,color:n}},_convertColorForModel:function(t){var e=t.rgb;return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")")}}),a.binding.addHandler("radioDiv",{init:function(t,e,n,o){var a=i(t,"radioDiv");this.callback=function(){var e=t.data("value");n[a](e)},t.on("click",l.bind(this.callback,this))},get:function(t,e,n){return t.data("value")},set:function(t,e){var n=t.siblings("div[data-bind*='radioDiv:']");t.data("value")===e&&(t.addClass("checked"),t.children(".radioChild").addClass("checked"),n.removeClass("checked"),n.children(".radioChild").removeClass("checked"))}}),a.binding.addHandler("checkboxDiv",{init:function(t,e,n,o){var a=i(t,"checkboxDiv");this.callback=function(){n[a](!n[a]())},t.on("click",l.bind(this.callback,this))},get:function(t,e,n){return t.data("value")},set:function(t,e){e?(t.addClass("checked"),t.children(".checkboxChild").addClass("checked")):(t.removeClass("checked"),t.children(".checkboxChild").removeClass("checked"))}}),a.binding.addHandler("slide",function(t,e){t[e?"slideDown":"slideUp"]({complete:function(){!e&&t.hide()}})}),a.binding.addHandler("selectionRange",{get:function(t,e,n){return{selectionRange:{start:t[0].selectionStart,end:t[0].selectionEnd}}},set:function(t,e){t.is(":visible")&&(t[0].setSelectionRange(e.start,e.end),t.focus())}}),a.binding.addFilter("prependText",function(t,e){return"'"===e.charAt(0)&&"'"===e.charAt(e.length-1)&&(e=e.slice(1,e.length-1)),e+" "+(l.isUndefined(t)?"":t)}),n.exports=a});