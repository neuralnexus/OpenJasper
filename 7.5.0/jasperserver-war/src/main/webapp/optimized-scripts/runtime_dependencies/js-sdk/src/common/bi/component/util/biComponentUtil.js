define(["require","exports","module","tv4","jquery","backbone","underscore","../../../logging/logger","../../error/biComponentErrorFactory","underscore.string"],function(e,r,n){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){if(e&&e instanceof f.Model&&e.get("_destroyed"))throw l.alreadyDestroyedError()}function i(e){var r=e;if(e.subErrors&&e.subErrors.length){var n=s.filter(e.subErrors,function(e){return e.code!=u.errorCodes.ENUM_MISMATCH});if(n.length>0)r=i(n[0]);else{s.all(e.subErrors,function(e){return!s.isUndefined(e.subErrors)})&&(r=s.max(e.subErrors,function(e){var r=e.dataPath;return s.count(r,"/")}))}}return r}function c(e){return"object"===("undefined"==typeof HTMLElement?"undefined":t(HTMLElement))?e instanceof HTMLElement:e&&"object"===t(e)&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}var u=e("tv4"),a=e("jquery"),f=e("backbone"),s=e("underscore"),d=e("../../../logging/logger"),l=e("../../error/biComponentErrorFactory");e("underscore.string");var p=d.register("biComponentUtil"),y={cloneDeep:function(e){return s.cloneDeep(e,function(e){if(e instanceof a)return e;if(s.isArray(e)&&e.parameters){var r=s.cloneDeep(e);return r.parameters=s.cloneDeep(e.parameters),r}})},createField:function(e,r,n,t,i){e[r]=function(c){if(o(i),!arguments.length)return y.ES5Object(y.cloneDeep(n[r]));var u=y.cloneDeep(c);if(t&&t.length)for(var a=0;a<t.length;a++)delete u[t[a]];return n[r]=s.extend({},n[r],u),void 0!==i&&"properties"==r&&i.set(y.cloneDeep(n[r])),e}},createReadOnlyField:function(e,r,n,t,i){e[r]=function(c){if(o(i),!arguments.length)return y.ES5Object(y.cloneDeep(n[r]));if(t)throw new Error("The field '"+r+"' cannot be set at this moment.");return e}},createProperty:function(e,r,n,t){e[r]=function(i){return o(t),arguments.length?(n.properties[r]=i,t&&t instanceof f.Model&&t.set(r,y.cloneDeep(n.properties[r])),e):n.properties[r]}},createReadOnlyProperty:function(e,r,n,t,i){e[r]=function(c){if(o(i),!arguments.length)return n.properties[r];if(t)throw new Error("The property '"+r+"' cannot be set at this moment.");return e}},createValidateAction:function(e,r,n){return function(){return o(n),y.validateObject(r,e.properties)}},createInstancePropertiesAndFields:function(e,r,n,t,o,i){function c(e,r){return y.createField(e,r,this,!1,i),e}function u(e,r){return y.createReadOnlyField(e,r,this,!0,i),e}function a(e,r){return y.createProperty(e,r,this,i),e}s.reduce(n,s.bind(a,r),e),s.reduce(t,s.bind(c,r),e),s.reduce(o,s.bind(u,r),e)},createDeferredAction:function(){var e=arguments;return function(r,n,t){var o=new a.Deferred;r&&s.isFunction(r)&&o.done(r),n&&s.isFunction(n)&&o.fail(n),t&&s.isFunction(t)&&o.always(t);try{var i=e[0],c=e[1],u=Array.prototype.slice.call(e,2);if(c.get("_destroyed")){var f=l.alreadyDestroyedError();p.error(f.toString()),o.reject(f)}else u.unshift(o),i.apply(this,u)}catch(e){var d=l.javaScriptException(e);p.error(d.toString()),o.reject(d)}return o}},validateObject:function(e,r){var n=u.validateResult(r,e,!1,!0);if(!n.valid)return i(n.error)},ES5Object:function(e){return s.isArray(e)?this.ES5Array(e):(s.isObject(e)&&s.each(s.keys(e),function(r){y.ES5Object(e[r])}),e)},ES5Array:function(e){if(!s.isArray(e))throw new Error("Must be array!",e);return e.indexOf||(e.indexOf=s.bind(s.indexOf,e,e)),e.lastIndexOf||(e.lastIndexOf=s.bind(s.lastIndexOf,e,e)),e.forEach||(e.forEach=s.bind(s.each,e,e)),e.every||(e.every=s.bind(s.every,e,e)),e.some||(e.some=s.bind(s.some,e,e)),e.map||(e.map=s.bind(s.map,e,e)),e.filter||(e.filter=s.bind(s.filter,e,e)),e.reduce||(e.reduce=s.bind(s.reduce,e,e)),e.reduceRight||(e.reduceRight=s.bind(s.reduceRight,e,e)),e},bindContextToArgument:function(e,r){if(!r)return r;if(s.isFunction(r.done)&&s.isFunction(r.fail)&&s.isFunction(r.progress)){var n=a.Deferred();return r.progress(function(){n.notifyWith(e,arguments)}),r.fail(function(){n.rejectWith(e,arguments)}),r.done(function(){n.resolveWith(e,arguments)}),n}if(s.isString(r.jquery))return r;if(c(r))return r;if(s.isFunction(r))return s.bind(r,e);if(s.isArray(r)){var t=s.map(r,function(r){return y.bindContextToArgument(e,r)});return r.parameters&&(t.parameters=s.cloneDeep(r.parameters)),t}return s.isObject(r)?s.reduce(r,function(r,n,t){return r[t]=y.bindContextToArgument(e,n),r},{}):r}};n.exports=y});