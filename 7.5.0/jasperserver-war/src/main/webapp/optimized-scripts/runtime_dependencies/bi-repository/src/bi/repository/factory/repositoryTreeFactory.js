define(["require","exports","module","runtime_dependencies/js-sdk/src/common/component/tree/Tree","jquery","underscore","bundle!CommonBundle","runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer","../dialog/processor/factory/processorFactory","runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin","../enum/repositoryResourceTypes","../enum/olapConnectionTypesEnum","../util/resourcesTreeGetDataUriFnUtil","../util/extractRootLevelDataFromHtmlResponse","text!../dialog/resourceChooser/template/repositoryFolderChooserDialogTooltipTemplate.htm","text!../dialog/resourceChooser/template/repositoryFoldersTreeLevelTemplate.htm","runtime_dependencies/js-sdk/src/jrs.configs"],function(e,t,r){function o(e){var t=d.extend({},{i18n:y,contentTemplate:v},e.tooltipOptions);return e.constr||m.use(h,t).create()}function s(e){e=e||{};var t=e.processors=d.map(e.processors,function(e){return T(e)});return o(e).instance({listItemHeight:R,bufferSize:e.treeBufferSize||U,additionalCssClasses:"folders",collapserSelector:e.collapserSelector,openClass:e.openClass,closedClass:e.closedClass,levelDataId:"uri",itemsTemplate:e.treeItemsTemplate||x,collapsed:!0,lazyLoad:!0,rootless:!0,getDataUri:C({getFolderUri:u,contextPath:P.contextPath,recursive:!1,type:e.types,containerType:e.containerType,forceTotalCount:!0,forceFullPage:!0}),selection:{allowed:!0,multiple:!1},customDataLayers:{"/":a(e)},processors:t,getDataArray:function(e){if(e&&e[g.RESOURCE_LOOKUP]){e=e[g.RESOURCE_LOOKUP];var t=this.levelDataId;return d.first(e)[t].match(/^\/public/)||(e=d.map(e,function(e){return e.uri="/root"+e[t],e})),e}return[]},getDataSize:function(e,t,r){return+r.getResponseHeader("Total-Count")},getDataLayer:l})}function n(e){var t=[],r=T("filterPublicFolderProcessor");return d.each(e,function(e){e!==r&&t.push(e)}),t}function a(e){var t=e.processors,r=n(t);return d.extend(new f({dataUriTemplate:e.contextPath+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:r,getDataArray:function(e){e=L(e);var t=d.find(e.children,function(e){return"/public"===e.uri}),r=[{id:"/root",label:e.label,uri:"/",resourceType:"folder",permissionMask:p(e.extra),_links:{content:"@fakeContentLink"}}];return t&&r.push({id:"/public",label:t.label,uri:"/public",resourceType:"folder",permissionMask:p(t.extra),_links:{content:"@fakeContentLink"}}),r}}),{accept:"text/html",dataType:"text"})}function i(e){var t=c(),r=e.processors;return o(e).instance({itemsTemplate:e.treeItemsTemplate||x,listItemHeight:R,selection:{allowed:!0,multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,getDataUri:C({getFolderUri:u,contextPath:P.contextPath,recursive:!0,type:e.types,containerType:e.containerType,forceTotalCount:!0,forceFullPage:!0}),levelDataId:"uri",cache:{searchKey:"searchString",pageSize:100},processors:r,customDataLayers:{olapDataLayer:t},getDataLayer:l,getDataArray:function(e){return e&&e[g.RESOURCE_LOOKUP]?e[g.RESOURCE_LOOKUP]:[]},getDataSize:function(e,t,r){return+r.getResponseHeader("Total-Count")}})}function c(){return new f({requestType:"POST",dataUriTemplate:P.contextPath+"/rest_v2/connections",processors:[T("i18nItemProcessor"),T("cssClassItemProcessor")],levelDataId:"uri",getDataArray:function(e){return e&&e[g.RESOURCE_LOOKUP]?e[g.RESOURCE_LOOKUP]:[]}})}function l(e){var t;if(e=e.item?e:this.getLevel(e.id)){if(t=e.item.value.resourceType,d.contains(D,t)){var r=d.clone(this.customDataLayers.olapDataLayer);return d.extend(r,{accept:"application/repository."+t+".metadata+json",contentType:"application/repository."+t+"+json",data:JSON.stringify(t)}),r}return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer}}function u(e){return e.match(/^\/root/)?e.replace("/root",""):e}function p(e){var t=2;return e.isWritable&&(t|=4),e.isRemovable&&(t|=16),e.isAdministrable&&(t=1),t}var m=e("runtime_dependencies/js-sdk/src/common/component/tree/Tree"),d=(e("jquery"),e("underscore")),y=e("bundle!CommonBundle"),f=e("runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer"),T=e("../dialog/processor/factory/processorFactory"),h=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin"),g=e("../enum/repositoryResourceTypes"),D=e("../enum/olapConnectionTypesEnum"),C=e("../util/resourcesTreeGetDataUriFnUtil"),L=e("../util/extractRootLevelDataFromHtmlResponse"),v=e("text!../dialog/resourceChooser/template/repositoryFolderChooserDialogTooltipTemplate.htm"),x=e("text!../dialog/resourceChooser/template/repositoryFoldersTreeLevelTemplate.htm"),P=e("runtime_dependencies/js-sdk/src/jrs.configs"),R=22,U=5e3,O=function(e){if(e=e||{},!e.types)throw"Resources types required";return e.listView?i(e):s(e)};O.settings=P,r.exports=O});