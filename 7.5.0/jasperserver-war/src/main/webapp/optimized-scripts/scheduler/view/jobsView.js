define(["require","exports","module","jquery","underscore","bundle!all","backbone","../../util/utils.common","runtime_dependencies/js-sdk/src/common/util/domUtil","../../util/touch.controller","../../util/tools.infiniteScroll","./jobView","../collection/jobsCollection","text!../template/jobsViewTemplate.htm","text!../template/masterViewTemplate.htm","text!../template/list/listOfJobsTemplate.htm","text!../template/list/nothingToDisplayTemplate.htm"],function(e,t,i){var o=e("jquery"),n=e("underscore"),s=e("bundle!all"),l=e("backbone"),r=e("../../util/utils.common"),c=r.isSupportsTouch,a=r.isIPad,h=e("runtime_dependencies/js-sdk/src/common/util/domUtil"),d=e("../../util/touch.controller"),u=e("../../util/tools.infiniteScroll"),m=e("./jobView"),b=e("../collection/jobsCollection"),p=e("text!../template/jobsViewTemplate.htm"),f=e("text!../template/masterViewTemplate.htm"),w=e("text!../template/list/listOfJobsTemplate.htm"),j=e("text!../template/list/nothingToDisplayTemplate.htm");i.exports=l.View.extend({events:{"click [name=backButton]":"backButtonClick","click [name=scheduleJob]":"createButtonClick","click [name=runJob]":"runButtonClick","click [name=refreshList]":"refreshButtonClick","keydown [name=jobSearchInput]":"jobSearchInputKeyDown","click [name=jobSearchIcon]":"jobSearchIconClick","click [name=jobSearchClear]":"clearJobSearch"},initialize:function(e){this.options=n.extend({},e),this.options=n.omit(this.options,"model"),this.jobsViewCollection=new b(null,this.options),this.listenTo(this.jobsViewCollection,"add",this.createAndAddJobView),this.listenTo(this.jobsViewCollection,"reset destroy",this.renderCollection)},refresh:function(){this.jobsViewCollection.fetch()},searchJobs:function(){var e=this.$el.find("[name=jobSearchInput]").val();e&&(this.$el.find("[name=jobSearchClear]").addClass("up"),this.jobsViewCollection.setSearchingTerm(e),this.jobsViewCollection.fetch())},clearJobSearch:function(){this.$el.find("[name=jobSearchClear]").removeClass("up"),this.$el.find("[name=jobSearchInput]").val(""),this.jobsViewCollection.setSearchingTerm(""),this.jobsViewCollection.fetch()},render:function(){var e=this.options.masterViewMode?f:p,t={i18n:s,reportUri:this.options.reportUri,searchTerm:this.jobsViewCollection.getSearchingTerm()};this.setElement(o(n.template(e,t))),this.renderCollection()},renderCollection:function(){var e=this.$el.find("[name=jobsContainer]").empty();this.jobsViewCollection.length?(e.append(o(n.template(w,{}))),this.jobsViewCollection.each(n.bind(this.createAndAddJobView,this)),this.initInfiniteScroll(),this.adjustTableHeaderWidth()):e.append(o(n.template(j,{message:this.options.masterViewMode?s["report.scheduling.list.no.jobs"]:s["report.scheduling.list.no.jobs.for.report"]})))},initInfiniteScroll:function(){var e=this.$el.find("#listOfJobs")[0],t=this.$el.find("#jobsSummaryContainer")[0];this.options.masterViewMode&&e&&(c()&&(this._touchController||(this._touchController=new d(e,e.up(),{forceLayout:!0})),this.listenTo(e,"layout_update orientationchange",function(){o(e).css("min-width",o(t).width()+"px"),e.width(o(t).width())})),a()?this._infiniteScroll=new u({control:t,content:e,scroll:this._touchController||void 0}):this._infiniteScroll=new u({control:t,content:e}),this._infiniteScroll.onLoad=n.bind(function(){this._infiniteScroll.wait(),this.jobsViewCollection.loadMoreJobs(),this._infiniteScroll.stopWaiting()},this))},adjustTableHeaderWidth:function(){var e=this.$el.find(".content > .subheader .wrap"),t=this.$el.find(".content > .body"),i=h.hasScrollBar(t[0],"vertical");e.css("margin-right",(i?15:0)+"px")},jobSearchInputKeyDown:function(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.clearJobSearch()),13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.searchJobs())},jobSearchIconClick:function(){this.searchJobs()},createAndAddJobView:function(e){var t=new m({model:e,masterViewMode:this.options.masterViewMode});this.listenTo(t,"editJobPressed",this.editJobPressed);var i=t.render().$el;this.$el.find("[name=listOfJobs]").append(i)},editJobPressed:function(e){this.trigger("editJobPressed",e)},backButtonClick:function(){this.trigger("backButtonPressed")},createButtonClick:function(){this.trigger("createNewJobRequest")},runButtonClick:function(){this.trigger("runNowRequest")},refreshButtonClick:function(){this.refresh()}})});