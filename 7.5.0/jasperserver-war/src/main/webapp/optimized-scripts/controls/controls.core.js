define(["require","exports","module","prototype","../namespace/namespace","../core/core.ajax","underscore","../components/components.dialogs","jquery","./controls.logging"],function(e,t,n){var o=e("prototype"),r=o.$,i=e("../namespace/namespace"),a=i.JRS,s=e("../core/core.ajax"),c=s.ajax,u=e("underscore"),l=e("../components/components.dialogs"),d=e("jquery");e("./controls.logging"),a.Controls=function(e,t,n){function o(e){return function(n){return t.template(e)(t.defaults({data:void 0,uuid:void 0,message:void 0,description:void 0},n))}}var i=navigator.userAgent.toLowerCase().indexOf("msie")>-1;return{Base:t.extend(function(){},{extend:function(e,n){var o,r=this;o=e&&t.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},t.extend(o,r,n);var i=function(){this.constructor=o};return i.prototype=r.prototype,o.prototype=new i,e&&t.extend(o.prototype,e),o.__super__=r.prototype,o}}),TemplateEngine:{render:function(e,n,r){if(!r)return o(e)(n);if(r==this.STD_PLACEHOLDERS){var i=String(e);return t.each(n,function(e,t){var n=new RegExp("\\{"+t+"\\}");i=i.replace(n,e)}),i}},renderUrl:function(e,n,o){var r=t.template(e)(n);return i&&!o&&(r=encodeURI(r)),r},getTemplateText:function(t){return e("#"+t).html()},createTemplate:function(t){var n=e("#"+t),r=n.html();if(r&&r.length>0)return o(r)},createTemplateSection:function(e,t){var n="\x3c!--#val--\x3e(\\s|\\S)*\x3c!--/val--\x3e",r=n.replace(/val/g,e),i=new RegExp(r,"g");return o(this.getTemplateText(t).match(i)[0])},STD_PLACEHOLDERS:"std_placeholder"},Utils:{LOADING_DIALOG_DELAY:800,INPUT_CONTROLS_COMPONENT_ID:"input-controls",isElementInDom:function(e){var t=e.nextSibling,n=e.parentNode&&11!==e.parentNode.nodeType;return t||n},setInnerHtml:function(n,o,r){var a,s,c;if(this.isElementInDom(n)&&(a=n.nextSibling,s=n.parentNode,c=n.style.display,n.style.display="none",s.removeChild(n)),e(n).html(""),i&&"SELECT"==n.tagName){var u=document.createDocumentFragment();t.each(r.data,function(n){var o=document.createElement("OPTION");o.value=t.isUndefined(n.value)?n.id:n.value,e(o).html(n.label),n.selected&&o.setAttribute("selected","selected"),u.appendChild(o)}),n.appendChild(u)}else e(n).html(o(r));if(a?s.insertBefore(n,a):s.appendChild(n),n.style.display=c,i&&"SELECT"==n.tagName){var l=n.getAttribute("style");n.removeAttribute("style"),n.setAttribute("style",l)}},wait:function(t){return e.Deferred(function(e){setTimeout(e.resolve,t)})},showLoadingDialogOn:function(o,i,a){this.wait(i||this.LOADING_DIALOG_DELAY).then(t.bind(function(){"pending"==o.state()&&(n.popup.showShared(r(c.LOADING_ID),a,{focus:!1,owner:this.INPUT_CONTROLS_COMPONENT_ID}),e.when(o).always(t.bind(function(){var e=this.INPUT_CONTROLS_COMPONENT_ID;this.wait(500).then(function(){window.viewer&&window.viewer.loading?window.viewer.loaded&&n.popup.hideShared(r(c.LOADING_ID),e):n.popup.hideShared(r(c.LOADING_ID),e)})},this)))},this))},createTimer:function(t){var n=new e.Deferred;return n.done(function(e){var n=(new Date).getTime(),o=n-e;console.log(t+" took time: "+o+" msec.")}),{start:function(){return this.startTime=(new Date).getTime(),this},stop:function(){return n.resolve(this.startTime),this}}}},listen:function(n,o){t.each(n,function(n,o){e(document).on(o,t.bind(n,this))},o||this)},ignore:function(t,n){e(document).off(t,n)}}}(d,u,l),window.Controls=a.Controls,n.exports=a.Controls});