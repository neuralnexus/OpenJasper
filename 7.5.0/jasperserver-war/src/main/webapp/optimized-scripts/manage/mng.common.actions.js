define(["require","exports","module","runtime_dependencies/js-sdk/src/common/component/dialog/ConfirmationDialog","./mng.org.module"],function(t,e,n){var i=t("runtime_dependencies/js-sdk/src/common/component/dialog/ConfirmationDialog"),o=t("./mng.org.module");o.serverActionFactory={browse:function(t){return this.createAction(o.ActionMap.BROWSE,t)},search:function(t){return this.createAction(o.ActionMap.SEARCH,t)},next:function(t){return this.createAction(o.ActionMap.NEXT,t)},selectAndGetDetails:function(t){return this.createAction(o.ActionMap.SELECT_AND_GET_DETAILS,t)},searchAvailable:function(t){return this.createAction(o.ActionMap.SEARCH_AVAILABLE,t)},searchAssigned:function(t){return this.createAction(o.ActionMap.SEARCH_ASSIGNED,t)},nextAvailable:function(t){return this.createAction(o.ActionMap.NEXT_AVAILABLE,t)},nextAssigned:function(t){return this.createAction(o.ActionMap.NEXT_ASSIGNED,t)},create:function(t){var e=t.entity,n={entity:Object.toJSON(e)};return this.createAction(o.ActionMap.CREATE,n)},update:function(t){var e=t.entityName,n={entityName:e,entity:Object.toJSON(t.entity),assignedEntities:Object.toJSON(t.assigned),unassignedEntities:Object.toJSON(t.unassigned)};return this.createAction(o.ActionMap.UPDATE,n,t.unencryptedEntity)},deleteAll:function(t){var e=t.entities,n={entities:Object.toJSON(e.collect(function(t){return t.getNameWithTenant()}))};return this.createAction(o.ActionMap.DELETE_ALL,n)},delete:function(t){var e=t.entity,n=t.entityEvent,i={entity:e.getNameWithTenant(),entityEvent:n};return this.createAction(o.ActionMap.DELETE,i)},exist:function(t){var e=t.entity,n={entityName:e.getNameWithTenant()},i=new o.ServerAction(o.ActionMap.EXIST,n);return i.onSuccess=function(e){e.exist?t.onExist&&t.onExist(e.uniqueId):t.onNotExist&&t.onNotExist()},i.onError=function(e){o.fire(o.Event.SERVER_ERROR,{inputData:t,responseData:e})},i},createAction:function(t,e,n){var i,c=new o.ServerAction(t,e);if(t==o.ActionMap.BROWSE)i=o.Event.RESULT_CHANGED;else if(t==o.ActionMap.SEARCH)i=o.Event.RESULT_CHANGED;else if(t==o.ActionMap.NEXT)i=o.Event.RESULT_NEXT;else if(t==o.ActionMap.SELECT_AND_GET_DETAILS)i=o.Event.ENTITY_DETAILS_LOADED;else if(t==o.ActionMap.SEARCH_AVAILABLE)i=o.Event.SEARCH_AVAILABLE_LOADED;else if(t==o.ActionMap.SEARCH_ASSIGNED)i=o.Event.SEARCH_ASSIGNED_LOADED;else if(t==o.ActionMap.NEXT_AVAILABLE)i=o.Event.NEXT_AVAILABLE_LOADED;else if(t==o.ActionMap.NEXT_ASSIGNED)i=o.Event.NEXT_ASSIGNED_LOADED;else if(t==o.ActionMap.CREATE)i=o.Event.ENTITY_CREATED;else if(t==o.ActionMap.UPDATE)i=o.Event.ENTITY_UPDATED;else if(t==o.ActionMap.DELETE_ALL)i=o.Event.ENTITIES_DELETED;else{if(t!=o.ActionMap.DELETE)throw new Error("Unexpected action name '"+t+"'");i=o.Event.ENTITY_DELETED}return c.onSuccess=function(t){o.fire(i,{inputData:e,unencryptedEntity:n,responseData:t})},c.onError=function(t){o.fire(o.Event.SERVER_ERROR,{inputData:e,unencryptedEntity:n,responseData:t})},c}},o.clientActionFactory={create:function(){var t;o.manager.tenantsTree&&(t=o.manager.tenantsTree.getTenant());var e=o.entityList.getSelectedEntities(),n=function(){return o.invokeClientAction("cancelIfEdit",{entity:e[0]})};return new o.Action(function(){o.entityList.deselectAll(),o.addDialog.show(t)},n)},deleteAll:function(){var t=o.entityList.getSelectedEntities(),e=function(){return o.invokeClientAction("cancelIfEdit",{entity:t[0]})};return new o.Action(function(){var e=o.getMessage("deleteAllMessage",{count:t.length}),n=new i({text:e});n.on("button:yes",function(){o.invokeServerAction(o.ActionMap.DELETE_ALL,{entities:t})}),n.open()},e)},delete:function(t){var e=t.entity,n=t.entityEvent;return new o.Action(function(){var t=o.getMessage("deleteMessage",{entity:e.getDisplayName()}),c=new i({text:t});c.on("button:yes",function(){o.invokeServerAction(o.ActionMap.DELETE,{entity:e,entityEvent:n})}),c.open()})},cancelIfEdit:function(t){t=t||{};var e=t.entity||o.manager.tenantsTree&&o.manager.tenantsTree.getTenant(),n=void 0===t.showConfirm||t.showConfirm,i=void 0===t.entityEvent||t.entityEvent,c=o.properties;return new o.Action(function(){return c.locked&&i||!(!c.isChanged()||n&&confirm(o.getMessage("cancelEdit",{entity:e.getDisplayName()})))?(!i&&c.lock(),!1):(c.isEditMode&&(c.lock(),c.cancel().done(function(){var t=c.getDetailsLoadedEntity(),e=!o.userManager||o.entityList.findEntity(t.fullName);c.unlock(),e?o.fire(o.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.id,cancelIfEdit:!0,entityEvent:!0}):c.hide()})),!0)})}},n.exports=o});