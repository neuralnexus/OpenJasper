define(["require","exports","module","prototype","../dynamicTree/dynamicTree.utils","../core/core.events.bis","../actionModel/actionModel.modelGenerator","../core/core.layout","../util/utils.common","../components/list.base"],function(t,e,n){var o=t("prototype"),i=o.$,s=o.$$,r=t("../dynamicTree/dynamicTree.utils"),c=t("../core/core.events.bis"),u=t("../actionModel/actionModel.modelGenerator"),a=t("../core/core.layout"),d=t("../util/utils.common"),h=d.isShiftHeld,l=t("../components/list.base"),T=l.dynamicList,f={ATTR_TAB_INDEX:"data-tab-index",ATTR_COMPONENT_TYPE:"data-component-type",delayTime:500,components:[],currentTabIndex:-1,disabled:!0,initialize:function(){s("*["+this.ATTR_TAB_INDEX+"]").each(function(t){var e=this.getTabIndex(t);e>0&&(this.components[e]=t)}.bind(this)),this.enable()},enable:function(){this.disabled=!1},disable:function(){this.disabled=!0},_focusByType:{tree:function(t){var e=t.readAttribute("id"),n=r.trees[e];if(n){var o=n.selectedNodes.last();o=o||(n.bShowRoot?n.getRootNode():n.getRootNode().getFirstChild()),o&&(o.isSelected()||o.select(),f._doFocus(o))}},list:function(t){var e=t.readAttribute("id"),n=T.lists[e];if(n){var o=n.getSelectedItems().last();o=o||n.getItems().first(),o&&(o.isSelected()||o.select(),f._doFocus(o))}},search:function(t){var e=t.down("input");e&&e.select(),f._doFocus(e)},navigation:function(t){var e=t.down("#main_home");c.over(e.down(a.BUTTON_PATTERN)),f._doFocus(e)},linkList:function(t){c.over(t.down("a")),f._doFocus(t)}},_blurByType:{navigation:function(t){u.hideMenu(),t.select(".over").each(function(t){c.out(t)})},linkList:function(t){t.select("a.over").each(function(t){c.out(t)})}},_doFocus:function(t){setTimeout(function(){t.focus()},this.delayTime)},_focusComponent:function(t){var e=t&&this.getType(t)&&this._focusByType[this.getType(t)];return e&&e(t)},_blurComponent:function(t){var e=t&&this.getType(t)&&this._blurByType[this.getType(t)];return e&&e(t)},findTabComponent:function(t){for(var e;t&&!e;)e=t.hasAttribute&&t.hasAttribute(this.ATTR_TAB_INDEX)&&t,t=i(t.parentNode);return e},getTabIndex:function(t){var e=-1;if(t&&t.hasAttribute){t.hasAttribute(this.ATTR_TAB_INDEX)||(t=f.findTabComponent(t));var n=t?t.readAttribute(this.ATTR_TAB_INDEX):this.currentTabIndex;try{n&&n.length>0&&(e=parseInt(n))}catch(t){}}return e},getType:function(t){return t&&t.hasAttribute(this.ATTR_COMPONENT_TYPE)?t.readAttribute(this.ATTR_COMPONENT_TYPE):void 0},getNext:function(t){var e=-1;if(this.components.length>0)for(t||(t=this.currentTabIndex),t<0&&(t=0),e=t+1;Object.isUndefined(this.components[e])&&e!=t;)++e<this.components.length||(e=0);return e},getPrevious:function(t){var e=-1;if(this.components.length>0)for(t||(t=this.currentTabIndex),t<0&&(t=0),e=t-1;Object.isUndefined(this.components[e])&&e!=t;)--e>-1||(e=this.components.length-1);return e},focusNext:function(t){this.focusByIndex(this.getNext(t))},focusPrevious:function(t){this.focusByIndex(this.getPrevious(t))},focusByIndex:function(t){t>-1&&(this.currentTabIndex=t)&&this._focusComponent(this.components[t])},blurCurrent:function(){var t=this.components[this.currentTabIndex];t&&this._blurComponent(t)},blurByIndex:function(t){var e=this.components[t];e&&this._blurComponent(e)}};document.observe("key:tab",function(t){if(!f.disabled){var e=f.getTabIndex(t.element());return f.blurCurrent(),h(t)?f.focusPrevious(e):f.focusNext(e),t.stop(),!1}}),n.exports=f});