define(["require","exports","module","backbone","underscore","xregexp","settings!dataSourcePatterns","../util/settingsUtility"],function(e,t,r){var n=e("backbone"),a=e("underscore"),i=e("xregexp"),u=e("settings!dataSourcePatterns"),s=e("../util/settingsUtility"),l=n.Model.extend({idAttribute:"jdbcDriverClass",defaults:{defaultValues:{},jdbcDriverClass:"",label:"",available:!1,isDefault:!1,jdbcUrl:"",uploaded:!1},initialize:function(e,t){var r=s.deepDefaults(t,{dataSourcePatterns:u});l.DYNAMIC_URL_PART_PATTERN=r.dataSourcePatterns.dynamicUrlPartPattern,l.VALIDATION_PATTERNS=a.reduce(r.dataSourcePatterns,function(e,t,r){return e[r]=i(t),e},{})},isOtherDriver:function(){return this.get("jdbcDriverClass")===l.OTHER_DRIVER},isUploadedDriver:function(){return!0===this.get("uploaded")},getCustomAttributes:function(){if(this.isOtherDriver())return[];var e=this._getRegExpFieldGroupsFromConnectionUrlTemplate(),t=[];return a.each(e,function(e){return t.push(e[1])}),t},convertUrlTemplateToRegex:function(){var e,t=this.get("jdbcUrl");t=t.replace(/\?/g,"\\?"),t=t.replace(/\[TMPDIR\/\]/g,"\\[TMPDIR/\\]");for(var r in l.VALIDATION_PATTERNS)e=new RegExp("\\$\\["+r+"\\]","g"),t=t.replace(e,l.DYNAMIC_URL_PART_PATTERN);return"^"+t},parse:function(e){return e.isDefault=!!e.isDefault,e.defaultValues&&(e.defaultValues=a.reduce(e.defaultValues,function(e,t){return e[t.key]=t.value,e},{})),e},_getRegExpFieldGroupsFromConnectionUrlTemplate:function(){for(var e,t=[],r=[];!a.isNull(e=l.FIELD_TEMPLATE_REGEXP.exec(this.get("jdbcUrl")));)a.isArray(e)&&2===e.length&&-1===r.indexOf(e[0])&&(t.push(e),r.push(e[0]));return t}},{FIELD_TEMPLATE_REGEXP:/\$\[([^\]]+)\]/g,OTHER_DRIVER:"other"});r.exports=l});