define(["require","exports","module","prototype","../core/core.layout","../util/utils.common","../components/components.dialogs","jquery","underscore"],function(t,o,n){var i=t("prototype"),e=i.$,r=i.$$,s=i.Template,a=i.$break,d=t("../core/core.layout"),u=t("../util/utils.common"),_=u.matchAny,l=t("../components/components.dialogs"),c=t("jquery"),O=t("underscore"),T={INPUT_CONTROLS_FORM:"inputControlsForm",INPUT_CONTROLS_CONTAINER:"inputControlsContainer",INPUT_CONTROLS_DIALOG:"inputControls",SAVE_REPORT_OPTIONS_DIALOG:"saveValues",REPORT_OPTIONS_SELECTOR:"savedValues",TOOLBAR_CONTROLS_BUTTON:"ICDialog",DEFAULT_OPTION_TEXT:"Options",NULL_SUBSTITUTION_VALUE:null,NULL_SUBSTITUTION_LABEL:null,NOTHING_SUBSTITUTION_VALUE:null,_BUTTON_OK:"ok",_BUTTON_SAVE:"save",_BUTTON_REMOVE:"remove",_BUTTON_APPLY:"apply",_BUTTON_CANCEL:"cancel",TEMP_REPORT_CONTAINER:"tempReportContainer",WRAPPER_ERROR_FLAG_PREFIX_SELECTOR:"div[id^=error_]",WRAPPERS_ERRORS_DIV:"wrappersErrors",EVAL_SCRIPT_ELEMENT_NAME:"_evalScript",CALENDAR_ICON_SPAN:'<span class="button picker calTriggerWrapper" />',_messages:{},getMessage:function(t,o){var n=this._messages[t];return n?new s(n).evaluate(o||{}):""},setControlError:function(t,o){t&&(t=e(t),o?(t.up().addClassName(d.ERROR_CLASS),t.nextSiblings()[0].update(o)):(t.up().removeClassName(d.ERROR_CLASS),t.nextSiblings()[0].update("")))},setControlsErrors:function(t){var o=r(T.WRAPPER_ERROR_FLAG_PREFIX_SELECTOR),n=0,i=-1;o.each(function(o){var e=!1;t&&t.each(function(t){if(o.id.indexOf(t[0])>-1)throw T.setControlError(o,t[1]),i<0&&(c("#inputControlsForm .leaf").each(function(t,o){t<n&&(i+=o.clientHeight)}),c(".groupBox .content .body")[0].scrollTop=i),e=!0,a;n++}),e||T.setControlError(o,"")})},buildParams:function(t){var o="";if(O.isObject(t)&&!O.isEmpty(t)){var n=function(t){return t.length>0&&"&"!=t[t.length-1]&&(t+="&"),t};O.each(t,function(t,i){o=n(o),O.isArray(t)?O.each(t,function(t){o=n(o),o+=i+"="+encodeURIComponent(t)}):o+=i+"="+encodeURIComponent(t)})}return o},buildSelectedDataUri:function(t,o){var n=T.buildParams(t);if(O.isObject(o)&&!O.isEmpty(o)){return n+"&"+T.buildParams(o)}return n}},h=function(t){var o=this;this._dom=e(T.INPUT_CONTROLS_DIALOG),this.buttonActions=t,c("#"+T.INPUT_CONTROLS_DIALOG).on("mouseup touchend","button",function(t){if(this.id&&!this.id.empty()&&!this.disabled){var n=o.buttonActions["button#"+this.id];n&&n()}})};h.addMethod("_dialogClickHandler",function(t){var o=t.element();for(var n in this.buttonActions)if(_(o,[n],!0))return this.buttonActions[n](),void t.stop()}),h.addMethod("show",function(){l.popup.show(this._dom)}),h.addMethod("hide",function(){l.popup.hide(this._dom)});var p=function(t){this._dom=e(T.SAVE_REPORT_OPTIONS_DIALOG),this.input=this._dom.select("input#savedValuesName")[0],this.overwrite=!1,this.buttonActions=t,this._dialogClickHandler=this._dialogClickHandler.bindAsEventListener(this),this._dom.observe("click",this._dialogClickHandler)};p.addMethod("remove",function(){this._dom.stopObserving("click",this._dialogClickHandler)}),p.addMethod("_dialogClickHandler",function(t){var o=t.element();for(var n in this.buttonActions)if(_(o,[n],!0))return this.buttonActions[n](),void t.stop()}),p.addMethod("show",function(){this.input.setValue(T.DEFAULT_OPTION_TEXT),l.popup.show(this._dom)}),p.addMethod("hide",function(){l.popup.hide(this._dom),this.hideWarning()}),p.addMethod("showWarning",function(t){var o=c("#"+T.SAVE_REPORT_OPTIONS_DIALOG).find(".warning");t&&o.text(t),o.show()}),p.addMethod("hideWarning",function(){var t=c("#"+T.SAVE_REPORT_OPTIONS_DIALOG).find(".warning");t.text(""),t.hide()}),o.ControlsBase=T,o.OptionsDialog=p,o.ControlDialog=h});