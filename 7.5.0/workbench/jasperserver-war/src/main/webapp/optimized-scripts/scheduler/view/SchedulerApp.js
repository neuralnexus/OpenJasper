define(["require","exports","module","jquery","underscore","bundle!all","backbone","requirejs-domready","runtime_dependencies/js-sdk/src/jrs.configs","../util/schedulerUtils","../model/jobModel","./jobsView","./jobEditorView","../../controls/controls.base"],function(e,t,i){var o=e("jquery"),s=e("underscore"),n=e("bundle!all"),r=e("backbone"),a=e("requirejs-domready"),d=e("runtime_dependencies/js-sdk/src/jrs.configs"),c=e("../util/schedulerUtils"),u=e("../model/jobModel"),h=e("./jobsView"),b=e("./jobEditorView"),l=e("../../controls/controls.base"),p=l.ControlsBase;a(function(){s.extend(p,d.inputControlsConstants)}),i.exports=r.View.extend({className:"schedulerApp",jobsView:!1,initialize:function(e){this.options=s.extend({},e),this.runInBackgroundMode=0===document.location.hash.indexOf("#runInBackground@"),c.saveCurrentLocation(),this.schedulerStartupParams=c.getParamsFromUri(),this.masterViewMode=!this.schedulerStartupParams.reportUnitURI,this.childViewInitParams={model:new u,runInBackgroundMode:this.runInBackgroundMode,masterViewMode:this.masterViewMode,reportUri:this.schedulerStartupParams.reportUnitURI,parentReportURI:this.schedulerStartupParams.parentReportURI||null},o.ajaxSetup({headers:{"X-Suppress-Basic":!0}}),o(document).on("ajaxError",function(e,t,i,o){401!==t.status&&"Unauthorized"!==o||location.reload()}),this.runInBackgroundMode?this.runNowRequest():this.openJobsListInterface()},prepareJobsView:function(){this.jobsView||(this.jobsView=new h(this.childViewInitParams),this.listenTo(this.jobsView,"createNewJobRequest",this.createNewJobRequest),this.listenTo(this.jobsView,"runNowRequest",this.runNowRequest),this.listenTo(this.jobsView,"backButtonPressed",this.backButtonPressed),this.listenTo(this.jobsView,"editJobPressed",this.openEditJobInterface))},prepareJobEditorView:function(){this.jobEditorView&&this.jobEditorView.remove(),this.jobEditorView=new b(this.childViewInitParams),this.listenTo(this.jobEditorView,"errorEditingJob",this.errorEditingJob),this.listenTo(this.jobEditorView,"cancelJobCreation",this.cancelJobCreation),this.listenTo(this.jobEditorView,"jobHasBeenCreated",this.jobHasBeenCreated)},openJobsListInterface:function(){this.prepareJobsView(),this.$el.empty(),this.jobsView.render(),this.$el.append(this.jobsView.$el),this.jobsView.refresh(),document.title=n["company.name"]+": "+n["report.scheduling.list.title"]},createNewJobRequest:function(){this._openNewJobInterface(!1)},runNowRequest:function(){this._openNewJobInterface(!0)},editJob:function(e){this.openEditJobInterface(e)},_openNewJobInterface:function(e){this.prepareJobEditorView(),this.jobEditorView.setRunNowMode(e),this.$el.empty(),this.jobEditorView.renderCreateNewJobInterface(),this.$el.append(this.jobEditorView.$el),this.jobEditorView.prepareModelForCreatingNewJob(),document.title=n["company.name"]+": "+n["report.scheduling.job.edit.title"]},openEditJobInterface:function(e){this.prepareJobEditorView(),this.$el.empty(),this.jobEditorView.editExistingJob(e),this.$el.append(this.jobEditorView.$el),document.title=n["company.name"]+": "+n["report.scheduling.job.edit.title"]},backButtonPressed:function(){c.getBackToPreviousLocation()},errorEditingJob:function(){this.openJobsListInterface()},cancelJobCreation:function(){this.runInBackgroundMode?c.getBackToPreviousLocation():this.openJobsListInterface()},jobHasBeenCreated:function(){this.runInBackgroundMode?c.getBackToPreviousLocation():this.openJobsListInterface()}})});