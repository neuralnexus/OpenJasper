define(["require","exports","module","prototype","./components.webHelp","./components.dialogs","../core/core.layout","../util/utils.common","jquery"],function(s,e,o){var a=s("prototype"),t=a.$,i=s("./components.webHelp"),n=s("./components.dialogs"),r=s("../core/core.layout"),d=s("../util/utils.common"),h=d.ValidationModule,_=s("jquery"),l={LOGIN_BOX_TEMPLATE_DOM_ID:"login",DOCUMENTATION_BUTTON_ID:"documentationButton",GOTO_JASPERFORGE_BUTTON_ID:"gotoJasperForge",CONTACT_SALES_BUTTON_ID:"contactSalesButton",NEED_HELP_LINK_ID:"needHelp",NEED_HELP_DIALOG_ID:"helpLoggingIn",CONTACT_SALES_URL:"http://www.jaspersoft.com/contact-us",_dom:null,_baseInitialize:function(s){this._initVars(s),this._processTemplate(),this._initHandlers(),this._warningMessage&&(this._customError.update(this._warningMessage),this._customError.removeClassName("hidden")),this._passwordExpiredDays&&this._passwordExpiredDays.setValue(this._passwordExpirationInDays)},initialize:function(s){this._baseInitialize(s)},_baseInitVars:function(s){this._showLocaleMessage=s.showLocaleMessage,this._hideLocaleMessage=s.hideLocaleMessage,this._changePasswordMessage=s.changePasswordMessage,this._cancelPasswordMessage=s.cancelPasswordMessage,this._allowUserPasswordChange=s.allowUserPasswordChange,this._showPasswordChange=s.showPasswordChange,this._allowedPasswordPattern=new RegExp(s.allowedPasswordPattern),this._passwordExpirationInDays=s.passwordExpirationInDays,this._nonEmptyPasswordMessage=s.nonEmptyPasswordMessage,this._passwordNotMatchMessage=s.passwordNotMatchMessage,this._passwordNotMatchMessage=s.passwordNotMatchMessage,this._passwordTooWeakMessage=s.passwordTooWeakMessage,this._warningMessage=s.warningMessage},_initVars:function(s){this._baseInitVars(s)},_baseProcessTemplate:function(){this._dom=t(this.LOGIN_BOX_TEMPLATE_DOM_ID),this._usernameInput=t("j_username"),this._passwordInput=t("j_password"),this._showHideLocaleAndTimezone=t("showHideLocaleAndTimezone"),this._localeAndTimeZone=t("localeAndTimeZone"),this._userLocale=t("userLocale"),this._changePassword=t("changePassword"),this._j_newpassword1=t("j_newpassword1"),this._j_newpassword2=t("j_newpassword2"),this._showHideChangePassword=t("showHideChangePassword"),this._passwordExpiredDays=this._dom.select('input[name="passwordExpiredDays"]')[0],this._customError=t("customError"),this._loginForm=this._dom.up("form"),this.documentationButton=t(this.DOCUMENTATION_BUTTON_ID),this.gotoJasperForge=t(this.GOTO_JASPERFORGE_BUTTON_ID),this.needHelpLink=t(this.NEED_HELP_LINK_ID),this.needHelpDialog=t(this.NEED_HELP_DIALOG_ID)},_processTemplate:function(){this._baseProcessTemplate()},_initHandlers:function(){this._showHideLocaleAndTimezone.observe("click",this._localeAndTimezoneShowHideHandler.bindAsEventListener(this)),this._allowUserPasswordChange&&(this._showHideChangePassword.observe("click",this._changePasswordShowHideHandler.bindAsEventListener(this)),_(this._loginForm).on("submit",this._submitValidateHandler.bind(this))),this._showPasswordChange&&this._changePasswordShowHideHandler(),window.webHelpModule&&this.documentationButton&&this.documentationButton.observe("click",function(s){i.displayWebHelp()}.bindAsEventListener(this)),this.gotoJasperForge&&this.gotoJasperForge.observe("click",function(s){window.name="",window.open("http://jasperforge.org","jasperforge.org").focus()}.bindAsEventListener(this)),this.needHelpLink.observe("click",function(s){n.popup.show(this.needHelpDialog)}.bindAsEventListener(this)),[this.needHelpDialog].each(function(s){s.select(r.BUTTON_PATTERN)[0].observe("click",function(e){n.popup.hide(s)})})},_submitValidateHandler:function(s){if(this._customError.addClassName("hidden"),!this._changePassword.hasClassName("hidden")){h.validate([{validator:this._emptyPasswordValidator.bind(this),element:this._j_newpassword1},{validator:this._emptyPasswordValidator.bind(this),element:this._j_newpassword2},{validator:this._confirmationPasswordNotMatchValidator.bind(this),element:this._j_newpassword2},{validator:this._confirmationPasswordTooWeakValidator.bind(this),element:this._j_newpassword1}])||s.preventDefault()}},_emptyPasswordValidator:function(s){var e=!0,o="";return s.blank()&&(e=!1,o=this._nonEmptyPasswordMessage),{isValid:e,errorMessage:o}},_confirmationPasswordNotMatchValidator:function(s){var e=!0,o="";return s!=this._j_newpassword1.getValue()&&(e=!1,o=this._passwordNotMatchMessage),{isValid:e,errorMessage:o}},_confirmationPasswordTooWeakValidator:function(s){return{isValid:this._allowedPasswordPattern.test(s),errorMessage:this._passwordTooWeakMessage}},_changePasswordShowHideHandler:function(){this._changePassword.toggleClassName("hidden"),this._changePassword.hasClassName("hidden")?(this._showHideChangePassword.update(this._changePasswordMessage),this._j_newpassword1.setValue(""),this._j_newpassword2.setValue("")):(this._showHideChangePassword.update(this._cancelPasswordMessage),this._j_newpassword1.focus())},_localeAndTimezoneShowHideHandler:function(){this._localeAndTimeZone.toggleClassName("hidden"),this._localeAndTimeZone.hasClassName("hidden")?this._showHideLocaleAndTimezone.update(this._showLocaleMessage):(this._showHideLocaleAndTimezone.update(this._hideLocaleMessage),this._userLocale.focus())}};o.exports=l});