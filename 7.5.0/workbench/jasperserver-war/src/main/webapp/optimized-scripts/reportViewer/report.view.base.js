define(["require","exports","module","../core/core.ajax","../core/core.layout","../util/utils.common","../components/components.dialogs","underscore","../controls/controls.base","jquery","prototype"],function(e,t,o){var r=e("../core/core.ajax"),n=r.ajax,a=e("../core/core.layout"),i=e("../util/utils.common"),s=i.doNothing,c=e("../components/components.dialogs"),u=e("underscore"),l=e("../controls/controls.base"),p=l.ControlsBase,d=e("jquery"),w=e("prototype"),m=w.$;!function(e){var t=window.dashboardViewFrame,o=window.Template,r={_messages:{},_scroll:null,pageActions:{},viewReportForm:null,pageIndex:0,lastPageIndex:0,pageTimestamp:null,checkPageUpdatedTimeoutId:null,emptyReport:!0,reportForceControls:!1,hasInputControls:!1,reportControlsLayout:null,refreshReportCanceled:!1,reportParameterValues:null,allRequestParameters:null,requestedInputParameters:{},parametersWithoutDefaultValues:null,isLoaded:!1,EXPORT_ACTION_FORM:"exportActionForm",TOOLBAR_SUBMENU:"toolbarText",PAGINATION_PAGE_FIRST:"page_first",PAGINATION_PAGE_PREV:"page_prev",PAGINATION_PAGE_CURRENT:"page_current",PAGINATION_PAGE_NEXT:"page_next",PAGINATION_PAGE_LAST:"page_last",PAGINATION_PAGE_TOTAL:"page_total",DATA_TIMESTAMP_SPAN:"dataTimestampMessage",DATA_REFRESH_BUTTON:"dataRefreshButton",ASYNC_CANCEL_BUTTON:"asyncCancel",REPORT_COMPONENT_ID:"report",getMessage:function(e,t){var r=this._messages[e];return r?new o(r).evaluate(t||{}):""},commonInit:function(e){var t=d("#"+n.LOADING_ID);t.length>0&&(t.addClass(a.CANCELLABLE_CLASS),t.find("#cancel").click(function(){this._reportIsCanceled||(this._reportIsCanceled=!0,r.cancelReportExecution())})),document.location.href.indexOf("frame=0")>0&&(d("#reportViewFrame > .content > .header").hide(),d("#reportViewFrame").css("margin",0),d("#innerPagination").css("margin","none"),d("#reportViewFrame > .content > .body").css({top:0,"margin-top":0}))},navigateToReportPage:function(e,t,o){window.viewer.jive&&window.viewer.jive.hide(),window.viewer.reportInstance.gotoPage(e)},goToPage:function(e){parseInt(e,10)&&parseInt(e,10)>0&&(null==r.lastPageIndex||parseInt(e,10)<=r.lastPageIndex+1)?r.navigateToReportPage(parseInt(e,10)-1):s()},reportExecutionKey:function(){return r.flowExecutionKeyOutput?r.flowExecutionKeyOutput:window.dashboardViewFrame?t.flowExecutionKey:r.flowExecutionKey},refreshReport:function(e,t,o){var a=/(\?|&)output=([^&]*)/.exec(location.href),i=a&&3===a.length?a[2]:"";c.popup.showShared(m(n.LOADING_ID),!0,{owner:this.REPORT_COMPONENT_ID}),e=e||{},e._flowExecutionKey=e._flowExecutionKey?e._flowExecutionKey:r.reportExecutionKey(),e._eventId=e._eventId?e._eventId:"refreshReport",e.decorate="no",e.confirm="true",e.decorator="empty",e.ajax||(e.ajax="true");var s="flow.html?"+Object.toQueryString(e);return r.requestedInputParameters=o||this.getParametersFromRequest(),e.freshData&&(r.requestedInputParameters+="&freshData=true"),""===i||"html"===i?r.isLoaded?(window.viewer.reportInstance.eventManager.triggerEvent("beforeAction",{name:"beforeAction",type:"reportRefresh"}),window.viewer.reportInstance.refreshPage(0)):window.viewer.loadReport().always(function(){r.isLoaded=!0}):"pdf"===i||"swf"===i?r.exportReport(i,s):void(window.location.href=s+"&"+r.requestedInputParameters)},cancelReportExecution:function(){document.body.style.cursor="default",c.popup.hideShared(m(n.LOADING_ID),this.REPORT_COMPONENT_ID),window.viewer.reportInstance?window.viewer.reportInstance.cancelExecution().then(function(){r.isLoaded||(this._reportIsCanceled=!1,r.goBack())},function(){}):(this._reportIsCanceled=!1,r.goBack())},getParametersFromRequest:function(){return p.buildParams(r.getAllRequestParameters())},getAllRequestParameters:function(){return u.isObject(r.allRequestParameters)?r.allRequestParameters:{}},canSaveReport:function(){return!r.isReportReadOnly},confirmExit:function(){return!0},confirmAndLeave:function(){return!!r.confirmExit()&&r.closeViewerOnExit},closeViewerOnExit:function(e){window.viewer.exit().then(function(){e()})},showAjaxDialog:function(){c.popup.showShared(m(n.LOADING_ID),!0,{owner:this.REPORT_COMPONENT_ID})},hideAjaxDialog:function(){c.popup.hideShared(m(n.LOADING_ID),this.REPORT_COMPONENT_ID)}};e.Report=r}(window),o.exports=window.Report});