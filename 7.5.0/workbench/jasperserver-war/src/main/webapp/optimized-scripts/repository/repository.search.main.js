define(["require","exports","module","prototype","underscore","../util/utils.common","../core/core.layout","../components/components.webHelp","../manage/mng.common","../core/core.events.bis","../components/components.dialogs","../actionModel/actionModel.modelGenerator","runtime_dependencies/js-sdk/src/jrs.configs","runtime_dependencies/js-sdk/src/common/component/dialog/AlertDialog","bundle!jasperserver_messages","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/js-sdk/src/common/component/dialog/ConfirmationDialog"],function(e,t,o){function r(e){Ae.Action["create"+e].call().invokeAction()}function n(e,t){var o=t||Ae.model.getContextFolder();Ae.folderActionFactory[e](o).invokeAction()}function i(e,t,o){var r=t||Ae.model.getSelectedResources()[0];Ae.resourceActionFactory[e](r,o).invokeAction()}function s(e){var t=Ae.model.getSelectedResources();Ae.bulkActionFactory[e](t).invokeAction()}function a(e,t){Ae.RedirectAction.createCreateResourceAction(e,t).invokeAction()}function d(){return Ae.CopyMoveController.isCopy()||Ae.CopyMoveController.isMove()}function c(){return Ae.CopyMoveController.isCopyFolder()||Ae.CopyMoveController.isMoveFolder()}function l(){return Ae.CopyMoveController.isCopyResource()||Ae.CopyMoveController.isMoveResource()}function u(){var e=Ae.model.getContextFolder();return e&&!e.isOrganizationsRoot()&&e.isEditable()}function m(){var e=Ae.model.getContextFolder();return e&&!e.isOrganization()&&!e.isRoot()&&!e.isPublic()&&!e.isTemp()&&!e.isOrganizationsRoot()&&e.isRemovable()&&!e.isActiveThemeFolder()&&!e.isThemeRootFolder()}function p(e){return(e=e||Ae.model.getContextFolder())&&e.isEditable()}function h(e){return(e=e||Ae.model.getContextFolder())&&!e.isOrganization()&&!e.isRoot()&&!e.isOrganizationsRoot()&&e.isReadable()}function f(e){var t=e||Ae.model.getContextFolder();if(!c()||t.isOrganizationsRoot()||!p(t))return!1;var o=Ae.CopyMoveController.object;return t.URI!==o.URI}function R(e){return(e=e||Ae.model.getContextFolder())&&!e.isOrganization()&&!e.isRoot()&&!e.isPublic()&&!e.isTemp()&&!e.isOrganizationsRoot()&&e.isRemovable()&&!e.isActiveThemeFolder()&&!e.isThemeRootFolder()}function v(e){e=e||Ae.model.getContextFolder();var t=e.URI.split("/");return!(("/"===e.URI||"organizations"===t[t.length-1]||"organizations"===t[t.length-2])&&"org_template"!==t[t.length-1])}function E(){var e=Ae.model.getContextFolder();return e&&e.isAdministrable()}function g(){var e=Ae.model.getContextFolder();return e&&e.isReadable()&&!A()}function A(){var e=Ae.model.getContextFolder();return e&&e.isEditable()&&!e.isOrganization()&&!e.isOrganizationsRoot()&&!e.isRoot()}function C(e){var t=Ae.model.getContextFolder();return t&&!t.isOrganization()&&!t.isRoot()&&!t.isOrganizationsRoot()&&t.isEditable()}function S(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isReadable()&&Ae.runActionFactory[e.typeSuffix()]&&!Ae.isflowRedirectRunning}function _(e){return!1}function b(e){return!1}function T(e){e=e||Ae.model.getSelectedResources()[0];var t=Ae.editActionFactory[e.typeSuffix()]||_e.isCustomDataSource(e),o=e&&e.isEditable()&&t;return!["DashboardResource"].include(e.typeSuffix())&&o}function O(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isEditable()&&Ae.openActionFactory[e.typeSuffix()]&&"ContentResource"!==e.typeSuffix()}function w(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isReadable()&&Ae.openActionFactory[e.typeSuffix()]&&"ContentResource"===e.typeSuffix()}function F(e){return window.canBeScheduled(e)}function D(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isReadable()&&[Ae.ResourceType.REPORT_UNIT,Ae.ResourceType.ADHOC_REPORT_UNIT,Ae.ResourceType.REPORT_OPTIONS].include(e.resourceType)}function M(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isReadable()}function I(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isRemovable()}function U(e){return(e=Ae.model.getSelectedResources()[0])&&e.isRemovable()}function y(){var e=Ae.model.getSelectedResources()[0];return e&&e.isReadable()&&!e.isEditable()}function P(e){return(e=e||Ae.model.getSelectedResources()[0])&&e.isEditable()}function x(){var e=Ae.model.getSelectedResources()[0];return e&&e.isAdministrable()}function N(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!window.canBeRun(e)});return e.length>0&&void 0===t}function B(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!window.canResourceBeEdited(e)});return e.length>0&&void 0===t&&!re()}function j(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!window.canBeOpenedInDesigner(e)&&!window.canBeOpened(e)});return e.length>0&&void 0===t}function L(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!M(e)});return e.length>0&&void 0===t}function k(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!I(e)});return e.length>0&&void 0===t}function H(e){if(e=e||Ae.model.getContextFolder(),!(l()&&!e.isOrganizationsRoot()&&p(e)))return!1;var t=Ae.CopyMoveController.isBulkAction()?Ae.CopyMoveController.object:[Ae.CopyMoveController.object],o=(t.collect(function(e){return e.parentFolder}),!0);if(e.isThemeRootFolder()||e.isThemeFolder()){o=null==t.detect(function(e){return!e.resourceType.endsWith(".FileResource")})}return o}function z(){return H(Ae.model.getSelectedFolder())}function V(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!y(e)});return e.length>0&&void 0===t}function W(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!P(e)});return e.length>0&&void 0===t}function G(){var e=Ae.model.getSelectedResources(),t=e.detect(function(e){return!U(e)});return e.length>0&&void 0===t}function Y(){var e=Ae.model.getContextFolder();return e&&e.isThemeFolder()}function X(){var e=Ae.model.getContextFolder();return Y()&&!e.isActiveThemeFolder()}function J(){var e=Ae.model.getContextFolder();return e&&e.isThemeRootFolder()}function K(){var e=Ae.model.getContextFolder();return e&&e.isThemeFolder()&&p(e)}function Q(){return Ae.dialogsPool.getAllPermissionsDialogs().detect(function(e){return e.isChanged()})}function q(){return Ae.dialogsPool.getAllPropertiesDialogs().detect(function(e){return e.isChanged()})}var Z=e("prototype"),$=Z.$,ee=Z.Template,te=e("underscore"),oe=e("../util/utils.common"),re=oe.isIPad,ne=oe.isWebKitEngine,ie=oe.isSupportsTouch,se=oe.isRightClick,ae=oe.deepClone,de=e("../core/core.layout"),ce=e("../components/components.webHelp"),le=e("../manage/mng.common"),ue=e("../core/core.events.bis"),me=e("../components/components.dialogs"),pe=e("../actionModel/actionModel.modelGenerator"),he=e("runtime_dependencies/js-sdk/src/jrs.configs"),fe=e("runtime_dependencies/js-sdk/src/common/component/dialog/AlertDialog"),Re=e("bundle!jasperserver_messages"),ve=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),Ee=e("runtime_dependencies/js-sdk/src/common/component/dialog/ConfirmationDialog"),ge=te.debounce(function(e,t){Ae.RedirectAction["create"+e].call().invokeAction(t)},500),Ae={_container:null,mode:null,isFlowRedirectRunning:!1,flowExecutionKey:"",messages:[],Mode:{SEARCH:"search",BROWSE:"browse",LIBRARY:"library"},ResourceType:{REPORT_UNIT:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.ReportUnit",ADHOC_REPORT_UNIT:"com.jaspersoft.ji.adhoc.AdhocReportUnit",OLAP_UNIT:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapUnit",DASHBOARD_RESOURCE:"com.jaspersoft.ji.adhoc.DashboardResource",DASHBOARD:"com.jaspersoft.ji.dashboard.DashboardModelResource",REPORT_OPTIONS:"com.jaspersoft.ji.report.options.metadata.ReportOptions",REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.ReportDataSource",JDBC_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.JdbcReportDataSource",JNDI_JDBC_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.JndiJdbcReportDataSource",VIRTUAL_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.VirtualReportDataSource",CUSTOM_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.CustomReportDataSource",BEAN_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.BeanReportDataSource",OLAP_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapDataSource",OLAP_CLIENT_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapClientConnection",QUERY:"com.jaspersoft.jasperserver.api.metadata.common.domain.Query",INPUT_CONTROL:"com.jaspersoft.jasperserver.api.metadata.common.domain.InputControl",LIST_OF_VALUES:"com.jaspersoft.jasperserver.api.metadata.common.domain.ListOfValues",LIST_OF_VALUES_ITEM:"com.jaspersoft.jasperserver.api.metadata.common.domain.ListOfValuesItem",DATA_TYPE:"com.jaspersoft.jasperserver.api.metadata.common.domain.DataType",MONDRIAN_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.MondrianConnection",SECURE_MONDRIAN_CONNECTION:"com.jaspersoft.ji.ja.security.domain.SecureMondrianConnection",XMLA_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.XMLAConnection",MONDRIAN_XMLA_DEFINITION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.MondrianXMLADefinition",CONTENT_RESOURCE:"com.jaspersoft.jasperserver.api.metadata.common.domain.ContentResource",FILE_RESOURCE:"com.jaspersoft.jasperserver.api.metadata.common.domain.FileResource",SEMANTIC_LAYER_DATA_SOURCE:"com.jaspersoft.commons.semantic.datasource.SemanticLayerDataSource",DATA_DEFINER_UNIT:"com.jaspersoft.commons.semantic.DataDefinerUnit"},SearchAction:{NEXT:"next",GET_RESOURCE_CHILDREN:"getResourceChildren"},Event:{SEARCH_RUN:"search:run",SEARCH_BROWSE:"search:browse",SEARCH_FILTER:"search:filter",SEARCH_SORT:"search:sort",SEARCH_NEXT:"search:next",SEARCH_ROLLBACK:"search:rollback",SEARCH_SEARCH:"search:search",SEARCH_CHILDREN:"search:children",STATE_CHANGED:"state:changed",FILTER_PATH_CHANGED:"filterPath:changed",RESULT_CHANGED:"result:changed",CHILDREN_LOADED:"resourceChildren:loaded",RESULT_NEXT:"result:next",RESULT_ERROR:"result:error",REDIRECT_ERROR:"redirect:error",FLOW_REDIRECT_RUNNING:"flowRedirect:running"},InfoAction:{GET_DISPLAY_PATH:"getDisplayPath"},PermissionAction:{BROWSE:"permissionBrowse",SEARCH:"permissionSearch",NEXT:"permissionNext",UPDATE:"permissionsUpdate"},PermissionEvent:{BROWSE:"permission:browse",SEARCH:"permission:search",NEXT:"permission:next",UPDATE:"permission:update",LOADED:"permission:loaded",UPDATED:"permission:updated",ERROR:"permission:error"},FolderAction:{CREATE:"createFolder",COPY:"copyFolder",MOVE:"moveFolder",UPDATE:"updateFolder",DELETE:"deleteFolder"},FolderEvent:{DELETED:"folder:deleted",DELETE_ERROR:"folder:deleteError",CREATED:"folder:created",CREATE_ERROR:"folder:createError",COPIED:"folder:copied",COPY_ERROR:"folder:copyError",MOVED:"folder:moved",MOVE_ERROR:"folder:moveError",UPDATED:"folder:updated",UPDATE_ERROR:"folder:updateError"},ResourceAction:{DELETE:"deleteResources",COPY:"copyResources",MOVE:"moveResources",UPDATE:"updateResource",GENERATE:"generate",CONVERT:"convert"},ResourceEvent:{DELETED:"resource:deleted",DELETE_ERROR:"resource:deleteError",COPIED:"resource:copied",COPY_ERROR:"resource:copyError",MOVED:"resource:moved",MOVE_ERROR:"resource:moveError",UPDATED:"resource:updated",UPDATE_ERROR:"resource:updateError",GENERATED:"resource:generated",GENERATE_ERROR:"resource:generateError",CONVERTED:"resource:converted",CONVERT_ERROR:"resource:convertError"},RedirectType:{FLOW_REDIRECT:0,LOCATION_REDIRECT:1,WINDOW_REDIRECT:2},ThemeAction:{SETTHEME:"setActiveTheme",DOWNLOAD_THEME:"downloadTheme",REUPLOAD:"reuploadTheme"},ThemeEvent:{UPDATED:"theme:updated",REUPLOADED:"theme:reuploaded",THEME_ERROR:"theme:error"},initialize:function(e){function t(e,t){if(e){var o="USER"==t?le.User:le.Role;return e.collect(function(e){return new o(e)})}return[]}var o=e.rsInitOptions;Ae.mode=o.mode,Ae.flowExecutionKey=o.flowExecutionKey,de.resizeOnClient("repoSearch"==document.body.id?"searchFilters":"folders","results"),ce.setCurrentContext(Ae.mode===Ae.Mode.SEARCH?"search":"repo"),o.enableDnD=Ae.mode==Ae.Mode.BROWSE&&!re(),Ae.model.setPublicFolderUri(o.publicFolderUri),Ae.model.setTempFolderUri(o.tempFolderUri),Ae.model.setRootFolderUri(o.rootFolderUri),Ae.model.setOrganizationsFolderUri(o.organizationsFolderUri),Ae.model.setFolderSeparator(o.folderSeparator),Ae.model.setAdministrator(o.isAdministrator),Ae.model.setConfiguration(o.configuration),Ae.model.setServerState(o.state),Ae.CursorManager.initialize(),Ae.actionModel.initialize(),Ae.mode==Ae.Mode.BROWSE?(Ae.toolbar.initialize(Ae.actionModel.bulkActions),Ae.foldersPanel.initialize(o)):(Ae.filtersPanel.initialize(Ae.model.getFiltersConfiguration(),Ae.model.getFiltersState()),Ae.secondarySearchBox.initialize(Ae.model.getTextState()),Ae.filterPath.initialize()),Ae.resultsPanel.initialize(o),Ae.sortersPanel.initialize(Ae.model.getSortersConfiguration(),Ae.model.getSortState()),Ae.initFolderEvents(),Ae.initResourceEvents(),Ae.initThemeEvents(),Ae.observe("search:filter",function(e){new Ae.ServerAction.createSearchAction("filter",{filterId:e.memo.filterId,filterOption:e.memo.optionId}).invokeAction()}),Ae.observe("search:sort",function(e){new Ae.ServerAction.createSearchAction("sort",{sortBy:e.memo.sorterId}).invokeAction()}),Ae.observe("search:browse",function(e){new Ae.ServerAction.createSearchAction("browse",{folderUri:e.memo.uri}).invokeAction(),Ae.actionModel.refreshToolbar()}),Ae.observe("search:search",function(e){new Ae.ServerAction.createSearchAction("search",{text:e.memo.text}).invokeAction()}),Ae.observe("search:next",function(e){new this.ServerAction.createSearchAction(this.SearchAction.NEXT,{}).invokeAction()}.bindAsEventListener(Ae)),Ae.observe("search:rollback",function(e){new Ae.ServerAction.createSearchAction("rollback",{position:e.memo.position}).invokeAction()}),Ae.observe("search:children",function(e){var t=e.memo.resource,o=e.memo.item;new this.ServerAction.createSearchAction(this.SearchAction.GET_RESOURCE_CHILDREN,{resourceUri:t.URIString,resourceType:t.resourceType,item:o}).invokeAction()}.bindAsEventListener(Ae)),Ae.observe("permission:browse",function(e){new Ae.ServerAction.createPermissionAction(this.PermissionAction.BROWSE,e.memo).invokeAction()}.bindAsEventListener(Ae)),Ae.observe("permission:search",function(e){new Ae.ServerAction.createPermissionAction(this.PermissionAction.SEARCH,e.memo).invokeAction()}.bindAsEventListener(Ae)),Ae.observe("permission:next",function(e){new Ae.ServerAction.createPermissionAction(this.PermissionAction.NEXT,e.memo).invokeAction()}.bindAsEventListener(Ae)),Ae.observe("permission:update",function(e){var t=e.memo.uri,o=e.memo.entities,r=e.memo.finishEdit;if(o.length>0){var n=o.collect(function(e){return e.toPermissionData()});new Ae.ServerAction.createPermissionAction(this.PermissionAction.UPDATE,{uri:t,entitiesWithPermission:Object.toJSON(n),finishEdit:r}).invokeAction()}else{var i=Ae.dialogsPool.getPermissionsDialog(t);r&&i.hide()}}.bindAsEventListener(Ae)),Ae.observe("permission:loaded",function(e){var o=e.memo.responseData,r=Ae.dialogsPool.getPermissionsDialog(e.memo.inputData.uri);r.stopWaiting(),o&&(e.memo.doSet?r.setEntities(t(o.entities,o.type)):r.addEntities(t(o.entities,o.type)),"USER"===o.type?(ue.select(r._byUsersButton.parentNode),ue.unSelect(r._byRolesButton.parentNode)):(ue.unSelect(r._byUsersButton.parentNode),ue.select(r._byRolesButton.parentNode)))}.bindAsEventListener(Ae)),Ae.observe("permission:updated",function(e){var o=e.memo.inputData.uri,r=e.memo.inputData.finishEdit,n=Ae.dialogsPool.getPermissionsDialog(o);if(n.enable(),r)n.hide();else{var i=e.memo.responseData;i&&n.updateEntities(t(i.entities,i.type))}}.bindAsEventListener(Ae)),Ae.observe("permission:error",function(e){alert(Object.toJSON(e.memo))}.bindAsEventListener(Ae)),Ae.observe("resourceChildren:loaded",function(e){var t=e.memo.inputData.item,o=t.getValue(),r=e.memo.responseData;if(Object.isArray(r)){var n=[];r.each(function(e){var t=new Ce(e);o.addChild(t),n.push(t)}),Ae.resultsPanel.setResources(n,t),o.isLoaded()&&t.isLoading&&t.setLoading(!1)}}.bindAsEventListener(Ae)),Ae.observe("state:changed",function(e){Ae.sortersPanel.enableItems(),Ae.updateUI(e.memo.state)}),Ae.observe("filterPath:changed",function(e){Ae.filterPath.setPathItems(e.memo.filterPath)}),Ae.observe("result:changed",function(e){var t=e.memo.resources,o=t.collect(function(e){return new Ce(e)});Ae.resultsPanel.setResources(o);var r=Ae.resultsPanel.getList(),n=r.getItems();r.setCursor(n[0])}),Ae.observe("result:next",function(e){var t=e.memo.resources,o=t.collect(function(e){return new Ce(e)});Ae.resultsPanel.addResources(o)}),Ae.observe("result:error",this.defaultErrorHandler),Ae.observe("redirect:error",this.defaultErrorHandler),Ae.observe("flowRedirect:running",function(){Ae.isflowRedirectRunning=!0,Ae.toolbar.refresh()}),Ae.Mode.BROWSE!=o.mode&&Ae.fire(Ae.Event.SEARCH_SEARCH,{text:Ae.model.getTextState()}),e.rsInitOptions.systemConfirm.blank()||me.systemConfirm.show(e.rsInitOptions.systemConfirm),e.rsInitOptions.errorPopupMessage.blank()||me.errorPopup.show(e.rsInitOptions.errorPopupMessage),this._disableBfCacheIfSafari()},showContextMenu:function(e){var t=e.memo.targetEvent;if(Ae.mode==Ae.Mode.BROWSE&&Ae.foldersPanel.isFolderContextMenu(t)&&Ae.actionModel.showFolderMenu(t),Ae.resultsPanel.isResourceContextMenu(t)){Ae.model.getSelectedResources().length>1?Ae.actionModel.showResourceBulkMenu(t):Ae.actionModel.showResourceMenu(t)}},_disableBfCacheIfSafari:function(){ne()&&(window.onpageshow=function(){event.persisted&&window.location.reload()})},updateUI:function(e){e.sortBy!=Ae.model.getSortState()&&Ae.sortersPanel.select(e.sortBy,!0),e.text!=Ae.model.getTextState()&&Ae.mode!=Ae.Mode.BROWSE&&Ae.secondarySearchBox.setText(e.text);for(var t in e.customFilters)e.customFilters[t]!=Ae.model.getFiltersState()[t]&&Ae.filtersPanel.select(t,e.customFilters[t],!0);e.folderUri,Ae.model.getFolderUriState(),Ae.model.setServerState(e)},initFolderEvents:function(){this.observe("folder:deleted",function(e){var t=e.memo.inputData.folder,o=t.getParentFolder(),r=Ae.foldersPanel;r.refreshFolder(o),"/"===o.URI&&r.tree._selectOrEditNode(void 0,o.node,!1)}),this.observe("folder:deleteError",this.defaultErrorHandler),this.observe("folder:created",function(e){var t=e.memo.inputData.toFolder;Ae.foldersPanel.refreshFolder(t)}),this.observe("folder:createError",this.defaultErrorHandler),this.observe("folder:copied",function(e){var t=e.memo.inputData.folder,o=e.memo.inputData.toFolder;Ae.CopyMoveController.cancel(),Ae.foldersPanel.moveOrCopyFolder(t,o,!0)}),this.observe("folder:copyError",this.defaultErrorHandler),this.observe("folder:moved",function(e){var t=e.memo.inputData.folder,o=e.memo.inputData.toFolder;Ae.CopyMoveController.cancel(),Ae.foldersPanel.moveOrCopyFolder(t,o)}),this.observe("folder:moveError",this.defaultErrorHandler),this.observe("folder:updated",function(e){var t=e.memo.inputData.folder,o=e.memo.responseData.label,r=e.memo.responseData.desc;Ae.foldersPanel.updateFolder(t,o,r)}),this.observe("folder:updateError",this.defaultErrorHandler)},initResourceEvents:function(){this.observe("resource:deleted",function(e){var t=e.memo.inputData.resources,o=e.memo.responseData;if(o.dependentResources)me.dependentResources.show(o.dependentResources,null,{okOnly:!0,canSave:!1,topMessage:Ae.messages["dialog.dependencies.resources.message"],bottomMessage:Ae.messages["dialog.dependencies.resources.deleteMessage"]});else{Ae.model.getSelectedFolder();Ae.resultsPanel.removeResources(t)}}),this.observe("resource:deleteError",this.defaultErrorHandler),this.observe("resource:copied",function(e){var t=e.memo.inputData.folder;Ae.foldersPanel.reselectFolder(t)}),this.observe("resource:copyError",this.defaultErrorHandler),this.observe("resource:moved",function(e){var t=e.memo.inputData.folder,o=Ae.model.getSelectedFolder();Ae.foldersPanel.reselectFolder(t),Ae.foldersPanel.reselectFolder(o)}),this.observe("resource:moveError",this.defaultErrorHandler),this.observe("resource:updated",function(e){Ae.resultsPanel.updateResource(new Ce(e.memo.responseData))}),this.observe("resource:updateError",this.defaultErrorHandler),this.observe("resource:generated",function(e){var t=e.memo.inputData,o=e.memo.responseData,r=new Ce(o);if(t.run){Ae.RedirectAction.createRunResourceAction(r,!1).invokeAction()}else Ae.mode==Ae.Mode.BROWSE?t.location==Ae.foldersPanel.getSelectedUri()&&Ae.foldersPanel.doBrowse():Ae.fire(Ae.Event.SEARCH_SEARCH,{text:Ae.model.getTextState()});me.systemConfirm.show(Ae.messages.RM_REPORT_CREATED,5e3)}),this.observe("resource:generateError",function(e){var t,o=(e.memo.inputData,e.memo.responseData),r=o.msg,n=o.data;if(r&&r.indexOf("SYSTEM_CONFIRM_REQUIRED")>-1){if(n){var i=new Ee({text:be.restOfString(r,"SYSTEM_CONFIRM_REQUIRED:")});i.on("button:yes",function(){n.overwrite=!0;var e=Ae.ResourceAction.GENERATE;t=new Ae.ServerAction.createGenerateAction(e,n),t.invokeAction(),i.remove()}),i.on("button:no",function(){i.remove()}),i.open()}}else Ae.defaultErrorHandler(e)}),this.observe("resource:converted",function(e){me.systemConfirm.show(e.memo.responseData||e.memo,5e3),Ae.mode==Ae.Mode.BROWSE?Ae.foldersPanel.doBrowse():Ae.fire(Ae.Event.SEARCH_SEARCH,{text:Ae.model.getTextState()})}),this.observe("resource:convertError",this.defaultErrorHandler)},defaultErrorHandler:function(e){var t=new fe({title:Re["dialog.dependencies.title"]});t.setMessage(e.memo.responseData||e.memo),t.open(),Ae.sortersPanel.enableItems()},initThemeEvents:function(){this.observe("theme:updated",function(e){var t=e.memo.responseData;if(t&&t.refresh)document.body.style.cursor="wait",window.location.reload(!0);else{var o=Ae&&Ae.model&&Ae.model.getContextFolder()&&Ae.model.getContextFolder().getParentFolder();o&&Ae.foldersPanel&&Ae.foldersPanel.refreshFolder&&Ae.foldersPanel.refreshFolder(o)}}),this.observe("theme:reuploaded",function(e){if(e.memo.responseData.isActiveTheme){var t=e.memo.responseData.themeUri;new Ae.ServerAction.createFolderAction(Ae.ThemeAction.SETTHEME,{folderUri:t}).invokeAction()}}),this.observe("theme:error",function(e){var t=e.memo.responseData;t&&alert(t)})},getMessage:function(e,t){var o=Ae.messages[e];return o?new ee(o).evaluate(t||{}):""},_createAction:function(e,t){var o;if(t.endsWith("FolderAction")){var r=Ae.model.getContextFolder();o=e["create"+t].call(null,r)}else if(t.endsWith("ResourceAction")||t.endsWith("RunAction")){var n=Ae.model.getContextResource();o=e["create"+t].call(null,n)}else o=e["create"+t].call();return o},observe:function(e,t){this._getContainer().observe(e,t)},stopObserving:function(e,t){this._getContainer().stopObserving(e,t)},fire:function(e,t){this._getContainer().fire(e,t)},_getContainer:function(){return this._container||(this._container=document.body),this._container}};Ae.model={_organizationsFolderUri:null,_rootFolderUri:null,_tempFolderUri:null,_publicFolderUri:null,_folderSeparator:null,_configuration:{},_serverState:{},_uiState:{selectedFolder:null,contextFolder:null,contextResource:null,selectedResources:[]},_isAdministrator:!1,setOrganizationsFolderUri:function(e){this._organizationsFolderUri=e},getOrganizationsFolderUri:function(){return this._organizationsFolderUri},setRootFolderUri:function(e){this._rootFolderUri=e},getRootFolderUri:function(){return this._rootFolderUri},setTempFolderUri:function(e){this._tempFolderUri=e},getTempFolderUri:function(){return this._tempFolderUri},setPublicFolderUri:function(e){this._publicFolderUri=e},getPublicFolderUri:function(){return this._publicFolderUri},setFolderSeparator:function(e){this._folderSeparator=e},getFolderSeparator:function(){return this._folderSeparator},setConfiguration:function(e){this._configuration=e},getConfiguration:function(){return this._configuration},getFiltersConfiguration:function(){return this.getConfiguration().filters},getSortersConfiguration:function(){return this.getConfiguration().sorters},setServerState:function(e){this._serverState=e},getServerState:function(){return this._serverState},getUIState:function(){return this._uiState},setAdministrator:function(e){this._isAdministrator=e},isAdministrator:function(){return this._isAdministrator},getFiltersState:function(){return this.getServerState().customFilters},getSortState:function(){return this.getServerState().sortBy},getTextState:function(){return this.getServerState().text},getFolderUriState:function(){return this.getServerState().folderUri},setSelectedFolder:function(e){return this.getUIState().selectedFolder=e,e},getSelectedFolder:function(){return this.getUIState().selectedFolder},setContextFolder:function(e){return this.getUIState().contextFolder=e,e},getContextFolder:function(){return this.getUIState().contextFolder},setSelectedResources:function(e){return this.getUIState().selectedResources=e,e},getSelectedResources:function(){return this.getUIState().selectedResources}},Ae.actionModel={bulkActions:{RUN:{buttonId:"run",action:s,actionArgs:"Run",test:N},EDIT:{buttonId:"edit",action:s,actionArgs:"Edit",test:B},OPEN:{buttonId:"open",action:s,actionArgs:"Open",test:j},COPY:{buttonId:"copy",action:s,actionArgs:"Copy",test:L},CUT:{buttonId:"cut",action:s,actionArgs:"Move",test:k},PASTE:{buttonId:"paste",action:n,actionArgs:"PasteResources",test:z},REMOVE:{buttonId:"remove",action:s,actionArgs:"Delete",test:G}},_holderId:"searchActionModel",_folderMenu:"folder_mutton",_resourceMenu:"resource_menu",_resourceBulkMenu:"resource_bulk_menu",initialize:function(){var e=$(de.PAGE_BODY_ID);e&&e.observe(ie()?"touchstart":"click",function(e){re()?!se(e)&&1==e.touches.length&&pe.hideMenu():!se(e)&&pe.hideMenu()})},showFolderMenu:function(e,t){pe.showDynamicMenu(this._folderMenu,e,null,t,this._holderId)},showResourceBulkMenu:function(e,t){pe.showDynamicMenu(this._resourceBulkMenu,e,null,t,this._holderId)},showResourceMenu:function(e,t){pe.showDynamicMenu(this._resourceMenu,e,null,t,this._holderId)},refreshToolbar:function(e){Ae.toolbar.refresh()}},Ae.CopyMoveController={object:null,_move:!1,_copy:!1,_dndMode:!1,onMove:function(){Ae.CursorManager.move(),Ae.actionModel.refreshToolbar()},onCopy:function(){Ae.CursorManager.copy(),Ae.actionModel.refreshToolbar()},onCancel:function(){Ae.CursorManager.none(),Ae.actionModel.refreshToolbar()},isObjectInstanceOf:function(e){var t=this.object;return!!t&&(this.isBulkAction()?t.length==t.findAll(function(t){return t instanceof e}).length:t instanceof e)},isMoveResource:function(){return this._move&&this.isObjectInstanceOf(Ce)},isMoveFolder:function(){return this._move&&this.isObjectInstanceOf(Se)},isCopyResource:function(){return this._copy&&this.isObjectInstanceOf(Ce)},isCopyFolder:function(){return this._copy&&this.isObjectInstanceOf(Se)},isBulkAction:function(){return Object.isArray(this.object)},move:function(e,t){this.cancel(),this.object=e,this._move=!0,this._copy=!1,this._dndMode=t,this.onMove()},copy:function(e,t){this.cancel(),this.object=e,this._move=!1,this._copy=!0,this._dndMode=t,this.onCopy()},cancel:function(){this.object=null,this._move=!1,this._copy=!1,this.onCancel()},isMove:function(){return this._move},isCopy:function(){return this._copy},isDnd:function(){return this._dndMode}},Ae.CursorManager={container:null,className:["copy_cursor","move_cursor"],initialize:function(){this.container=$("display")},copy:function(){this.none(),this.container.addClassName(this.className[0])},move:function(){this.none(),this.container.addClassName(this.className[1])},none:function(){this.className.each(function(e,t){this.container.removeClassName(this.className[t])}.bind(this))}};var Ce=function(e){this._json=e,this.name=e.name,this.label=e.label,this.description=e.description,this.date=e.date,this.dateTimestamp=e.dateTimestamp,this.dateTime=e.dateTime,this.updateDate=e.updateDate,this.updateDateTimestamp=e.updateDateTimestamp,this.updateDateTime=e.updateDateTime,this.URI=e.URI,this.URIString=e.URIString,this.parentUri=e.parentUri,this.parentFolder=e.parentFolder,this.resourceType=e.resourceType,this.type=e.type,this.isScheduled=e.scheduled,this._permissions=e.permissions,this.hasChildren=e.hasChildren,this.isChild=!1,this.parentResource=null,this.isOpen=!1,this._children=[]};Ce.addMethod("clone",function(){return new Ce(this._json)}),Ce.addMethod("isReadable",function(){return this._permissions.include("r")}),Ce.addMethod("isEditable",function(){return this._permissions.include("e")}),Ce.addMethod("isRemovable",function(){return this._permissions.include("d")}),Ce.addMethod("isAdministrable",function(){return this._permissions.include("a")}),Ce.addMethod("typeEquals",function(e){return this.resourceType===e}),Ce.addMethod("typeSuffix",function(){return this.resourceType.split(".").last()}),Ce.addMethod("isLoaded",function(){return this._children.size()>0}),Ce.addMethod("isFolder",function(){return!1}),Ce.addMethod("getChildren",function(e){return this._children}),Ce.addMethod("addChild",function(e){e.isChild=!0,e.parentResource=this,this._children.push(e)}),Ce.addMethod("updateChild",function(e){e.isChild=!0,e.parentResource=this;var t=-1;this._children.each(function(o,r){o.URIString==e.URIString&&(t=r)}),t>-1?this._children[t]=e:this._children.push(e)}),Ce.addMethod("permissionsToString",function(){var e="";return this.isEditable()?e+=Ae.messages["permission.modify"]:e+=Ae.messages["permission.readOnly"],this.isRemovable()&&(e+=", "+Ae.messages["permission.delete"]),this.isAdministrable()&&(e+=", "+Ae.messages["permission.administer"]),e});var Se=function(e){this.node=e,this.name=e.param.id,this.label=ve.unescape(e.name),this.desc=e.param.extra.desc?ve.unescape(e.param.extra.desc):"",this.description=ve.unescape(this.desc),this.date=e.param.extra.date?ve.unescape(e.param.extra.date):"",this.URI=e.param.uri,this.URIString=e.param.uri};Se.prototype=ae(Ce.prototype),Se.addMethod("clone",function(){return new Se(this.node)}),Se.addMethod("getParentFolder",function(){return this.isRoot()?null:new Se(this.node.parent)}),Se.addMethod("getReadableUri",function(){return this.isRoot()?"":this.getParentFolder().getReadableUri()+Ae.model.getFolderSeparator()+this.label}),Se.addMethod("isRoot",function(){return this.URI==Ae.model.getRootFolderUri()||null==this.node.parent}),Se.addMethod("isPublic",function(){return this.URI==Ae.model.getPublicFolderUri()}),Se.addMethod("isTemp",function(){return this.URI==Ae.model.getTempFolderUri()}),Se.addMethod("isOrganization",function(){return this.URI.match(Ae.model.getOrganizationsFolderUri()+"/[^/]+$")}),Se.addMethod("isOrganizationsRoot",function(){return this.URI.match(Ae.model.getOrganizationsFolderUri()+"$")}),Se.addMethod("isReadable",function(){return!0}),Se.addMethod("isEditable",function(){return this.node.param.extra.isWritable}),Se.addMethod("isRemovable",function(){return this.node.param.extra.isRemovable}),Se.addMethod("isAdministrable",function(){return this.node.param.extra.isAdministrable}),Se.addMethod("isSelected",function(){return this.node.isSelected()}),Se.addMethod("equals",function(e){return e&&this.URI==e.URI}),Se.addMethod("isThemeFolder",function(){return this.node.param.extra&&this.node.param.extra.isThemeFolder}),Se.addMethod("isThemeRootFolder",function(){return this.node.param.extra&&this.node.param.extra.isThemeRootFolder}),Se.addMethod("isActiveThemeFolder",function(){return this.node.param.extra&&this.node.param.extra.isActiveThemeFolder}),Se.addMethod("isFolder",function(){return!0});var _e={getResourceUris:function(e){var t=[];return e.each(function(e){t.push(e.URIString?e.URIString:e.URI)}),t},getResourceUriAndTypeList:function(e){var t=[];return e.each(function(e){var o=e.URIString?e.URIString:e.URI;t.push({URIString:o,type:e.type})}),t},checkNameLength:function(e){return!e.blank()&&e.length<=Ae.model.getConfiguration().resourceNameMaxLength},checkDescriptionLength:function(e){return e.length<=Ae.model.getConfiguration().resourceDescriptionMaxLength},labelValidator:function(e){var t=!0,o=""
;return e.blank()?(o=Ae.messages.RE_INVALID_NAME_SIZE.replace("{0}",Ae.model.getConfiguration().resourceLabelMaxLength),t=!1):e.length>Ae.model.getConfiguration().resourceLabelMaxLength&&(o=Ae.messages.RE_INVALID_NAME_SIZE.replace("{0}",Ae.model.getConfiguration().resourceLabelMaxLength),t=!1),{isValid:t,errorMessage:o}},descriptionValidator:function(e){var t=!0,o="";return e.length>Ae.model.getConfiguration().resourceDescriptionMaxLength&&(o=Ae.messages.RE_INVALID_DESC_SIZE.replace("{0}",Ae.model.getConfiguration().resourceDescriptionMaxLength),t=!1),{isValid:t,errorMessage:o}},_fileTypeValidatorTemplate:function(e,t){var o=!0,r="";return!e||e.blank()?(r=Ae.messages.RE_ENTER_FILE_NAME,o=!1):e.toLowerCase().endsWith(t)||(r=Ae.messages.RE_INVALID_FILE_TYPE.replace("{0}",t),o=!1),{isValid:o,errorMessage:r}},zipFileTypeValidator:function(e){return _e._fileTypeValidatorTemplate(e,".zip")},isCustomDataSource:function(e){return te.contains(be.getInitConfiguration().customDataSources,e.resourceType)}},be={restOfString:function(e,t){var o=e.lastIndexOf(t)+t.length;return e.substring(o,e.length).trim()},getInitOptions:function(){return window.localContext.rsInitOptions||he.repositorySearch.localContext.rsInitOptions},getInitConfiguration:function(){return be.getInitOptions().configuration}};document.observe("element:contextmenu",Ae.showContextMenu.bindAsEventListener(Ae)),document.observe("key:escape",function(e){pe.hideMenu(),Event.stop(e)}),document.observe("key:delete",function(e){e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||G()&&s("Delete")}),window.canResourceBeCreated=C,window.invokeResourceAction=i,window.invokeAction=r,window.invokeFolderAction=n,window.invokeCreate=a,window.invokeBulkAction=s,window.invokeRedirectAction=ge,window.isPropertiesChanged=q,window.isPermissionsChanged=Q,window.isCopyOrMove=d,window.isFolderCopyOrMove=c,window.isResourceCopyOrMove=l,window.isThemeFolder=Y,window.isNonActiveThemeFolder=X,window.isThemeRootFolder=J,window.canThemeBeReuploaded=K,window.canFolderBeCopied=h,window.canFolderBeDeleted=m,window.canFolderBeEdited=p,window.canFolderBeMoved=R,window.canFolderBeCopiedOrMovedToFolder=f,window.canAllBeCopiedOrMovedToFolder=H,window.canFolderBeExported=v,window.canFolderPermissionsBeAssigned=E,window.canFolderPropertiesBeShowed=g,window.canFolderPropertiesBeEdited=A,window.canBeRun=S,window.canBeGenerated=_,window.canBeConverted=b,window.canBeOpened=w,window.canBeRunInBackground=F,window.canResourceBeEdited=T,window.canBeOpenedInDesigner=O,window.canCreateFolder=u,window.canBeScheduled=D,window.canResourceBeCopied=M,window.canResourceBeMoved=I,window.canResourceBeDeleted=U,window.canResourcePropertiesBeShowed=y,window.canResourcePropertiesBeEdited=P,window.canResourcePermissionsBeAssigned=x,window.canAllBeRun=N,window.canAllBeEdited=B,window.canAllBeOpened=j,window.canAllBeCopied=L,window.canAllBeMoved=k,window.canAllBePasted=z,window.canAllPropertiesBeShowed=V,window.canAllPropertiesBeEdited=W,window.canAllBeDeleted=G,t.repositorySearch=Ae,t.ResourcesUtils=_e,t.invokeResourceAction=i,t.invokeFolderAction=n,t.isPropertiesChanged=q,t.isPermissionsChanged=Q,t.Folder=Se,t.canFolderBeCopied=h,t.canFolderBeMoved=R,t.canFolderBeCopiedOrMovedToFolder=f,t.canAllBeCopiedOrMovedToFolder=H,t.canBeRun=S,t.canBeOpened=w,t.invokeBulkAction=s,t.invokeRedirectAction=ge,t.canBeScheduled=D});