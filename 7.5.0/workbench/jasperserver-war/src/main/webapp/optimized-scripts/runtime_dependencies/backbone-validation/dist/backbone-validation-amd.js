!function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define(["backbone","underscore"],t)}(function(t,e){return t.Validation=function(e){"use strict";var n={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},u={formatLabel:function(t,e){return s[n.labelFormatter](t,e)},format:function(){var t=Array.prototype.slice.call(arguments);return t.shift().replace(/\{(\d+)\}/g,function(e,n){return void 0!==t[n]?t[n]:e})}},i=function(n,u,a){return u=u||{},a=a||"",e.each(n,function(e,r){n.hasOwnProperty(r)&&(e&&"object"==typeof e&&!(e instanceof Array||e instanceof Date||e instanceof RegExp||e instanceof t.Model||e instanceof t.Collection)?i(e,u,a+r+"."):u[a+r]=e)}),u},a=function(){var t=function(t){return e.reduce(e.keys(e.result(t,"validation")||{}),function(t,e){return t[e]=void 0,t},{})},a=function(t,n){var u=t.validation?e.result(t,"validation")[n]||{}:{};return(e.isFunction(u)||e.isString(u))&&(u={fn:u}),e.isArray(u)||(u=[u]),e.reduce(u,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:d[e],val:n[e],msg:n.msg})}),t},[])},F=function(t,n,i,r){return e.reduce(a(t,n),function(a,F){var o=e.extend({},u,d),s=F.fn.call(o,i,n,F.val,t,r);return!1!==s&&!1!==a&&(s&&!a?e.result(F,"msg")||s:a)},"")},o=function(t,n){var u,a={},r=!0,o=e.clone(n),s=i(n);return e.each(s,function(e,n){(u=F(t,n,e,o))&&(a[n]=u,r=!1)}),{invalidAttrs:a,isValid:r}},s=function(n,u){return{preValidate:function(t,n){var u,i=this,a={};return e.isObject(t)?(e.each(t,function(t,e){(u=i.preValidate(e,t))&&(a[e]=u)}),e.isEmpty(a)?void 0:a):F(this,t,n,e.extend({},this.attributes))},isValid:function(t){var n=i(this.attributes);return e.isString(t)?!F(this,t,n[t],e.extend({},this.attributes)):e.isArray(t)?e.reduce(t,function(t,u){return t&&!F(this,u,n[u],e.extend({},this.attributes))},!0,this):(!0===t&&this.validate(),!this.validation||this._isValid)},validate:function(a,r){var F=this,s=!a,d=e.extend({},u,r),l=t(F),c=e.extend({},l,F.attributes,a),f=i(a||c),m=o(F,c);if(F._isValid=m.isValid,e.each(l,function(t,e){m.invalidAttrs.hasOwnProperty(e)||d.valid(n,e,d.selector)}),e.each(l,function(t,e){var u=m.invalidAttrs.hasOwnProperty(e),i=f.hasOwnProperty(e);u&&(i||s)&&d.invalid(n,e,m.invalidAttrs[e],d.selector)}),e.defer(function(){F.trigger("validated",F._isValid,F,m.invalidAttrs),F.trigger("validated:"+(F._isValid?"valid":"invalid"),F,m.invalidAttrs)}),!d.forceUpdate&&e.intersection(e.keys(m.invalidAttrs),e.keys(f)).length>0)return m.invalidAttrs}}},l=function(t,n,u){e.extend(n,s(t,u))},c=function(t){delete t.validate,delete t.preValidate,delete t.isValid},f=function(t){l(this.view,t,this.options)},m=function(t){c(t)};return{version:"0.9.1",configure:function(t){e.extend(n,t)},bind:function(t,u){u=e.extend({},n,r,u);var i=u.model||t.model,a=u.collection||t.collection;if(void 0===i&&void 0===a)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?l(t,i,u):a&&(a.each(function(e){l(t,e,u)}),a.bind("add",f,{view:t,options:u}),a.bind("remove",m))},unbind:function(t,n){n=e.extend({},n);var u=n.model||t.model,i=n.collection||t.collection;u?c(u):i&&(i.each(function(t){c(t)}),i.unbind("add",f),i.unbind("remove",m))},mixin:s(null,n)}}(),r=a.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,u){t.$("["+u+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},F=a.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o=a.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},s=a.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(t,e){return e.labels&&e.labels[t]||s.sentenceCase(t,e)}},d=a.validators=function(){var t=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){var e=/^\s+/,n=/\s+$/;return null===t?"":t.toString().replace(e,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(F.number)},u=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n)||e.isArray(n)&&e.isEmpty(n))};return{fn:function(t,n,u,i,a){return e.isString(u)&&(u=i[u]),u.call(i,t,n,a)},required:function(t,n,i,a,r){var F=e.isFunction(i)?i.call(a,t,n,r):i;return!(!F&&!u(t))&&(F&&!u(t)?this.format(o.required,this.formatLabel(n,a)):void 0)},acceptance:function(t,n,u,i){if("true"!==t&&(!e.isBoolean(t)||!1===t))return this.format(o.acceptance,this.formatLabel(n,i))},min:function(t,e,u,i){if(!n(t)||t<u)return this.format(o.min,this.formatLabel(e,i),u)},max:function(t,e,u,i){if(!n(t)||t>u)return this.format(o.max,this.formatLabel(e,i),u)},range:function(t,e,u,i){if(!n(t)||t<u[0]||t>u[1])return this.format(o.range,this.formatLabel(e,i),u[0],u[1])},length:function(t,n,u,i){if(!e.isString(t)||t.length!==u)return this.format(o.length,this.formatLabel(n,i),u)},minLength:function(t,n,u,i){if(!e.isString(t)||t.length<u)return this.format(o.minLength,this.formatLabel(n,i),u)},maxLength:function(t,n,u,i){if(!e.isString(t)||t.length>u)return this.format(o.maxLength,this.formatLabel(n,i),u)},rangeLength:function(t,n,u,i){if(!e.isString(t)||t.length<u[0]||t.length>u[1])return this.format(o.rangeLength,this.formatLabel(n,i),u[0],u[1])},oneOf:function(t,n,u,i){if(!e.include(u,t))return this.format(o.oneOf,this.formatLabel(n,i),u.join(", "))},equalTo:function(t,e,n,u,i){if(t!==i[n])return this.format(o.equalTo,this.formatLabel(e,u),this.formatLabel(n,u))},pattern:function(t,e,n,i){if(!u(t)||!t.toString().match(F[n]||n))return this.format(o[n]||o.inlinePattern,this.formatLabel(e,i),n)}}}();return e.each(d,function(t,n){d[n]=e.bind(d[n],e.extend({},u,d))}),a}(e),t.Validation});