define(["require","exports","module","jquery","backbone","underscore","text!./template/dialogTemplate.htm","../utils/Event","../overlay/Overlay","../../common/logging/logger","jquery-ui/ui/widgets/draggable","jquery-ui/ui/widgets/resizable"],function(t,e,i){var o=t("jquery"),s=t("backbone"),r=t("underscore"),n=t("text!./template/dialogTemplate.htm"),l=t("../utils/Event"),h=t("../overlay/Overlay"),a=t("../../common/logging/logger");t("jquery-ui/ui/widgets/draggable"),t("jquery-ui/ui/widgets/resizable");var d=a.register("Dialog"),p=s.View.extend({defaults:{title:"",modal:!0,zIndex:4e3,resetSizeOnOpen:!0},template:r.template(n),events:{"click .jr-jDialogClose":"_onClose","mousedown .jr-jDialogClose":"_onClose"},el:function(){return this.template({options:this.props})},constructor:function(t){this.props=r.defaults(t||{},this.defaults),this.log=this.props.log||d,this.$overlay=this.props.$overlay?this.props.$overlay:new h({zIndex:this.props.zIndex}),s.View.apply(this,arguments)},initialize:function(){this.$window=o(window),this.$body=o("body"),this.$body.append(this.$overlay.$el),this.$body.append(this.$el)},_onClose:function(){var t=new l({name:"dialog:close"});this.trigger(t.name,t),t.isDefaultPrevented()||this.close()},open:function(t){return this.$el.removeClass("jr-isHidden"),this.$el.css({position:"absolute"}),this.props.resetSizeOnOpen&&(this.$el.css({height:"",width:""}),this.$el.find("textarea").css({height:"",width:""})),this._position(t),this.props.modal&&(this.$overlay.show(),this.$el.addClass("jr-mDialogModal")),this},setPosition:function(t){this.$el.css({top:parseInt(t.top),left:parseInt(t.left),zIndex:t.zIndex||this.props.zIndex})},getPosition:function(){var t,e;return t=parseInt(this.$el.css("top")),e=parseInt(this.$el.css("left")),r.isNaN(t)&&(t=0),r.isNaN(e)&&(e=0),{top:t,left:e}},_position:function(t){var e,i=this.$el.height(),o=this.$el.width(),s={height:i,width:o};return e=t&&void 0!==t.top&&void 0!==t.left?p.fitInProvidedCoordinates({coordinates:t,outerRect:{height:this.$body.height()||this.$window.height(),width:this.$body.width()||this.$window.width()},elemRect:s}):p.calculateCenterPosition({outerRect:{width:this.$window.width(),height:this.$window.height()},innerRect:s,scrollCorrection:{width:this.$window.scrollLeft(),height:this.$window.scrollTop()}}),this.setPosition(e),this},close:function(){return this.$el.addClass("jr-isHidden"),this.props.modal&&this.$overlay.hide(),this},delegateEvents:function(){var t=this;return s.View.prototype.delegateEvents.apply(this,arguments),this.$el.draggable({handle:".jr-jDialogDraggable",addClasses:!1,containment:"document"}),this.$(".jr-jDialogResizer").length>0&&this.$el.resizable({handles:{se:this.$(".jr-jDialogResizer")},start:function(e,i){t.trigger("dialog:resize:started",i)},stop:function(e,i){t.trigger("dialog:resize:stopped",i)},resize:function(e,i){t.trigger("dialog:resize",i)}}),this},undelegateEvents:function(){try{this.$el.draggable("destroy"),this.$el.resizable("destroy")}catch(t){}return s.View.prototype.undelegateEvents.apply(this,arguments)},remove:function(){return this.stopListening(),this.$overlay.remove(),s.View.prototype.remove.call(this),this}},{calculateCenterPosition:function(t){t=t||{};var e=t.outerRect,i=t.innerRect,o=t.scrollCorrection;if(o||(o={width:0,height:0}),e&&i){var s=Math.max(0,o.width+e.width/2-i.width/2),n=Math.max(0,o.height+e.height/2-i.height/2);if(r.isNaN(s)||r.isNaN(n))throw new TypeError("Can't calculate position. Make sure that you pass dimension as integer values");return{left:s,top:n}}throw new Error("Illegal arguments")},fitInProvidedCoordinates:function(t){t=t||{};var e=t.coordinates,i=t.outerRect,o=t.elemRect,s=e.topPoint||0,r=e.leftPoint||0,n=e.top-s*o.height,l=e.left-r*o.width,h=i.height-e.top,a=i.width-e.left;return h<o.height&&(n=e.top-o.height)<0&&(n=i.height/2-o.height/2),a<o.width&&(l=e.left-o.width)<0&&(l=i.width/2-o.width/2),{top:n,left:l}}});p.prototype=r.extend({get title(){return this.props.title},set title(t){if(!r.isString(t))throw new TypeError("'Title' should be string");this.props.title=t,this.$el.find(".jr-jDialogTitle").text(this.props.title)},get modal(){return this.props.modal},set modal(t){if(!r.isBoolean(t))throw new TypeError("'Modal' should be boolean");this.props.modal=t}},p.prototype),i.exports=p});