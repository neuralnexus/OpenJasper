define(["require","exports","module","jquery","underscore","bundle!all","runtime_dependencies/js-sdk/src/common/enum/javaTypeMapper","./enum/javaTypes","runtime_dependencies/js-sdk/src/jrs.configs","./SimpleDomainModel","runtime_dependencies/js-sdk/src/common/component/dialog/DialogWithModelInputValidation","../saveDialog/DomainSaveDialogView","text!runtime_dependencies/js-sdk/src/common/templates/standardConfirm.htm","text!./template/simpleDomainDialogTemplate.htm","../../components/components.dialogs","../../util/utils.common"],function(e,t,o){var a=e("jquery"),i=e("underscore"),n=e("bundle!all"),s=e("runtime_dependencies/js-sdk/src/common/enum/javaTypeMapper"),l=e("./enum/javaTypes"),r=e("runtime_dependencies/js-sdk/src/jrs.configs"),c=e("./SimpleDomainModel"),d=e("runtime_dependencies/js-sdk/src/common/component/dialog/DialogWithModelInputValidation"),m=e("../saveDialog/DomainSaveDialogView"),u=e("text!runtime_dependencies/js-sdk/src/common/templates/standardConfirm.htm"),p=e("text!./template/simpleDomainDialogTemplate.htm"),h=e("../../components/components.dialogs"),g=e("../../util/utils.common"),v=g.redirectToUrl;o.exports=d.extend({hasChanges:!1,modelIsValid:!0,theDialogIsOpen:!1,constructor:function(e){e||(e={}),this.options=e,this.dataSource=e.dataSource?e.dataSource:{};this.model=new c({},e),d.prototype.constructor.call(this,{modal:!0,model:this.model,width:400,additionalCssClasses:"dataSourceCreateNewDomainDialog",title:n["resource.datasource.createDomain.dialogTitle"],content:"",buttons:[{label:n["resource.datasource.createDomain.save"],action:"save",primary:!0},{label:n["resource.datasource.createDomain.cancel"],action:"cancel",primary:!1}]}),this.on("button:save",i.bind(this._onSaveButtonClick,this)),this.on("button:cancel",i.bind(this._onCancelButtonClick,this)),this.model.on("validationPassed",i.bind(this.clearValidationErrors,this)),this.model.on("validationFailed",i.bind(this.validationFailed,this))},initialize:function(e){d.prototype.initialize.apply(this,arguments)},updateModelProperty:function(e){var t,o,i=a(e.target),s=i.attr("type"),l=i.attr("name"),r=i.parents("tr").attr("data-fieldId");o="checkbox"===s||"radio"===s?i.is(":checked"):a.trim(i.val()),t=this.model.get("columns"),t[r][l]=o,this.model.set("columns",t),this.model.validate("columns"),!1===this.hasChanges&&this.changeButtonLabel("save",n["resource.datasource.createDomain.applyAndSave"]),this.hasChanges=!0},startDialog:function(){var e=this;this.theDialogIsOpen||(this.bindValidation(),this.model.fetchMetadata(this.dataSource).done(function(){d.prototype.open.apply(e,arguments);var t=i.template(p,{i18n:n,javaTypes:l,columns:e.model.get("columns"),javaTypeMapper:s});e.setContent(t),e._center()}),this.theDialogIsOpen=!0)},fieldIsValid:function(){},fieldIsInvalid:function(e){},clearValidationErrors:function(){this.$el.find(".error").removeClass("error"),this.modelIsValid=!0},validationFailed:function(e){var t=this;this.clearValidationErrors(),this.modelIsValid=!1,i.each(e,function(e){var o=a(t.$el.find("table tr").get(e.rowId+1));o.find("[name="+e.name+"]").parent().addClass("error"),o.find(".message").text(n["resource.datasource.createDomain.validation.missing.label"])})},_closeDialog:function(){this.theDialogIsOpen&&(this.unbindValidation(),this.clearValidationErrors(),d.prototype.close.apply(this,arguments),this.theDialogIsOpen=!1)},_onCancelButtonClick:function(){var e=this,t=n["resource.datasource.createDomain.cancelMessage"],o=a(u);o.find(".body").html(t),h.popupConfirm.show(o.get(0),!0,{okButtonSelector:"[name=buttonOK]",cancelButtonSelector:"[name=buttonCancel]"}).done(function(){e._closeDialog(),e.options.cancel&&e.options.cancel()})},_onSaveButtonClick:function(){this.modelIsValid&&(this._closeDialog(),this.saveDialog=new m(i.extend({},this.options,{model:this.model,success:function(){v(r.contextPath+"/flow.html?_flowId=repositoryConfirmFlow&resourceType=dataSource&resourceType=domain")}})),this.saveDialog.startSaveDialog())}})});