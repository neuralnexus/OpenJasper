define(["require","underscore","common/util/classUtil"],function(e){"use strict";var t=e("underscore"),r=e("common/util/classUtil"),n={INDEX:"index",KEY_VALUE:"keyValue"},o=r.extend({constructor:function(e){this.code=e,this.args=Array.prototype.slice.call(arguments,1)},bundle:{}});return o.prototype.toString=function(){var e=this.bundle[this.code];if(!e)return this.code;var t=this._getArgsType(this.args);return t===n.INDEX?e=this._interpolateIndexArgs(this.args,e):t===n.KEY_VALUE&&(e=this._interpolateObjectArgs(this.args,e)),e},o.prototype._getArgsType=function(e){if(e&&e.length){var r=t.first(e);return t.isObject(r)?n.KEY_VALUE:n.INDEX}},o.prototype._interpolateObjectArgs=function(e,r){var n=e[0].separator||", ",o=e.reduce(function(e,t){var r=t.key,o=t.value;return e[r]?e[r]=e[r]+n:e[r]="",e[r]=e[r]+o,e},{});return r=t.keys(o).reduce(function(e,t){var r=o[t],n="\\{"+t+"\\}";return e.replace(new RegExp(n,"g"),r)},r)},o.prototype._interpolateIndexArgs=function(e,t){for(var r=0,n=e.length;r<n;r++){var o=e[r],i="\\{"+r+"\\}";t=t.replace(new RegExp(i,"g"),o)}return t},o.create=function(e){return function(r){var n=Object.create(o.prototype);return n=t.extend(n,{bundle:e,code:r,args:Array.prototype.slice.call(arguments,1)}),n.toString(n)}},o});