define(["require","underscore","bundle!all","common/component/dialog/Dialog","text!../template/repositoryFolderChooserDialogTemplate.htm","bi/repository/factory/repositoryTreeFactory","bi/repository/enum/repositoryResourceTypes"],function(e){"use strict";var t=e("underscore"),o=e("bundle!all"),s=e("common/component/dialog/Dialog"),i=e("text!../template/repositoryFolderChooserDialogTemplate.htm"),r=e("bi/repository/factory/repositoryTreeFactory"),l=e("bi/repository/enum/repositoryResourceTypes");return s.extend({constructor:function(e){e||(e={});var n="selectFolder";e.additionalCssClasses&&(n+=" "+e.additionalCssClasses),this.foldersTree=r({processors:["folderTreeProcessor","treeNodeProcessor","i18nItemProcessor","filterPublicFolderProcessor","cssClassItemProcessor","fakeUriProcessor"],treeBufferSize:e.treeBufferSize,types:[l.FOLDER],tooltipOptions:{}}),s.prototype.constructor.call(this,{modal:!0,resizable:!0,minWidth:400,minHeight:400,setMinSizeAsSize:e.setMinSizeAsSize,additionalCssClasses:n,title:o["repository.content"],content:t.template(i)({i18n:o}),buttons:[{label:o["button.select"],action:"select",primary:!0},{label:o["button.cancel"],action:"cancel",primary:!1}]}),this.$contentContainer.find(".control.groupBox .body").append(this.foldersTree.render().el)},initialize:function(e){this.listenTo(this.foldersTree,"selection:change",this._selectionListener),this.listenTo(this,"button:select",this._onOkButtonClick),this.listenTo(this,"button:cancel",this._onCancelButtonClick),s.prototype.initialize.apply(this,arguments),this._isOpened=!1,this.selectedResource=null,this._lastSelectedResource=null},open:function(){this._openDialog()},close:function(){this._closeDialog()},remove:function(){this._closeDialog(),this.foldersTree.remove(),s.prototype.remove.apply(this,arguments)},setDefaultSelectedItem:function(e){this._defaultSelectedItem=e},_onOkButtonClick:function(){this.selectedResource&&(this._closeDialog(),this._lastSelectedResource=this.selectedResource)},_onCancelButtonClick:function(){this.selectedResource=null,this._lastSelectedResource&&(this.selectedResource=this._lastSelectedResource),this._closeDialog()},_openDialog:function(){this._isOpened||(s.prototype.open.apply(this,arguments),this._resetTree(),this.disableButton("select"),this._preselectItem(),this._isOpened=!0)},_closeDialog:function(){this._isOpened&&(s.prototype.close.apply(this,arguments),this._isOpened=!1)},_onDialogResize:function(){var e=this.$contentContainer.find(".treeBox > .content > .body"),t=this.$contentContainer.closest(".jr-mDialog > .jr-mDialog-body");e.width(t.outerWidth(!0)-55),e.height(t.outerHeight(!0)-50)},_selectionListener:function(e){var o=Object.keys(e),s=e&&(t.isArray(e)||t.isObject(e))&&e[o[0]],i=s?s.uri:void 0,r=s?s.resourceType:void 0;if(!(s||i||r))return void this.disableButton("select");this.selectedResource={resourceUri:i},this.enableButton("select")},_resetTree:function(){this.foldersTree.collapse("/root",{silent:!0}),this.foldersTree.collapse("/public",{silent:!0}),this.foldersTree.resetSelection()},_preselectItem:function(){var e=!1;if(this._lastSelectedResource?e=this._lastSelectedResource.resourceUri:this._defaultSelectedItem&&(e=this._defaultSelectedItem),e){var t=this.foldersTree.$el.parent();this.foldersTree._selectTreeNode(e,t)}}})});