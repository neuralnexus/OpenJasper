define(["require","jquery","underscore","../view/AvailableItemsList","../mixin/listWithTrueAllSelectionTrait"],function(e){"use strict";var t=(e("jquery"),e("underscore")),i=e("../view/AvailableItemsList"),l=e("../mixin/listWithTrueAllSelectionTrait");return i.extend({initialize:function(e){e.trueAll&&delete e.value,i.prototype.initialize.call(this,e),this.setTrueAll(e.trueAll)},_createListView:function(e){var n=i.prototype._createListView.call(this,e);return t.extend(n,l)},initListeners:function(){i.prototype.initListeners.call(this),this.listenTo(this.model,"change:isTrueAll",this.changeTrueAll,this)},listRenderError:function(e,t){this._boundedOnSelectionChangeOnce&&this.listViewModel.off("selection:change",this._boundedOnSelectionChangeOnce),this.trigger("listRenderError",e,t)},selectionAdd:function(e){if(this.model.get("isTrueAll")){this.model.set("isTrueAll",!1,{silent:!0});var i=t.chain(this.listViewModel.get("items")).map(function(e){return e.value}).reject(function(t){return t===e.value}).value();this.listView.setTrueAll(!1,{silent:!0}),this.listView.setValue(i,{silent:!0}),this._boundedOnSelectionChangeOnce=t.bind(this._onSelectionChangeOnce,this,e),this.listViewModel.once("selection:change",this._boundedOnSelectionChangeOnce),this.listView.selectAll({silent:!0})}else this.model.get("value")[e.value]=!0,this.model.trigger("change:value")},_onSelectionChangeOnce:function(e){this.listViewModel.once("selection:remove",function(){this.processSelectionThroughApi(this.listView.getValue())},this),this.listViewModel.toggleSelection(e.value,e.index)},onSelectAll:function(){this.model.get("isTrueAll")||this.model.set("isTrueAll",!0)},onSelectNone:function(){this.model.set("isTrueAll",!1),i.prototype.onSelectNone.call(this)},onInvertSelection:function(){this.model.get("isTrueAll")?this.onSelectNone():t.isEmpty(this.model.get("value"))?this.onSelectAll():i.prototype.onInvertSelection.call(this)},changeTrueAll:function(){if(this.model.get("isTrueAll")){this.listView.activate(void 0),this.listView.reset();var e=this;this.clearFilter(function(){e.listView.once("selection:change",e.processSelectionThroughApi,e),e.listView.setTrueAll(!0)})}else this.model.trigger("change:value"),this.listView.setTrueAll(!1)},getModelForRendering:function(){return t.extend(i.prototype.getModelForRendering.call(this),{isTrueAll:this.model.get("isTrueAll")})},setTrueAll:function(e){this.model.set("isTrueAll",e)},getTrueAll:function(){return this.model.get("isTrueAll")}})});