define(["require","underscore","../dataprovider/DelegatingDataProvider","../dataprovider/SelectedItemsDataProvider","../view/AvailableItemsListWithTrueAll","../view/MultiSelect"],function(e){"use strict";var t=e("underscore"),i=e("../dataprovider/DelegatingDataProvider"),a=e("../dataprovider/SelectedItemsDataProvider"),s=e("../view/AvailableItemsListWithTrueAll"),l=e("../view/MultiSelect");return l.extend({_createAvailableItemsList:function(e){return this.availableItemsListDataProvider=e.getData,e.availableItemsList||new s({model:this.availableItemsListModel,getData:e.getData,bufferSize:e.bufferSize,loadFactor:e.loadFactor,chunksTemplate:e.chunksTemplate,scrollTimeout:e.scrollTimeout,trueAll:e.trueAll})},_createSelectedItemsListDataProvider:function(e){return this.selectedListOptions=e?e.selectedListOptions:{},this.selectedItemsDataProviderInstance=e?e.selectedItemsDataProvider:null,new i},selectionRemoved:function(e){if(this.getTrueAll()){var t;for(var i in e)if(e.hasOwnProperty(i)){t={value:e[i],index:i};break}this.availableItemsList.selectionAdd(t)}else l.prototype.selectionRemoved.call(this,e)},selectionChangeInternal:function(e){if(this.getTrueAll()){this.selectedItemsDataProvider.setGetData(this.availableItemsListDataProvider),this.selectedItemsDataProvider.setData=null;var i=this;this.selectedItemsList.fetch(function(){i._updateSelectedItemsCountLabel(),i.selectedItemsList.resize()}),this.silent?delete this.silent:this.triggerSelectionChange()}else{var a=this._getSelectedItemsDataProviderInstance();this.selectedItemsDataProvider.setGetData(a.getData),this.selectedItemsDataProvider.setData=t.bind(a.setData,a),this.selectedItemsDataProvider.getAllCachedData=t.bind(a.getAllCachedData,a),l.prototype.selectionChangeInternal.call(this,e)}},triggerSelectionChange:function(){this.trigger("selection:change",this.getValue(),{isTrueAll:this.getTrueAll()})},setTrueAll:function(e,t){t=t||{},t.silent&&(this.silent=!0),delete t.silent,this.availableItemsList.setTrueAll(e,t)},getTrueAll:function(){return this.availableItemsList.getTrueAll()},_getSelectedItemsDataProviderInstance:function(){var e=this.selectedItemsDataProviderInstance||new a(this.selectedListOptions);return e.setData([]),e}})});