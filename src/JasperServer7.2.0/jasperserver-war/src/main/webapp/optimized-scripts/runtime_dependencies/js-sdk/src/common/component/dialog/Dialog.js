define(["require","underscore","jquery","common/component/base/Dimmer","common/component/panel/Panel","common/component/base/OptionContainer","common/component/panel/trait/resizablePanelTrait","text!./template/dialogTemplate.htm","text!./template/dialogButtonTemplate.htm","jquery-ui/widgets/draggable"],function(t){"use strict";var e=t("underscore"),i=t("jquery"),s=t("common/component/base/Dimmer"),n=t("common/component/panel/Panel"),o=t("common/component/base/OptionContainer"),a=t("common/component/panel/trait/resizablePanelTrait"),h=t("text!./template/dialogTemplate.htm"),l=t("text!./template/dialogButtonTemplate.htm");t("jquery-ui/widgets/draggable");var r=n.extend({defaultTemplate:h,events:{mousedown:"_focus",touchstart:"_focus",keydown:"_onKeyDown",keyup:"_onKeyboardEvent",keypress:"_onKeyboardEvent",resize:"_onDialogResize"},constructor:function(t){t||(t={}),t.traits||(t.traits=[]),this.resizable=t.resizable||!1,this.modal=t.modal||!1,this.additionalBodyCssClasses=t.additionalBodyCssClasses||"",this.resizable&&-1===e.indexOf(t.traits,a)&&t.traits.push(a),n.call(this,t)},initialize:function(t){this.dialogOptions=e.extend({},t),this.collapsed=!this.collapsed,this.resetSizeOnOpen=!!e.isUndefined(t.resetSizeOnOpen)||t.resetSizeOnOpen,e.isEmpty(t.buttons)||(this.buttons=new o({options:t.buttons,el:this.$(".jr-mDialog-footer")[0]||this.$(".footer")[0],contextName:"button",optionTemplate:t.dialogButtonTemplate||l})),n.prototype.initialize.apply(this,arguments),this.buttons&&this.listenTo(this.buttons,e.map(t.buttons,function(t){return"button:"+t.action}).join(" "),e.bind(function(t,e){this.trigger("button:"+e.get("action"),t,e)},this)),this.render()},getTemplateArguments:function(){var t=n.prototype.getTemplateArguments.apply(this,arguments);return e.extend(t,{additionalBodyCssClasses:this.additionalBodyCssClasses})},setElement:function(t){var e=n.prototype.setElement.apply(this,arguments);return this.buttons&&this.buttons.setElement(this.$(".jr-mDialog-footer")[0]||this.$(".footer")[0]),e},setTitle:function(t){this.$(".jr-mDialog-header > .jr-mDialog-header-title").text(t)},render:function(){return this.$el.hide(),this.modal&&(this.dimmer=new s({zIndex:900})),i("body").append(this.$el),this.$el.draggable({handle:".mover",addClasses:!1,containment:"document"}),this},open:function(t){return this.isVisible()?this:(this.resetSizeOnOpen&&(this.$el.css({height:"",width:""}),this.$el.find("textarea").css({height:"",width:""})),n.prototype.open.apply(this,arguments),this.modal&&this.dimmer.css({zIndex:++r.highestIndex}).show(),this._setMinSize(),this._position(t),this._increaseZIndex(),this.buttons&&this.buttons.$(".over").removeClass("over"),this.$el.show(),this.$el.find("input").first().focus(),this._onDialogResize(),this.trigger("dialog:visible"),this)},close:function(){if(this.isVisible())return this.$el.css({zIndex:--r.highestIndex}),this.modal&&this.dimmer.css({zIndex:--r.highestIndex}).hide(),this.$el.hide(),n.prototype.close.apply(this,arguments),this},addCssClasses:function(t){this.$el.addClass(t)},toggleCollapsedState:function(){return this},enableButton:function(t){this.buttons.enable(t)},disableButton:function(t){this.buttons.disable(t)},isVisible:function(){return this.$el.is(":visible")},_setMinSize:function(){this.dialogOptions.minWidth&&this.$el.css({minWidth:this.dialogOptions.minWidth}),this.dialogOptions.minHeight&&this.$el.css({minHeight:this.dialogOptions.minHeight}),this.dialogOptions.setMinSizeAsSize&&this.$el.css({width:this.dialogOptions.minWidth,height:this.dialogOptions.minHeight})},_position:function(t){var e,s,n=i("body"),o=this.$el.height(),a=this.$el.width();if(t&&void 0!==t.top&&void 0!==t.left){e=t.top,s=t.left;var h=n.height(),l=n.width(),r=h-t.top,d=l-t.left;r<o&&(e=t.top-o,e=e<0?h/2-o/2:e),d<a&&(s=t.left-a,s=s<0?l/2-a/2:s)}else e=i(window).height()/2-o/2,s=i(window).width()/2-a/2;return this.$el.css({top:Math.max(0,e),left:Math.max(0,s),position:"absolute"}),this},_focus:function(){!this.modal&&this._increaseZIndex()},_increaseZIndex:function(){this.$el.css({zIndex:++r.highestIndex})},_onKeyDown:function(t){this.buttons._onKeyDown(t),t.stopPropagation()},_onKeyboardEvent:function(t){t.stopPropagation()},_onDialogResize:function(){},remove:function(){this.buttons&&this.buttons.remove(),this.dimmer&&this.dimmer.remove();try{this.$el.draggable("destroy")}catch(t){}n.prototype.remove.call(this)}},{highestIndex:5e3,resetHighestIndex:function(t){r.highestIndex=t||5e3}});return r});