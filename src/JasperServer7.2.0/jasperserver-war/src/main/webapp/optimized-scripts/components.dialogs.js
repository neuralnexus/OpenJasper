var dialogs={};dialogs.systemConfirm={container:null,message:null,show:function(e,t,o){var s=this;require(["underscore","jquery","text!common/templates/dialogSystemConfirmTemplate.htm"],function(i,n,a){if(window.isEmbeddedDesigner)n(document).trigger("adhocDesigner:notification",[i.template(a,{messages:e,isWarning:o}),t]);else{if(s.container=s.container||n("#systemMessageConsole").on("mouseup touchend",function(){dialogs.systemConfirm.container.slideUp()}),s.message=s.message||document.getElementById("systemMessage"),!s.message)return void console.warn(e);s.closeText||(s.closeText=n(s.message).html().toLowerCase()),n(s.message).html(i.template(a,{messages:e,isWarning:o,closeText:s.closeText})),dialogs.systemConfirm.container.slideDown(),setTimeout("dialogs.systemConfirm.hide()",t||2e3)}})},showWarning:function(e,t){this.show(e,t,!0)},hide:function(){dialogs.systemConfirm.container&&dialogs.systemConfirm.container.slideUp()}},jQuery(document).on("systemDialogWarn",function(e){var t=e.detail.message,o=e.detail.duration;dialogs.systemConfirm.showWarning(t,o)}),dialogs.errorPopup={_dom:null,_content:null,_DOM_ID:"standardAlert",_CONTENT_ID:"errorPopupContents",_PAGE_CONTENT_PATTERN:"#errorPageContent",_DIALOG_WIDTH:"546px",_DIALOG_HEIGHT:"350px",clickHandler:null,onClose:null,getZIndex:function(){var e=0;return this._dom&&(e=parseInt(this._dom.getStyle("zIndex"),10)),e},show:function(e,t,o){o||(o={});var s=Builder.node("DIV",{style:"display:none"});jQuery(s).html(e),document.body.insertBefore(s,document.body.firstChild);var i=$$(this._PAGE_CONTENT_PATTERN)[0],n=i?jQuery(i).html():e,a=i&&jQuery(i).html();if(s.remove(),n&&(this._dom||(this._dom=$(this._DOM_ID),this._content=$(this._CONTENT_ID),this.clickHandler=this._clickHandler.bindAsEventListener(this)),this._dom)){var l=n;a||(l=Builder.node("P",{class:"message"}),l.update(n)),this._content.update(l),this._dom.observe("click",this.clickHandler),this._dom.setStyle({height:o.height||this._DIALOG_HEIGHT,width:o.width||this._DIALOG_WIDTH}),t&&this._dom.addClassName(layoutModule.STACKTRACE_CLASS),dialogs.popup.show(this._dom,t);var d=document.getElementById("completeStackTrace");d&&isIPad()&&new TouchController(d,d.parentNode,{noInit3d:!0})}},_hide:function(){this._dom&&(this._dom.stopObserving("click",this.clickHandler),this.onClose&&(this.onClose(),this.onClose=null),dialogs.popup.hide(this._dom))},_clickHandler:function(e){var t=e.element();matchAny(t,["button"],!0)&&this._hide()}},dialogs.clusterErrorPopup=_.extend({},dialogs.errorPopup,{show:function(e){var t=this;require(["bundle!jasperserver_messages","bundle!jsexceptions_messages"],function(e,o){var s=o["cluster.exception.session.attribute.missing.popup"];dialogs.errorPopup.show.call(t,s);var i=e["button.home"];jQuery("#"+t._DOM_ID).find("button span.wrap").html(i)})},_hide:function(e){dialogs.errorPopup._hide.apply(this,arguments),window.location="home.html"}}),dialogs.popup={OWNER_ATTR:"data-owner",show:function(e,t,o){require(["stdnav","jquery"],function(s,i){if(o=o||{},e=$(e)){"message"in o&&i(e).find(".body").text(xssUtil.unescape(o.message)),t&&(pageDimmer.show(),e.match(layoutModule.DIALOG_LOADING_PATTERN)&&pageDimmer.setZindex(e.getStyle("zIndex")-1)),reParent(e,document.body),e.setOpacity(0),e.removeClassName(layoutModule.HIDDEN_CLASS),layoutModule.createSizer.call(layoutModule,e),o.cascade?cascadeElement(e,{position:o.position,number:o.number,horzOffset:40,vertOffset:40}):centerElement(e,{horz:!0,vert:!0}),dialogs.popup._setHigherZIndex(e),layoutModule.createMover.call(layoutModule,e),isIPad()?e.setOpacity(1)&&e.show():appear(e,.4),i(document.activeElement).addClass("preDialogFocus");var n=e;e&&i(".primary",e).length>0&&(n=i(".primary",e)[0]),o&&void 0!==o.focus&&!o.focus||(e.tabIndex=0,n.tabIndex=0,n.focus()),!t&&e.observe("click",dialogs.popup.zIndexHandler),s.beginModalFocus(e)}})},hide:function(e){require(["stdnav","jquery"],function(t,o){t.endModalFocus(e);var s=o(".preDialogFocus");if(s.length&&o(e).is(":visible")&&(t.forceFocus(s.first()),s.removeClass("preDialogFocus")),e){var i=$(e);i.hasClassName(layoutModule.HIDDEN_CLASS)||(i.addClassName(layoutModule.HIDDEN_CLASS),pageDimmer.hide(),i.match(layoutModule.DIALOG_LOADING_PATTERN)&&pageDimmer.setZindex(layoutModule.DIMMER_Z_INDEX)),i.stopObserving("click",dialogs.popup.zIndexHandler)}})},showShared:function(e,t,o){e&&($elem=$(e),o=o||{},o.owner&&($elem.writeAttribute(this.OWNER_ATTR,o.owner),$elem.hasClassName(layoutModule.HIDDEN_CLASS)&&this.show($elem,t,o)))},hideShared:function(e,t){if(e){$elem=$(e);$elem.readAttribute(this.OWNER_ATTR)==t&&($elem.writeAttribute(this.OWNER_ATTR,!1),this.hide($elem))}},zIndexHandler:function(e){var t=Event.element(e),o=matchMeOrUp(t,layoutModule.DIALOG_PATTERN);o&&dialogs.popup._setHigherZIndex(o)},_setHigherZIndex:function(e,t){var o,s,i,n=0,a=0;e&&(i=e.getStyle("zIndex"),t&&(n=t.getStyle("zIndex")),o=document.body.select(layoutModule.DIALOG_PATTERN),o=o.filter(function(t){return!!t.visible()&&(!t.match(layoutModule.DIALOG_LOADING_PATTERN)&&t!==e)}),o.each(function(e){a=Math.max(a,e.getStyle("zIndex"))}),s=Math.max(n,i,a,layoutModule.DIMMER_Z_INDEX),e.setStyle({zIndex:s}),o.each(function(e){e.getStyle("zIndex")>=s&&e.setStyle({zIndex:s-1})}))}},dialogs.popupConfirm=_.extend({},dialogs.popup,{show:function(e,t,o){dialogs.popup.show.apply(this,arguments),o=_.extend({okButtonSelector:"button.ok",cancelButtonSelector:"button.cancel"},o);var s=jQuery(e),i=s.find(o.okButtonSelector),n=s.find(o.cancelButtonSelector),a=jQuery.Deferred();return i.on("click",function(){o.validateFunc&&!1===o.validateFunc()||(i.off("click"),n.off("click"),dialogs.popupConfirm.hide(e),a.resolve())}),n.on("click",function(){i.off("click"),n.off("click"),dialogs.popupConfirm.hide(e),a.reject()}),a}}),dialogs.childPopup=_.extend({},dialogs.popup,{cascadePopups:{},show:function(e,t,o,s){o?(s=_.extend({parent:o},s),this.cascadePopups[o.id]||(this.cascadePopups[o.id]=[]),this.cascadePopups[o.id].push(e.id),$(e).setAttribute("data-parentDialog",o.id),dialogs.popup.show.apply(this,[e,t,s]),dialogs.popup._setHigherZIndex(e,o),t&&pageDimmer.setZindex(e.getStyle("zIndex")-1),o.stopObserving("click",dialogs.popup.zIndexHandler)):dialogs.popup.show.apply(this,[e,t,s])},hide:function(e){var t=$(e).getAttribute("data-parentDialog");if(t){this.cascadePopups[t]&&(this.cascadePopups[t]=_.without(this.cascadePopups[t],e.id)),dialogs.popup.hide.apply(this,[e]);var o=$(t);pageDimmer.show(o),dialogs.popup._setHigherZIndex(o)}else dialogs.popup.hide.apply(this,[e])}});