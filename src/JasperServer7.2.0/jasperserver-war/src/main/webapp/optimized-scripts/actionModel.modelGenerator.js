function replaceNbsps(e){var t=new RegExp("&nbsp;","g");return e.replace(t," ")}function fireMenuAction(e,t){var n=getAsFunction(e);n&&n()}function fireMenuActionWithEvent(e,t,n){var o,i=toFunction(t);(i=i||(o=toFunction("localContext."+t)))&&(e=_.isArray(e)?e:[e],i.apply(o?localContext:null,e))}function getMenuMouseupFunction(e,t,n,o,i){if(!e)return null;if(t){var a=resolveReservedStringsInArray(t,n,o,i);return function(){fireMenuActionWithEvent(a,e,i)}}return function(){fireMenuAction(e,i)}}function evaluateTest(e,t,n,o,i,a){var l=null==a||a,d=getAsFunction(e);return d&&(l=d.apply(this,resolveReservedStringsInArray(t,n,o,null)),i&&(l=!l)),l}function resolveReservedStringsInArray(e,t,n,o){return e?e.collect(function(e){return resolveReservedStrings(e,t,n,o)}):[]}function resolveReservedStrings(e,t,n,o){return e==actionModel.RES_SELECTED?actionModel.selObjects:e==actionModel.RES_LABEL?t:e==actionModel.RES_ID?n:e==actionModel.EVENT?o:e}function getRandomId(){return"_"+Math.round(50*Math.random(10))}"undefined"==typeof localContext&&(localContext=window);var actionModel={};actionModel.SIMPLE_ACTION="simpleAction",actionModel.SELECT_ACTION="selectAction",actionModel.INPUT_ACTION="inputAction",actionModel.OPTION_ACTION="optionAction",actionModel.SEPARATOR="separator",actionModel.SINGLE_SELECT_CONSTRAINT="singleSelect",actionModel.HIGH_Z_INDEX=99999,actionModel.RES_LABEL="$label",actionModel.RES_ID="$id",actionModel.RES_SELECTED="$selected",actionModel.EVENT="$event",actionModel.selObjects=[],actionModel.lastItemWasSeparator=!1,actionModel.noItemsYet=!0,actionModel.data=null,actionModel.openedSubMenus=[],actionModel.parentMenu="",actionModel.menuDom=null,actionModel.menuListDom=null,actionModel.PARENT_MENU_CONTAINER="menuList",actionModel.PARENT_MENU_STYLE="menu vertical context hidden",actionModel.SIMPLE_ACTION_DOM_ID="menuList_simpleAction",actionModel.SEPARATOR_DOM_ID="menuList_separator",actionModel.FLYOUT_PARENT_DOM_ID="menuList_flyout",actionModel.EXTRA_INPUT_DOM_ID="menuList_extraInput",actionModel.LIST_ITEM_DOM_ID="menuList_listItem",actionModel.DISPLAY_STYLE="inline",actionModel.DROP_DOWN_MENU_CLASS="dropDown",actionModel.MOUSE_OUT_PATTERNS=["#"+layoutModule.MENU_ID,"."+layoutModule.MENU_ROOT_CLASS,".toolbar .capsule",".header > .button.mutton","#"+layoutModule.MENU_ID+" *",layoutModule.MENU_ROOT_CLASS+" *"],actionModel.showDynamicMenu=function(e,t,n,o,i,a){if(null==e){if(!isProVersion())return;var l=designerBase.getSelectedObject();if(!l||!l.menuLevel)return;e=l.menuLevel}actionModel.resetMenu(e),actionModel.updateCSSClass(n),actionModel.initActionModelData(i),actionModel.assembleMenuFromActionModel(e,t,actionModel.menuListDom,a),actionModel.setMenuPosition(actionModel.menuDom,t,o),actionModel.setMenuEventHandlers(actionModel.menuDom),isIE()&&jQuery("#"+actionModel.menuDom.id).prepend('<div class="msshadow"></div>'),actionModel.makeMenuVisible(actionModel.menuDom),actionModel.adjustMenuPosition(actionModel.menuDom),jQuery(actionModel.MOUSE_OUT_PATTERNS.join(",")).on("mouseout",actionModel.closeHandler)},actionModel.closeHandler=function(e){var t=jQuery(e.relatedTarget);(t.hasClass("mutton")||t.parents(".mutton").length)&&e.relatedTarget||"menu"===t.attr("id")||t.parents("#menu").length||(jQuery("body").trigger("actionmodel-mouseout"),actionModel.hideMenu())},actionModel.resetMenu=function(e){var t=e.indexOf("toolbar")>-1?"toolbar":"actionmenu",n=$("menu");n.parentId=void 0,n.setAttribute("tabIndex",-1),n.setAttribute("js-navtype",t),n.childElements().each(function(e){Element.remove(e)}),jQuery(n).html(jQuery($("commonMenu").cloneNode(!0)).html());var o=n.down("ul"),i=o.readAttribute("id");o.writeAttribute("id",actionModel.updateTemplateId(i)),o.writeAttribute("js-navtype",n.getAttribute("js-navtype")),n.className=actionModel.PARENT_MENU_STYLE,n.writeAttribute("style",""),actionModel.menuDom=n,actionModel.menuListDom=o,actionModel.lastInputSrc="none"},actionModel.updateTemplateId=function(e){var t=new RegExp("_template");return e.replace(t,"")},actionModel.updateCSSClass=function(e){isNotNullORUndefined(e)&&($(actionModel.menuDom).className=e+" hidden")},actionModel.setMenuPosition=function(e,t,n){var o,i=t||window.event;o=i?isSupportsTouch()&&i.changedTouches?{x:i.changedTouches[0].pageX+20,y:i.changedTouches[0].pageY}:Event.pointer(i):{x:0,y:0};var a,l;isNotNullORUndefined(n)?(a=isNotNullORUndefined(n.menuLeft)?n.menuLeft:o.x,l=isNotNullORUndefined(n.menuTop)?n.menuTop:o.y):(a=o.x,l=o.y),e.setStyle({left:a+"px",top:l+"px"})},actionModel.adjustMenuPosition=function(e,t,n,o,i){$(e).hasClassName(this.DROP_DOWN_MENU_CLASS)&&!$(e).hasClassName("fitable")||fitObjectIntoScreen(e,null,n,null,i)},actionModel.assembleMenuFromActionModel=function(e,t,n,o){actionModel.noItemsYet=!0;var i=actionModel.data[e];o&&(i=o(e,i)),i.each(function(e){actionModel.appendToMenu(e,t,n)}),actionModel.removeTrailingSeparator()},actionModel.initActionModelData=function(e){actionModel.data="navigationActionModel"===e?primaryNavModule.JSON:_.isString(e)?jQuery("#"+e).html().evalJSON():e},actionModel.appendToMenu=function(e,t,n){if(actionModel.passesClientTest(e)){var o=getMenuMouseupFunction(getAsFunction(e.action),e.actionArgs,e.text,e.id,t);actionModel.appendDesiredRowType(e,t,o,n)}},actionModel.appendDesiredRowType=function(e,t,n,o){var i=function(){actionModel.isMenuShowing()&&actionModel.hideMenu(),n&&n()};e.type==actionModel.SIMPLE_ACTION&&actionModel.addSimpleActionRow(e,i,o),e.type!=actionModel.SEPARATOR||actionModel.lastItemWasSeparator||actionModel.addSeparatorRows(e,o),e.type==actionModel.SELECT_ACTION&&actionModel.addSelector(e,o,t),e.type==actionModel.OPTION_ACTION&&actionModel.addOption(e,i,o)},actionModel.addSimpleActionRow=function(e,t,n){var o=null;o=e.className&&"requiresInput"==e.className?$(actionModel.EXTRA_INPUT_DOM_ID).cloneNode(!0):$(actionModel.SIMPLE_ACTION_DOM_ID).cloneNode(!0),isSupportsTouch()?o.ontouchend=t:o.onmouseup=t,o.onmouseup_saved=t;var i=$(o).down(".button"),a=document.createTextNode(e.text);a.nodeValue=replaceNbsps(a.nodeValue),i.appendChild(a);var l=o.readAttribute("id")+getRandomId();o.writeAttribute("id",l),actionModel.insertMenuRow(n,o,!1,e.isDisabled,e.id,null)},actionModel.addSeparatorRows=function(e,t){var n=null;if(!actionModel.noItemsYet){var o=$(actionModel.SEPARATOR_DOM_ID).cloneNode(!0),i=o.readAttribute("id")+getRandomId();o.writeAttribute("id",i),e.className&&(n=e.className),actionModel.insertMenuRow(t,o,!0,e.isDisabled,null,n)}},actionModel.addOption=function(e,t,n){if(actionModel.passesClientTest(e)){var o=null,i=$(actionModel.LIST_ITEM_DOM_ID).cloneNode(!0);e.button=!(!e.button||"true"!=String(e.button).toLowerCase()),isSupportsTouch()?i.ontouchend=t:i.onmouseup=t,i.onmouseup_saved=t;var a=$(i).down(".button"),l=document.createTextNode(e.text);l.nodeValue=replaceNbsps(l.nodeValue),a.appendChild(l);var d=i.readAttribute("id")+getRandomId();i.writeAttribute("id",d),e.className&&(o=e.className),!e.button&&evaluateTest(e.isSelectedTest,e.isSelectedTestArgs,e.text,e.id,!1,!1)&&a.addClassName("down"),actionModel.insertMenuRow(n,i,!1,e.isDisabled,e.id,o)}},actionModel.addSelector=function(e,t,n){var o;if("flyout"==e.className){if(e&&e.children.length>0){o=$(actionModel.FLYOUT_PARENT_DOM_ID).cloneNode(!0);var i=$(o).down(".button"),a=document.createTextNode(e.text);a.nodeValue=replaceNbsps(a.nodeValue),i.appendChild(a);var l=o.readAttribute("id")+getRandomId();o.writeAttribute("id",l),actionModel.insertMenuRow(t,o,!1,e.isDisabled,e.id,null);var d=actionModel.menuDom.cloneNode(!1);d.writeAttribute("id",o.readAttribute("id")+"_subMenu"),jQuery(d).html(jQuery($("commonMenu").cloneNode(!0)).html());var u=d.down("ul"),c=u.readAttribute("id");u.writeAttribute("id",actionModel.updateTemplateId(c)),o.appendChild(d);var s=d.select("ul")[0],r=s.writeAttribute("id",s.readAttribute("id")+"_subMenu");actionModel.buildSubMenu(e,r,n)}}else e.children.each(function(e){var o=getMenuMouseupFunction(getAsFunction(e.action),e.actionArgs,e.text,e.id,n);actionModel.appendDesiredRowType(e,n,o,t)})},actionModel.getSubMenuLeft=function(e){return $(e).up(2).clientWidth+Math.abs(parseInt($(e).up(1).offsetLeft))},actionModel.getSubMenuTop=function(e){return Math.abs(parseInt($(e).offsetTop))},actionModel.showChildSubmenu=function(e){var t,n,o=e.parentNode.parentNode.parentNode.id,i=!1;for(t=0;t<actionModel.openedSubMenus.length;t++)actionModel.openedSubMenus[t]==o&&(n=t,i=!0,jQuery("#"+o+">div.content>ul").children("li.node").each(function(){actionModel.hideChildSubmenu(jQuery(this).get(0))})),i&&jQuery("#"+actionModel.openedSubMenus[t]+">div.content>ul").children("li.node").each(function(){actionModel.hideChildSubmenu(jQuery(this).get(0))});actionModel.openedSubMenus.splice(n,actionModel.openedSubMenus.length-n);var a=null,l=null,d=null,u=e.childElements()[1];u.setStyle({display:actionModel.DISPLAY_STYLE}),u.setStyle({position:"absolute"});var c=actionModel.getSubMenuLeft(e),s=0;u.setStyle({left:c+"px",top:s+"px"}),isIE()&&jQuery(u).prepend('<div class="msshadow"></div>'),actionModel.makeMenuVisible(u),a=$(u).cumulativeOffset()[1],l=$(u).getHeight();var r=getWindowHeight(),M=a+l;r<M&&(s=r-M-20,u.setStyle({top:s+"px"}));var m=u.cumulativeOffset()[0];d=u.getWidth(),getWindowWidth()<m+d&&u.setStyle({left:"-"+d+"px"}),actionModel.openedSubMenus.push(o)},actionModel.hideChildSubmenu=function(e){var t=e.childElements()[1];t.setStyle({display:"none"}),t.setStyle({position:"absolute"}),t.setStyle({left:0}),actionModel.makeMenuInVisible($(t))},actionModel.makeMenuVisible=function(e){e.down("ul").childElements().length>0&&(e.setStyle({zIndex:actionModel.HIGH_Z_INDEX}),$(e).removeClassName("hidden"))},actionModel.makeMenuInVisible=function(e){e.addClassName("hidden")},actionModel.buildSubMenu=function(e,t,n){e.children.each(function(e){actionModel.appendToMenu(e,n,$(t))})},actionModel.isMenuShowing=function(){return!("none"==$("menu").getStyle("display")||$("menu").hasClassName("hidden"))},actionModel.updateRowDom=function(e,t){if(e){jQuery(e).html(t);var n=e.readAttribute("id")+getRandomId();e.writeAttribute("id",n)}return e},actionModel.launchNewMenu=function(){actionModel.hideMenu(),alert("action not implemented...")},actionModel.insertMenuRow=function(e,t,n,o,i,a){null==t.readAttribute("id")&&(i?t.setAttribute("id",i):t.identify()),o&&actionModel.disableMenuOption(t),a&&t.addClassName(a),t.setAttribute("js-navtype",e.getAttribute("js-navtype")),e.appendChild(t),actionModel.lastItemWasSeparator=n,actionModel.noItemsYet=!1},actionModel.disableMenuOption=function(e){buttonManager.disable(e),_.isEmpty(e.childNodes)&&buttonManager.disable(e.childNodes[0])},actionModel.passesClientTest=function(e){var t,n=!0;if(e.clientTest){t=e.clientTest;var o=!1;t.startsWith("!")&&(t=e.clientTest.sub("!",""),o=!0),n=evaluateTest(t,e.clientTestArgs,e.text,e.id,o,null)}var i=actionModel.selObjects;return _.isEmpty(i)||n&&e.selectionConstraint&&(n=e.selectionConstraint==actionModel.SINGLE_SELECT_CONSTRAINT?1==i.length:i.length>1),n},actionModel.removeTrailingSeparator=function(){var e=actionModel.menuListDom.lastChild;if($(e)&&!actionModel.noItemsYet){var t=e.identify();new RegExp("w*separatorw*").test(t)&&e.remove()}},actionModel.getMenuParent=function(){return $(actionModel.menuDom.parentId)},actionModel.getFirstMenuButton=function(){return actionModel.menuDom.down(layoutModule.BUTTON_PATTERN,0)},actionModel.focusMenu=function(){var e=jQuery("#"+actionModel.menuDom.id);if(!jQuery.contains(e,document.activeElement)){actionModel.lastFocused=document.activeElement;var t=e.find(layoutModule.BUTTON_PATTERN);t.length>0&&$(t[0]).focus()}},actionModel.showDropDownMenu=function(e,t,n,o,i){t=jQuery(t);var a=t.offset(),l={menuLeft:a.left,menuTop:a.top+t.height()-1};actionModel.showDynamicMenu(n,e,o,l,i)},actionModel.setMenuEventHandlers=function(e){e.select("li").each(function(e){e.hasClassName("disabled")||e.hasClassName("node")&&(isSupportsTouch()?Event.observe(e,"touchstart",function(t){t.firstCall||actionModel.showChildSubmenu(e),t.firstCall=!0}):(Event.observe(e,"mouseenter",function(t){actionModel.showChildSubmenu(e)}),Event.observe(e,"mouseleave",function(t){actionModel.hideChildSubmenu(e)})))})},actionModel.initializeOneTimeMenuHandlers=function(){},actionModel.hideMenu=function(){if(actionModel.isMenuShowing()){var e=function(){var e=actionModel.lastFocused;try{e&&e.focus()}catch(e){}};!isSupportsTouch()&&setTimeout(e,0),actionModel.makeMenuInVisible($("menu")),jQuery(actionModel.MOUSE_OUT_PATTERNS.join(",")).off("mouseout",actionModel.closeHandler)}},actionModel.createMenuElement=function(e,t){if(!e)throw new Error("Can not construct actionModel object: type can not be empty");return Object.extend({type:e},t)},actionModel.setSelected=function(e){actionModel.selObjects=e};