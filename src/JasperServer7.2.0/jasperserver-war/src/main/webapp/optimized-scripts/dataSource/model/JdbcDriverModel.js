define(["require","backbone","underscore","xregexp","settings!dataSourcePatterns","dataSource/util/settingsUtility"],function(e){"use strict";var t=e("backbone"),r=e("underscore"),a=e("xregexp"),n=e("settings!dataSourcePatterns"),u=e("dataSource/util/settingsUtility"),i=t.Model.extend({idAttribute:"jdbcDriverClass",defaults:{defaultValues:{},jdbcDriverClass:"",label:"",available:!1,isDefault:!1,jdbcUrl:"",uploaded:!1},initialize:function(e,t){var s=u.deepDefaults(t,{dataSourcePatterns:n});i.DYNAMIC_URL_PART_PATTERN=s.dataSourcePatterns.dynamicUrlPartPattern,i.VALIDATION_PATTERNS=r.reduce(s.dataSourcePatterns,function(e,t,r){return e[r]=a(t),e},{})},isOtherDriver:function(){return this.get("jdbcDriverClass")===i.OTHER_DRIVER},isUploadedDriver:function(){return!0===this.get("uploaded")},getCustomAttributes:function(){if(this.isOtherDriver())return[];var e=this._getRegExpFieldGroupsFromConnectionUrlTemplate(),t=[];return r.each(e,function(e){return t.push(e[1])}),t},convertUrlTemplateToRegex:function(){var e,t=this.get("jdbcUrl");t=t.replace(/\?/g,"\\?"),t=t.replace(/\[TMPDIR\/\]/g,"\\[TMPDIR/\\]");for(var r in i.VALIDATION_PATTERNS)e=new RegExp("\\$\\["+r+"\\]","g"),t=t.replace(e,i.DYNAMIC_URL_PART_PATTERN);return"^"+t},parse:function(e){return e.isDefault=!!e.isDefault,e.defaultValues&&(e.defaultValues=r.reduce(e.defaultValues,function(e,t){return e[t.key]=t.value,e},{})),e},_getRegExpFieldGroupsFromConnectionUrlTemplate:function(){for(var e,t=[],a=[];!r.isNull(e=i.FIELD_TEMPLATE_REGEXP.exec(this.get("jdbcUrl")));)r.isArray(e)&&2===e.length&&-1===a.indexOf(e[0])&&(t.push(e),a.push(e[0]));return t}},{FIELD_TEMPLATE_REGEXP:/\$\[([^\]]+)\]/g,OTHER_DRIVER:"other"});return i});