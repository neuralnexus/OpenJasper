define(["require","underscore","jquery","backbone.validation","bundle!AttributeBundle","common/util/i18nMessage","backbone.epoxy","attributes/enum/permissionMasksEnum","attributes/enum/validationRulesEnum","./validation/baseProfileAttributeValidation"],function(t){var e=t("underscore"),i=t("jquery"),n=t("backbone.validation"),r=t("bundle!AttributeBundle"),a=t("common/util/i18nMessage").extend({bundle:r}),s=t("backbone.epoxy"),o=t("attributes/enum/permissionMasksEnum"),u=t("attributes/enum/validationRulesEnum"),l=t("./validation/baseProfileAttributeValidation"),d=u.MAX_ATTRIBUTE_NAME_LENGTH,h=u.MAX_ATTRIBUTE_VALUE_LENGTH,c=s.Model.extend({defaults:{id:void 0,name:void 0,value:"",description:"",inherited:!1,permissionMask:1,secure:!1},constructor:function(){this._initModelWithPermissionDefaults&&this._initModelWithPermissionDefaults(),s.Model.apply(this,arguments)},initialize:function(){this.get("id")||this.setId(),this.validateSameNames=!1,this.setState("originalState"),this.setState("confirmedState")},url:function(){var t=encodeURIComponent(this.id).replace(/'/g,"%27");return this.collection.url(this.isNew()?"":t)},validation:{name:l.concat([{fn:function(){if(this.attr){for(var t,i,n=this.attr.length,r=0;r<n;r++){if(i=this.attr[r],e.defaults(i,this.defaults),this.holder===i.holder&&this.get("inherited")===i.inherited){t="attributes.error.attribute.name.already.exist";break}if(i.inherited&&i.permissionMask===o.READ_ONLY){t="attributes.error.attribute.name.already.exist.at.higher.level";break}}return this.attr=null,this.holder=null,t&&new a(t)}}},{fn:function(){if(this.validateIfSecure)return new a("attributes.error.attribute.secure.renaming.not.allowed")}}]),value:[{maxLength:h,msg:new a("attributes.error.attribute.value.too.long",h)},{fn:function(){if(this.validateIfSecure)return this.validateIfSecure=!1," "}}],description:[{maxLength:d,msg:new a("attributes.error.attribute.description.too.long",d)}]},setId:function(){var t=this.get("name");t!==this.get("id")&&this.set("id",t)},toggleSameNamesValidation:function(){this.validateSameNames=!this.validateSameNames},resetField:function(t){this.set(t,this.defaults[t])},reset:function(t,e){var i={};return e=this.getState(e),i[t]=e[t],this.set(t?i:e),this},isRenamed:function(){return this.get("name")!==this.get("id")},isOriginallyInherited:function(){return this.originalState.inherited},isOverridden:function(){return!this.compareAttribute("inherited")},compareAttribute:function(t){return this.originalState[t]===this.confirmedState[t]},setState:function(t,i){i=i||this.attributes,this[t||"originalState"]=e.clone(i)},getState:function(t){return this[t||"originalState"]},trimAttrs:function(t,n){e.each(t,function(t){var e=this.get(t);this.set(t,i.trim(e),n)},this)},toJSON:function(t){t=t||{};var i=s.Model.prototype.toJSON.apply(this,arguments);return t.omitValue&&this.validateSecureValue()&&e.omit(i,"value")||i},confirmState:function(t){this.stateConfirmed=t||!0},isStateConfirmed:function(){return this.stateConfirmed},validateSecureValue:function(){var t=e.isEmpty(this.get("value")),i=this.get("secure");return!(this.isNew()||this.isOverridden())&&i&&t}});return e.extend(c.prototype,n.mixin),c});