Report.toolbarActionMap={back:"Report.goBack",ICDialog:"Controls.show",export:"doNothing",undo:"Report.undo",redo:"Report.redo",undoAll:"Report.undoAll"},jQuery.extend(Report,{initialize:function(){this.commonInit(),Report.exportForm=$(Report.EXPORT_ACTION_FORM),this.nothingToDisplay=$("nothingToDisplay"),$(Report.DATA_REFRESH_BUTTON)&&$(Report.DATA_REFRESH_BUTTON).observe("mouseup",function(){if(viewer.jive&&viewer.jive.hide(),"undefined"!=typeof Controls){var e=Controls.viewModel.get("selection"),t=ControlsBase.buildSelectedDataUri(e);this.refreshReport({freshData:!0},null,t?"&"+t:"")}else this.refreshReport({freshData:!0},null,"")}.bindAsEventListener(this)),$(Report.ASYNC_CANCEL_BUTTON)&&$(Report.ASYNC_CANCEL_BUTTON).observe("mouseup",function(){this.cancelReportAsyncExecution(!0)}.bindAsEventListener(this)),window.toolbarButtonModule&&(toolbarButtonModule.ACTION_MODEL_TAG=Report.TOOLBAR_SUBMENU,toolbarButtonModule.initialize(Report.toolbarActionMap)),$(Report.PAGINATION_PAGE_CURRENT)&&($(Report.PAGINATION_PAGE_CURRENT).observe("change",function(e){this.goToPage($(Report.PAGINATION_PAGE_CURRENT).getValue()),e.stop()}.bindAsEventListener(this)),jQuery(".toolsRight")[0].observe("click",function(e){var t=e.element();e.stop();for(var o in this.pageActions)if(matchAny(t,[o],!0))return void this.navigateToReportPage(this.pageActions[o])}.bindAsEventListener(this))),document.location.href.indexOf("noReturn=true")>0&&buttonManager.disable($("back")),"undefined"!=typeof Controls?Controls.initialize.bind(Controls)(Report.refreshReport):Report.refreshReport()},reportRefreshed:function(e){var t,o;if("undefined"!=typeof JRS&&JRS.fid){t=jQuery("#"+JRS.fid,window.parent.document),o=t.contents().find("#reportContainer"),t.removeClass(layoutModule.HIDDEN_CLASS).show(),isIPad()||t.parent().parent().css("background-image","none");o.height(),o.width();isSupportsTouch()&&(new TouchController(o.get(0),t.get(0).parentNode.parentNode,{use2Fingers:!0,showBorders:!0,noInit3d:!0}),o.children("div").bind({touchstart:function(){t.parent().parent().siblings().removeClass(layoutModule.HOVERED_CLASS),t.parent().parent().addClass(layoutModule.HOVERED_CLASS)}})),o.show(),window.reportFrameHeight=window.reportFrameHeight||t.parent().height(),window.reportFrameWidth=window.reportFrameWidth||t.parent().width()}else{var r=$(ControlsBase.INPUT_CONTROLS_FORM);if(isSupportsTouch()){if(this.touchController)this.touchController.reset();else{var a=jQuery("#reportContainer").parent().parent(),n=jQuery("#reportContainer > div").width();a.width()<n&&a.css("width",n+"px"),this.touchController=new TouchController(a[0],a.parent()[0],{noInit3d:!0,scrollbars:!0})}var s=jQuery("#"+ControlsBase.INPUT_CONTROLS_FORM+" > button.minimize");if(r&&s&&s.is(":visible")){var i=r.hasClassName("minimized");layoutModule.maximize(r),i&&layoutModule.minimize(r)}}jQuery("#reportContainer").show().height()}jQuery("#reportContainer").parents(".body").slice(0,1).scrollTop(0),Report.nothingToDisplay&&(Report.nothingToDisplay.addClassName(layoutModule.HIDDEN_CLASS),jQuery("#"+Report.DATA_REFRESH_BUTTON).removeAttr(layoutModule.DISABLED_ATTR_NAME));var l=jQuery("#paginationIndexHolder"),p=jQuery("#emptyReportMessageHolder");if(l.length>0){var u=l.attr("data-lastPageIndex");jQuery("#emptyReportID").addClass(layoutModule.HIDDEN_CLASS),"0"===u?jQuery(".control.paging").addClass(layoutModule.HIDDEN_CLASS).prev(".divider").addClass(layoutModule.HIDDEN_CLASS):jQuery(".control.paging").removeClass(layoutModule.HIDDEN_CLASS).prev(".divider").removeClass(layoutModule.HIDDEN_CLASS)}if(p&&p.length>0){var d=p.html();jQuery(".control.paging").addClass(layoutModule.HIDDEN_CLASS).prev(".divider").addClass(layoutModule.HIDDEN_CLASS),jQuery(jQuery("#emptyReportID p.message")[1]).html(d),jQuery("#emptyReportID").removeClass(layoutModule.HIDDEN_CLASS),centerElement(jQuery("#emptyReportID"),{horz:!0,vert:!0})}Report.refreshPagination(e),Report.refreshExporters(),Report.refreshSave(),Report.refreshAsyncCancel(),this.dataTimestampMessage&&$(Report.DATA_TIMESTAMP_SPAN)&&$(Report.DATA_TIMESTAMP_SPAN).update(this.dataTimestampMessage),jQuery("#innerPagination").css("margin",0),dialogs.popup.hideShared($(ajax.LOADING_ID),Report.REPORT_COMPONENT_ID)}}),jQuery.extend(Report,{refreshExporters:function(){buttonManager[null!=this.lastPageIndex?"enable":"disable"]($("export"))},refreshSave:function(){},refreshPagination:function(e){var t=viewer.reportInstance.currentpage,o=viewer.reportInstance.status.totalPages;if(this.emptyReport||null!=o&&o<=0)return buttonManager.disable($(Report.PAGINATION_PAGE_FIRST)),buttonManager.disable($(Report.PAGINATION_PAGE_PREV)),buttonManager.disable($(Report.PAGINATION_PAGE_CURRENT)),buttonManager.disable($(Report.PAGINATION_PAGE_NEXT)),buttonManager.disable($(Report.PAGINATION_PAGE_LAST)),void($(Report.PAGINATION_PAGE_CURRENT)&&($(Report.PAGINATION_PAGE_CURRENT).setValue(""),$(Report.PAGINATION_PAGE_TOTAL).update("")));t>0?(buttonManager.enable($(Report.PAGINATION_PAGE_FIRST)),buttonManager.enable($(Report.PAGINATION_PAGE_PREV))):(buttonManager.disable($(Report.PAGINATION_PAGE_FIRST)),buttonManager.disable($(Report.PAGINATION_PAGE_PREV))),null==o?(null==this.lastPartialPageIndex||t<this.lastPartialPageIndex?buttonManager.enable($(Report.PAGINATION_PAGE_NEXT)):buttonManager.disable($(Report.PAGINATION_PAGE_NEXT)),buttonManager.disable($(Report.PAGINATION_PAGE_LAST))):t+1<o?(buttonManager.enable($(Report.PAGINATION_PAGE_NEXT)),buttonManager.enable($(Report.PAGINATION_PAGE_LAST))):(buttonManager.disable($(Report.PAGINATION_PAGE_NEXT)),buttonManager.disable($(Report.PAGINATION_PAGE_LAST))),buttonManager.enable($(Report.PAGINATION_PAGE_CURRENT)),$(Report.PAGINATION_PAGE_CURRENT)&&(e||$(Report.PAGINATION_PAGE_CURRENT).setValue(t+1),null==o?$(Report.PAGINATION_PAGE_TOTAL).update(""):$(Report.PAGINATION_PAGE_TOTAL).update(this.getMessage("jasper.report.view.page.of")+o)),this.pageActions={"button#page_first":0,"button#page_prev":t-1,"button#page_next":t+1},null!=viewer.reportInstance.status.totalPages&&(this.pageActions["button#page_last"]=o-1),require(["stdnav","jquery"],function(e,t){var o=t(".toolsRight .paging.subfocus").find("button");o.length&&o.is(":disabled")?o.is("#"+Report.PAGINATION_PAGE_LAST)?e.forceFocus(".toolsRight li.page_first"):o.is("#"+Report.PAGINATION_PAGE_FIRST)?e.forceFocus(".toolsRight li.page_last"):o.is("#"+Report.PAGINATION_PAGE_NEXT)?e.forceFocus(".toolsRight li.page_prev"):o.is("#"+Report.PAGINATION_PAGE_PREV)?e.forceFocus(".toolsRight li.page_next"):o.closest("ul").focus():o.addClass(layoutModule.HOVERED_CLASS)})},refreshAsyncCancel:function(e){var t=viewer.reportInstance.status;$(Report.ASYNC_CANCEL_BUTTON)&&(e?($("asyncIndicator").addClassName(layoutModule.HIDDEN_CLASS),buttonManager.disable(Report.ASYNC_CANCEL_BUTTON),$(Report.DATA_REFRESH_BUTTON).removeClassName(layoutModule.HIDDEN_CLASS)):t.jasperPrintName&&"running"==t.reportStatus&&null==t.totalPages?(buttonManager.enable(Report.ASYNC_CANCEL_BUTTON),$("asyncIndicator").removeClassName(layoutModule.HIDDEN_CLASS),$(Report.DATA_REFRESH_BUTTON).addClassName(layoutModule.HIDDEN_CLASS)):($("asyncIndicator").addClassName(layoutModule.HIDDEN_CLASS),buttonManager.disable(Report.ASYNC_CANCEL_BUTTON),$(Report.DATA_REFRESH_BUTTON).removeClassName(layoutModule.HIDDEN_CLASS)))}}),jQuery.extend(Report,{exportReport:function(e,t){var o,r,a,n,s=Report.exportForm;jQuery(s).empty(),s.method="post",s.target="_blank",o=s.action,n=function(){s.target="_self",s.action=o},r={_eventId:"export",_flowExecutionKey:Report.reportExecutionKey(),output:""+e};var i=Controls.getLastSelection();a=_.extend(r,i),addDataToForm(s,a),t&&(s.action=t),s.submit(),setTimeout(n,500)},goBack:function(){if(Report.confirmExit()){var e=Report.getAllRequestParameters();buttonManager.disable($("back")),e._ddHyperlink?window.history.back():(Report.exportForm._eventId.value="close",Report.exportForm._flowExecutionKey.value=Report.reportExecutionKey(),Report.exportForm.submit())}},open:function(){alert("Not implemented yet: open report")},save:function(){alert("Report saving is not available in community edition")},saveAs:function(){alert("Report saving is not available in community edition")},undo:function(){viewer.reportInstance.undo()},redo:function(){viewer.reportInstance.redo()},undoAll:function(){viewer.reportInstance.undoAll()},cancelReportAsyncExecution:function(e){viewer.reportInstance.status.jasperPrintName&&(buttonManager.disable($(Report.ASYNC_CANCEL_BUTTON)),viewer.reportInstance.cancelExecution(e).then(function(e,t,o){var r=e.result.status;if("finished"!=viewer.reportInstance.status.reportStatus&&null==viewer.reportInstance.status.totalPages)return e.result.lastPartialPageIndex&&(Report.lastPartialPageIndex=e.result.lastPartialPageIndex),"error"==r?void alert("Report execution error: "+e.result.errorMessage):"canceled"==r?(Report.refreshAsyncCancel(!0),void dialogs.systemConfirm.show(Report.getMessage("jasper.report.view.report.canceled"),5e3)):(e.result.lastPageIndex&&(Report.lastPageIndex=e.result.lastPageIndex,viewer.reportInstance.status.totalPages=Report.lastPageIndex+1),e.result.snapshotSaveStatus&&(Report.snapshotSaveStatus=e.result.snapshotSaveStatus),viewer.reportInstance.status.reportStatus=r,Report.refreshPagination(!0),Report.refreshExporters(),Report.refreshSave(),Report.refreshAsyncCancel(),void 0)},function(e){e.getResponseHeader("lastPartialPageIndex")&&(Report.lastPartialPageIndex=e.getResponseHeader("lastPartialPageIndex")),Report.refreshPagination(!0)}))}});