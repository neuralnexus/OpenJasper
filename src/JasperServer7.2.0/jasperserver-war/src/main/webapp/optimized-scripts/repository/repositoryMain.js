function invokeAction(e){repositorySearch.Action["create"+e].call().invokeAction()}function invokeFolderAction(e,t){var i=t||repositorySearch.model.getContextFolder();repositorySearch.folderActionFactory[e](i).invokeAction()}function invokeResourceAction(e,t,i){var o=t||repositorySearch.model.getSelectedResources()[0];repositorySearch.resourceActionFactory[e](o,i).invokeAction()}function invokeBulkAction(e){var t=repositorySearch.model.getSelectedResources();repositorySearch.bulkActionFactory[e](t).invokeAction()}function invokeCreate(e,t){repositorySearch.RedirectAction.createCreateResourceAction(e,t).invokeAction()}function isCopyOrMove(){return repositorySearch.CopyMoveController.isCopy()||repositorySearch.CopyMoveController.isMove()}function isFolderCopyOrMove(){return repositorySearch.CopyMoveController.isCopyFolder()||repositorySearch.CopyMoveController.isMoveFolder()}function isResourceCopyOrMove(){return repositorySearch.CopyMoveController.isCopyResource()||repositorySearch.CopyMoveController.isMoveResource()}function canCreateFolder(){var e=repositorySearch.model.getContextFolder();return e&&!e.isOrganizationsRoot()&&e.isEditable()}function canFolderBeDeleted(){var e=repositorySearch.model.getContextFolder();return e&&!e.isOrganization()&&!e.isRoot()&&!e.isPublic()&&!e.isTemp()&&!e.isOrganizationsRoot()&&e.isRemovable()&&!e.isActiveThemeFolder()&&!e.isThemeRootFolder()}function canFolderBeEdited(e){return(e=e||repositorySearch.model.getContextFolder())&&e.isEditable()}function canFolderBeCopied(e){return(e=e||repositorySearch.model.getContextFolder())&&!e.isOrganization()&&!e.isRoot()&&!e.isOrganizationsRoot()&&e.isReadable()}function canFolderBeCopiedOrMovedToFolder(e){var t=e||repositorySearch.model.getContextFolder();if(!isFolderCopyOrMove()||t.isOrganizationsRoot()||!canFolderBeEdited(t))return!1;var i=repositorySearch.CopyMoveController.object;return t.URI!==i.URI}function canFolderBeMoved(e){return(e=e||repositorySearch.model.getContextFolder())&&!e.isOrganization()&&!e.isRoot()&&!e.isPublic()&&!e.isTemp()&&!e.isOrganizationsRoot()&&e.isRemovable()&&!e.isActiveThemeFolder()&&!e.isThemeRootFolder()}function canFolderBeExported(e){e=e||repositorySearch.model.getContextFolder();var t=e.URI.split("/");return!(("/"===e.URI||"organizations"===t[t.length-1]||"organizations"===t[t.length-2])&&"org_template"!==t[t.length-1])}function canFolderPermissionsBeAssigned(){var e=repositorySearch.model.getContextFolder();return e&&e.isAdministrable()}function canFolderPropertiesBeShowed(){var e=repositorySearch.model.getContextFolder();return e&&e.isReadable()&&!canFolderPropertiesBeEdited()}function canFolderPropertiesBeEdited(){var e=repositorySearch.model.getContextFolder();return e&&e.isEditable()&&!e.isOrganization()&&!e.isOrganizationsRoot()&&!e.isRoot()}function canResourceBeCreated(e){var t=repositorySearch.model.getContextFolder();return t&&!t.isOrganization()&&!t.isRoot()&&!t.isOrganizationsRoot()&&t.isEditable()}function canBeRun(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isReadable()&&repositorySearch.runActionFactory[e.typeSuffix()]&&!repositorySearch.isflowRedirectRunning}function canBeGenerated(e){return!1}function canBeConverted(e){return!1}function canResourceBeEdited(e){e=e||repositorySearch.model.getSelectedResources()[0];var t=repositorySearch.editActionFactory[e.typeSuffix()]||ResourcesUtils.isCustomDataSource(e),i=e&&e.isEditable()&&t;return!["DashboardResource"].include(e.typeSuffix())&&i}function canBeOpenedInDesigner(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isEditable()&&repositorySearch.openActionFactory[e.typeSuffix()]&&"ContentResource"!==e.typeSuffix()}function canBeOpened(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isReadable()&&repositorySearch.openActionFactory[e.typeSuffix()]&&"ContentResource"===e.typeSuffix()}function canBeRunInBackground(e){return canBeScheduled(e)}function canBeScheduled(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isReadable()&&[repositorySearch.ResourceType.REPORT_UNIT,repositorySearch.ResourceType.ADHOC_REPORT_UNIT,repositorySearch.ResourceType.REPORT_OPTIONS].include(e.resourceType)}function canResourceBeCopied(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isReadable()}function canResourceBeMoved(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isRemovable()}function canResourceBeDeleted(e){return(e=repositorySearch.model.getSelectedResources()[0])&&e.isRemovable()}function canResourcePropertiesBeShowed(){var e=repositorySearch.model.getSelectedResources()[0];return e&&e.isReadable()&&!e.isEditable()}function canResourcePropertiesBeEdited(e){return(e=e||repositorySearch.model.getSelectedResources()[0])&&e.isEditable()}function canResourcePermissionsBeAssigned(){var e=repositorySearch.model.getSelectedResources()[0];return e&&e.isAdministrable()}function canAllBeRun(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canBeRun(e)});return e.length>0&&void 0===t}function canAllBeEdited(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourceBeEdited(e)});return e.length>0&&void 0===t&&!isIPad()}function canAllBeOpened(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canBeOpenedInDesigner(e)&&!canBeOpened(e)});return e.length>0&&void 0===t}function canAllBeCopied(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourceBeCopied(e)});return e.length>0&&void 0===t}function canAllBeMoved(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourceBeMoved(e)});return e.length>0&&void 0===t}function canAllBeCopiedOrMovedToFolder(e){if(e=e||repositorySearch.model.getContextFolder(),!(isResourceCopyOrMove()&&!e.isOrganizationsRoot()&&canFolderBeEdited(e)))return!1;var t=repositorySearch.CopyMoveController.isBulkAction()?repositorySearch.CopyMoveController.object:[repositorySearch.CopyMoveController.object],i=(t.collect(function(e){return e.parentFolder}),!0);if(e.isThemeRootFolder()||e.isThemeFolder()){i=null==t.detect(function(e){return!e.resourceType.endsWith(".FileResource")})}return i}function canAllBePasted(){return canAllBeCopiedOrMovedToFolder(repositorySearch.model.getSelectedFolder())}function canAllPropertiesBeShowed(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourcePropertiesBeShowed(e)});return e.length>0&&void 0===t}function canAllPropertiesBeEdited(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourcePropertiesBeEdited(e)});return e.length>0&&void 0===t}function canAllBeDeleted(){var e=repositorySearch.model.getSelectedResources(),t=e.detect(function(e){return!canResourceBeDeleted(e)});return e.length>0&&void 0===t}function isThemeFolder(){var e=repositorySearch.model.getContextFolder();return e&&e.isThemeFolder()}function isNonActiveThemeFolder(){var e=repositorySearch.model.getContextFolder();return isThemeFolder()&&!e.isActiveThemeFolder()}function isThemeRootFolder(){var e=repositorySearch.model.getContextFolder();return e&&e.isThemeRootFolder()}function canThemeBeReuploaded(){var e=repositorySearch.model.getContextFolder();return e&&e.isThemeFolder()&&canFolderBeEdited(e)}function isPermissionsChanged(){return repositorySearch.dialogsPool.getAllPermissionsDialogs().detect(function(e){return e.isChanged()})}function isPropertiesChanged(){return repositorySearch.dialogsPool.getAllPropertiesDialogs().detect(function(e){return e.isChanged()})}function parseRepoData(e){return _.isArray(e)?_.pluck(e,"URIString"):[e.URIString]}function RegExpRepresenter(e){this.charMap={"\\s":" "},this.expressionTokens=this.__parse(e)}define("common/component/base/Dimmer",["require","jquery","common/util/classUtil"],function(e){var t,i,o=e("jquery"),r=e("common/util/classUtil");return r.extend({constructor:function(e){t||(i=0,t=o("<div id='dialogDimmer' class='dimmer'></div>").css(e),o(document.body).append(t),t.hide()),i++},css:function(e){return t.css(e),this},show:function(){var e=this.getCount()||0;return this.setCount(++e),t.show(),this},hide:function(){if(this.isVisible()){var e=this.getCount();return this.setCount(--e),!e&&t.hide(),this}},setCount:function(e){t.data({count:e})},getCount:function(){return parseInt(t.data("count"),10)},isVisible:function(){return t.is(":visible")},remove:function(){this._removed||(this._removed=!0,t&&(--i||(t.remove(),t=null)))}})}),define("text!common/component/panel/template/panelTemplate.htm",[],function(){return'<div class="panel {{- additionalCssClasses }}">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="header">\n        <div class="title">{{- title}}</div>\n    </div>\n    <div class="subcontainer"></div>\n</div>\n'}),define("common/component/panel/Panel",["require","css!panel","underscore","backbone","text!./template/panelTemplate.htm"],function(e){"use strict";e("css!panel");var t=e("underscore"),i=e("backbone"),o=e("text!./template/panelTemplate.htm");return i.View.extend({defaultTemplate:o,el:function(){var e=this.getTemplateArguments();return this.template(e)},getTemplateArguments:function(){return{title:this.title,additionalCssClasses:this.additionalCssClasses}},constructor:function(e){e||(e={}),this.template=t.template(e.template||this.defaultTemplate),this.title=e.title||"",this.additionalCssClasses=e.additionalCssClasses||"",this.content=e.content||"",this.collapsed=!e.collapsed,this.openClass=e.openClass||"open",this.closedClass=e.closedClass||"closed",this.loadingClass=e.loadingClass||"loading",this.fixedHeight=e.fixedHeight||!1,this.contentContainer=e.contentContainer||".subcontainer",this.overflow=e.overflow||"auto",this.traits=e.traits||[],t.each(this.traits,t.bind(function(e){e.extension&&t.extend(this,e.extension)},this)),this.invokeTraits("onConstructor",e),i.View.apply(this,arguments)},invokeTraits:function(e){var i=Array.prototype.slice.call(arguments,1),o=this;t.each(this.traits,function(t){t[e]&&t[e].apply(o,i)})},initialize:function(e){this.invokeTraits("beforeInitialize",e),this.content&&this.setContent(this.content),this.toggleCollapsedState(),this.invokeTraits("afterInitialize",e)},setElement:function(e){this.invokeTraits("beforeSetElement",e);var t=i.View.prototype.setElement.apply(this,arguments);return this.$contentContainer=this.$(this.contentContainer),this.$contentContainer[this.collapsed?"hide":"show"](),this.invokeTraits("afterSetElement",e),t},open:function(e){return this.invokeTraits("beforeOpen",e),this.$contentContainer.show(),this.$el.removeClass(this.closedClass).addClass(this.openClass),this.collapsed=!1,e&&e.renderContent&&this.renderContent(),this.invokeTraits("afterOpen",e),e&&e.silent||this.trigger("open",this),this},close:function(e){return this.invokeTraits("beforeClose",e),this.$contentContainer.hide(),this.$el.removeClass(this.openClass).addClass(this.closedClass),this.collapsed=!0,this.invokeTraits("afterClose",e),e&&e.silent||this.trigger("close",this),this},setContent:function(e,t){this.content=e;var i=this.renderContent();this.$contentContainer[!0===t?"append":"html"](i)},renderContent:function(){return this.content instanceof i.View?this.content.render().$el:this.content},setHeight:function(e){var i=this.$("> .header").outerHeight();this.$contentContainer.css({height:t.isNumber(e)?e-i+"px":"auto",overflow:this.overflow})},toggleCollapsedState:function(){return this.collapsed?this.open():this.close(),this},remove:function(){this.invokeTraits("onRemove"),this.content&&this.content.remove&&this.content.remove(),i.View.prototype.remove.call(this)}})}),define("common/component/base/OptionView",["require","backbone","underscore"],function(e){"use strict";var t=e("backbone"),i=e("underscore");return t.View.extend({events:{click:"select",mouseover:"mouseover",mouseout:"mouseout"},constructor:function(e){if(!e||!e.template)throw new Error("Option should have defined template");if(!(e.model&&e.model instanceof t.Model))throw new Error("Option should have associated Backbone.Model");this.template=i.template(e.template),this.disabledClass=e.disabledClass,this.hiddenClass=e.hiddenClass,this.toggleClass=e.toggleClass,this.overClass=e.overClass||"over",t.View.apply(this,arguments)},initialize:function(){t.View.prototype.initialize.apply(this,arguments);var e=this;!0===this.model.get("disabled")&&this.disable(),!0===this.model.get("hidden")&&this.hide(),!0===this.model.get("selected")&&this.addSelection(),this.listenTo(this.model,"change:over",function(t,i){i?e.$("> p").addClass(e.overClass):e.$("> p").removeClass(e.overClass)})},el:function(){return this.template(this.model.toJSON())},enable:function(){this.$el.removeAttr("disabled").removeClass(this.disabledClass)},disable:function(){this.$el.attr("disabled","disabled").addClass(this.disabledClass)},over:function(){this.model.set({over:!0})},leave:function(){this.model.set({over:!1})},show:function(){this.$el.show().removeClass(this.hiddenClass)},hide:function(){this.$el.hide().addClass(this.hiddenClass)},isVisible:function(){return this.$el.is(":visible")},isDisabled:function(){return this.$el.is(":disabled")},select:function(e){this.model.trigger("select",this,this.model,e),this.trigger("click",this,this.model,e)},addSelection:function(){this.$el.addClass(this.toggleClass),this.model.set("selected",!0)},removeSelection:function(){this.$el.removeClass(this.toggleClass),this.model.unset("selected")},mouseover:function(e){this.trigger("mouseover",this,this.model,e)},mouseout:function(e){this.trigger("mouseout",this,this.model,e)}})}),define("common/component/base/OptionContainer",["require","backbone","underscore","./OptionView"],function(e){"use strict";function t(e){if(!e||o.isEmpty(e))throw new Error("Init options must be specified");if(!e.options||!e.options.length)throw new Error("Option views descriptors must be specified");if(!e.mainTemplate&&!e.el)throw new Error("Option container must have a template");if(!e.optionTemplate)throw new Error("Option container must have an option template")}var i=e("backbone"),o=e("underscore"),r=e("./OptionView");return i.View.extend({events:{mouseout:"_mouseout",mouseover:"_mouseover"},el:function(){return o.template(this.template)()},constructor:function(e){t(e),this.contextName=e.contextName||"option",this.contentContainer=e.contentContainer?e.contentContainer:e.el||".content > ul",this.toggle=!!e.toggle,this.toggleClass=e.toggleClass||"active",this.options=[],this.collection=e.collection||new i.Collection,delete e.collection,e.options&&this.collection.reset(e.options),this.hasGroups=!(!this.collection.models[0]||!this.collection.models[0].get("groupId")),this.defalutOptionView=this.hasGroups?this.collection.where({default:!0}):[this.collection.findWhere({default:!0})],this.listenTo(this.collection,"select",this._selectOption),this.listenTo(this.collection,"update reset",this.render),this.template=e.mainTemplate,this.optionTemplate=e.optionTemplate,i.View.apply(this,arguments)},_mouseout:function(){this.trigger("container:mouseout")},_mouseover:function(){this.trigger("container:mouseover")},setElement:function(e){var t=i.View.prototype.setElement.apply(this,arguments);return this.$contentContainer=this.contentContainer?this.$(this.contentContainer).addBack().filter(this.contentContainer):this.$el,t},initialize:function(){this.render(),this.toggle&&this.defalutOptionView&&o.each(this.defalutOptionView,function(e){e&&this.getOptionView(e.get("action")).addSelection()},this)},render:function(){var e=this;o.each(this.options,function(t){e.stopListening(t,"mouseover"),e.stopListening(t,"mouseout"),t.remove()}),this.options=[],this.collection.forEach(function(t){var i=new r({template:e.optionTemplate,model:t,toggleClass:e.toggleClass});e.listenTo(i,"mouseover",function(t,i){e.trigger("mouseover",t,e,i)}),e.listenTo(i,"mouseout",function(t,i){e.trigger("mouseout",t,e,i)}),e.options.push(i),e.$contentContainer.append(i.$el)})},_onKeyDown:function(e){var t=this.getOptionView(e.keyCode,"triggerOnKeyCode");t&&!t.isDisabled()&&t.select()},_selectOption:function(e,t){if(this.toggle){var i=t.get("groupId"),r=this.hasGroups?o.reduce(this.options,function(e,t){return t.model.get("groupId")===i&&e.push(t),e},[]):this.options;o.each(r,function(e){e.removeSelection()},this),e.addSelection()}this.trigger("selection",e,t),this.trigger(this.contextName+":"+t.get("action"),e,t)},getOptionView:function(e,t){return o.find(this.options,function(i){return i.model.get(t||"action")===e})},resetSelection:function(e,t){e=e||[],this.toggle&&(this.hasGroups?(e.length<this.defalutOptionView.length&&o.each(this.defalutOptionView,function(t){var i={groupId:t.get("groupId")};!o.findWhere(e,i)&&t&&e.push(o.extend(i,{action:t.get("action")}))}),e=o.pluck(e,"action")):!e.length&&this.defalutOptionView[0]&&e.push(this.defalutOptionView[0].get("action")),o.each(this.options,function(i){e.length&&o.contains(e,i.model.get("action"))?t?this._selectOption(i,i.model):i.addSelection():i.removeSelection()},this))},select:function(){var e=Array.prototype.slice.call(arguments,0);this.toggle&&o.each(this.options,function(t){!e.length||o.contains(e,t.model.get("action"))?t.addSelection():t.removeSelection()},this)},deselect:function(){var e=Array.prototype.slice.call(arguments,0);this.toggle&&o.each(this.options,function(t){(!e.length||o.contains(e,t.model.get("action")))&&t.removeSelection()},this)},getSelection:function(){return o.chain(this.options).filter(function(e){return e.model.get("selected")}).map(function(e){return e.model.get("action")}).value()},show:function(){return o.each(this.options,function(e){var t=e.model.get("test");t&&!t()?e.hide():e[e.model.get("hidden")?"hide":"show"]()}),this.$el.show(),this.trigger("show",this),this},hide:function(){return this.$el.hide(),this.trigger("hide",this),this},enable:function(e){var t=Array.prototype.slice.call(arguments);o.each(this.options,function(e){(!t.length||o.contains(t,e.model.get("action")))&&e.enable()})},disable:function(e){var t=Array.prototype.slice.call(arguments);o.each(this.options,function(e){(!t.length||o.contains(t,e.model.get("action")))&&e.disable()})},addOptions:function(e,t){this.collection.add(e,o.extend(t||{},{silent:!0})),this.collection.reset(this.collection.toJSON())},removeOptions:function(e){var t=this.collection.filter(function(t){return!o.contains(e,t.get("action"))});t.length<this.collection.length&&this.collection.reset(t)},remove:function(){o.invoke(this.options,"remove"),i.View.prototype.remove.apply(this,arguments)}})}),define("common/component/panel/trait/abstractPanelTrait",[],function(){"use strict";return{extension:{},onConstructor:function(){},beforeInitialize:function(){},afterInitialize:function(){},beforeSetElement:function(){},afterSetElement:function(){},beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},onRemove:function(){}}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/disable-selection",["jquery","./version"],e):e(jQuery)}(function(e){return e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/plugin",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.plugin={add:function(t,i,o){var r,s=e.ui[t].prototype;for(r in o)s.plugins[r]=s.plugins[r]||[],s.plugins[r].push([i,o[r]])},call:function(e,t,i,o){var r,s=e.plugins[t];if(s&&(o||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(r=0;r<s.length;r++)e.options[s[r][0]]&&s[r][1].apply(e.element,i)}}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/resizable",["jquery","./mouse","../disable-selection","../plugin","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var o=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[o]>0||(t[o]=1,r=t[o]>0,t[o]=0,r)},_create:function(){var t,i=this.options,o=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),i.autoHide&&e(this.element).on("mouseenter",function(){i.disabled||(o._removeClass("ui-resizable-autohide"),o._handles.show())}).on("mouseleave",function(){i.disabled||o.resizing||(o._addClass("ui-resizable-autohide"),o._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,i,o,r,s,n=this.options,a=this;if(this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),o=this.handles.split(","),this.handles={},i=0;i<o.length;i++)t=e.trim(o[i]),r="ui-resizable-"+t,s=e("<div>"),this._addClass(s,"ui-resizable-handle "+r),s.css({zIndex:n.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(s);this._renderAxis=function(t){var i,o,r,s;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(o=e(this.handles[i],this.element),s=/sw|ne|nw|se|n|s/.test(i)?o.outerHeight():o.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(r,s),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(s=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=s&&s[1]?s[1]:"se")}),n.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var i,o,r=!1;for(i in this.handles)((o=e(this.handles[i])[0])===t.target||e.contains(o,t.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(t){var i,o,r,s=this.options,n=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),o=this._num(this.helper.css("top")),s.containment&&(i+=e(s.containment).scrollLeft()||0,o+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:o},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:n.width(),height:n.height()},this.originalSize=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.sizeDiff={width:n.outerWidth()-n.width(),height:n.outerHeight()-n.height()},this.originalPosition={left:i,top:o},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,o,r=this.originalMousePosition,s=this.axis,n=t.pageX-r.left||0,a=t.pageY-r.top||0,l=this._change[s];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[t,n,a]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),o=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(o)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,o,r,s,n,a,l,d=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,o=i.length&&/textarea/i.test(i[0].nodeName),r=o&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,s=o?0:c.sizeDiff.width,n={width:c.helper.width()-s,height:c.helper.height()-r},a=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,d.animate||this.element.css(e.extend(n,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!d.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,o,r,s,n=this.options;s={minWidth:this._isNumber(n.minWidth)?n.minWidth:0,maxWidth:this._isNumber(n.maxWidth)?n.maxWidth:1/0,minHeight:this._isNumber(n.minHeight)?n.minHeight:0,maxHeight:this._isNumber(n.maxHeight)?n.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,o=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),o>s.minHeight&&(s.minHeight=o),i<s.maxWidth&&(s.maxWidth=i),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,o=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===o&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===o&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,o=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,n=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,d=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return s&&(e.width=t.minWidth),n&&(e.height=t.minHeight),o&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),s&&d&&(e.left=a-t.minWidth),o&&d&&(e.left=a-t.maxWidth),n&&c&&(e.top=l-t.minHeight),r&&c&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],o=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],r=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)i[t]=parseFloat(o[t])||0,i[t]+=parseFloat(r[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var o=this.originalSize;return{top:this.originalPosition.top+i,height:o.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,o){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,o]))},sw:function(t,i,o){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,o]))},ne:function(t,i,o){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,o]))},nw:function(t,i,o){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,o]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,
originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),o=i.options,r=i._proportionallyResizeElements,s=r.length&&/textarea/i.test(r[0].nodeName),n=s&&i._hasScroll(r[0],"left")?0:i.sizeDiff.height,a=s?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-n},d=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&d?{top:c,left:d}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var o={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};r&&r.length&&e(r[0]).css({width:o.width,height:o.height}),i._updateCache(o),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,o,r,s,n,a,l=e(this).resizable("instance"),d=l.options,c=l.element,h=d.containment,u=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;u&&(l.containerElement=e(u),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(u),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,o){i[e]=l._num(t.css("padding"+o))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},o=l.containerOffset,r=l.containerSize.height,s=l.containerSize.width,n=l._hasScroll(u,"left")?u.scrollWidth:s,a=l._hasScroll(u)?u.scrollHeight:r,l.parentData={element:u,left:o.left,top:o.top,width:n,height:a}))},resize:function(t){var i,o,r,s,n=e(this).resizable("instance"),a=n.options,l=n.containerOffset,d=n.position,c=n._aspectRatio||t.shiftKey,h={top:0,left:0},u=n.containerElement,p=!0;u[0]!==document&&/static/.test(u.css("position"))&&(h=l),d.left<(n._helper?l.left:0)&&(n.size.width=n.size.width+(n._helper?n.position.left-l.left:n.position.left-h.left),c&&(n.size.height=n.size.width/n.aspectRatio,p=!1),n.position.left=a.helper?l.left:0),d.top<(n._helper?l.top:0)&&(n.size.height=n.size.height+(n._helper?n.position.top-l.top:n.position.top),c&&(n.size.width=n.size.height*n.aspectRatio,p=!1),n.position.top=n._helper?l.top:0),r=n.containerElement.get(0)===n.element.parent().get(0),s=/relative|absolute/.test(n.containerElement.css("position")),r&&s?(n.offset.left=n.parentData.left+n.position.left,n.offset.top=n.parentData.top+n.position.top):(n.offset.left=n.element.offset().left,n.offset.top=n.element.offset().top),i=Math.abs(n.sizeDiff.width+(n._helper?n.offset.left-h.left:n.offset.left-l.left)),o=Math.abs(n.sizeDiff.height+(n._helper?n.offset.top-h.top:n.offset.top-l.top)),i+n.size.width>=n.parentData.width&&(n.size.width=n.parentData.width-i,c&&(n.size.height=n.size.width/n.aspectRatio,p=!1)),o+n.size.height>=n.parentData.height&&(n.size.height=n.parentData.height-o,c&&(n.size.width=n.size.height*n.aspectRatio,p=!1)),p||(n.position.left=n.prevPosition.left,n.position.top=n.prevPosition.top,n.size.width=n.prevSize.width,n.size.height=n.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,o=t.containerOffset,r=t.containerPosition,s=t.containerElement,n=e(t.helper),a=n.offset(),l=n.outerWidth()-t.sizeDiff.width,d=n.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(s.css("position"))&&e(this).css({left:a.left-r.left-o.left,width:l,height:d}),t._helper&&!i.animate&&/static/.test(s.css("position"))&&e(this).css({left:a.left-r.left-o.left,width:l,height:d})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,i){var o=e(this).resizable("instance"),r=o.options,s=o.originalSize,n=o.originalPosition,a={height:o.size.height-s.height||0,width:o.size.width-s.width||0,top:o.position.top-n.top||0,left:o.position.left-n.left||0};e(r.alsoResize).each(function(){var t=e(this),o=e(this).data("ui-resizable-alsoresize"),r={},s=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(o[t]||0)+(a[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),o=i.options,r=i.size,s=i.originalSize,n=i.originalPosition,a=i.axis,l="number"==typeof o.grid?[o.grid,o.grid]:o.grid,d=l[0]||1,c=l[1]||1,h=Math.round((r.width-s.width)/d)*d,u=Math.round((r.height-s.height)/c)*c,p=s.width+h,m=s.height+u,f=o.maxWidth&&o.maxWidth<p,g=o.maxHeight&&o.maxHeight<m,v=o.minWidth&&o.minWidth>p,y=o.minHeight&&o.minHeight>m;o.grid=l,v&&(p+=d),y&&(m+=c),f&&(p-=d),g&&(m-=c),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=m):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=m,i.position.top=n.top-u):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=m,i.position.left=n.left-h):((m-c<=0||p-d<=0)&&(t=i._getPaddingPlusBorderDimensions(this)),m-c>0?(i.size.height=m,i.position.top=n.top-u):(m=c-t.height,i.size.height=m,i.position.top=n.top+s.height-m),p-d>0?(i.size.width=p,i.position.left=n.left-h):(p=d-t.width,i.size.width=p,i.position.left=n.left+s.width-p))}}),e.ui.resizable}),define("common/component/panel/trait/resizablePanelTrait",["require","underscore","./abstractPanelTrait","css!jquery-ui/jquery-ui","jquery-ui/widgets/resizable"],function(e){"use strict";function t(e,t){this.trigger("resize",e,t)}function i(e,t){this.trigger("resizeStart",e,t)}function o(e,t){this.trigger("resizeStop",e,t)}var r=e("underscore"),s=e("./abstractPanelTrait");return e("css!jquery-ui/jquery-ui"),e("jquery-ui/widgets/resizable"),r.extend({},s,{onConstructor:function(e){e||(e={}),this.handles=e.handles||"e, s, se",this.minWidth=e.minWidth||10,this.minHeight=e.minHeight||10,this.maxWidth=e.maxWidth||null,this.maxHeight=e.maxHeight||null,this.alsoResize=e.alsoResize||!1,this.resizableEl=e.resizableEl},afterSetElement:function(){this.$resizableEl=this.$el.find(this.resizableEl).length?this.$el.find(this.resizableEl):this.$el;var e=this.handles;"function"==typeof e&&(e=e(this.$el)),this.$resizableEl.resizable({handles:e,minHeight:this.minHeight,minWidth:this.minWidth,maxWidth:this.maxWidth,maxHeight:this.maxHeight,alsoResize:this.alsoResize,resize:r.bind(t,this),start:r.bind(i,this),stop:r.bind(o,this)})},onRemove:function(){try{this.$el.resizable("destroy")}catch(e){}}})}),define("text!common/component/dialog/template/dialogTemplate.htm",[],function(){return'<div class="jr-mDialog jr {{- additionalCssClasses }}" tabindex="-1">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="jr-mDialog-header mover jr">\n        <h1 class="jr-mDialog-header-title jr">{{- title }}</h1>\n    </div>\n    <div class="jr-mDialog-body jr {{- additionalBodyCssClasses }}">\n        <div class="jr-mDialog-body-wrapper jr subcontainer"></div>\n    </div>\n    <div class="jr-mDialog-footer jr"></div>\n\n</div>\n'}),define("text!common/component/dialog/template/dialogButtonTemplate.htm",[],function(){return"<button class=\"button action up {{- primary ? 'primary' : ''}} {{- (typeof float !== 'undefined' ? 'right' : '') }}\">\n\n    <js-templateNonce></js-templateNonce>\n    <span class=\"wrap\">{{- label }}<span class=\"icon\"></span></span>\n</button>\n"}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/data",["jquery","./version"],e):e(jQuery)}(function(e){return e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,o){return!!e.data(t,o[3])}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/safe-active-element",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(i){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/safe-blur",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/scroll-parent",["jquery","./version"],e):e(jQuery)}(function(e){return e.fn.scrollParent=function(t){var i=this.css("position"),o="absolute"===i,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter(function(){var t=e(this);return(!o||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&s.length?s:e(this[0].ownerDocument||document)}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/draggable",["jquery","./mouse","../data","../plugin","../safe-active-element","../safe-blur","../scroll-parent","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging"))return void(this.destroyOnClear=!0);this._removeHandleClassName(),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(this._blurActiveElement(t),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=e.ui.safeActiveElement(this.document[0]);e(t.target).closest(i).length||e.ui.safeBlur(i)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var o=this._uiHash();if(!1===this._trigger("drag",t,o))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=o.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,o=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(o=e.ui.ddmanager.drop(this,t)),this.dropped&&(o=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!o||"valid"===this.options.revert&&o||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,o)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var i=this.options,o=e.isFunction(i.helper),r=o?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),o&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,o,r=this.options,s=this.document[0];return this.relativeContainer=null,r.containment?"window"===r.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,e(s).width()-this.helperProportions.width-this.margins.left,(e(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=e(r.containment),void((o=i[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(o.scrollWidth,o.offsetWidth):o.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(o.scrollHeight,o.offsetHeight):o.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,o=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:o?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:o?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,o,r,s,n=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,d=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(o=this.relativeContainer.offset(),i=[this.containment[0]+o.left,this.containment[1]+o.top,this.containment[2]+o.left,this.containment[3]+o.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(d=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(d=i[3]+this.offset.click.top)),n.grid&&(r=n.grid[1]?this.originalPageY+Math.round((d-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY,d=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-n.grid[1]:r+n.grid[1]:r,s=n.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX,l=i?s-this.offset.click.left>=i[0]||s-this.offset.click.left>i[2]?s:s-this.offset.click.left>=i[0]?s-n.grid[0]:s+n.grid[0]:s),"y"===n.axis&&(l=this.originalPageX),"x"===n.axis&&(d=this.originalPageY)),{top:d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,i,o){return o=o||this._uiHash(),e.ui.plugin.call(this,t,[i,o,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),o.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,o)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,o){var r=e.extend({},i,{item:o.element});o.sortables=[],e(o.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(o.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i,o){var r=e.extend({},i,{item:o.element});o.cancelHelperRemoval=!1,e.each(o.sortables,function(){var e=this;e.isOver?(e.isOver=0,o.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,r))})},drag:function(t,i,o){e.each(o.sortables,function(){var r=!1,s=this;s.positionAbs=o.positionAbs,s.helperProportions=o.helperProportions,s.offset.click=o.offset.click,s._intersectsWith(s.containerCache)&&(r=!0,e.each(o.sortables,function(){return this.positionAbs=o.positionAbs,this.helperProportions=o.helperProportions,this.offset.click=o.offset.click,this!==s&&this._intersectsWith(this.containerCache)&&e.contains(s.element[0],this.element[0])&&(r=!1),r})),r?(s.isOver||(s.isOver=1,o._parent=i.helper.parent(),s.currentItem=i.helper.appendTo(s.element).data("ui-sortable-item",!0),s.options._helper=s.options.helper,s.options.helper=function(){return i.helper[0]},t.target=s.currentItem[0],s._mouseCapture(t,!0),s._mouseStart(t,!0,!0),s.offset.click.top=o.offset.click.top,s.offset.click.left=o.offset.click.left,s.offset.parent.left-=o.offset.parent.left-s.offset.parent.left,s.offset.parent.top-=o.offset.parent.top-s.offset.parent.top,o._trigger("toSortable",t),o.dropped=s.element,e.each(o.sortables,function(){this.refreshPositions()}),o.currentItem=o.element,s.fromOutside=o),s.currentItem&&(s._mouseDrag(t),i.position=s.position)):s.isOver&&(s.isOver=0,s.cancelHelperRemoval=!0,s.options._revert=s.options.revert,s.options.revert=!1,s._trigger("out",t,s._uiHash(s)),s._mouseStop(t,!0),s.options.revert=s.options._revert,s.options.helper=s.options._helper,s.placeholder&&s.placeholder.remove(),i.helper.appendTo(o._parent),o._refreshOffsets(t),i.position=o._generatePosition(t,!0),o._trigger("fromSortable",t),o.dropped=!1,e.each(o.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,o){var r=e("body"),s=o.options;r.css("cursor")&&(s._cursor=r.css("cursor")),r.css("cursor",s.cursor)},stop:function(t,i,o){var r=o.options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,o){var r=e(i.helper),s=o.options;r.css("opacity")&&(s._opacity=r.css("opacity")),r.css("opacity",s.opacity)},stop:function(t,i,o){var r=o.options;r._opacity&&e(i.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,o){var r=o.options,s=!1,n=o.scrollParentNotHidden[0],a=o.document[0];n!==a&&"HTML"!==n.tagName?(r.axis&&"x"===r.axis||(o.overflowOffset.top+n.offsetHeight-t.pageY<r.scrollSensitivity?n.scrollTop=s=n.scrollTop+r.scrollSpeed:t.pageY-o.overflowOffset.top<r.scrollSensitivity&&(n.scrollTop=s=n.scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(o.overflowOffset.left+n.offsetWidth-t.pageX<r.scrollSensitivity?n.scrollLeft=s=n.scrollLeft+r.scrollSpeed:t.pageX-o.overflowOffset.left<r.scrollSensitivity&&(n.scrollLeft=s=n.scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(a).scrollTop()<r.scrollSensitivity?s=e(a).scrollTop(e(a).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<r.scrollSensitivity&&(s=e(a).scrollTop(e(a).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(a).scrollLeft()<r.scrollSensitivity?s=e(a).scrollLeft(e(a).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<r.scrollSensitivity&&(s=e(a).scrollLeft(e(a).scrollLeft()+r.scrollSpeed)))),!1!==s&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(o,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,o){var r=o.options;o.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var t=e(this),i=t.offset();this!==o.element[0]&&o.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,o){var r,s,n,a,l,d,c,h,u,p,m=o.options,f=m.snapTolerance,g=i.offset.left,v=g+o.helperProportions.width,y=i.offset.top,_=y+o.helperProportions.height;for(u=o.snapElements.length-1;u>=0;u--)l=o.snapElements[u].left-o.margins.left,d=l+o.snapElements[u].width,c=o.snapElements[u].top-o.margins.top,h=c+o.snapElements[u].height,v<l-f||g>d+f||_<c-f||y>h+f||!e.contains(o.snapElements[u].item.ownerDocument,o.snapElements[u].item)?(o.snapElements[u].snapping&&o.options.snap.release&&o.options.snap.release.call(o.element,t,e.extend(o._uiHash(),{snapItem:o.snapElements[u].item})),o.snapElements[u].snapping=!1):("inner"!==m.snapMode&&(r=Math.abs(c-_)<=f,s=Math.abs(h-y)<=f,n=Math.abs(l-v)<=f,a=Math.abs(d-g)<=f,r&&(i.position.top=o._convertPositionTo("relative",{top:c-o.helperProportions.height,left:0}).top),s&&(i.position.top=o._convertPositionTo("relative",{top:h,left:0}).top),n&&(i.position.left=o._convertPositionTo("relative",{top:0,left:l-o.helperProportions.width}).left),a&&(i.position.left=o._convertPositionTo("relative",{top:0,left:d}).left)),p=r||s||n||a,"outer"!==m.snapMode&&(r=Math.abs(c-y)<=f,s=Math.abs(h-_)<=f,n=Math.abs(l-g)<=f,a=Math.abs(d-v)<=f,r&&(i.position.top=o._convertPositionTo("relative",{top:c,left:0}).top),s&&(i.position.top=o._convertPositionTo("relative",{top:h-o.helperProportions.height,left:0}).top),n&&(i.position.left=o._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=o._convertPositionTo("relative",{top:0,left:d-o.helperProportions.width}).left)),!o.snapElements[u].snapping&&(r||s||n||a||p)&&o.options.snap.snap&&o.options.snap.snap.call(o.element,t,e.extend(o._uiHash(),{snapItem:o.snapElements[u].item})),o.snapElements[u].snapping=r||s||n||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,o){var r,s=o.options,n=e.makeArray(e(s.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(r=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(t){e(this).css("zIndex",r+t)}),this.css("zIndex",r+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,o){var r=e(i.helper),s=o.options;r.css("zIndex")&&(s._zIndex=r.css("zIndex")),r.css("zIndex",s.zIndex)},stop:function(t,i,o){var r=o.options;r._zIndex&&e(i.helper).css("zIndex",r._zIndex)}}),e.ui.draggable}),define("common/component/dialog/Dialog",["require","underscore","jquery","common/component/base/Dimmer","common/component/panel/Panel","common/component/base/OptionContainer","common/component/panel/trait/resizablePanelTrait","text!./template/dialogTemplate.htm","text!./template/dialogButtonTemplate.htm","jquery-ui/widgets/draggable"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),o=e("common/component/base/Dimmer"),r=e("common/component/panel/Panel"),s=e("common/component/base/OptionContainer"),n=e("common/component/panel/trait/resizablePanelTrait"),a=e("text!./template/dialogTemplate.htm"),l=e("text!./template/dialogButtonTemplate.htm");e("jquery-ui/widgets/draggable");var d=r.extend({defaultTemplate:a,events:{mousedown:"_focus",touchstart:"_focus",keydown:"_onKeyDown",keyup:"_onKeyboardEvent",keypress:"_onKeyboardEvent",resize:"_onDialogResize"},constructor:function(e){e||(e={}),e.traits||(e.traits=[]),this.resizable=e.resizable||!1,this.modal=e.modal||!1,this.additionalBodyCssClasses=e.additionalBodyCssClasses||"",this.resizable&&-1===t.indexOf(e.traits,n)&&e.traits.push(n),r.call(this,e)},initialize:function(e){this.dialogOptions=t.extend({},e),this.collapsed=!this.collapsed,this.resetSizeOnOpen=!!t.isUndefined(e.resetSizeOnOpen)||e.resetSizeOnOpen,t.isEmpty(e.buttons)||(this.buttons=new s({options:e.buttons,el:this.$(".jr-mDialog-footer")[0]||this.$(".footer")[0],contextName:"button",optionTemplate:e.dialogButtonTemplate||l})),r.prototype.initialize.apply(this,arguments),this.buttons&&this.listenTo(this.buttons,t.map(e.buttons,function(e){return"button:"+e.action}).join(" "),t.bind(function(e,t){this.trigger("button:"+t.get("action"),e,t)},this)),this.render()},getTemplateArguments:function(){var e=r.prototype.getTemplateArguments.apply(this,arguments);return t.extend(e,{additionalBodyCssClasses:this.additionalBodyCssClasses})},setElement:function(e){var t=r.prototype.setElement.apply(this,arguments);return this.buttons&&this.buttons.setElement(this.$(".jr-mDialog-footer")[0]||this.$(".footer")[0]),t},setTitle:function(e){this.$(".jr-mDialog-header > .jr-mDialog-header-title").text(e)},render:function(){return this.$el.hide(),this.modal&&(this.dimmer=new o({zIndex:900})),i("body").append(this.$el),this.$el.draggable({handle:".mover",addClasses:!1,containment:"document"}),this},open:function(e){return this.isVisible()?this:(this.resetSizeOnOpen&&(this.$el.css({height:"",width:""}),this.$el.find("textarea").css({height:"",width:""})),r.prototype.open.apply(this,arguments),this.modal&&this.dimmer.css({zIndex:++d.highestIndex}).show(),this._setMinSize(),this._position(e),this._increaseZIndex(),this.buttons&&this.buttons.$(".over").removeClass("over"),this.$el.show(),this.$el.find("input").first().focus(),this._onDialogResize(),this.trigger("dialog:visible"),this)},close:function(){if(this.isVisible())return this.$el.css({zIndex:--d.highestIndex}),this.modal&&this.dimmer.css({zIndex:--d.highestIndex}).hide(),this.$el.hide(),r.prototype.close.apply(this,arguments),this},addCssClasses:function(e){this.$el.addClass(e)},toggleCollapsedState:function(){return this},enableButton:function(e){this.buttons.enable(e)},disableButton:function(e){this.buttons.disable(e)},isVisible:function(){return this.$el.is(":visible")},_setMinSize:function(){this.dialogOptions.minWidth&&this.$el.css({minWidth:this.dialogOptions.minWidth}),this.dialogOptions.minHeight&&this.$el.css({minHeight:this.dialogOptions.minHeight}),this.dialogOptions.setMinSizeAsSize&&this.$el.css({width:this.dialogOptions.minWidth,height:this.dialogOptions.minHeight})},_position:function(e){var t,o,r=i("body"),s=this.$el.height(),n=this.$el.width();if(e&&void 0!==e.top&&void 0!==e.left){t=e.top,o=e.left;var a=r.height(),l=r.width(),d=a-e.top,c=l-e.left;d<s&&(t=e.top-s,t=t<0?a/2-s/2:t),c<n&&(o=e.left-n,o=o<0?l/2-n/2:o)}else t=i(window).height()/2-s/2,o=i(window).width()/2-n/2;return this.$el.css({top:Math.max(0,t),
left:Math.max(0,o),position:"absolute"}),this},_focus:function(){!this.modal&&this._increaseZIndex()},_increaseZIndex:function(){this.$el.css({zIndex:++d.highestIndex})},_onKeyDown:function(e){this.buttons._onKeyDown(e),e.stopPropagation()},_onKeyboardEvent:function(e){e.stopPropagation()},_onDialogResize:function(){},remove:function(){this.buttons&&this.buttons.remove(),this.dimmer&&this.dimmer.remove();try{this.$el.draggable("destroy")}catch(e){}r.prototype.remove.call(this)}},{highestIndex:5e3,resetHighestIndex:function(e){d.highestIndex=e||5e3}});return d}),define("text!common/component/dialog/template/alertDialogTemplate.htm",[],function(){return"<p class='alertText'>\n\n    <js-templateNonce></js-templateNonce>\n    {{- message }}\n</p>"}),define("common/component/dialog/AlertDialog",["require","underscore","./Dialog","common/util/xssUtil","text!./template/alertDialogTemplate.htm","bundle!js-sdk/CommonBundle"],function(e){"use strict";var t=e("underscore"),i=e("./Dialog"),o=e("common/util/xssUtil"),r=e("text!./template/alertDialogTemplate.htm"),s=e("bundle!js-sdk/CommonBundle");return i.extend({contentTemplate:t.template(r),constructor:function(e){e||(e={}),i.prototype.constructor.call(this,{modal:!1!==e.modal,message:e.message,additionalCssClasses:"alertDialog "+(e.additionalCssClasses||""),title:e.title||s["dialog.exception.title"],buttons:[{label:s["button.close"],action:"close",primary:!0}]},e)},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.on("button:close",this.close),this.setMessage(e.message)},setMessage:function(e){e=o.softHtmlEscape(e,{whiteList:["br"]}),this.content=this.contentTemplate({message:e});var t=this.renderContent();this.$contentContainer.html(t)}})}),define("text!common/component/dialog/template/confirmDialogTemplate.htm",[],function(){return"<p class='confirmationText'>\n\n    <js-templateNonce></js-templateNonce>\n    {{ print(_.xssSoftEscape(text)) }}\n</p>"}),define("common/component/dialog/ConfirmationDialog",["require","underscore","./Dialog","text!./template/confirmDialogTemplate.htm","bundle!js-sdk/CommonBundle"],function(e){"use strict";var t=e("underscore"),i=e("./Dialog"),o=e("text!./template/confirmDialogTemplate.htm"),r=e("bundle!js-sdk/CommonBundle");return i.extend({constructor:function(e){e||(e={}),this.confirmDialogTemplate=t.template(o),i.prototype.constructor.call(this,{modal:!0,additionalCssClasses:e.additionalCssClasses||"confirmationDialog",title:e.title||r["dialog.confirm.title"],content:this.confirmDialogTemplate({text:e.text}),buttons:[{label:e.yesLabel||r["button.yes"],action:"yes",primary:!0},{label:e.noLabel||r["button.no"],action:"no",primary:!1}]})},initialize:function(){i.prototype.initialize.apply(this,arguments),this.on("button:yes",this.close),this.on("button:no",this.close)},setContent:function(e){i.prototype.setContent.call(this,this.confirmDialogTemplate({text:e}))}})});var invokeRedirectAction=_.debounce(function(e){repositorySearch.RedirectAction["create"+e].call().invokeAction()},500),repositorySearch={_container:null,mode:null,isFlowRedirectRunning:!1,flowExecutionKey:"",messages:[],Mode:{SEARCH:"search",BROWSE:"browse",LIBRARY:"library"},ResourceType:{REPORT_UNIT:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.ReportUnit",ADHOC_REPORT_UNIT:"com.jaspersoft.ji.adhoc.AdhocReportUnit",OLAP_UNIT:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapUnit",DASHBOARD_RESOURCE:"com.jaspersoft.ji.adhoc.DashboardResource",DASHBOARD:"com.jaspersoft.ji.dashboard.DashboardModelResource",REPORT_OPTIONS:"com.jaspersoft.ji.report.options.metadata.ReportOptions",REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.ReportDataSource",JDBC_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.JdbcReportDataSource",JNDI_JDBC_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.JndiJdbcReportDataSource",VIRTUAL_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.VirtualReportDataSource",CUSTOM_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.CustomReportDataSource",BEAN_REPORT_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.jasperreports.domain.BeanReportDataSource",OLAP_DATA_SOURCE:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapDataSource",OLAP_CLIENT_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.OlapClientConnection",QUERY:"com.jaspersoft.jasperserver.api.metadata.common.domain.Query",INPUT_CONTROL:"com.jaspersoft.jasperserver.api.metadata.common.domain.InputControl",LIST_OF_VALUES:"com.jaspersoft.jasperserver.api.metadata.common.domain.ListOfValues",LIST_OF_VALUES_ITEM:"com.jaspersoft.jasperserver.api.metadata.common.domain.ListOfValuesItem",DATA_TYPE:"com.jaspersoft.jasperserver.api.metadata.common.domain.DataType",MONDRIAN_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.MondrianConnection",SECURE_MONDRIAN_CONNECTION:"com.jaspersoft.ji.ja.security.domain.SecureMondrianConnection",XMLA_CONNECTION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.XMLAConnection",MONDRIAN_XMLA_DEFINITION:"com.jaspersoft.jasperserver.api.metadata.olap.domain.MondrianXMLADefinition",CONTENT_RESOURCE:"com.jaspersoft.jasperserver.api.metadata.common.domain.ContentResource",FILE_RESOURCE:"com.jaspersoft.jasperserver.api.metadata.common.domain.FileResource",SEMANTIC_LAYER_DATA_SOURCE:"com.jaspersoft.commons.semantic.datasource.SemanticLayerDataSource",DATA_DEFINER_UNIT:"com.jaspersoft.commons.semantic.DataDefinerUnit"},SearchAction:{NEXT:"next",GET_RESOURCE_CHILDREN:"getResourceChildren"},Event:{SEARCH_RUN:"search:run",SEARCH_BROWSE:"search:browse",SEARCH_FILTER:"search:filter",SEARCH_SORT:"search:sort",SEARCH_NEXT:"search:next",SEARCH_ROLLBACK:"search:rollback",SEARCH_SEARCH:"search:search",SEARCH_CHILDREN:"search:children",STATE_CHANGED:"state:changed",FILTER_PATH_CHANGED:"filterPath:changed",RESULT_CHANGED:"result:changed",CHILDREN_LOADED:"resourceChildren:loaded",RESULT_NEXT:"result:next",RESULT_ERROR:"result:error",REDIRECT_ERROR:"redirect:error",FLOW_REDIRECT_RUNNING:"flowRedirect:running"},InfoAction:{GET_DISPLAY_PATH:"getDisplayPath"},PermissionAction:{BROWSE:"permissionBrowse",SEARCH:"permissionSearch",NEXT:"permissionNext",UPDATE:"permissionsUpdate"},PermissionEvent:{BROWSE:"permission:browse",SEARCH:"permission:search",NEXT:"permission:next",UPDATE:"permission:update",LOADED:"permission:loaded",UPDATED:"permission:updated",ERROR:"permission:error"},FolderAction:{CREATE:"createFolder",COPY:"copyFolder",MOVE:"moveFolder",UPDATE:"updateFolder",DELETE:"deleteFolder"},FolderEvent:{DELETED:"folder:deleted",DELETE_ERROR:"folder:deleteError",CREATED:"folder:created",CREATE_ERROR:"folder:createError",COPIED:"folder:copied",COPY_ERROR:"folder:copyError",MOVED:"folder:moved",MOVE_ERROR:"folder:moveError",UPDATED:"folder:updated",UPDATE_ERROR:"folder:updateError"},ResourceAction:{DELETE:"deleteResources",COPY:"copyResources",MOVE:"moveResources",UPDATE:"updateResource",GENERATE:"generate",CONVERT:"convert"},ResourceEvent:{DELETED:"resource:deleted",DELETE_ERROR:"resource:deleteError",COPIED:"resource:copied",COPY_ERROR:"resource:copyError",MOVED:"resource:moved",MOVE_ERROR:"resource:moveError",UPDATED:"resource:updated",UPDATE_ERROR:"resource:updateError",GENERATED:"resource:generated",GENERATE_ERROR:"resource:generateError",CONVERTED:"resource:converted",CONVERT_ERROR:"resource:convertError"},RedirectType:{FLOW_REDIRECT:0,LOCATION_REDIRECT:1,WINDOW_REDIRECT:2},ThemeAction:{SETTHEME:"setActiveTheme",DOWNLOAD_THEME:"downloadTheme",REUPLOAD:"reuploadTheme"},ThemeEvent:{UPDATED:"theme:updated",REUPLOADED:"theme:reuploaded",THEME_ERROR:"theme:error"},initialize:function(e){function t(e,t){if(e){var i="USER"==t?orgModule.User:orgModule.Role;return e.collect(function(e){return new i(e)})}return[]}var i=e.rsInitOptions;repositorySearch.mode=i.mode,repositorySearch.flowExecutionKey=i.flowExecutionKey,layoutModule.resizeOnClient("repoSearch"==document.body.id?"searchFilters":"folders","results"),webHelpModule.setCurrentContext(repositorySearch.mode===repositorySearch.Mode.SEARCH?"search":"repo"),i.enableDnD=repositorySearch.mode==repositorySearch.Mode.BROWSE&&!isIPad(),repositorySearch.model.setPublicFolderUri(i.publicFolderUri),repositorySearch.model.setTempFolderUri(i.tempFolderUri),repositorySearch.model.setRootFolderUri(i.rootFolderUri),repositorySearch.model.setOrganizationsFolderUri(i.organizationsFolderUri),repositorySearch.model.setFolderSeparator(i.folderSeparator),repositorySearch.model.setAdministrator(i.isAdministrator),repositorySearch.model.setConfiguration(i.configuration),repositorySearch.model.setServerState(i.state),repositorySearch.CursorManager.initialize(),repositorySearch.actionModel.initialize(),repositorySearch.mode==repositorySearch.Mode.BROWSE?(repositorySearch.toolbar.initialize(repositorySearch.actionModel.bulkActions),repositorySearch.foldersPanel.initialize(i)):(repositorySearch.filtersPanel.initialize(repositorySearch.model.getFiltersConfiguration(),repositorySearch.model.getFiltersState()),repositorySearch.secondarySearchBox.initialize(repositorySearch.model.getTextState()),repositorySearch.filterPath.initialize()),repositorySearch.resultsPanel.initialize(i),repositorySearch.sortersPanel.initialize(repositorySearch.model.getSortersConfiguration(),repositorySearch.model.getSortState()),repositorySearch.initFolderEvents(),repositorySearch.initResourceEvents(),repositorySearch.initThemeEvents(),repositorySearch.observe("search:filter",function(e){new repositorySearch.ServerAction.createSearchAction("filter",{filterId:e.memo.filterId,filterOption:e.memo.optionId}).invokeAction()}),repositorySearch.observe("search:sort",function(e){new repositorySearch.ServerAction.createSearchAction("sort",{sortBy:e.memo.sorterId}).invokeAction()}),repositorySearch.observe("search:browse",function(e){new repositorySearch.ServerAction.createSearchAction("browse",{folderUri:e.memo.uri}).invokeAction(),repositorySearch.actionModel.refreshToolbar()}),repositorySearch.observe("search:search",function(e){new repositorySearch.ServerAction.createSearchAction("search",{text:e.memo.text}).invokeAction()}),repositorySearch.observe("search:next",function(e){new this.ServerAction.createSearchAction(this.SearchAction.NEXT,{}).invokeAction()}.bindAsEventListener(repositorySearch)),repositorySearch.observe("search:rollback",function(e){new repositorySearch.ServerAction.createSearchAction("rollback",{position:e.memo.position}).invokeAction()}),repositorySearch.observe("search:children",function(e){var t=e.memo.resource,i=e.memo.item;new this.ServerAction.createSearchAction(this.SearchAction.GET_RESOURCE_CHILDREN,{resourceUri:t.URIString,resourceType:t.resourceType,item:i}).invokeAction()}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:browse",function(e){new repositorySearch.ServerAction.createPermissionAction(this.PermissionAction.BROWSE,e.memo).invokeAction()}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:search",function(e){new repositorySearch.ServerAction.createPermissionAction(this.PermissionAction.SEARCH,e.memo).invokeAction()}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:next",function(e){new repositorySearch.ServerAction.createPermissionAction(this.PermissionAction.NEXT,e.memo).invokeAction()}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:update",function(e){var t=e.memo.uri,i=e.memo.entities,o=e.memo.finishEdit;if(i.length>0){var r=i.collect(function(e){return e.toPermissionData()});new repositorySearch.ServerAction.createPermissionAction(this.PermissionAction.UPDATE,{uri:t,entitiesWithPermission:Object.toJSON(r),finishEdit:o}).invokeAction()}else{var s=repositorySearch.dialogsPool.getPermissionsDialog(t);o&&s.hide()}}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:loaded",function(e){var i=e.memo.responseData,o=repositorySearch.dialogsPool.getPermissionsDialog(e.memo.inputData.uri);o.stopWaiting(),i&&(e.memo.doSet?o.setEntities(t(i.entities,i.type)):o.addEntities(t(i.entities,i.type)),"USER"===i.type?(buttonManager.select(o._byUsersButton.parentNode),buttonManager.unSelect(o._byRolesButton.parentNode)):(buttonManager.unSelect(o._byUsersButton.parentNode),buttonManager.select(o._byRolesButton.parentNode)))}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:updated",function(e){var i=e.memo.inputData.uri,o=e.memo.inputData.finishEdit,r=repositorySearch.dialogsPool.getPermissionsDialog(i);if(r.enable(),o)r.hide();else{var s=e.memo.responseData;s&&r.updateEntities(t(s.entities,s.type))}}.bindAsEventListener(repositorySearch)),repositorySearch.observe("permission:error",function(e){alert(Object.toJSON(e.memo))}.bindAsEventListener(repositorySearch)),repositorySearch.observe("resourceChildren:loaded",function(e){var t=e.memo.inputData.item,i=t.getValue(),o=e.memo.responseData;if(Object.isArray(o)){var r=[];o.each(function(e){var t=new Resource(e);i.addChild(t),r.push(t)}),repositorySearch.resultsPanel.setResources(r,t),i.isLoaded()&&t.isLoading&&t.setLoading(!1)}}.bindAsEventListener(repositorySearch)),repositorySearch.observe("state:changed",function(e){repositorySearch.updateUI(e.memo.state)}),repositorySearch.observe("filterPath:changed",function(e){repositorySearch.filterPath.setPathItems(e.memo.filterPath)}),repositorySearch.observe("result:changed",function(e){var t=e.memo.resources,i=t.collect(function(e){return new Resource(e)});repositorySearch.resultsPanel.setResources(i)}),repositorySearch.observe("result:next",function(e){var t=e.memo.resources,i=t.collect(function(e){return new Resource(e)});repositorySearch.resultsPanel.addResources(i)}),repositorySearch.observe("result:error",this.defaultErrorHandler),repositorySearch.observe("redirect:error",this.defaultErrorHandler),repositorySearch.observe("flowRedirect:running",function(){repositorySearch.isflowRedirectRunning=!0,repositorySearch.toolbar.refresh()}),repositorySearch.Mode.BROWSE!=i.mode&&repositorySearch.fire(repositorySearch.Event.SEARCH_SEARCH,{text:repositorySearch.model.getTextState()}),e.rsInitOptions.systemConfirm.blank()||dialogs.systemConfirm.show(e.rsInitOptions.systemConfirm),e.rsInitOptions.errorPopupMessage.blank()||dialogs.errorPopup.show(e.rsInitOptions.errorPopupMessage),this._disableBfCacheIfSafari()},showContextMenu:function(e){var t=e.memo.targetEvent;if(repositorySearch.mode==repositorySearch.Mode.BROWSE&&repositorySearch.foldersPanel.isFolderContextMenu(t)&&repositorySearch.actionModel.showFolderMenu(t),repositorySearch.resultsPanel.isResourceContextMenu(t)){repositorySearch.model.getSelectedResources().length>1?repositorySearch.actionModel.showResourceBulkMenu(t):repositorySearch.actionModel.showResourceMenu(t)}},_disableBfCacheIfSafari:function(){isWebKitEngine()&&(window.onpageshow=function(){event.persisted&&window.location.reload()})},updateUI:function(e){e.sortBy!=repositorySearch.model.getSortState()&&repositorySearch.sortersPanel.select(e.sortBy,!0),e.text!=repositorySearch.model.getTextState()&&repositorySearch.mode!=repositorySearch.Mode.BROWSE&&repositorySearch.secondarySearchBox.setText(e.text);for(var t in e.customFilters)e.customFilters[t]!=repositorySearch.model.getFiltersState()[t]&&repositorySearch.filtersPanel.select(t,e.customFilters[t],!0);e.folderUri,repositorySearch.model.getFolderUriState(),repositorySearch.model.setServerState(e)},initFolderEvents:function(){this.observe("folder:deleted",function(e){var t=e.memo.inputData.folder,i=t.getParentFolder(),o=repositorySearch.foldersPanel;o.refreshFolder(i),"/"===i.URI&&o.tree._selectOrEditNode(void 0,i.node,!1)}),this.observe("folder:deleteError",this.defaultErrorHandler),this.observe("folder:created",function(e){var t=e.memo.inputData.toFolder;repositorySearch.foldersPanel.refreshFolder(t)}),this.observe("folder:createError",this.defaultErrorHandler),this.observe("folder:copied",function(e){var t=e.memo.inputData.folder,i=e.memo.inputData.toFolder;repositorySearch.CopyMoveController.cancel(),repositorySearch.foldersPanel.moveOrCopyFolder(t,i,!0)}),this.observe("folder:copyError",this.defaultErrorHandler),this.observe("folder:moved",function(e){var t=e.memo.inputData.folder,i=e.memo.inputData.toFolder;repositorySearch.CopyMoveController.cancel(),repositorySearch.foldersPanel.moveOrCopyFolder(t,i)}),this.observe("folder:moveError",this.defaultErrorHandler),this.observe("folder:updated",function(e){var t=e.memo.inputData.folder,i=e.memo.responseData.label,o=e.memo.responseData.desc;repositorySearch.foldersPanel.updateFolder(t,i,o)}),this.observe("folder:updateError",this.defaultErrorHandler)},initResourceEvents:function(){this.observe("resource:deleted",function(e){var t=e.memo.inputData.resources,i=e.memo.responseData;if(i.dependentResources)dialogs.dependentResources.show(i.dependentResources,null,{okOnly:!0,canSave:!1,topMessage:repositorySearch.messages["dialog.dependencies.resources.message"],bottomMessage:repositorySearch.messages["dialog.dependencies.resources.deleteMessage"]});else{repositorySearch.model.getSelectedFolder();repositorySearch.resultsPanel.removeResources(t)}}),this.observe("resource:deleteError",this.defaultErrorHandler),this.observe("resource:copied",function(e){var t=e.memo.inputData.folder;repositorySearch.foldersPanel.reselectFolder(t)}),this.observe("resource:copyError",this.defaultErrorHandler),this.observe("resource:moved",function(e){var t=e.memo.inputData.folder,i=repositorySearch.model.getSelectedFolder();repositorySearch.foldersPanel.reselectFolder(t),repositorySearch.foldersPanel.reselectFolder(i)}),this.observe("resource:moveError",this.defaultErrorHandler),this.observe("resource:updated",function(e){repositorySearch.resultsPanel.updateResource(new Resource(e.memo.responseData))}),this.observe("resource:updateError",this.defaultErrorHandler),this.observe("resource:generated",function(e){var t=e.memo.inputData,i=e.memo.responseData,o=new Resource(i);if(t.run){repositorySearch.RedirectAction.createRunResourceAction(o,!1).invokeAction()}else repositorySearch.mode==repositorySearch.Mode.BROWSE?t.location==repositorySearch.foldersPanel.getSelectedUri()&&repositorySearch.foldersPanel.doBrowse():repositorySearch.fire(repositorySearch.Event.SEARCH_SEARCH,{text:repositorySearch.model.getTextState()});dialogs.systemConfirm.show(repositorySearch.messages.RM_REPORT_CREATED,5e3)}),this.observe("resource:generateError",function(e){var t,i=(e.memo.inputData,e.memo.responseData),o=i.msg,r=i.data;o&&o.indexOf("SYSTEM_CONFIRM_REQUIRED")>-1?r&&require(["common/component/dialog/ConfirmationDialog"],function(e){var i=new e({text:Utils.restOfString(o,"SYSTEM_CONFIRM_REQUIRED:")});i.on("button:yes",function(){r.overwrite=!0;var e=repositorySearch.ResourceAction.GENERATE;t=new repositorySearch.ServerAction.createGenerateAction(e,r),t.invokeAction(),i.remove()}),i.on("button:no",function(){i.remove()}),i.open()}):repositorySearch.defaultErrorHandler(e)}),this.observe("resource:converted",function(e){dialogs.systemConfirm.show(e.memo.responseData||e.memo,5e3),repositorySearch.mode==repositorySearch.Mode.BROWSE?repositorySearch.foldersPanel.doBrowse():repositorySearch.fire(repositorySearch.Event.SEARCH_SEARCH,{text:repositorySearch.model.getTextState()})}),this.observe("resource:convertError",this.defaultErrorHandler)},defaultErrorHandler:function(e){require(["common/component/dialog/AlertDialog","bundle!jasperserver_messages"],function(t,i){var o=new t({title:i["dialog.dependencies.title"]});o.setMessage(e.memo.responseData||e.memo),o.open()})},initThemeEvents:function(){this.observe("theme:updated",function(e){var t=e.memo.responseData;if(t&&t.refresh)document.body.style.cursor="wait",window.location.reload(!0);else{var i=repositorySearch&&repositorySearch.model&&repositorySearch.model.getContextFolder()&&repositorySearch.model.getContextFolder().getParentFolder();i&&repositorySearch.foldersPanel&&repositorySearch.foldersPanel.refreshFolder&&repositorySearch.foldersPanel.refreshFolder(i)}}),this.observe("theme:reuploaded",function(e){if(e.memo.responseData.isActiveTheme){var t=e.memo.responseData.themeUri;new repositorySearch.ServerAction.createFolderAction(repositorySearch.ThemeAction.SETTHEME,{folderUri:t}).invokeAction()}}),this.observe("theme:error",function(e){var t=e.memo.responseData;t&&alert(t)})},getMessage:function(e,t){var i=repositorySearch.messages[e];return i?new Template(i).evaluate(t||{}):""},_createAction:function(e,t){var i;if(t.endsWith("FolderAction")){var o=repositorySearch.model.getContextFolder();i=e["create"+t].call(null,o)}else if(t.endsWith("ResourceAction")||t.endsWith("RunAction")){var r=repositorySearch.model.getContextResource();i=e["create"+t].call(null,r)}else i=e["create"+t].call();return i},observe:function(e,t){this._getContainer().observe(e,t)},stopObserving:function(e,t){this._getContainer().stopObserving(e,t)},fire:function(e,t){this._getContainer().fire(e,t)},_getContainer:function(){return this._container||(this._container=document.body),this._container}};repositorySearch.model={_organizationsFolderUri:null,_rootFolderUri:null,_tempFolderUri:null,_publicFolderUri:null,_folderSeparator:null,_configuration:{},_serverState:{},_uiState:{selectedFolder:null,contextFolder:null,contextResource:null,selectedResources:[]},_isAdministrator:!1,setOrganizationsFolderUri:function(e){this._organizationsFolderUri=e},getOrganizationsFolderUri:function(){return this._organizationsFolderUri},setRootFolderUri:function(e){this._rootFolderUri=e},getRootFolderUri:function(){return this._rootFolderUri},setTempFolderUri:function(e){this._tempFolderUri=e},getTempFolderUri:function(){return this._tempFolderUri},setPublicFolderUri:function(e){this._publicFolderUri=e},getPublicFolderUri:function(){return this._publicFolderUri},setFolderSeparator:function(e){this._folderSeparator=e},getFolderSeparator:function(){return this._folderSeparator},setConfiguration:function(e){this._configuration=e},getConfiguration:function(){return this._configuration},getFiltersConfiguration:function(){return this.getConfiguration().filters},getSortersConfiguration:function(){return this.getConfiguration().sorters},setServerState:function(e){this._serverState=e},getServerState:function(){return this._serverState},getUIState:function(){return this._uiState},setAdministrator:function(e){this._isAdministrator=e},isAdministrator:function(){return this._isAdministrator},getFiltersState:function(){return this.getServerState().customFilters},getSortState:function(){return this.getServerState().sortBy},getTextState:function(){return this.getServerState().text},getFolderUriState:function(){return this.getServerState().folderUri},setSelectedFolder:function(e){return this.getUIState().selectedFolder=e},getSelectedFolder:function(){return this.getUIState().selectedFolder},setContextFolder:function(e){return this.getUIState().contextFolder=e},getContextFolder:function(){return this.getUIState().contextFolder},setSelectedResources:function(e){return this.getUIState().selectedResources=e},getSelectedResources:function(){return this.getUIState().selectedResources}},repositorySearch.actionModel={bulkActions:{RUN:{buttonId:"run",action:invokeBulkAction,actionArgs:"Run",test:canAllBeRun},EDIT:{buttonId:"edit",action:invokeBulkAction,actionArgs:"Edit",test:canAllBeEdited},OPEN:{buttonId:"open",action:invokeBulkAction,actionArgs:"Open",test:canAllBeOpened},COPY:{buttonId:"copy",action:invokeBulkAction,actionArgs:"Copy",test:canAllBeCopied},CUT:{buttonId:"cut",action:invokeBulkAction,actionArgs:"Move",test:canAllBeMoved},PASTE:{buttonId:"paste",action:invokeFolderAction,actionArgs:"PasteResources",test:canAllBePasted},REMOVE:{buttonId:"remove",action:invokeBulkAction,actionArgs:"Delete",test:canAllBeDeleted}},_holderId:"searchActionModel",_folderMenu:"folder_mutton",_resourceMenu:"resource_menu",_resourceBulkMenu:"resource_bulk_menu",initialize:function(){var e=$(layoutModule.PAGE_BODY_ID);e&&e.observe(isSupportsTouch()?"touchstart":"click",function(e){isIPad()?!isRightClick(e)&&1==e.touches.length&&actionModel.hideMenu():!isRightClick(e)&&actionModel.hideMenu()})},showFolderMenu:function(e,t){actionModel.showDynamicMenu(this._folderMenu,e,null,t,this._holderId)},showResourceBulkMenu:function(e,t){actionModel.showDynamicMenu(this._resourceBulkMenu,e,null,t,this._holderId)},showResourceMenu:function(e,t){actionModel.showDynamicMenu(this._resourceMenu,e,null,t,this._holderId)},refreshToolbar:function(e){repositorySearch.toolbar.refresh()}},repositorySearch.CopyMoveController={object:null,_move:!1,_copy:!1,_dndMode:!1,onMove:function(){repositorySearch.CursorManager.move(),repositorySearch.actionModel.refreshToolbar()},onCopy:function(){repositorySearch.CursorManager.copy(),repositorySearch.actionModel.refreshToolbar()},onCancel:function(){repositorySearch.CursorManager.none(),repositorySearch.actionModel.refreshToolbar()},isObjectInstanceOf:function(e){var t=this.object;return!!t&&(this.isBulkAction()?t.length==t.findAll(function(t){return t instanceof e}).length:t instanceof e)},isMoveResource:function(){return this._move&&this.isObjectInstanceOf(Resource)},isMoveFolder:function(){return this._move&&this.isObjectInstanceOf(Folder)},isCopyResource:function(){return this._copy&&this.isObjectInstanceOf(Resource)},isCopyFolder:function(){return this._copy&&this.isObjectInstanceOf(Folder)},isBulkAction:function(){return Object.isArray(this.object)},move:function(e,t){this.cancel(),this.object=e,this._move=!0,this._copy=!1,this._dndMode=t,this.onMove()},copy:function(e,t){this.cancel(),this.object=e,this._move=!1,this._copy=!0,this._dndMode=t,this.onCopy()},cancel:function(){this.object=null,this._move=!1,this._copy=!1,this.onCancel()},isMove:function(){return this._move},isCopy:function(){return this._copy},isDnd:function(){return this._dndMode}},repositorySearch.CursorManager={container:null,className:["copy_cursor","move_cursor"],initialize:function(){this.container=$("display")},copy:function(){this.none(),this.container.addClassName(this.className[0])},move:function(){this.none(),this.container.addClassName(this.className[1])},none:function(){this.className.each(function(e,t){this.container.removeClassName(this.className[t])}.bind(this))}};var Resource=function(e){this._json=e,this.name=e.name,this.label=e.label,this.description=e.description,this.date=e.date,this.dateTimestamp=e.dateTimestamp,this.dateTime=e.dateTime,this.updateDate=e.updateDate,this.updateDateTimestamp=e.updateDateTimestamp,this.updateDateTime=e.updateDateTime,this.URI=e.URI,this.URIString=e.URIString,this.parentUri=e.parentUri,this.parentFolder=e.parentFolder,this.resourceType=e.resourceType,this.type=e.type,this.isScheduled=e.scheduled,this._permissions=e.permissions,this.hasChildren=e.hasChildren,this.isChild=!1,this.parentResource=null,this.isOpen=!1,this._children=[]};Resource.addMethod("clone",function(){return new Resource(this._json)}),Resource.addMethod("isReadable",function(){return this._permissions.include("r")}),Resource.addMethod("isEditable",function(){return this._permissions.include("e")}),Resource.addMethod("isRemovable",function(){return this._permissions.include("d")}),Resource.addMethod("isAdministrable",function(){return this._permissions.include("a")}),Resource.addMethod("typeEquals",function(e){return this.resourceType===e}),Resource.addMethod("typeSuffix",function(){return this.resourceType.split(".").last()}),Resource.addMethod("isLoaded",function(){return this._children.size()>0}),Resource.addMethod("isFolder",function(){return!1}),Resource.addMethod("getChildren",function(e){return this._children}),Resource.addMethod("addChild",function(e){e.isChild=!0,e.parentResource=this,this._children.push(e)}),Resource.addMethod("updateChild",function(e){e.isChild=!0,e.parentResource=this;var t=-1;this._children.each(function(i,o){i.URIString==e.URIString&&(t=o)}),t>-1?this._children[t]=e:this._children.push(e)}),Resource.addMethod("permissionsToString",function(){var e="";return this.isEditable()?e+=repositorySearch.messages["permission.modify"]:e+=repositorySearch.messages["permission.readOnly"],this.isRemovable()&&(e+=", "+repositorySearch.messages["permission.delete"]),this.isAdministrable()&&(e+=", "+repositorySearch.messages["permission.administer"]),e});var Folder=function(e){this.node=e,this.name=e.param.id,this.label=xssUtil.unescape(e.name),this.desc=e.param.extra.desc?xssUtil.unescape(e.param.extra.desc):"",this.description=xssUtil.unescape(this.desc),this.date=e.param.extra.date?xssUtil.unescape(e.param.extra.date):"",this.URI=e.param.uri,this.URIString=e.param.uri};Folder.prototype=deepClone(Resource.prototype),Folder.addMethod("clone",function(){return new Folder(this.node)}),Folder.addMethod("getParentFolder",function(){return this.isRoot()?null:new Folder(this.node.parent)}),Folder.addMethod("getReadableUri",function(){return this.isRoot()?"":this.getParentFolder().getReadableUri()+repositorySearch.model.getFolderSeparator()+this.label}),Folder.addMethod("isRoot",function(){return this.URI==repositorySearch.model.getRootFolderUri()||null==this.node.parent}),Folder.addMethod("isPublic",function(){return this.URI==repositorySearch.model.getPublicFolderUri()}),Folder.addMethod("isTemp",function(){return this.URI==repositorySearch.model.getTempFolderUri()}),Folder.addMethod("isOrganization",function(){return this.URI.match(repositorySearch.model.getOrganizationsFolderUri()+"/[^/]+$")}),Folder.addMethod("isOrganizationsRoot",function(){return this.URI.match(repositorySearch.model.getOrganizationsFolderUri()+"$")}),Folder.addMethod("isReadable",function(){return!0}),Folder.addMethod("isEditable",function(){return this.node.param.extra.isWritable}),Folder.addMethod("isRemovable",function(){return this.node.param.extra.isRemovable}),Folder.addMethod("isAdministrable",function(){return this.node.param.extra.isAdministrable}),Folder.addMethod("isSelected",function(){return this.node.isSelected()}),Folder.addMethod("equals",function(e){return e&&this.URI==e.URI}),Folder.addMethod("isThemeFolder",function(){return this.node.param.extra&&this.node.param.extra.isThemeFolder}),Folder.addMethod("isThemeRootFolder",function(){return this.node.param.extra&&this.node.param.extra.isThemeRootFolder}),Folder.addMethod("isActiveThemeFolder",function(){return this.node.param.extra&&this.node.param.extra.isActiveThemeFolder}),Folder.addMethod("isFolder",function(){return!0});var ResourcesUtils={getResourceUris:function(e){var t=[];return e.each(function(e){t.push(e.URIString?e.URIString:e.URI)}),t},getResourceUriAndTypeList:function(e){var t=[];return e.each(function(e){var i=e.URIString?e.URIString:e.URI;t.push({URIString:i,type:e.type})}),t},checkNameLength:function(e){return!e.blank()&&e.length<=repositorySearch.model.getConfiguration().resourceNameMaxLength},checkDescriptionLength:function(e){return e.length<=repositorySearch.model.getConfiguration().resourceDescriptionMaxLength},labelValidator:function(e){var t=!0,i="";return e.blank()?(i=repositorySearch.messages.RE_INVALID_NAME_SIZE.replace("{0}",repositorySearch.model.getConfiguration().resourceLabelMaxLength),t=!1):e.length>repositorySearch.model.getConfiguration().resourceLabelMaxLength&&(i=repositorySearch.messages.RE_INVALID_NAME_SIZE.replace("{0}",repositorySearch.model.getConfiguration().resourceLabelMaxLength),t=!1),{isValid:t,errorMessage:i}},descriptionValidator:function(e){var t=!0,i="";return e.length>repositorySearch.model.getConfiguration().resourceDescriptionMaxLength&&(i=repositorySearch.messages.RE_INVALID_DESC_SIZE.replace("{0}",repositorySearch.model.getConfiguration().resourceDescriptionMaxLength),t=!1),{isValid:t,errorMessage:i}},_fileTypeValidatorTemplate:function(e,t){var i=!0,o="";return!e||e.blank()?(o=repositorySearch.messages.RE_ENTER_FILE_NAME,
i=!1):e.toLowerCase().endsWith(t)||(o=repositorySearch.messages.RE_INVALID_FILE_TYPE.replace("{0}",t),i=!1),{isValid:i,errorMessage:o}},zipFileTypeValidator:function(e){return ResourcesUtils._fileTypeValidatorTemplate(e,".zip")},isCustomDataSource:function(e){return _.contains(Utils.getInitConfiguration().customDataSources,e.resourceType)}},Utils={restOfString:function(e,t){var i=e.lastIndexOf(t)+t.length;return e.substring(i,e.length).trim()},getInitOptions:function(){return localContext.rsInitOptions||__jrsConfigs__.repositorySearch.localContext.rsInitOptions},getInitConfiguration:function(){return Utils.getInitOptions().configuration}};document.observe("element:contextmenu",repositorySearch.showContextMenu.bindAsEventListener(repositorySearch)),document.observe("key:escape",function(e){actionModel.hideMenu(),Event.stop(e)}),document.observe("key:delete",function(e){e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||canAllBeDeleted()&&invokeBulkAction("Delete")}),designerBase=void 0,define("repository.search.main",["prototype","actionModel.modelGenerator","utils.common","common/component/dialog/AlertDialog"],function(e){return function(){return e.repositorySearch}}(this));var dynamicTree={trees:{},nodes:{},treeNodeEdited:null,editaborted:!1,activeTreeId:null,Tree:function(e,t){this.id=e,t?(this.setRootNode(t.root),this.bShowRoot=!!t.bShowRoot,this.handleNodeOnDblclick=void 0===t.handleNodeOnDblclick||t.handleNodeOnDblclick,this.multiSelectEnabled=!!t.multiSelectEnabled,this.showAllNodesOnStartup=!!t.showAllNodesOnStartup,this.treeClassName=t.treeClassName?t.treeClassName:"",this.dragPattern=t.dragPattern,this.dragClasses=t.dragClasses,this.dropClasses=t.dropClasses,this.selectOnMousedown=t.selectOnMousedown,this.regionID=t.regionID,this.scroll=t.scroll,this.templateDomId=t.templateDomId?t.templateDomId:this.DEFAULT_TREE_TEMPLATE_ID):(this.templateDomId=this.DEFAULT_TREE_TEMPLATE_ID,this.handleNodeOnDblclick=!0),this.stateObject={},this.sortNodes=!0,this.sorters=[this.sortByOrder,this.sortByName],this.selectedNodes=[],this.TREE_NN_ITEMS_SELECTED="#{count} items selected",dynamicTree.trees[this.id]=this,this._createFromTemplate(),this.refreshStyle(),this._registerEvents(),this._registerCustomScroll()},getNextId:function(){var e=1;return function(){return e++}}(),getActiveTree:function(){return dynamicTree.trees[dynamicTree.activeTreeId]},getTreeNode:function(e){return dynamicTree.nodes[e]},getStorageVal:function(e){return(JSON.parse(window.localStorage.getItem("dynamicTree"))||{})[e]||null},setStorageVal:function(e,t){var i=window.localStorage,o=JSON.parse(i.getItem("dynamicTree"))||{};o[e]=t;try{i.setItem("dynamicTree",JSON.stringify(o))}catch(e){window.console&&console.log(e)}},_templateHash:{}};dynamicTree.Tree.addVar("DEFAULT_TREE_TEMPLATE_ID","list_responsive_collapsible"),dynamicTree.Tree.addVar("HIDE_ROOT_CLASS_NAME","hideRoot"),dynamicTree.Tree.addMethod("getId",function(){return this.id}),dynamicTree.Tree.addMethod("_getElement",function(){return this._element||(this._element=$(this.id)),this._element}),dynamicTree.Tree.addMethod("_createFromTemplate",function(){this._getElement()&&(this._getElement().insert({after:this._getTemplateElement(this._getElement())}),this._getElement().remove(),this._element=null,this._getElement().update())}),dynamicTree.Tree.addMethod("_registerCustomScroll",function(){if(!this.scroll&&this._getElement()){var e=this._getElement().up(layoutModule.SWIPE_SCROLL_PATTERN);if(e){var t=layoutModule.scrolls.get(e.identify());t&&(this.scroll=t)}}}),dynamicTree.Tree.addMethod("setRootNode",function(e){this.rootNode=e,this.rootNode&&(this.rootNode.treeId=this.id)}),dynamicTree.Tree.addMethod("getRootNode",function(){return this.rootNode}),dynamicTree.Tree.addMethod("refreshStyle",function(){var e=this._getElement();e.templateClassName&&(e.className=e.templateClassName),this.treeClassName&&e.addClassName(this.treeClassName),this.bShowRoot?e.removeClassName(this.HIDE_ROOT_CLASS_NAME):e.addClassName(this.HIDE_ROOT_CLASS_NAME)}),dynamicTree.Tree.addMethod("resetSelected",function(){this._prevSelectedNodes=this.selectedNodes.clone(),this.selectedNodes=[]}),dynamicTree.Tree.addMethod("revertSelection",function(e){var t=this._prevSelectedNodes.clone();t=t.concat(this.selectedNodes),this.selectedNodes=this._prevSelectedNodes.clone();for(var i=0;i<t.length;i++)t[i].refreshStyle()}),dynamicTree.Tree.addMethod("getSelectedNode",function(){return 0===this.selectedNodes.length?null:this.selectedNodes[0]}),dynamicTree.Tree.addMethod("addNodeToSelected",function(e){this.selectedNodes.push(e),this._prevSelectedNodes=this.selectedNodes.clone()}),dynamicTree.Tree.addMethod("removeNodeFromSelected",function(e){for(var t=0;t<this.selectedNodes.length;t++)if(this.selectedNodes[t]==e)return this._prevSelectedNodes=this.selectedNodes.clone(),void this.selectedNodes.splice(t,1)}),dynamicTree.Tree.addMethod("isNodeSelected",function(e){var t=this.selectedNodes&&this.selectedNodes.length;if(t)for(var i=0;i<t;i++)if(this.selectedNodes[i]==e)return!0;return!1}),dynamicTree.Tree.addMethod("resortSubtree",function(e){if(e){e.resortChilds();for(var t=0;t<e.childs.length;t++)this.resortSubtree(e.childs[t])}}),dynamicTree.Tree.addMethod("resortTree",function(){this.sortNodes&&this.resortSubtree(this.rootNode)}),dynamicTree.Tree.addMethod("readStates",function(){var e=dynamicTree.getStorageVal("tree"+this.id);if(e)for(var t in e)this.stateObject[t]=e[t]}),dynamicTree.Tree.addMethod("getState",function(e){var t,i=this.stateObject;return i[e]?(t=i[e],null!==t&&""!==t||(t=dynamicTree.TreeNode.State.CLOSED),t):dynamicTree.TreeNode.State.CLOSED}),dynamicTree.Tree.addMethod("writeStates",function(e,t){var i={},o=this.stateObject;for(var r in o)i[r]=o[r];o[e]=t,null!=t&&(i[e]=t),dynamicTree.setStorageVal("tree"+this.id,i)}),dynamicTree.Tree.addMethod("resetStates",function(){this.stateObject={},dynamicTree.setStorageVal("tree"+this.id,"")}),dynamicTree.Tree.addMethod("comparer",function(e,t){var i,o;if(this.sorters&&this.sorters.length)for(i=0;i<this.sorters.length;i++)if(0!==(o=this.sorters[i](e,t)))return o;return 0}),dynamicTree.Tree.addMethod("renderTree",function(){this.readStates(),this.stopWaiting(),this.refreshStyle();var e=this._getElement();this.rootNode&&(this.writeStates(this.rootNode.id,dynamicTree.TreeNode.State.OPEN),this.rootNode.showNode(),this.rootNode.render(e),this.refreshScroll())}),dynamicTree.Tree.addMethod("refreshScroll",function(e){e?setTimeout(function(){this.scroll&&this.scroll.refresh()}.bind(this),e):this.scroll&&this.scroll.refresh()}),dynamicTree.Tree.addMethod("binarySearchOfNode",function(e,t){for(var i=0,o=e.length-1;i<=o;){var r=Math.round((i+o)/2),s=e[r];if(this.comparer(s,t)<0)i=r+1;else{if(!(this.comparer(s,t)>0))return r;o=r-1}}return-(i+1)}),dynamicTree.Tree.addMethod("_deselectAllNodes",function(e){if(this.selectedNodes.length>0){var t=this.selectedNodes.clone();this.resetSelected();for(var i=0;i<t.length;i++)t[i].refreshStyle();if(e){dynamicTree.trees[this.id].fireUnSelectAllEvent(e)}}}),dynamicTree.Tree.addMethod("_selectOrEditNode",function(e,t,i,o,r,s){var n,a,l,d=t.isSelected()&&r,c=this.multiSelectEnabled&&t.isSelected()&&i&&!d,h=t.isSelected()&&dynamicTree.treeNodeEdited!==t&&!this.multiSelectEnabled&&!i&&!d,u=null!=dynamicTree.treeNodeEdited&&(f||c),p=this.multiSelectEnabled&&!t.isSelected()&&o&&isNotNullORUndefined(this._lastSelectedNode)&&this._lastSelectedNode.parent===t.parent,m=this.multiSelectEnabled&&t.isSelected()&&o&&isNotNullORUndefined(this._lastSelectedNode)&&this._lastSelectedNode.parent===t.parent,f=!this.multiSelectEnabled&&!t.isSelected()||this.multiSelectEnabled&&!i&&!t.isSelected(),g=!t.isSelected()||f&&this.selectedNodes.length>1;if(o&&this._lastSelectedNode||(this._lastSelectedNode=t),c&&t.deselect(e),f&&this._deselectAllNodes(e),h)return void t.edit(e);if(u&&dynamicTree.treeNodeEdited.doEndEdit(e),p||m){l=t.parent;var v=l.childs.indexOf(this._lastSelectedNode),y=l.childs.indexOf(t);n=Math.min(v,y),a=Math.max(v,y)}if(p)if(n>-1)for(var _=n;_<=a;_++)l.childs[_].select(e);else l.childs[a].select(e);else if(m){for(var _=0;_<n;_++)l.childs[_].deselect(e);for(var _=a+1;_<l.childs.length;_++)l.childs[_].deselect(e)}else g&&t.select(e,t.nofocus,s)}),dynamicTree.Tree.addMethod("_deselectOthers",function(e,t,i,o,r){this.multiSelectEnabled&&this.selectedNodes.length>1&&t.isSelected()&&!(i||o||r)&&this.selectedNodes.findAll(function(e){return e!=t}.bind(this)).invoke("deselect",e)}),dynamicTree.Tree.addMethod("_selectNextNode",function(e,t){function i(e){return e=e.parent,e?e.nextSibling?e.nextSibling:i(e):null}var o=e.isOpen()&&e.getFirstChild()||e.nextSibling||i(e);o&&e.deselect()&&o.select(t)}),dynamicTree.Tree.addMethod("_selectPreviousNode",function(e,t){function i(e){return!(e.isOpen()&&e.hasChilds())&&e||i(e.getLastChild())}var o=e.prevSibling&&i(e.prevSibling)||e.parent;o&&e.deselect()&&o.select(t)}),dynamicTree.Tree.addMethod("_selectInwards",function(e,t){var i=e.isOpen()&&e.getFirstChild();i?e.deselect()&&i.select(t):e.handleNode(t)}),dynamicTree.Tree.addMethod("_selectOutwards",function(e,t){if(!e.isHiddenRootNode()){var i=e.isOpen()?null:e.parent;i?e.deselect()&&i.select(t):e.handleNode(t)}}),dynamicTree.Tree.addMethod("sortByOrder",function(e,t){var i=e.orderNumber,o=t.orderNumber;return null==i&&null==o?0:null==i?1:null==o?-1:i-o}),dynamicTree.Tree.addMethod("sortByName",function(e,t){var i=e.name.toLowerCase(),o=t.name.toLowerCase();return i>o?1:i<o?-1:0}),dynamicTree.Tree.addVar("TREE_WAIT_TEMPLATE_DOM_ID","list_responsive_collapsible:loading"),dynamicTree.Tree.addMethod("wait",function(){$(this.id).update($(this.TREE_WAIT_TEMPLATE_DOM_ID).cloneNode(!0))}),dynamicTree.Tree.addMethod("stopWaiting",function(){$(this.id).update("")}),dynamicTree.Tree.addMethod("_getTemplateElement",function(e){var t=this.templateDomId,i=$(t).cloneNode(!0);return i.writeAttribute("id",this.getId()),i.templateId=t,i.templateClassName=i.className,cloneCustomAttributes(e,i),i}),define("dynamicTree.tree",["prototype","dragdrop.extra","touchcontroller","utils.common","core.layout"],function(e){return function(){return e.dynamicTree}}(this)),dynamicTree.TreeNode=function(e){this.id=dynamicTree.getNextId(),this.treeId=null,this.name=null!=e.name?e.name:this.DEFAULT_NAME,this.param=null!=e.param?e.param:{},this.orderNumber=null!=e.orderNumber?e.orderNumber:null,this.childs=[],this.parent=null,this.Types={Folder:new dynamicTree.TreeNode.Type(this.FOLDER_TYPE_NAME)},this.isloaded=!1,this.delayedRendering=!0,this.haschilds=!1,this.editable=!1,this.isWaiting=!1,this.hidden=!1,this.isDropTarget=!1,dynamicTree.nodes[this.id]=this},dynamicTree.TreeNode.Type=function(e,t){this.name=e,t&&(this.cssClassName=t.cssClassName,this.templateDomId=t.templateDomId)},dynamicTree.TreeNode.State={OPEN:"open",CLOSED:"closed"},dynamicTree.TreeNode.addVar("FOLDER_TYPE_NAME","com.jaspersoft.jasperserver.api.metadata.common.domain.Folder"),dynamicTree.TreeNode.addVar("DEFAULT_NAME","unset name"),dynamicTree.TreeNode.addVar("NODE_ID_PREFIX","node"),dynamicTree.TreeNode.addVar("SUB_NODE_ID_SUFFIX","sub"),dynamicTree.TreeNode.addVar("HANDLER_ID_PREFIX","handler"),dynamicTree.TreeNode.addVar("NODE_CLASS_NAME","node").addVar("LEAF_CLASS_NAME","leaf").addVar("OPEN_CLASS_NAME","open").addVar("CLOSED_CLASS_NAME","closed").addVar("SELECTED_CLASS_NAME","selected").addVar("LOADING_CLASS_NAME","loading").addVar("ROOTS_CLASS_NAME","roots"),dynamicTree.TreeNode.addVar("nodeHeaderTemplateDomId","list_responsive_collapsible:leaf"),dynamicTree.TreeNode.addVar("nodeFooterTemplateDomId","list_responsive_collapsible"),dynamicTree.TreeNode.addVar("nodeInputTemplateDomId","list_responsive_collapsible:input"),dynamicTree.TreeNode.addVar("isSelectable",!1),dynamicTree.TreeNode.addMethod("getTreeId",function(){return this.treeId||this.parent&&this.parent.getTreeId()}),dynamicTree.TreeNode.addMethod("getState",function(){return dynamicTree.trees[this.getTreeId()].getState(this.id)}),dynamicTree.TreeNode.addMethod("isParent",function(){return this.param.type==this.Types.Folder.name}),dynamicTree.TreeNode.addMethod("addChild",function(e){if(this.isParent()){var t=this.childs[this.childs.length-1];t&&(t.nextSibling=e,e.prevSibling=t),this.childs.push(e),e.parent=this,this.resortChilds(),this.delayedRendering||(e.showNode(),e.render(this._getChildrenElement(),e.nextSibling))}}),dynamicTree.TreeNode.addMethod("removeChild",function(e){for(var t=0;t<this.childs.length;t++)if(this.childs[t]==e){this.childs.splice(t,1);break}if(e.deselect(),!this.delayedRendering){var i=e._getElement();i&&i.remove()}}),dynamicTree.TreeNode.addMethod("resortChilds",function(){var e=this.getTreeId(),t=dynamicTree.trees[e];if(t&&t.sortNodes&&isArray(this.childs)){this.childs.sort(function(e,i){return t.comparer(e,i)});for(var i=this.childs.length;i--;){var o=this.childs[i];o.prevSibling=this.childs[i-1],o.nextSibling=this.childs[i+1]}}}),dynamicTree.TreeNode.addMethod("resetChilds",function(){this.childs=[]}),dynamicTree.TreeNode.addMethod("setHasChilds",function(e){this.haschilds=e}),dynamicTree.TreeNode.addMethod("hasChilds",function(){return!!this.haschilds||this.getChildCount()>0}),dynamicTree.TreeNode.addMethod("getChildCount",function(){return this.childs.length}),dynamicTree.TreeNode.addMethod("getFirstChild",function(){return this.hasChilds()?this.childs[0]:null}),dynamicTree.TreeNode.addMethod("getLastChild",function(){return this.hasChilds()?this.childs[this.childs.length-1]:null}),dynamicTree.TreeNode.addMethod("_getElement",function(e){return this._element||(this._element=$(this.NODE_ID_PREFIX+this.id)),this._element}),dynamicTree.TreeNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0];e.cleanWhitespace();var t=e.childNodes[e.childNodes.length-1];return"#text"!==t.nodeName&&(t=document.createTextNode(""),e.appendChild(t)),t}),dynamicTree.TreeNode.addMethod("_getTitleInputElement",function(){return $(this._getElement().getElementsByTagName("input")[0])}),dynamicTree.TreeNode.addMethod("_getChildrenElement",function(){return this._childrenElement||(this._childrenElement=$(this.NODE_ID_PREFIX+this.id+this.SUB_NODE_ID_SUFFIX)),this._childrenElement}),dynamicTree.TreeNode.addMethod("isOpen",function(){return this.getState()===dynamicTree.TreeNode.State.OPEN}),dynamicTree.TreeNode.addMethod("changeName",function(e){this.name=e,this._getTitle().data=this.name}),dynamicTree.TreeNode.addMethod("getType",function(){for(var e in this.Types)if(this.param.type===this.Types[e].name)return this.Types[e]}),dynamicTree.TreeNode.addMethod("refreshStyle",function(e){if(e=$(e)||this._getElement()){e.templateClassName&&(e.className=e.templateClassName),this.isParent()?(e.addClassName(this.NODE_CLASS_NAME).removeClassName(this.LEAF_CLASS_NAME),this.isWaiting||(this.isOpen()?e.addClassName(this.OPEN_CLASS_NAME).removeClassName(this.CLOSED_CLASS_NAME):e.addClassName(this.CLOSED_CLASS_NAME).removeClassName(this.OPEN_CLASS_NAME))):e.addClassName(this.LEAF_CLASS_NAME).removeClassName(this.NODE_CLASS_NAME),this.isWaiting?e.addClassName(this.LOADING_CLASS_NAME):e.removeClassName(this.LOADING_CLASS_NAME),this.isSelected()?e.addClassName(this.SELECTED_CLASS_NAME):e.removeClassName(this.SELECTED_CLASS_NAME),this.hidden?e.addClassName(layoutModule.HIDDEN_CLASS):e.removeClassName(layoutModule.HIDDEN_CLASS),this.param.cssClass&&e.addClassName(this.param.cssClass);var t=this.getType();t&&t.cssClassName&&e.addClassName(t.cssClassName);var i=e.down();this.isDropTarget&&i&&i.addClassName(layoutModule.DROP_TARGET_CLASS),!this.isDropTarget&&i&&i.removeClassName(layoutModule.DROP_TARGET_CLASS)}}),dynamicTree.TreeNode.addMethod("_createNode",function(){var e=this.id,t=dynamicTree.trees[this.getTreeId()],i=this._getHeaderTemplateElement();i.id=this.NODE_ID_PREFIX+e,i.tabIndex=-1,this.refreshStyle(i),this.treeId=t.id,i.treeNode=this;var o=i.childElements()[0];o.insert(xssUtil.softHtmlEscape(this.name,{whiteList:["a"]})),null!=this.tooltip&&this.tooltip.length>0&&(o.title=this.tooltip),o.childElements().each(function(t,i){0===i&&(t.id=this.HANDLER_ID_PREFIX+e);var o=this.iconTooltip;o&&(t.title=isArray(o)?o[i]:o)}.bind(this)),this._element=i}),dynamicTree.TreeNode.addMethod("_createNodeChildren",function(){var e=this._getFooterTemplateElement();e.id=this.NODE_ID_PREFIX+this.id+this.SUB_NODE_ID_SUFFIX,this._childrenElement=e}),dynamicTree.TreeNode.addMethod("showNode",function(e){var t=dynamicTree.trees[this.getTreeId()];if(this._createNode(),this.isParent()){if(this.isOpen()||t.showAllNodesOnStartup){this._createNodeChildren();for(var i=0;i<this.getChildCount();i++)this.childs[i].showNode(this._getChildrenElement());this.delayedRendering=!1,t.fireOpenEvent(this)}}this.render(e)}),dynamicTree.TreeNode.addMethod("render",function(e,t){if(!Object.isUndefined(e)){var i=$(e);i&&(this._getChildrenElement()&&this._getElement().insert(this._getChildrenElement()),t?i.insert(this._getElement(),{before:t._getElement()}):i.insert(this._getElement()))}}),dynamicTree.TreeNode.addMethod("_renderChildren",function(){var e=this._getElement();e&&this._getChildrenElement()&&e.insert(this._getChildrenElement())}),dynamicTree.TreeNode.addMethod("refreshNode",function(){if(this.refreshStyle(),this.isParent()&&this.isOpen()&&this.isloaded){this.delayedRendering?(this._createNodeChildren(),this._renderChildren()):this._getChildrenElement().update("");for(var e=0;e<this.getChildCount();e++)this.childs[e].showNode(this._getChildrenElement());this.delayedRendering=!1}dynamicTree.trees[this.getTreeId()].refreshScroll()}),dynamicTree.TreeNode.addMethod("wait",function(){this.isWaiting=!0,this.refreshStyle()}),dynamicTree.TreeNode.addMethod("stopWaiting",function(){this.isWaiting=!1,this.refreshStyle()}),dynamicTree.TreeNode.addMethod("isHiddenRootNode",function(){var e=dynamicTree.trees[this.getTreeId()];return e.rootNode==this&&!e.bShowRoot}),dynamicTree.TreeNode.addMethod("deselect",function(e){var t=dynamicTree.trees[this.getTreeId()];return!(!t||!this.isSelected())&&(t.removeNodeFromSelected(this),this.refreshStyle(),e&&t.fireUnSelectEvent(this,e),!0)}),dynamicTree.TreeNode.addMethod("select",function(e,t,i){if(i=i||{},!t&&this.focus(),this.isSelected())return!1;var o=dynamicTree.trees[this.getTreeId()];return o.addNodeToSelected(this),this.refreshStyle(),!i.silent&&o.fireSelectEvent(this,e),!0}),dynamicTree.TreeNode.addMethod("focus",function(){var e=this;!isIPad()&&this._getElement()&&setTimeout(function(){e._getElement().focus()},100)}),dynamicTree.TreeNode.addMethod("isSelected",function(){var e=dynamicTree.trees[this.getTreeId()];return e&&e.isNodeSelected(this)}),dynamicTree.TreeNode.addMethod("_removeTitle",function(){var e=this._getTitle();e.data="",$(e.parentNode).cleanWhitespace()}),dynamicTree.TreeNode.addMethod("edit",function(e){if(this.editable){if(dynamicTree.treeNodeEdited==this)return;dynamicTree.treeNodeEdited=this;var t=this.name,i=$(this._getTitle().parentNode),o=this._getInputTemplateElement();this._getTitle().data="",i.cleanWhitespace(),i.insert(o),o.value=xssUtil.unescape(this.name),o.focus(),o.select(e),o.onclick=function(e){cancelEventBubbling(e)},o.ondblclick=function(e){cancelEventBubbling(e)},o.onmousedown=function(e){cancelEventBubbling(e)},o.onmouseup=function(e){cancelEventBubbling(e)},o.onkeydown=function(e){var i=window.event?window.event:e;13==i.keyCode?(o.onblur=null,this.doEndEdit(i)):27==i.keyCode&&(o.onblur=null,o.value=t,this.doEndEdit(i))}.bindAsEventListener(this),o.onblur=function(e){this.doEndEdit(e)}.bindAsEventListener(this),dynamicTree.trees[this.getTreeId()].fireStartEditEvent(this,o)}}),dynamicTree.TreeNode.addMethod("doEndEdit",function(e){this.editEnded(),dynamicTree.trees[this.getTreeId()].fireEndEditEvent(this)}),dynamicTree.TreeNode.addMethod("editEnded",function(){var e=dynamicTree.trees[this.getTreeId()];if(null!=dynamicTree.treeNodeEdited){var t=this._getTitleInputElement(),i=($(t.parentNode),t.value);if(i==dynamicTree.treeNodeEdited.name)return t.remove(),this._getTitle().data=dynamicTree.treeNodeEdited.name,void(dynamicTree.treeNodeEdited=null);e.fireEditEvent(dynamicTree.treeNodeEdited,i),dynamicTree.editaborted||(dynamicTree.treeNodeEdited.name=i,t.remove(),this._getTitle().data=i),dynamicTree.treeNodeEdited=null}}),dynamicTree.TreeNode.addMethod("scroll",function(e){var t=dynamicTree.trees[this.getTreeId()].rootNode._getElement(),i=e?$(e):$(t.parentNode),o=this._getElement();if(i){var r=i.clientHeight,s=i.clientWidth,n=i.scrollTop,a=i.scrollLeft,l=o.cumulativeOffset().top-i.cumulativeOffset().top,d=o.offsetLeft,c=o.clientHeight,h=o.clientWidth;l>n+r?i.scrollTop=l-(r/2-c/2):l+c<n&&(i.scrollTop=l-(r/2-c/2)),d>a+s?i.scrollLeft=d-(s/2-h/2):d+h<a&&(i.scrollTop=d-(s/2-h/2))}}),dynamicTree.TreeNode.addMethod("handleNode",function(e){if(this.isParent()){var t=dynamicTree.trees[this.getTreeId()];this.isOpen()?t.writeStates(this.id,dynamicTree.TreeNode.State.CLOSED):(t.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),t.fireOpenEvent(this,e)),this.refreshNode()}}),dynamicTree.TreeNode.addMethod("openNode",function(e){if(this.isParent()){var t=dynamicTree.trees[this.getTreeId()];this.isOpen()||(t.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),t.fireOpenEvent(this,e)),this.refreshNode()}}),dynamicTree.TreeNode.addMethod("_getHeaderTemplateElement",function(){var e=this.getType(),t=e&&e.templateDomId?e.templateDomId:this.nodeHeaderTemplateDomId,i=$(t).cloneNode(!0);return i.templateId=t,i.templateClassName=i.className,i}),dynamicTree.TreeNode.addMethod("_getFooterTemplateElement",function(){var e=this.nodeFooterTemplateDomId,t=$(e).cloneNode(!0);return t.templateId=e,t.update(""),t}),dynamicTree.TreeNode.addMethod("_getInputTemplateElement",function(){var e=this.nodeInputTemplateDomId,t=$(e).cloneNode(!0);return t.templateId=e,t}),define("dynamicTree.treenode",["prototype","underscore","dynamicTree.tree"],function(e){return function(){return e.dynamicTree}}(this)),dynamicTree.Tree.addVar("NODE_PATTERN",".node").addVar("NODE_WRAPPER_PATTERN",".node > .wrap").addVar("NODE_ICON_PATTERN",".node > .wrap .icon").addVar("NODE_CUSTOM_PATTERNS",[]),dynamicTree.Tree.addVar("LEAF_PATTERN",".leaf").addVar("LEAF_WRAPPER_PATTERN",".leaf > .wrap").addVar("LEAF_ICON_PATTERN",".leaf > .wrap .icon").addVar("LEAF_CUSTOM_PATTERNS",[]),dynamicTree.Tree.addVar("EXPANDING_TIME",1e3),dynamicTree.Tree.addVar("draggables",[]),dynamicTree.Tree.addMethod("getTreeNodeByEvent",function(e){var t=Event.element(e);return this.getTreeNodeByElement(t)}),dynamicTree.Tree.addMethod("getTreeNodeByElement",function(e){for(;e&&e.readAttribute&&e.readAttribute("id")!==this.id;){var t=e.treeNode;if(t&&t.getTreeId()===this.getId())return t;e=$(e.parentNode)}return null}),dynamicTree.Tree.addMethod("isNodeEvent",function(e){var t=matchMeOrUp(e.element().parentNode,"LI");return t&&t.hasClassName(layoutModule.NODE_CLASS)}),dynamicTree.Tree.addMethod("isLeafEvent",function(e){var t=matchMeOrUp(e.element().parentNode,"LI");return t&&t.hasClassName(layoutModule.LEAF_CLASS)}),dynamicTree.Tree.addMethod("isIconEvent",function(e){return e.element().hasClassName(layoutModule.ICON_CLASS)}),dynamicTree.Tree.addMethod("_registerEvents",function(){this._cleanUpListeners(),this._registerClickEvents(),this._registerCustomEvents(),this._registerKeyEvents(),this._registerMouseEvents()}),dynamicTree.Tree.addMethod("_cleanUpListeners",function(){var e=this._getElement();e.stopObserving("click"),e.stopObserving("dblclick"),isSupportsTouch()?(e.stopObserving("touchstart"),e.stopObserving("drag:touchstart"),e.stopObserving("touchend")):(e.stopObserving("mousedown"),e.stopObserving("drag:mousedown"),e.stopObserving("mouseup")),e.stopObserving("mouseover"),e.stopObserving("mouseout")}),dynamicTree.Tree.addMethod("_registerClickEvents",function(){var e=this._getElement();e.observe("click",function(t){var i=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(i){var o=this.isIconEvent(t),r=this.isNodeEvent(t),s=this.isLeafEvent(t);r?(o&&e.fire("nodeIcon:click",{targetEvent:t,node:i}),e.fire("node:click",{targetEvent:t,node:i})):s&&(o&&e.fire("nodeIcon:click",{targetEvent:t,node:i}),e.fire("leaf:click",{targetEvent:t,node:i})),!isIPad()&&r&&o&&i.handleNode(t)}}.bindAsEventListener(this)),e.observe("dblclick",function(t){var i=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(i){var o=this.isIconEvent(t),r=this.isNodeEvent(t),s=this.isLeafEvent(t);r?(o&&e.fire("nodeIcon:dblclick",{targetEvent:t,node:i}),e.fire("node:dblclick",{targetEvent:t,node:i})):s&&(o&&e.fire("leafIcon:dblclick",{targetEvent:t,node:i}),e.fire("leaf:dblclick",{targetEvent:t,node:i})),this.handleNodeOnDblclick&&(r||s)&&!o&&i.handleNode(t)}}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("_registerMouseEvents",function(){var e=this._getElement();e.observe(isSupportsTouch()?"touchstart":"mousedown",function(t){var i=t.element(),o=matchMeOrUp(i,layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(o){t.treeEvent=!0;var r=this.isIconEvent(t),s=this.isNodeEvent(t),n=this.isLeafEvent(t);if(isSupportsTouch())if(JRS.vars.ajax_in_progress)alert("please wait");else if(this.twofingers=!1,2==t.touches.length&&(this.twofingers=!0,this._selectOrEditNode(t,o,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),o.isSelected()||designerBase&&designerBase.isInSelection(o))){var a=jQuery(i).parents("li:first");return void(a.hasClass("selected")&&document.fire(layoutModule.ELEMENT_CONTEXTMENU,{targetEvent:t,node:i}))}isSupportsTouch()&&JRS.vars.ajax_in_progress||(!this.selectOnMousedown||isSupportsTouch()&&1!=t.touches.length||this._selectOrEditNode(t,o,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),s?(r&&e.fire("nodeIcon:mousedown",{targetEvent:t,node:o}),e.fire("node:mousedown",{targetEvent:t,node:o})):n&&(r&&e.fire("leafIcon:mousedown",{targetEvent:t,node:o}),e.fire("leaf:mousedown",{targetEvent:t,node:o})))}}.bindAsEventListener(this)),e.observe(isSupportsTouch()?"drag:touchstart":"drag:mousedown",function(t){var i=t.memo.targetEvent,o=matchMeOrUp(i.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(i);if(o){i.treeEvent=!0;var r=this.isIconEvent(i),s=this.isNodeEvent(i),n=this.isLeafEvent(i);this.selectOnMousedown&&!isRightClick(i)&&this._selectOrEditNode(i,o,isMetaHeld(i),isShiftHeld(i),isRightClick(i)),s?(r&&e.fire("nodeIcon.drag:mousedown",{targetEvent:i,node:o}),e.fire("node.drag:mousedown",{targetEvent:i,node:o})):n&&(r&&e.fire("leafIcon.drag:mousedown",{targetEvent:i,node:o}),e.fire("leaf.drag:mousedown",{targetEvent:i,node:o}))}}.bindAsEventListener(this)),e.observe(isSupportsTouch()?"touchend":"mouseup",function(t){var i=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(i){t.treeEvent=!0;var o=this.isIconEvent(t),r=this.isNodeEvent(t),s=this.isLeafEvent(t);if(this.twofingers&&(t.isEmulatedRightClick=!0),isSupportsTouch()&&!this.twofingers&&(this.clickid==i.id&&!JRS.vars.ajax_in_progress&&t.timeStamp-this.clicktime<700&&(r?(o&&e.fire("nodeIcon:dblclick",{targetEvent:t,node:i}),e.fire("node:dblclick",{targetEvent:t,node:i})):s&&(o&&e.fire("leafIcon:dblclick",{targetEvent:t,node:i}),e.fire("leaf:dblclick",{targetEvent:t,node:i})),this.handleNodeOnDblclick&&(r||s)&&!o&&i.handleNode(t)),this.clicktime=t.timeStamp,this.clickid=i.id),!isSupportsTouch()||!JRS.vars.ajax_in_progress){this.selectOnMousedown||TouchController.element_scrolled||isSupportsTouch()&&1!=t.changedTouches.length||this._selectOrEditNode(t,i,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),this._deselectOthers(t,i,isMetaHeld(t),isShiftHeld(t),isRightClick(t));r?(o&&e.fire("nodeIcon:mouseup",{targetEvent:t,node:i}),e.fire("node:mouseup",{targetEvent:t,node:i})):s&&(o&&e.fire("leafIcon:mouseup",{targetEvent:t,node:i}),e.fire("leaf:mouseup",{targetEvent:t,node:i})),isSupportsTouch()&&r&&o&&!TouchController.element_scrolled&&i.handleNode(t)}}}.bindAsEventListener(this)),"createTouch"in document||(e.observe("mouseover",function(t){var i=t.element(),o=matchMeOrUp(i,layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);o&&(Draggables.dragging&&(clearTimeout(this.timeout_id),this.timeout_id=setTimeout(function(e){o.openNode(e)},this.EXPANDING_TIME)),this.createDraggableIfNeeded(t,o),!isIE7()&&e.fire("tree:mouseover",{targetEvent:t,node:o}))}.bindAsEventListener(this)),isIE7()||e.observe("mouseout",function(t){var i=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);i&&e.fire("tree:mouseout",{targetEvent:t,node:i})}.bindAsEventListener(this))),Droppables.add(e,{accept:this.dropClasses,onDrop:function(e){this.elementDropped=e}.bind(this)})}),dynamicTree.Tree.addMethod("_registerKeyEvents",function(){var e=this._getElement();e.observe("key:down",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectNextNode(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:up",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectPreviousNode(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:right",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectInwards(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:left",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectOutwards(t,e.memo.targetEvent)}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("_registerCustomEvents",function(){var e=this._getElement();e.observe("mousedown",function(t){dynamicTree.activeTreeId&&dynamicTree.activeTreeId===this.getId()||(e.fire("tree:blur",{targetEvent:t,tree:dynamicTree.getActiveTree()}),dynamicTree.activeTreeId=this.getId(),e.fire("tree:focus",{targetEvent:t,tree:dynamicTree.getActiveTree()}))}.bindAsEventListener(this)),e.observe("mouseover",function(t){this.getTreeNodeByEvent(t)||e.fire("tree:mouseover",{targetEvent:t,tree:this})}.bindAsEventListener(this)),e.observe("mouseout",function(t){this.getTreeNodeByEvent(t)||e.fire("tree:mouseout",{targetEvent:t,tree:this})}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("fireOpenEvent",function(e,t){this._getElement().fire("node:open",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireSelectEvent",function(e,t){this._getElement().fire(e.isParent()?"node:selected":"leaf:selected",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireUnSelectEvent",function(e,t){this._getElement().fire(e.isParent()?"node:unselected":"leaf:unselected",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireUnSelectAllEvent",function(e){this._getElement().fire("items:unselected",{targetEvent:e})}),dynamicTree.Tree.addMethod("fireEditEvent",function(e,t){this._getElement().fire(e.isParent()?"node:edit":"leaf:edit",{node:e,newValue:t})}),dynamicTree.Tree.addMethod("fireStartEditEvent",function(e,t){this._getElement().fire(e.isParent()?"node:startEdit":"leaf:startEdit",{node:e,input:t})}),dynamicTree.Tree.addMethod("fireEndEditEvent",function(e){this._getElement().fire(e.isParent()?"node:endEdit":"leaf:endEdit",{node:e})}),dynamicTree.Tree.addMethod("observe",function(e,t){this._getElement().observe(e,t)}),dynamicTree.Tree.addMethod("stopObserving",function(e,t){this._getElement().stopObserving(e,t)}),dynamicTree.Tree.addMethod("createDraggableIfNeeded",function(e,t){var i=e?e.element():t._getElement().down(this.dragPattern),o=this.draggables[i.identify()];if(this.dragPattern&&!o){var r=matchAny(i,[this.dragPattern],!0);if(r&&i.className.toLowerCase().indexOf("icon")<0&&!this.draggables[r.identify()])return this.draggables[r.identify()]=new Draggable(i,{superghosting:!0,mouseOffset:!0,delay:isIE()||isSupportsTouch()?200:0,onStart:this.setDragStartState.bind(this,t),onEnd:this.setDragEndState.bind(this,t)}),this.draggables[r.identify()]}return null}),dynamicTree.Tree.addMethod("setDragStartState",function(e,t,i){var o=e._getElement().templateClassName
;o&&t.element.addClassName(o),t.element.setStyle({width:null,height:null}),t.element.addClassName(layoutModule.DRAGGING_CLASS).addClassName(this.getId()),this.dragClasses&&t.element.addClassName(this.dragClasses),this.selectedNodes.length>1&&t.element.update(new Template(this.TREE_NN_ITEMS_SELECTED).evaluate({count:this.selectedNodes.length})),t.element.node=e,t.element.nodes=this.selectedNodes,t.options.scroll=this._getElement(),t.options.scrollSensitivity=layoutModule.SCROLL_SENSITIVITY,Draggables.dragging=this.regionID||!0}),dynamicTree.Tree.addMethod("setDragEndState",function(e,t,i){delete Draggables.dragging}),define("dynamicTree.events",["prototype","dynamicTree.tree"],function(e){return function(){return e.dynamicTree}}(this)),dynamicTree.TreeSupport=function(e,t){if(dynamicTree.Tree.call(this,e,t),this.providerId=t.providerId,this.hideLoader=t.hideLoader,this.rootUri=Object.isUndefined(t.rootUri)?"/":t.rootUri,this.nodeClass=t.nodeClass&&Object.isFunction(t.nodeClass)?t.nodeClass:dynamicTree.TreeNode,t.rootObjectModifier&&(this.modifyRootObject=t.rootObjectModifier),this.resetStatesOnShow=Object.isUndefined(t.resetStatesOnShow)||t.resetStatesOnShow,this.inInit=!0,this.ajaxBufferId="ajaxbuffer",this.nodeTextId="treeNodeText",this.urlGetNode=t.urlGetNode?t.urlGetNode:this._getFlowUrl("getNode"),this.urlGetChildren=t.urlGetChildren?t.urlGetChildren:this._getFlowUrl("getChildren"),this.urlGetMultipleChildren=t.urlGetMultipleChildren?t.urlGetMultipleChildren:this._getFlowUrl("getMultipleChildren"),this.urlGetMessage=t.urlGetMessage?t.urlGetMessage:this._getFlowUrl("getMessage"),this.additionalParams=t.additionalParams?t.additionalParams:{},null==this.TREE_NN_ITEMS_SELECTED){var i=function(e){this.TREE_NN_ITEMS_SELECTED=e}.bind(this);this.getMessage("TREE_NN_ITEMS_SELECTED",i,null)}this._initOpenListener()},dynamicTree.TreeSupport.prototype=deepClone(dynamicTree.Tree.prototype),dynamicTree.TreeSupport.addMethod("_initOpenListener",function(){this.observe("node:open",function(e){var t=e.memo.node;t&&!t.isloaded&&this.getTreeNodeChildren(t)}.bindAsEventListener(this))}),dynamicTree.TreeSupport.addMethod("stopObserving",function(e,t){this._getElement().stopObserving(e,t),"node:open"!==e||t||this._initOpenListener()}),dynamicTree.TreeSupport.addMethod("_getFlowUrl",function(e){return __jrsConfigs__.contextPath+"/flow.html?_flowId=treeFlow&method="+e}),dynamicTree.TreeSupport.addMethod("showTree",function(e,t,i,o){var r=this.urlGetNode+"&provider="+this.providerId+"&uri="+this.rootUri+"&depth="+e;o&&(r+="&forceHtmlEscape=true"),r+="&"+this._evaluateAdditionalParams(),this._showTree(r,t,i)}),dynamicTree.TreeSupport.addMethod("_evaluateAdditionalParams",function(){var e=this.additionalParams;return _.isFunction(e)&&(e=e.call(null)),_.isObject(e)?Object.toQueryString(e):null}),dynamicTree.TreeSupport.addMethod("showTreePrefetchNodes",function(e,t,i){var o=this.urlGetNode+"&provider="+this.providerId+"&uri="+this.rootUri;e&&(o+="&prefetch="+encodeURIComponent(e)),o+="&"+this._evaluateAdditionalParams(),this._showTree(o,t,i)}),dynamicTree.TreeSupport.addMethod("_showTree",function(e,t,i){var o=this;this.inInit=!0,this.wait();var r=function(e,t,i){return function(){return e.showTreeCallback(t,i)}}(this,t,i),s=function(){var e=!1;return o.httpErrorHandler&&(e=o.httpErrorHandler.apply(window,arguments)),!1===e&&(e=baseErrorHandler.apply(window,arguments)),e};ajaxTargettedUpdate(e,{fillLocation:this.ajaxBufferId,callback:r,errorHandler:s,hideLoader:this.hideLoader})}),dynamicTree.TreeSupport.addMethod("showTreeCallback",function(e,t){var i=document.getElementById(this.nodeTextId);if(null==i)return void(t?t():this.fireServerErrorEvent());var o=xssUtil.unescape(jQuery(i).text()),r=o.evalJSON();this.modifyRootObject&&(r=this.modifyRootObject(r,!1)),i=document.getElementById(this.ajaxBufferId),jQuery(i).html(""),this.setRootNode(this.processNode(r)),this.resortTree(),this.resetStatesOnShow&&this.resetStates(),this.renderTree(),this.inInit=!1,e?e():this.fireTreeLoadedEvent({tree:this})}),dynamicTree.TreeSupport.addMethod("processNode",function(e){var t={};t.id=e.id,t.type=e.type,t.uri=e.uri,t.extra=deepClone(e.extra),e.cssClass&&(t.cssClass=e.cssClass);var i=this.nodeClass,o=new i({name:unescapeBackslash(e.label),param:t,orderNumber:e.order});e.tooltip&&(o.tooltip=e.tooltip);var r=e.children;if(null!=r){var s=r.length;if(0===s)o.setHasChilds(!1);else for(var n=0;n<s;n++){var a=r[n];if(a){var l=this.processNode(a);o.addChild(l)}}o.isloaded=!0}return o}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildren",function(e,t,i){var o=e.param.uri,r=function(e,t,i,o){return function(){return e.getTreeNodeChildrenCallback(t,i,o)}}(this,e.id,t,i),s=function(t){(500==t.status||t.getResponseHeader("JasperServerError"))&&e.stopWaiting(),baseErrorHandler(t)};ajaxTargettedUpdate(this.urlGetChildren+"&provider="+this.providerId+"&uri="+encodeURIComponent(encodeURIComponent(o))+"&"+this._evaluateAdditionalParams(),{fillLocation:this.ajaxBufferId,callback:r,errorHandler:s,hideLoader:this.hideLoader}),this.inInit||e.wait()}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenCallback",function(e,t,i){var o=document.getElementById(this.nodeTextId);if(null==o)return void(i?i():this.fireServerErrorEvent());var r=xssUtil.unescape(jQuery(o).text()).evalJSON(),s=dynamicTree.nodes[e];this.modifyRootObject&&(r=this.modifyRootObject(r,!0,s)),o=document.getElementById(this.ajaxBufferId),jQuery(o).html(""),s.resetChilds(),s.stopWaiting();var n=r.length;if(0===n)s.setHasChilds(!1);else{var a=s.getTreeId(),l=a?dynamicTree.trees[a]:null,d=l?l.sortNodes:null;l&&(l.sortNodes=!1);for(var c=0;c<n;c++){var h=this.processNode(r[c]);s.addChild(h)}l&&(l.sortNodes=d,s.resortChilds())}s.isloaded=!0,s.refreshNode(),t?t(s.childs):this.fireChildrenLoadedEvent(s.childs)}),dynamicTree.TreeSupport.addMethod("getTreeMultipleNodesChildren",function(e,t,i){var o,r="",s=[];if(e&&e.length)for(o=0;o<e.length;o++)o>0&&(r+=","),r+=encodeURIComponent(encodeURIComponent(e[o].param.uri)),s[o]=e[o].id;if(r.length){var n=function(e,t,i,o){return function(){return e.getTreeMultipleNodesChildrenCallback(t,i,o)}}(this,s,t,i);if(ajaxTargettedUpdate(this.urlGetMultipleChildren+"&provider="+this.providerId,{fillLocation:this.ajaxBufferId,callback:n,postData:"uris="+r,errorHandler:baseErrorHandler,hideLoader:this.hideLoader}),!this.inInit)for(o=0;o<e.length;o++)e[o].wait()}}),dynamicTree.TreeSupport.addMethod("getTreeMultipleNodesChildrenCallback",function(e,t,i){var o=document.getElementById(this.nodeTextId);if(null==o)return void(i?i():this.fireServerErrorEvent());var r=xssUtil.unescape(jQuery(o).text()).evalJSON();o=document.getElementById(this.ajaxBufferId),jQuery(o).html(""),t?t(e,r):(this.setMultipleNodesChilden(e,r),this.fireMultipleChildrenLoadedEvent(e,r))}),dynamicTree.TreeSupport.addMethod("setMultipleNodesChilden",function(e,t,i){if(e&&t)for(var o=0;o<t.length;o++){for(var r=t[o],s=r.children,n=null,a=0;a<e.length;a++){var l=dynamicTree.nodes[e[a]];if(l.param.uri==r.parentUri){n=l;break}}if(n){n.resetChilds(),n.stopWaiting();var d=s.length;if(0===d)n.setHasChilds(!1);else{var c=n.getTreeId(),h=c?dynamicTree.trees[c]:null,u=h?h.sortNodes:null;h&&(h.sortNodes=!1);for(var p=0;p<d;p++){var m=this.processNode(s[p]);n.addChild(m)}h&&(h.sortNodes=u,n.resortChilds())}n.isloaded=!0,i||n.refreshNode()}}}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenPrefetched",function(e,t,i,o,r,s,n){var a=e.param.uri,l=this.urlGetNode+"&provider="+this.providerId+"&uri="+a,d="";t&&(d="&prefetch="+t),r&&(l+="&depth="+r);var c=function(e,t,i,o,r,s){return function(){return e.getTreeNodeChildrenPrefetchedCallback(t,i,o,r,s)}}(this,e.id,i,o,s,n);ajaxTargettedUpdate(l,{fillLocation:this.ajaxBufferId,callback:c,postData:d,errorHandler:baseErrorHandler,hideLoader:this.hideLoader}),this.inInit||e.wait()}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenPrefetchedCallback",function(e,t,i,o,r){var s=document.getElementById(this.nodeTextId);if(null==s)return void(i?i():this.fireServerErrorEvent());var n=xssUtil.unescape(jQuery(s).text()).evalJSON();s=document.getElementById(this.ajaxBufferId),jQuery(s).html("");var a=dynamicTree.nodes[e];if(a.resetChilds(),a.stopWaiting(),n.children){var l=a.getTreeId(),d=l?dynamicTree.trees[l]:null,c=d?d.sortNodes:null;d&&(d.sortNodes=!1);for(var h=0;h<n.children.length;h++){var u=this.processNode(n.children[h]);a.addChild(u)}d&&(d.sortNodes=c,o||a.resortChilds())}a.isloaded=!0,r||a.refreshNode(),t?t():this.fireChildredPrefetchedLoadedEvent(a.childs)}),dynamicTree.TreeSupport.addMethod("openAndSelectNode",function(e,t,i,o){var r=function(e){var t=dynamicTree.trees[e.getTreeId()];e.parent&&t&&t.rootNode!=e.parent&&t.getState(e.parent.id)==dynamicTree.TreeNode.State.CLOSED&&e.parent.handleNode(),e&&jQuery("#dataChooserSource").length&&(e.nofocus=!0),t._selectOrEditNode(void 0,e,!1,!1,!1,o)};this.processNodePath(e,r,i);var s=this.getSelectedNode();s&&s.scroll(),t&&t()}),dynamicTree.TreeSupport.addMethod("processNodePath",function(e,t,i){var o=this.getRootNode();if("/"===e)t(o);else{var r,s=e.split("/");for(r=0;r<s.length;r++)if(s[r]){var n=o;if(!(o=this.findNodeChildByMetaName(o,s[r]))){if(!i)return;if(!(o=this.findNodeFirstNodeChildByAlphabeticalOrder(n)))return}t(o)}}}),dynamicTree.TreeSupport.addMethod("findLastLoadedNode",function(e){var t={node:null},i=function(e){return function(t){e.node=t}}(t);return this.processNodePath(e,i),t.node}),dynamicTree.TreeSupport.addMethod("findNodeChildByMetaName",function(e,t){if(e.hasChilds())for(var i=0;i<e.childs.length;i++)if(e.childs[i].param.id==t)return e.childs[i];return null}),dynamicTree.TreeSupport.addMethod("findNodeFirstNodeChildByAlphabeticalOrder",function(e){var t=null,i=null;if(e.childs.length>0){t=e.childs[0].param.id,i=0;for(var o=null,r=null,s=1;s<e.childs.length;s++){o=e.childs[s].param.id,r=s;for(var n=o.length<t.length?o.length:t.length,a=0;a<n;a++){if(o.charCodeAt(a)<t.charCodeAt(a)){t=o,i=r;break}if(o.charCodeAt(a)>t.charCodeAt(a))break}}return e.childs[i]}return null}),dynamicTree.TreeSupport.addMethod("findNodeById",function(e,t){return function e(t,i){if(!i||!t)return null;if(i.param.id===t)return i;if(i.hasChilds())for(var o=0;o<i.childs.length;++o){var r=e(t,i.childs[o]);if(r)return r}return null}(e,t||this.getRootNode())}),dynamicTree.TreeSupport.addMethod("hasVisibleFolders",function(e){if(this.bShowRoot)return!0;var t=e.children;if(t)for(var i=0;i<t.length;i++){var o=e.children[i].children;if(o&&o.length>0)return!0}return!1}),dynamicTree.TreeSupport.addMethod("getMessage",function(e,t,i){var o=this.urlGetMessage+"&messageId="+e,r=function(e,t,i){return function(){return e.getMessageCallback(t,i)}}(this,t,i);ajaxTargettedUpdate(o,{fillLocation:this.ajaxBufferId,callback:r,errorHandler:baseErrorHandler,hideLoader:this.hideLoader})}),dynamicTree.TreeSupport.addMethod("getMessageCallback",function(e,t){var i=document.getElementById(this.ajaxBufferId);if(null==i)return void(t&&t());var o=jQuery(i),r=trim(o.html());o.html(""),e&&e(r)}),dynamicTree.TreeSupport.addMethod("fireServerErrorEvent",function(){this._getElement().fire("server:error",{})}),dynamicTree.TreeSupport.addMethod("fireTreeLoadedEvent",function(e){this._getElement().fire("tree:loaded",{tree:e})}),dynamicTree.TreeSupport.addMethod("fireChildrenLoadedEvent",function(e){this._getElement().fire("children:loaded",{nodes:e})}),dynamicTree.TreeSupport.addMethod("fireMultipleChildrenLoadedEvent",function(e,t){this._getElement().fire("multipleChildren:loaded",{parentNodeIds:e,metaNodes:t})}),dynamicTree.TreeSupport.addMethod("fireChildredPrefetchedLoadedEvent",function(e){this._getElement().fire("childredPrefetched:loaded",{nodes:e})}),define("components.dynamicTree",["prototype","dynamicTree.tree","dynamicTree.treenode","dynamicTree.events","core.ajax"],function(e){return function(){return e.dynamicTree}}(this)),dynamicTree.RepositoryFolder=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("com.jaspersoft.jasperserver.api.metadata.common.domain.Folder"),SuperRoot:new dynamicTree.TreeNode.Type("superroot"),Root:new dynamicTree.TreeNode.Type("root")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_folders:folders",this.param.extra&&this.param.extra.isActiveThemeFolder&&(this.param.cssClass=this.ACTIVE_THEME_CLASS)},dynamicTree.TreeNode&&(dynamicTree.RepositoryFolder.prototype=deepClone(dynamicTree.TreeNode.prototype)),dynamicTree.RepositoryFolder.addVar("ACTIVE_THEME_CLASS","activeTheme"),dynamicTree.RepositoryFolder.addMethod("isParent",function(){return this.param.type==this.Types.Folder.name||this.param.type==this.Types.SuperRoot.name||this.param.type==this.Types.Root.name}),dynamicTree.RepositoryFolder.addMethod("isSuperRoot",function(){return this.param.type==this.Types.SuperRoot.name}),dynamicTree.RepositoryFolder.addMethod("isPublic",function(){return"public"===this.param.id}),dynamicTree.createRepositoryTree=function(e,t){var i=null!=t.organizationId&&""!==t.organizationId;null==t.bShowRoot&&(t.bShowRoot=!i),t.nodeClass||(t.nodeClass=dynamicTree.RepositoryFolder),t.templateDomId="list_responsive_collapsible_folders";var o=new dynamicTree.TreeSupport(e,t);if(o.organizationId=t.organizationId,o.publicFolderUri=t.publicFolderUri,o.orgMode=i,o.modifyRootObject=function(e,t,i){var o;if(t){o=[];for(var r=0;r<e.length;r++)e[r].uri==this.publicFolderUri&&i&&"/"!=i.param.uri||o.push(e[r])}else if(this.orgMode&&null!=e.children){for(var s,n=e.children,a=[],r=0;r<n.length;r++)n[r].uri==this.publicFolderUri?s=n[r]:a.push(n[r]);e.children=a,o={type:"superroot",label:"",extra:{}},o.children=[e,s]}else o=e;return o},o.getRootNode=function(){var e=this.rootNode;return e.isSuperRoot()?e.childs[0].isPublic()?e.childs[1]:e.childs[0]:e},o.findNodeChildByMetaName=function(e,t){if(e.isSuperRoot()){var i,r;if(e.childs[0].isPublic()?(i=e.childs[0],r=e.childs[1]):(i=e.childs[1],r=e.childs[0]),"public"===t)return i;e=r}if(e.hasChilds())for(var s=0;s<e.childs.length;s++)if(e.childs[s].param.id==t)return e.childs[s];return"public"==t&&e.parent&&e.parent.isSuperRoot()?o.findNodeChildByMetaName(e.parent,t):null},isIPad()){var r=$(e);o.touchController=new TouchController(r,r.up(1),{absolute:!0})}return o},define("dynamicTree.utils",["components.dynamicTree","touchcontroller","dynamicTree.treenode"],function(e){return function(){return e.dynamicTree}}(this)),define("tools.infiniteScroll",["require","prototype","utils.common"],function(e){"use strict";e("prototype"),e("utils.common");var t=function(e){this._id=e.id,this._contentId=e.contentId?e.contentId:void 0,this._scroll=e.scroll,this._loadFactor=e.loadFactor?e.loadFactor:.95,this._lastContentHeight=0,this._loading=!1,e.control?void 0!==e.control.length&&e.control.length>1?this._control=$(e.control[0]):this._control=$(e.control):this._control=this._scroll?this._scroll.parent:$(this._id),this._scroll?this._content=this._scroll.element:e.content?void 0!==e.content.length&&e.content.length>1?this._content=$(e.content[0]):this._content=$(e.content):this._content=this._contentId?$(this._contentId):this._control.childElements()[0],this._eventType=isSupportsTouch()?"touchmove":"scroll",this._control.observe(this._eventType,this._onScrollHandler.bind(this))};return t.addMethod("destroy",function(){this._control&&this._control.stopObserving(this._eventType,this._handler)}),t.addMethod("_onScrollHandler",function(e){var t=this._scroll?-1*this._scroll.y:this._control.scrollTop,i=this._content.getHeight(),o=this._control.getHeight();i!=this._lastContentHeight&&(this._loading=!1);var r=!this._loading&&0!=i;(r=this._scroll?r&&this._scroll.isBottom():r&&(o+t)/i>this._loadFactor)&&(this._loading=!0,this._lastContentHeight=i,isIPad()&&this.wait(),this.onLoad())}),t.addMethod("onLoad",doNothing),t.addMethod("reset",function(){isIPad()?this._scroll.reset():this._control.scrollTop=0,this._loading=!1}),t.addMethod("wait",function(){if(!this._waitIndicator){this._waitIndicator=new Element("div",{class:"dimmer resultsOverlay"});var e=this._control.getDimensions(),t=this._control.positionedOffset();this._waitIndicator.setStyle({zIndex:"4000",top:t.top+"px",left:t.left+"px",height:e.height+"px",width:e.width+"px"}),this._control.insert({after:this._waitIndicator})}this._waitIndicator.show()}),t.addMethod("stopWaiting",function(){this._waitIndicator&&this._waitIndicator.hide()}),window.InfiniteScroll=t,t}),define("common/enum/httpStatusCodes",{100:"continue",101:"switchingProtocols",200:"ok",201:"created",202:"accepted",203:"nonAuthoritativeInformation",204:"noContent",205:"resetContent",206:"partialContent",300:"multipleChoices",301:"movedPermanently",302:"found",303:"seeOther",304:"notModified",305:"useProxy",307:"temporaryRedirect",400:"badRequest",401:"unauthorized",402:"paymentRequired",403:"forbidden",404:"notFound",405:"methodNotAllowed",406:"notAcceptable",407:"proxyAuthenticationRequired",408:"requestTimeout",409:"conflict",410:"gone",411:"lengthRequired",412:"preconditionFailed",413:"requestEntityTooLarge",414:"requestUriTooLong",415:"unsupportedMediaType",416:"requestedRangeNotSatisfiable",417:"expectationFailed",500:"internalServerError",501:"notImplemented",502:"badGateway",503:"serviceUnavailable",504:"gatewayTimeout",505:"httpVersionNotSupported"}),define("common/enum/errorCodes",["require"],function(e){"use strict";return{UNEXPECTED_ERROR:"unexpected.error",INVALID_RESOURCE_TYPE:"invalid.resource.type",ACCESS_DENIED:"access.denied"}}),define("common/model/BaseModel",["require","underscore","backbone","common/enum/httpStatusCodes","common/enum/errorCodes"],function(e){"use strict";var t=e("underscore"),i=e("backbone"),o=e("common/enum/httpStatusCodes"),r=e("common/enum/errorCodes"),s=i.Model.extend({initialize:function(){this.on("error",s.unifyServerErrors)},serialize:function(){return t.clone(this.attributes)}},{unifyServerErrors:function(e,t){var i=o[t.status],r=s.createServerError(t);e.trigger("error:"+i,e,r,t),e.trigger("error:all",e,r,t)},createServerError:function(e){var t;try{t=JSON.parse(e.responseText)}catch(e){t={message:"Can't parse server response",errorCode:r.UNEXPECTED_ERROR,parameters:[]}}return t}});return s}),define("tenantImportExport/export/model/ResourcesModel",["require","backbone","request"],function(e){var t=e("backbone"),i=e("request");return t.Model.extend({url:"rest_v2/settings/exportResourceOptions",fetch:function(){return i({url:this.url,type:"GET"})}})}),define("tenantImportExport/export/enum/exportTypesEnum",{ROOT_TENANT:"rootTenant",TENANT:"tenant",SERVER_CE:"serverCE",SERVER_PRO:"serverPRO",REPOSITORY:"repository"}),define("tenantImportExport/export/factory/exportModelAttributesFactory",["require","underscore","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("underscore"),i=e("tenantImportExport/export/enum/exportTypesEnum"),o={},r={roles:null,users:null,everything:!0,userForRoles:!1,rolesForUser:!1,includeReports:!0,includeOtherResourceFiles:!0,includeDataSources:!0,includeDependentObjects:!0,includeAttributes:!0,includeAttributeValues:!0},s={includeAccessEvents:!1,includeAuditEvents:!1,includeMonitoringEvents:!1},n={includeDomains:!0,includeAdHocViews:!0,includeDashboards:!0},a={includeSubOrganizations:!0},l={includeServerSettings:!0};return o[i.ROOT_TENANT]=t.extend({},r,s,n,a,l),o[i.TENANT]=t.extend({},r,n,a),o[i.SERVER_PRO]=t.extend({},r,s,n,a,l),o[i.SERVER_CE]=t.extend({},r,l,{includeAccessEvents:!0}),function(e){return o[e]}}),define("tenantImportExport/export/model/ExportModel",["require","jquery","underscore","backbone","backbone.validation","jrs.configs","bundle!ImportExportValidationBundle","common/util/i18nMessage","common/model/BaseModel","../model/ResourcesModel","tenantImportExport/export/factory/exportModelAttributesFactory","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){var t,i,r=[];return e.get("everything")?(r.push("everything"),e.get("includeAccessEvents")&&r.push("include-access-events")):(t=o(e)&&e.get("includeRepositoryPermissions")&&!n.isEmpty(e.get("uris")),i=!e.get("includeAttributeValues")||!e.get("includeAttributes"),e.get("userForRoles")&&r.push("role-users"),e.get("rolesForUser")&&r.push("users-roles"),t&&r.push("repository-permissions"),!e.get("includeSubOrganizations")&&r.push("skip-suborganizations"),e.get("includeAttributes")&&r.push("include-attributes"),i&&r.push("skip-attribute-values"),e.get("includeServerSettings")&&r.push("include-server-settings"),(!o(e)||!e.get("includeDependentObjects"))&&r.push("skip-dependent-resources")),e.get("includeAuditEvents")&&r.push("include-audit-events"),e.get("includeMonitoringEvents")&&r.push("include-monitoring-events"),e.get("encryptFile")&&r.push("encrypted"),r}function i(e){var t=[],i=new s.Deferred;return!e.get("everything")&&o(e)?e.resources.fetch().done(function(o){for(var r in g)e.get(r)&&t.push(o[g[r]]);i.resolve(n.flatten(t))}):i.resolve(null),i}function o(e){var t=n.keys(g);return n.filter(t,function(t){return e.get(t)}).length}function r(e){var t=d.organizationsFolderUri||"/organizations",i=d.orgTemplateFolderUri||"/org_template";return new RegExp("^("+t+"(?!"+i+")/([^/]+))+").exec(e)}var s=e("jquery"),n=e("underscore"),a=e("backbone"),l=e("backbone.validation"),d=e("jrs.configs"),c=e("bundle!ImportExportValidationBundle"),h=e("common/util/i18nMessage").extend({bundle:c}),u=e("common/model/BaseModel"),p=e("../model/ResourcesModel"),m=e("tenantImportExport/export/factory/exportModelAttributesFactory"),f=e("tenantImportExport/export/enum/exportTypesEnum"),g={includeReports:"report",includeDomains:"domain",includeAdHocViews:"adhocDataView",includeDataSources:"dataSource",includeDashboards:"dashboard",includeOtherResourceFiles:"others"},v=u.extend({defaults:{uris:["/"],fileName:"export.zip",encryptFile:!1,includeRepositoryPermissions:!0,includeScheduledReportJobs:!0,includeDependencies:!0,includeFullResourcePath:!0},validation:{fileName:[{required:!0,msg:new h("export.file.name.empty")},{maxLength:256,msg:new h("export.file.name.too.long",256)},{fn:function(e){return/[\\\/?*%:|"<>]/g.test(e)?new h("export.file.name.contains.not.supported.characters"):/^[\.]{1,2}$/g.test(e)?new h("export.file.name.not.valid"):void 0}}],uris:[{fn:function(){var e=this.toExportTask();return!(e.uris||e.roles||e.users||n.filter(e.parameters,function(e){return"role-users"!==e&&"users-roles"!==e}).length)}}]},initialize:function(){u.prototype.initialize.call(this),n.bindAll(this,"url","save","cancel","toExportTask","reset"),this.resources=new p},url:function(){return"rest_v2/export"},save:function(){var e=new s.Deferred,t=new a.Model,o=this;t.url=this.url;var r={};return i(this).done(function(i){i&&(r.resourceTypes=i),t.save(n.extend(o.toExportTask(),r)).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t),o.trigger("error",o,t)})}),e},cancel:function(){var e=this.url()+"/"+this.id;this.destroy({url:e})},toExportTask:function(){var e=this.get("everything"),i=this.get("roles"),s=this.get("users"),a=n.clone(this.get("uris")),l=e||this.get("includeReports")&&this.get("includeScheduledReportJobs"),d={uris:a,scheduledJobs:this.get("includeScheduledReportJobs")?a:null,parameters:[]};this.get("includeRepositoryPermissions")&&d.parameters.push("repository-permissions"),!this.get("includeDependencies")&&d.parameters.push("skip-dependent-resources");var c=r(a&&a[0]);c&&!this.get("includeFullResourcePath")&&(d.organization=c.last(),d.parameters.push("skip-suborganizations","skip-attribute-values"),d.uris=n.map(a,function(e){return e.replace(c.first(),"")}),d.scheduledJobs=this.get("includeScheduledReportJobs")?d.uris:null);var h={uris:o(this)?a:null,roles:n.isEmpty(i)?null:i,users:n.isEmpty(s)?null:s,scheduledJobs:l?a:null,organization:this.get("organization"),parameters:t(this)};return this.type!==f.REPOSITORY?h:d},reset:function(e,t){this.type=t;var i=n.extend({},this.defaults,m(t));this.clear().set(n.extend({},i,e))}});return n.extend(v.prototype,l.mixin),v}),define("tenantImportExport/export/model/ExportStateModel",["require","underscore","common/model/BaseModel"],function(e){var t=e("underscore"),i=e("common/model/BaseModel"),o={INPROGRESS:"inprogress",READY:"finished",FAILED:"failed",PENDING:"pending",CANCELLED:"cancelled"};return i.extend({url:function(){return"rest_v2/export/"+this.id+"/state"},initialize:function(e){i.prototype.initialize.call(this),this.on("change:phase",function(e,i){i==o.INPROGRESS&&t.isUndefined(e.interval)?e.interval=window.setInterval(function(){e.fetch({cache:!1}).fail(t.bind(e.stopPolling,e))},1e3):e.stopPolling()})},stopPolling:function(){t.isUndefined(this.interval)||(window.clearInterval(this.interval),this.interval=void 0)}},{STATE:o})}),define("tenantImportExport/export/model/AuthorityPickerModel",["require","jquery","backbone","components.templateengine","underscore"],function(e){"use strict";var t=(e("jquery"),e("backbone")),i=e("components.templateengine"),o=e("underscore");return t.Model.extend({defaults:{items:[]},url:function(){return i.renderUrl(this.urlTemplate,this.context,!0)},parse:function(e){return{items:e?e.role?e.role:e.user:[]}},defaultErrorHandler:function(e,t){var i;try{i=JSON.parse(t.responseText)}catch(e){i=null}this.trigger("error:server",t.status,i,e)},setContext:function(e){this.context=o.extend(this.context||{searchString:"",excludeSubOrgs:!1},e),this.fetch({error:o.bind(this.defaultErrorHandler,this)})}},{instance:function(e,t){var i=new this;return i.urlTemplate=e,t&&i.setContext(t),i}})}),define("text!tenantImportExport/export/template/authorityPickerTemplate.htm",[],function(){return'<div class="control combo {{- customClass}} " title="{{- title}}">\n\n    <js-templateNonce></js-templateNonce>\n    <span class="wrap">{{- title}}</span>\n        <span class="control searchLockup ">\n            <div class="wrap">\n                <input type="text" tabindex="">\n            </div>\n            <b class="right">\n                <a class="button searchClear"></a>\n            </b>\n            <a class="button search up"></a>\n        </span>\n\n    <div class="authorityPicker" onselectstart="return false">\n        <div class="selectBorder upper"></div>\n        <ul class="list"></ul>\n        <div class="selectBorder lower"></div>\n    </div>\n\n    <div class="button-select-all" title="{{- selectLabel }}">\n        <i class="icon"></i>\n        <a class="label">\n            <span class="text">{{- selectLabel }}</span>\n        </a>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm",[],function(){return'{{ for (var i = 0, l = items.length; i<l; i++){ }}\n<li class="leaf">\n\n    <js-templateNonce></js-templateNonce>\n    <div class=""><span class="leftColumn">{{- items[i].name}}{{- items[i].username}}</span>\n        {{ if (items[i].tenantId){ }}\n            <span class="rightColumn">{{- items[i].tenantId }}</span>\n        {{ } }}\n    </div>\n</li>\n{{ } }}\n'}),define("tenantImportExport/export/view/AuthorityPickerView",["require","jquery","backbone","text!tenantImportExport/export/template/authorityPickerTemplate.htm","text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm","underscore"],function(e){"use strict";function t(e,t,i){return i<=Math.max(e,t)&&i>=Math.min(e,t)}var i=e("jquery"),o=e("backbone"),r=e("text!tenantImportExport/export/template/authorityPickerTemplate.htm"),s=e("text!tenantImportExport/export/template/authorityPickerOptionsTemplate.htm"),n=e("underscore");return o.View.extend({events:{"click .button.search":"search","click .button.searchClear":"clear","click .button-select-all":"_selectAllHandler","keydown input[type=text]":"keyHandler","mousedown li":"selectionStarted","mouseenter li":"mouseEntered","mouseleave li":"mouseLeave","mouseup ul":"selectionFinished","mouseenter ul":"stopScroll","mouseleave ul":"startScroll"},cursor:-1,baseCursor:-1,selecting:!1,scrollSpeed:30,initialize:function(e){this.model.on("change",n.bind(this.renderList,this)),this.model.on("error:server",n.bind(function(){this.trigger("error:server",arguments)},this)),this.upHandler=n.bind(function(e){this.stopScroll(e),this.selecting=!1},this),this.el=!1,this.initOptions=e},render:function(){return this.mainTemplate||(this.mainTemplate=n.template(r)),this.optionsTemplate||(this.optionsTemplate=n.template(s)),this.el||(this.$el=i("<div/>").html(this.mainTemplate(this.initOptions)).children(),this.el=this.$el[0],this.subEl=this.$el.find(".authorityPicker ul"),this.delegateEvents()),this.model.context||this.model.setContext(),this},renderList:function(){return this.subEl.html(this.optionsTemplate(this.model.attributes)).find("li").each(function(e,t){i(t).attr("index",e)}),this.cursor=-1,this.baseCursor=-1,this.scrollSpeed=this.subEl.find("li:eq(0)").height(),this.subEl.scrollTop(0),this.trigger("change:selection",[]),this},getSelected:function(){return n.reduce(this.subEl.find(".selected"),function(e,t){var o=n.map(i(t).find("span"),function(e){return i(e).html()});return e.push(o.join("|")),e},[])},search:function(){var e=this.$el.find("input[type=text]").val();this.model.setContext({searchString:e}),e?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},_selectAllHandler:function(){this.selectAll()},clear:function(){this.$el.find("input[type=text]").val(""),this.search()},keyHandler:function(e){13===e.which&&this.search()},setDisabled:function(e){var t=this.$el.find(".button-select-all").children();e?(this.subEl.addClass("disabled"),t.addClass("disabled"),this.undelegateEvents()):(this.subEl.removeClass("disabled"),t.removeClass("disabled"),this.delegateEvents()),this.$el.find("input[type=text]").attr("disabled",e)},highlightSet:function(e){this.subEl.find("li").each(function(t,o){o=i(o);var r=n.map(o.find("span"),function(e){return i(e).html()});o.toggleClass("highlighted",n.contains(e,r.join("|")))})},selectAll:function(e){this.subEl.find("li").each(function(e,t){i(t).addClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectNone:function(e){this.subEl.find("li").each(function(e,t){i(t).removeClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectInverse:function(e){this.subEl.find("li").each(function(e,t){i(t).toggleClass("selected")}),e||this.trigger("change:selection",this.getSelected())},selectItem:function(e,t){this.subEl.find("li[index="+e+"]").addClass("selected"),t||this.trigger("change:selection",this.getSelected())},unSelectItem:function(e,t){this.subEl.find("li[index="+e+"]").removeClass("selected"),t||this.trigger("change:selection",this.getSelected())},selectRange:function(e,t,o){var r=Math.min(e,t),s=Math.max(e,t);this.subEl.find("li:lt("+(s+1)+")").each(function(e,t){e>=r&&i(t).addClass("selected")}),o||this.trigger("change:selection",this.getSelected())},selectionStarted:function(e){this.selecting=!0,e.ctrlKey||e.metaKey||this.selectNone(!0);var t=+i(e.target).parents("li").toggleClass("selected").attr("index");e.shiftKey?-1!=this.cursor&&this.selectRange(this.cursor,t,!0):(this.cursor=t,this.baseCursor=this.cursor)},mouseEntered:function(e){this.selecting&&(this.cursor=+i(e.target).parents("li").addClass("selected").attr("index"))},mouseLeave:function(e){if(this.selecting){var o=i(e.target).parents("li"),r=i(e.relatedTarget).parents("li");t(this.cursor,this.baseCursor,+r.attr("index"))&&o.removeClass("selected")}},selectionFinished:function(e){this.selecting=!1,this.trigger("change:selection",this.getSelected())},startScroll:function(e){if(this.selecting){if(i(e.relatedTarget).hasClass("upper"))this.direction=-1;else{if(!i(e.relatedTarget).hasClass("lower"))return void(this.selecting=!1);this.direction=1}i(document.body).on("mouseup",this.upHandler),this.scrollTimer=setInterval(n.bind(this.scrollList,this),200)}},stopScroll:function(e){this.selecting&&(clearInterval(this.scrollTimer),this.direction=0,
i(document.body).off("mouseup",this.upHandler))},scrollList:function(){this.subEl.scrollTop(+this.subEl.scrollTop()+this.scrollSpeed*this.direction),t(this.cursor,this.baseCursor,this.cursor+this.direction)?this.unSelectItem(this.cursor,!0):this.selectItem(this.cursor+this.direction,!0),this.cursor=this.cursor+this.direction}})}),define("text!tenantImportExport/export/template/loadingDialogTemplate.htm",[],function(){return'<div class="panel dialog loading overlay moveable centered_horz centered_vert {{- additionalCssClasses }}" tabindex="-1">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="content">\n        <div class="header mover">\n            <div class="title">{{- title }}</div>\n        </div>\n        <div class="body">\n            <p class="message"></p>\n        </div>\n    </div>\n</div>\n'}),define("tenantImportExport/export/view/LoadingDialog",["require","common/component/dialog/Dialog","underscore","bundle!CommonBundle","text!tenantImportExport/export/template/loadingDialogTemplate.htm"],function(e){var t=e("common/component/dialog/Dialog"),i=e("underscore"),o=e("bundle!CommonBundle"),r=e("text!tenantImportExport/export/template/loadingDialogTemplate.htm");return t.extend({defaultTemplate:r,constructor:function(e){i.defaults(e,{contentContainer:".body > .message",title:o["dialog.overlay.title"],modal:!0}),t.call(this,e)}})}),define("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm",[],function(){return'{{ if (message) { }}<p class="message">\n\n    <js-templateNonce></js-templateNonce>\n    {{- message }}</p> {{ } }}\n<div class="control groupBox">\n    <ol class="list tabular oneColumn">\n        {{ for (var i = 0; i<items.length; i++) { }}\n        <li class="leaf {{-  i === 0 ? \' first\' : \'\' }} {{- i === items.length - 1 ? \'last\' : \'\' }}" tabindex="-1">\n            <div class="wrap">\n                <div class="column one">\n                    <p class="uri">{{- items[i] }} </p>\n                </div>\n            </div>\n        </li>\n        {{ } }}\n    </ol>\n\n</div>\n\n'}),define("tenantImportExport/view/BaseWarningDialogView",["require","jquery","underscore","common/component/dialog/Dialog","bundle!ImportExportBundle","text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm"],function(e){var t=(e("jquery"),e("underscore")),i=e("common/component/dialog/Dialog"),o=e("bundle!ImportExportBundle"),r=e("text!tenantImportExport/import/template/dependentResourcesDialogTemplate.htm");return i.extend({events:{resize:"onResizeHeight"},onResizeHeight:function(){this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight),this.$(".control.groupBox").css("min-height",this.$contentContainer.height()-this.$(".message").outerHeight(!0))},constructor:function(e){e=e||{},this.options=e,i.prototype.constructor.call(this,{modal:!0,resizable:e.resizable,minWidth:e.minWidth,minHeight:e.minHeight,additionalCssClasses:e.additionalCssClasses||"dependent-resources-dialog jr-uWidth-725px jr-uHeight-500px",title:e.title||o["dialog.broken.dependencies.title"],content:"",buttons:e.buttons}),this.template=t.template(e.template||r)},open:function(e){this.setContent(this.template(t.defaults(e,{message:""}))),i.prototype.open.apply(this,arguments),this.$contentContainer.scrollTop(0);var o=this.$(".jr-mDialog-footer").outerHeight(),r=this.$(".jr-mDialog-header").outerHeight(),s=this.$contentContainer.outerHeight(),n=this.$contentContainer.height();this._resizableContainerShiftHeight=o+r+s-n,this.onResizeHeight()}})}),define("tenantImportExport/export/view/ExportDependentResourcesDialogView",["require","underscore","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/view/BaseWarningDialogView"],function(e){var t=e("underscore"),i=e("bundle!CommonBundle"),o=e("bundle!ImportExportBundle"),r=e("tenantImportExport/view/BaseWarningDialogView");return r.extend({constructor:function(e){e||(e={}),t.extend(e,{resizable:!0,buttons:[{label:o["export.button.continue"],action:"export",primary:!0},{label:i["button.cancel"],action:"cancel",primary:!1}]}),r.prototype.constructor.call(this,e),this.on("button:export",t.bind(this.close,this)),this.on("button:cancel",t.bind(this.close,this))},open:function(e){t.extend(e,{message:o["export.dialog.broken.dependencies.intro"]}),r.prototype.open.call(this,e)}})}),define("text!common/component/notification/template/notificationTemplate.htm",[],function(){return'<div class="notificationAlert">\n\n    <js-templateNonce></js-templateNonce>\n    <p class="notificationMessage">\n        <span>{{- message }}</span>\n        <span class="close">| <a href="#">{{- i18n[\'notification.button.close\'] }}</a></span>\n    </p>\n</div>'}),define("common/component/notification/Notification",["require","underscore","jquery","backbone","bundle!js-sdk/CommonBundle","text!./template/notificationTemplate.htm","css!notifications"],function(e){"use strict";var t,i,o=e("underscore"),r=e("jquery"),s=e("backbone"),n=e("bundle!js-sdk/CommonBundle"),a=e("text!./template/notificationTemplate.htm");e("css!notifications");var l={SUCCESS:"success",WARNING:"warning"},d={};return d[l.WARNING]=l.WARNING,i=s.View.extend({template:o.template(a),events:{"click .close a":"hide"},el:function(){return this.template({message:this.message,i18n:n})},initialize:function(){this.render()},render:function(){return r("body").append(this.$el),this.$el.hide(),this.$messageContainer=this.$(".notificationMessage > span:first-child"),this},show:function(e){return e=o.extend({type:l.WARNING,delay:2e3},e),this.$messageContainer.text(e.message),this.$messageContainer.removeClass().attr({class:d[e.type]}),this.$el.slideDown(),e.delay&&o.delay(o.bind(this.hide,this),e.delay),this},hide:function(){return arguments.length&&arguments[0].preventDefault&&arguments[0].preventDefault(),this.$el.slideUp(),this},remove:function(){s.View.prototype.remove.apply(this,arguments)}},{show:function(){return t||(t=new i),t.show.apply(t,arguments)},hide:function(){return t||(t=new i),t.hide.apply(t,arguments)}})}),define("common/view/mixin/epoxyCustomBindingHandlers",["require"],function(e){return{}}),define("common/view/mixin/epoxyCustomBindingFilters",["require"],function(e){return{}}),define("common/view/mixin/epoxyViewMixin",["require","backbone.epoxy","underscore","./epoxyCustomBindingHandlers","./epoxyCustomBindingFilters"],function(e){var t=e("backbone.epoxy"),i=e("underscore"),o=e("./epoxyCustomBindingHandlers"),r=e("./epoxyCustomBindingFilters");return{epoxifyView:function(){var e=this.remove;t.View.mixin(this),e&&(this.remove=e),this.bindingFilters&&(this.bindingFilters=i.extend({},r,this.bindingFilters)),this.bindingHandlers&&(this.bindingHandlers=i.extend({},o,this.bindingHandlers))},applyEpoxyBindings:function(){this.applyBindings&&this.applyBindings()},removeEpoxyBindings:function(){this.removeBindings&&this.removeBindings()}}}),define("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm",[],function(){return'<div class="section resources tenant-options">\n\n    <js-templateNonce></js-templateNonce>\n    <p class="title">{{- i18n["export.dialog.resources"] }}</p>\n\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.data.sources"] }}</label>\n            <input class="includeDataSources" name="includeDataSources" type="checkbox"\n                   data-bind="checked:includeDataSources, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.domains"] }}</label>\n            <input class="includeDomains" name="includeDomains" type="checkbox"\n                   data-bind="checked:includeDomains, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.ad.hoc.views"] }}</label>\n            <input class="includeAdHocViews" name="includeAdHocViews" type="checkbox"\n                   data-bind="checked:includeAdHocViews, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.reports"] }}</label>\n            <input class="includeReports" name="includeReports" type="checkbox"\n                   data-bind="checked:includeReports, disabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.dashboards"] }}</label>\n            <input class="includeDashboards" name="includeDashboards" type="checkbox"\n                   data-bind="checked:includeDashboards, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.scheduled.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox"\n                   data-bind="checked:includeScheduledReportJobs, enabled:enableReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.resources.other.resources"] }}</label>\n            <input class="includeOtherResourceFiles" name="includeOtherResourceFiles" type="checkbox"\n                   data-bind="checked:includeOtherResourceFiles, disabled:everything">\n        </div>\n    </div>\n</div>\n\n<div class="section assets tenant-options">\n    <p class="title">{{- i18n["export.dialog.assets"] }}</p>\n\n    <div class="group">\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.sub.organizations"] }}</label>\n            <input class="includeSubOrganizations" name="includeSubOrganizations" type="checkbox"\n                   data-bind="checked:includeSubOrganizations, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.dependent.objects"] }}</label>\n            <input class="includeDependentObjects" name="includeDependentObjects" type="checkbox"\n                   data-bind="checked:includeDependentObjects, enabled:someResourceIsChecked">\n        </div>\n\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.repository.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox"\n                   data-bind="checked:includeRepositoryPermissions, enabled:someResourceIsChecked">\n        </div>\n        {{ if (isServerOrRootType) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.server.settings"] }}</label>\n            <input class="includeServerSettings" name="includeServerSettings" type="checkbox"\n                   data-bind="checked:includeServerSettings, disabled:everything">\n        </div>\n        {{ } }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attributes"] }}</label>\n            <input class="includeAttributes" name="includeAttributes" type="checkbox"\n                   data-bind="checked:includeAttributes, disabled:everything">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.assets.attribute.values"] }}</label>\n            <input class="includeAttributeValues" name="includeAttributeValues" type="checkbox"\n                   data-bind="checked:includeAttributeValues, enabled:enableAttributesValues">\n        </div>\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm",[],function(){return'<div class="section events">\n\n    <js-templateNonce></js-templateNonce>\n    <p class="title">{{- i18n["export.dialog.events"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.access.events"] }}</label>\n            <input class="includeAccessEvents" name="includeAccessEvents" type="checkbox" data-bind="checked:includeAccessEvents, enabled:everything">\n        </div>\n        {{ if(!isServerCe) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.audit.events"] }}</label>\n            <input class="includeAuditEvents" name="includeAuditEvents" type="checkbox" data-bind="checked:includeAuditEvents">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.dialog.events.monitoring.events"] }}</label>\n            <input class="includeMonitoringEvents" name="includeMonitoringEvents" type="checkbox" data-bind="checked:includeMonitoringEvents">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportDataFileTemplate.htm",[],function(){return'<div class="section file-name">\n\n    <js-templateNonce></js-templateNonce>\n    {{ if (!isRepository) { }} <p class="title">{{- i18n["export.dialog.file.properties"] }}</p> {{ } }}\n    <div class="group">\n        <div class="control input" data-bind="validationErrorClass:fileName" data-model-attr="fileName">\n            <span class="wrap">{{- i18n["export.dialog.file.properties.data.file.name"]}}</span>\n            <input type="text" class="fileName"  data-bind="value:fileName, events:[\'keyup\']"/>\n            <span class="message warning fileNameMessage" data-bind="validationErrorText:fileName" data-model-attr="fileName"></span>\n        </div>\n\n        {{ if (0) { }}\n        <div class="control checkBox encryptFileWrapper">\n            <label class="wrap" title="">{{- i18n["export.dialog.file.properties.encrypt.file"] }}</label>\n            <input class="encryptFile" name="encryptFile" type="checkbox" data-bind="checked:encryptFile">\n        </div>\n        {{ } }}\n    </div>\n</div>\n'}),define("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm",[],function(){return'<div class="section roles-users">\n\n    <js-templateNonce></js-templateNonce>\n    <p class="title">{{- i18n["export.dialog.roles.users"] }}</p>\n    <div class="group rolesAndUsers">\n        <div class="control radio">\n            <label class="wrap" title="" for="selectedUsersRoles">{{- i18n["export.dialog.roles.users.selected.roles.users"] }}</label>\n            <input id="selectedUsersRoles" class="selectedUsersRoles" name="sample" type="radio" data-bind="disabled:everything" checked="checked">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="usersWithSelectedRoles">{{- i18n["export.dialog.roles.users.users.with.selected.roles"] }}</label>\n            <input id="usersWithSelectedRoles" class="usersWithSelectedRoles" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n        <div class="control radio">\n            <label class="wrap" title="" for="rolesWithSelectedUsers">{{- i18n["export.dialog.roles.users.roles.with.selected.users"] }}</label>\n            <input id="rolesWithSelectedUsers" class="rolesWithSelectedUsers" name="sample" type="radio" data-bind="disabled:everything">\n        </div>\n    </div>\n    <div class="group">\n        <div class="selectRolesUsers column two control pickWells"></div>\n    </div>\n</div>'}),define("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm",[],function(){return'<div class="export-options">\n\n    <js-templateNonce></js-templateNonce>\n    {{ if (!isRepository) { }}\n    <p class="title export-options-title">{{- i18n["export.dialog.options"] }}</p>\n    <div class="section everything">\n        <div class="control checkBox everything">\n            <label class="wrap" title="">{{- i18n["export.dialog.everything"] }}</label>\n            <input class="everything" name="everything" type="checkbox" data-bind="checked:everything">\n        </div>\n    </div>\n    {{ } }}\n</div>'}),define("text!tenantImportExport/export/template/repositoryExportTemplate.htm",[],function(){return'<div class="section resources">\n\n    <js-templateNonce></js-templateNonce>\n    <p>{{- i18n["export.dialog.options"] }}</p>\n    <div class="group">\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.report.jobs"] }}</label>\n            <input class="includeScheduledReportJobs" name="includeScheduledReportJobs" type="checkbox" data-bind="checked:includeScheduledReportJobs">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.permissions"] }}</label>\n            <input class="includeRepositoryPermissions" name="includeRepositoryPermissions" type="checkbox" data-bind="checked:includeRepositoryPermissions">\n        </div>\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.dependencies"] }} </label>\n            <input class="includeDependencies" name="includeDependencies" type="checkbox" data-bind="checked:includeDependencies">\n        </div>\n        {{ if (isSubOrgLevel) { }}\n        <div class="control checkBox">\n            <label class="wrap" title="">{{- i18n["export.include.full.repo.path"] }}</label>\n            <input class="includeFullResourcePath" name="includeFullResourcePath" type="checkbox" data-bind="checked:includeFullResourcePath">\n        </div>\n        {{ } }}\n    </div>\n</div>'}),define("tenantImportExport/export/factory/exportTemplateFactory",["require","jquery","text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm","text!tenantImportExport/export/template/eventsToIncludeTemplate.htm","text!tenantImportExport/export/template/exportDataFileTemplate.htm","text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm","text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm","text!tenantImportExport/export/template/repositoryExportTemplate.htm","tenantImportExport/export/enum/exportTypesEnum"],function(e){var t=e("jquery"),i=e("text!tenantImportExport/export/template/assetsToIncludeExtendedVersionTemplate.htm"),o=e("text!tenantImportExport/export/template/eventsToIncludeTemplate.htm"),r=e("text!tenantImportExport/export/template/exportDataFileTemplate.htm"),s=e("text!tenantImportExport/export/template/rolesAndUsersToIncludeTemplate.htm"),n=e("text!tenantImportExport/export/template/exportOptionsContainerTemplate.htm"),a=e("text!tenantImportExport/export/template/repositoryExportTemplate.htm"),l=e("tenantImportExport/export/enum/exportTypesEnum"),d={};return d[l.ROOT_TENANT]=[s,i,o].join(""),d[l.TENANT]=[s,i].join(""),d[l.SERVER_PRO]=[s,i,o].join(""),d[l.SERVER_CE]=[s,i,o].join(""),d[l.REPOSITORY]=[a].join(""),function(e){return e=e||{},r+t(n).append(d[e.type])[0].outerHTML}}),define("tenantImportExport/export/view/ExportView",["require","css!importExport","jquery","underscore","backbone","../model/ExportModel","../model/ExportStateModel","../model/AuthorityPickerModel","./AuthorityPickerView","./LoadingDialog","./ExportDependentResourcesDialogView","common/component/notification/Notification","common/view/mixin/epoxyViewMixin","tenantImportExport/export/factory/exportTemplateFactory","tenantImportExport/export/enum/exportTypesEnum","bundle!ImportExportBundle","bundle!CommonBundle"],function(e){"use strict";function t(e){this.rolesList=new c({model:d.instance("rest_v2/{{if (tenantId) { }}organizations/{{-tenantId}}/{{ } }}roles?q={{-searchString}}{{ if (excludeSubOrgs) { }}&includeSubOrgs=false{{ } }}",{tenantId:e.tenantId}),customClass:"selectedRoles",title:v["export.dialog.roles.users.roles.label"],selectLabel:v["export.dialog.roles.users.select.all.roles.label"]}),this.rolesList.on("change:selection",this.bindWithRoles),this.rolesList.render(),this.usersList=new c({model:d.instance("rest_v2/{{if (tenantId) { }}organizations/{{-tenantId}}/{{ } }}users?q={{-searchString}}{{ if (excludeSubOrgs) { }}&includeSubOrgs=false{{ } }}",{tenantId:e.tenantId}),customClass:"select selectedUsers",title:v["export.dialog.roles.users.users.label"],selectLabel:v["export.dialog.roles.users.select.all.users.label"]}),this.usersList.on("change:selection",this.bindWithUsers),this.usersList.render(),this.rolesToUsers=d.instance("rest_v2/users?hasAllRequiredRoles=false{{ if (roles) for (var i = 0; i < roles.length; i++) { }}&requiredRole={{-roles[i]}}{{ } }}"),this.rolesToUsers.on("change",this.onRolesToUsersChange),this.usersToRoles=d.instance("rest_v2/roles?hasAllUsers=false{{ if (users) for (var i = 0; i < users.length; i++) { }}&user={{-users[i]}}{{ } }}"),this.usersToRoles.on("change",this.onUsersToRolesChange),this.changeEnabledState(),this.listenTo(this.model,"change:everything",this.changeEnabledState),this.$el.find(".selectRolesUsers").append(this.rolesList.el).append(this.usersList.el),this.listenTo(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs)}function i(){var e=document.createElement("iframe");e.src=this.model.url()+"/"+this.stateModel.id+"/"+this.model.get("fileName"),e.style.display="none",r("body").append(e)}function o(e){this.model.cancel(),this.stateModel.set("phase",e)}e("css!importExport");var r=e("jquery"),s=e("underscore"),n=e("backbone"),a=e("../model/ExportModel"),l=e("../model/ExportStateModel"),d=e("../model/AuthorityPickerModel"),c=e("./AuthorityPickerView"),h=e("./LoadingDialog"),u=e("./ExportDependentResourcesDialogView"),p=e("common/component/notification/Notification"),m=e("common/view/mixin/epoxyViewMixin"),f=e("tenantImportExport/export/factory/exportTemplateFactory"),g=e("tenantImportExport/export/enum/exportTypesEnum"),v=e("bundle!ImportExportBundle"),y=e("bundle!CommonBundle"),_=n.View.extend({className:"export-view",events:{"change .usersWithSelectedRoles":"includeRolesByUsers","change .rolesWithSelectedUsers":"includeUsersWithRoles","change .selectedUsersRoles":"includeSelectedRolesUsersOnly","click .section .checkBox label":"_clickOnCheckbox"},computeds:{includeAccessEventsChecked:function(){return!!this.model.get("everything")&&this.model.get("includeAccessEvents")},enableAttributesValues:{deps:["everything","includeAttributes"],get:function(e,t){return!e&&t}},enableReportJobs:{deps:["everything","includeReports"],get:function(e,t){return!e&&t}},someResourceIsChecked:{deps:["everything","includeReports","includeAdHocViews","includeDashboards","includeDomains","includeDataSources","includeOtherResourceFiles"],get:function(e,t,i,o,r,s,n){return!e&&(t||i||o||r||s||n)}}},initialize:function(){s.bindAll(this,"render","doExport","handleExportPhase","filterAuthoritiesBySubOrgs","bindWithRoles","bindWithUsers","changeEnabledState","includeRolesByUsers","includeUsersWithRoles","includeSelectedRolesUsersOnly","sendParameters","onRolesToUsersChange","onUsersToRolesChange","_isServerLevel","_includeUsersOrRoles","_showNotification","_getBrokenDependencies","_clickOnCheckbox","_onModelChange","_resetModel"),this.model||(this.model=new a),this.stateModel=new l,this.epoxifyView(),this.loadingDialog=new h({content:y["dialog.overlay.loading"]}),this.notification=new p,this.dependentResourcesDialogView=new u,this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.stateModel,"change:phase",this.handleExportPhase,this),this.listenTo(this.model,"error:unauthorized",window.location.reload),this.listenTo(this.stateModel,"error:unauthorized",window.location.reload);var e={delay:!1,message:v["export.error.cancelled"]},t={delay:!1,message:v["export.error.unexpected"]};this.listenTo(this.model,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.stateModel,"error:notFound",s.bind(this.notification.show,this.notification,e)),this.listenTo(this.model,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.stateModel,"error:internalServerError",s.bind(this.notification.show,this.notification,t)),this.listenTo(this.model,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",s.bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.dependentResourcesDialogView,"button:export",s.compose(s.bind(this.dependentResourcesDialogView.close,this.dependentResourcesDialogView),s.bind(function(){i.call(this),this._showNotification({message:v["export.finished"],type:"success"})},this))),this.listenTo(this.dependentResourcesDialogView,"button:cancel",s.bind(o,this,l.STATE.CANCELLED))},render:function(e){e=e||{},this.type=e.type;var i=this._isServerLevel(this.type),o=i||this.type===g.ROOT_TENANT;return o?this.$el.addClass("with-events"):this.$el.removeClass("with-events"),this.stopListening(this.model,"change:includeSubOrganizations",this.filterAuthoritiesBySubOrgs),this._resetModel(e),this.template=s.template(f(e))({everything:!1,i18n:v,isServerOrRootType:o,isServerLevel:i,isServerCe:this.type===g.SERVER_CE,isRepository:this.type===g.REPOSITORY,isSubOrgLevel:e.isSubOrgLevel}),this.$el.html(this.template),this.$(".selectRolesUsers").length&&t.call(this,e),this.applyEpoxyBindings(),this},doExport:function(){var e=this;this.model.isValid(!0)&&(this.loadingDialog.open(),this.model.save().done(function(t){e.stateModel.unset("warnings",{silent:!0}),e.stateModel.set(t),e.model.set("id",t.id)}))},handleExportPhase:function(){var e,t=this.stateModel.get("phase"),o=this._getBrokenDependencies();t==l.STATE.READY&&(this.loadingDialog.close(),s.isEmpty(o)?(i.call(this),e={message:v["export.finished"],type:"success"}):this.dependentResourcesDialogView.open({items:o})),t==l.STATE.FAILED&&(e={message:v["export.error.unexpected"]}),t==l.STATE.CANCELLED&&(e={message:v["export.error.cancelled"]}),e&&this._showNotification(e)},filterAuthoritiesBySubOrgs:function(){var e={excludeSubOrgs:!this.model.get("includeSubOrganizations")};this.rolesList.model.setContext(e),this.usersList.model.setContext(e)},bindWithRoles:function(e){this.model.set({roles:e}),this.onUsersToRolesChange(),e.length?this.rolesToUsers.setContext({roles:e}):this.rolesToUsers.set({items:[]})},bindWithUsers:function(e){this.model.set({users:e}),this.onRolesToUsersChange(),e.length?this.usersToRoles.setContext({users:e}):this.usersToRoles.set({items:[]})},changeEnabledState:function(){var e=this.model.get("everything");this.rolesList.setDisabled(e||this.model.get("rolesForUser")),this.usersList.setDisabled(e||this.model.get("userForRoles")),e&&(this.rolesList.selectNone(),this.usersList.selectNone())},includeRolesByUsers:function(e){var t=r(e.target).is(":checked");this.model.set({rolesForUser:!t,userForRoles:t}),this.onRolesToUsersChange(),this._includeUsersOrRoles(!t,t)},includeUsersWithRoles:function(e){var t=r(e.target).is(":checked");this.model.set({rolesForUser:t,userForRoles:!t}),this.onUsersToRolesChange(),this._includeUsersOrRoles(t,!t)},includeSelectedRolesUsersOnly:function(e){r(e.target).is(":checked")&&(this.model.set({userForRoles:!1,rolesForUser:!1}),this.onRolesToUsersChange(),this.onUsersToRolesChange(),this._includeUsersOrRoles(!1,!1))},sendParameters:function(e){this.model.isValid(!0)&&this.model.save()},onRolesToUsersChange:function(){this.model.get("userForRoles")?(this.usersList.highlightSet(s.map(this.rolesToUsers.get("items"),function(e){return e.username+(e.tenantId?"|"+e.tenantId:"")})),this.rolesList.highlightSet([])):this.usersList.highlightSet([])},onUsersToRolesChange:function(){this.model.get("rolesForUser")?(this.rolesList.highlightSet(s.map(this.usersToRoles.get("items"),function(e){return e.name+(e.tenantId?"|"+e.tenantId:"")})),this.usersList.highlightSet([])):this.rolesList.highlightSet([])},_isServerLevel:function(e){return e===g.SERVER_CE||e===g.SERVER_PRO},_includeUsersOrRoles:function(e,t){this.rolesList.setDisabled(e),this.usersList.setDisabled(t),this.rolesList.selectNone(),this.usersList.selectNone()},_showNotification:function(e){e=s.defaults(e,{type:"warning"}),this.loadingDialog.isVisible()&&this.loadingDialog.close(),this.notification.show({delay:!1,message:e.message,type:e.type})},_getBrokenDependencies:function(){var e=this.stateModel.get("warnings"),t=[];return s.each(e,function(e){"export.broken.dependency"===e.code&&t.push(e.parameters)}),s.flatten(s.sortBy(t,function(e){return e}))},_clickOnCheckbox:function(e){var t=r(e.target).next();t[0].disabled||this.model.set(t[0].name,!t[0].checked)},_onModelChange:function(){this.model.isValid(!0)},_resetModel:function(e){var t={organization:this.type==g.REPOSITORY?null:e.tenantId};if(this.type===g.ROOT_TENANT||this.type===g.TENANT){var i=this.type===g.ROOT_TENANT?"root_export.zip":e.tenantId+"_export.zip";s.extend(t,{fileName:i})}this.model.reset(t,this.type)}});return s.extend(_.prototype,m),_}),define("tenantImportExport/export/view/ExportDialogView",["require","jquery","underscore","jrs.configs","common/component/dialog/Dialog","./ExportView","bundle!CommonBundle","bundle!ImportExportBundle","tenantImportExport/export/enum/exportTypesEnum"],function(e){function t(e){return o.isArray(e)?o.pluck(e,"URIString"):[e.URIString]}function i(e){return o.isArray(e)||(e=[e]),!!o.reduce(e,function(e,t){return e||!t.resourceType||t.resourceType.indexOf("ReportUnit")+1||t.resourceType.indexOf("ReportOptions")+1},!1)}var o=(e("jquery"),e("underscore")),r=e("jrs.configs"),s=e("common/component/dialog/Dialog"),n=e("./ExportView"),a=e("bundle!CommonBundle"),l=e("bundle!ImportExportBundle"),d=e("tenantImportExport/export/enum/exportTypesEnum");return s.extend({constructor:function(e){e||(e={}),this.options=e,s.prototype.constructor.call(this,{model:this.model,resizable:!0,modal:!0,content:"",buttons:[{label:a["button.export"],action:"export",primary:!0},{label:a["button.cancel"],action:"cancel",primary:!1}]}),this.on("button:export",o.bind(this._onExportButtonClick,this)),this.on("button:cancel",o.bind(this._closeExportDialog,this))},initialize:function(e){this.exportView=new n,this.listenTo(this.exportView.model,"validated",function(e){e?this.buttons.enable("export"):this.buttons.disable("export")},this),s.prototype.initialize.apply(this,arguments)},openRepoDialog:function(e){var o=t(e),s=r.organizationsFolderUri||"/organizations",n=r.orgTemplateFolderUri||"/org_template",a=new RegExp("^("+s+"/([^/]+))+"),c=new RegExp("^"+s+n+"(/.*)?"),h=!!a.exec(o[0])&&!c.exec(o[0]),u={type:d.REPOSITORY,isSubOrgLevel:h},p=" "+l["export.dialog.repository.title"];this.addCssClasses("repository-export-dialog"),this._openExportDialog(u,p),this.exportView.model.set({uris:o,includeScheduledReportJobs:i(e)})},openTenantDialog:function(e){var t=" "+e.name,i=e.isRoot()?d.ROOT_TENANT:d.TENANT,o={type:i,tenantId:e.id};this.addCssClasses("tenant-export-dialog"),this._openExportDialog(o,t)},fieldIsValid:function(){},fieldIsInvalid:function(e){},_onExportButtonClick:function(){this.exportView.doExport(),this._closeExportDialog()},_closeExportDialog:function(){this.$el.css({width:this.width}),this.close()},_openExportDialog:function(e,t){var i=l["export.dialog.title"]+(t||"");this.setContent(this.exportView.render(e).$el),this.setTitle(i),this.exportView.applyEpoxyBindings(),this.exportView.delegateEvents(),s.prototype.open.apply(this,arguments),this.$el.css({minHeight:this.$el.outerHeight()}),this.width=this.$el.outerWidth()}})}),repositorySearch.secondarySearchBox={_searchBox:null,initialize:function(e){this._searchBox=new SearchBox({id:"secondarySearchBox"}),this._searchBox.onSearch=function(e){repositorySearch.fire(repositorySearch.Event.SEARCH_SEARCH,{
text:e})},this.setText(e)},setText:function(e){this._searchBox.setText(e)}},repositorySearch.toolbar={_bulkActions:{},initialize:function(e){this._bulkActions=e,toolbarButtonModule.initialize(this._toActionMap(this._bulkActions)),this.refresh()},refresh:function(){for(var e in this._bulkActions){var t=this._bulkActions[e].buttonId,i=toFunction(this._bulkActions[e].test);toolbarButtonModule.setButtonState($(t),i())}},_toActionMap:function(e){var t={};for(var i in e){var o=e[i];t[o.buttonId]=function(e,t){return function(){var i=getAsFunction(e),o=t,r=localContext&&localContext[e];o&&isArray(o)?i.apply(r?localContext:null,o):i.call(r?localContext:null,o)}}(o.action,o.actionArgs)}return t}},repositorySearch.foldersPanel={_treeId:"foldersTree",_uri:"/",_cookieName:"lastFolderUri",_canDoBrowse:!0,_touchController:null,initialize:function(e){if(e.isFolderSet)this._uri=e.state.folderUri;else{var t=window.localStorage?localStorage.getItem(this._cookieName):void 0;this._uri=t&&t.length>0?t:"/"}return this._container=$(this.getTreeId()).up(1),this.tree=new dynamicTree.createRepositoryTree(this.getTreeId(),{providerId:"repositoryExplorerTreeFoldersProvider",rootUri:repositorySearch.model.getRootFolderUri(),organizationId:e.organizationId,publicFolderUri:e.publicFolderUri,urlGetNode:"flow.html?_flowId=searchFlow&method=getNode",urlGetChildren:"flow.html?_flowId=searchFlow&method=getChildren",dragPattern:".draggable",selectOnMousedown:!1}),disableSelectionWithoutCursorStyle($(this.getTreeId()).up(1)),this.tree.observe("key:contextMenu",function(e){var t=e.memo.node,i=getBoxOffsets(t,!0);repositorySearch.actionModel.showFolderMenu(e,{menuLeft:i[0]+100,menuTop:i[1]+20}),Event.stop(e)}),this.tree.observe("key:escape",function(e){actionModel.hideMenu(),Event.stop(e)}),this.tree.observe("tree:mouseover",function(e){this.tree._overNode=e.memo.node}.bindAsEventListener(this)),this.tree.observe("tree:mouseout",function(e){this.tree.refreshDropTarget(!1),this.tree._overNode==e.memo.node&&(this.tree._overNode=null)}.bindAsEventListener(this)),this.tree.setDragStartState=function(e,t,i){dynamicTree.Tree.prototype.setDragStartState.call(this,e,t,i);var o=new Folder(e);isMetaHeld(i,!0)?(canFolderBeCopied(o)&&invokeFolderAction("CopyFolder",o),$(document.body).addClassName(layoutModule.COPY_CLASS)):canFolderBeMoved(o)&&invokeFolderAction("MoveFolder",o)},this.tree.setDragEndState=function(e,t,i){repositorySearch.CopyMoveController.cancel(),this.refreshDropTarget(!1),$(document.body).removeClassName(layoutModule.COPY_CLASS),dynamicTree.Tree.prototype.setDragEndState.call(this,e,t,i)},this.tree.refreshDropTarget=function(e){this._overNode&&(this._overNode.isDropTarget=e,this._overNode.refreshStyle())},Droppables.remove(this.getTreeId()),Droppables.add(this.getTreeId(),{accept:["dragging","wrap"],onHover:function(e,t,i){if(this.tree._overNode){var o=new Folder(this.tree._overNode),r=e.node&&canFolderBeCopiedOrMovedToFolder(o)||e.items&&canAllBeCopiedOrMovedToFolder(o);this.tree.refreshDropTarget(r)}}.bind(this),onDrop:function(e,t,i){var o;if(Draggables.supportsTouch){var r=i.changedTouches[0];o=this.tree.getTreeNodeByElement($(document.elementFromPoint(r.pageX,r.pageY)))}else o=this.tree.getTreeNodeByEvent(i);if(o&&(this.tree._overNode=o),this.tree._overNode){var s=new Folder(this.tree._overNode);e.node&&canFolderBeCopiedOrMovedToFolder(s)&&invokeFolderAction("PasteFolder",s),e.items&&canAllBeCopiedOrMovedToFolder(s)&&invokeFolderAction("PasteResources",s)}}.bind(this)}),this.tree.observe("server:error",function(){window.console&&alert("Tree load error.")}),this.tree.observe("childredPrefetched:loaded",function(e){this.tree.openAndSelectNode(this._uri)}.bindAsEventListener(this)),this.tree.observe("tree:loaded",function(e){this._canDoBrowse=!1,"/"==this._uri?this.tree.rootNode.select():this.tree.openAndSelectNode(this._uri),this._canDoBrowse=!0;var t=this.tree.getSelectedNode();t&&t.scroll($(this._treeId).parentNode),this.doBrowse()}.bindAsEventListener(this)),this.tree.observe("node:selected",function(e){this._uri=e.memo.node.param.uri,window.localStorage&&localStorage.setItem(this._cookieName,this._uri),repositorySearch.model.setSelectedFolder(new Folder(e.memo.node)),this.doBrowse()}.bindAsEventListener(this)),this.tree.observe("node:mouseup",function(e){repositorySearch.model.setContextFolder(new Folder(e.memo.node))}),this.tree.showTreePrefetchNodes(this._uri),this},doBrowse:function(){this._canDoBrowse&&repositorySearch.fire(repositorySearch.Event.SEARCH_BROWSE,{uri:this._uri})},getSelectedUri:function(){return this._uri},getTreeId:function(){return this._treeId},selectFolder:function(e){this.tree.openAndSelectNode(e.URI)},reselectFolder:function(e){e.node.isSelected()&&(e.node.deselect(),e.node.select())},refreshFolder:function(e){this.selectFolder(e),this.updateSubFolders(e)},updateFolder:function(e,t,i){e.label=t,e.description=i,e.node.changeName(e.label),e.node.param.extra.desc=e.description,this.tree.resortSubtree(e.node.parent),e.node.parent.refreshNode()},updateSubFolders:function(e){e.node.hasChilds()||e.node.setHasChilds(!0),e.node.isOpen()&&e.node.handleNode(),e.node.isloaded=!1,e.node.handleNode()},isFolderContextMenu:function(e){return this.tree.getTreeNodeByEvent(e)&&!this.tree.isIconEvent(e)},moveOrCopyFolder:function(e,t,i){var o=e.getParentFolder().node;return i||o.removeChild(e.node),this.tree.getTreeNodeChildren(t.node,function(t){if(t){var i=t.detect(function(t){return t.param.id==e.name});i&&this.tree.openAndSelectNode(i.param.uri)}}.bind(this))}};repositorySearch.resultsPanel={_list:null,_infiniteScroll:null,_resultListHeaderId:"resultsListHeader",_resultListId:"resultsList",_resultsContainerId:"resultsContainer",_touchScroller:null,_folderDisplayPathCache:{},NOTHING_TO_DISPLAY_ID:"nothingToDisplay",RESOURCE_NAME_TOOLTIP_ID:"resourceNameTooltip",NAME_PATTERN:".resourceName",LINK_NAME_PATTERN:".resourceName > a",DISCLOSURE_PATTERN:".disclosure",SCHEDULED_PATTERN:".scheduled",LOADING_CLASS_NAME:"loading",initialize:function(e){var t=this;return this._container=$(this._resultListId).up(),this._header=$(this._resultListHeaderId),this._list=new dynamicList.List(this._resultListId,{listTemplateDomId:"tabular_fourColumn_resources",itemTemplateDomId:"tabular_fourColumn_resources:leaf",dragPattern:e.enableDnD?".draggable":"",multiSelect:!0,selectOnMousedown:!isIPad()}),this._intiListEvents(),this._initDnD(),this.getList().show(),isSupportsTouch()&&(this._touchController=new TouchController(document.getElementById(this._resultListId),document.getElementById(this._resultsContainerId),{scrollbars:!0}),jQuery("#"+this._resultListId).on("layout_update orientationchange",function(){jQuery("#"+t._resultListId).css("min-width",jQuery("#"+t._resultsContainerId).width()+"px"),jQuery("#"+t._resultListId).width(jQuery("#"+t._resultsContainerId).width())})),isIPad()?this._infiniteScroll=new InfiniteScroll({id:this._container.identify(),contentId:this._resultListId,scroll:this._touchController}):this._infiniteScroll=new InfiniteScroll({id:this._container.identify(),contentId:this._resultListId}),this._infiniteScroll.onLoad=function(){repositorySearch.fire(repositorySearch.Event.SEARCH_NEXT)},disableSelectionWithoutCursorStyle(this._container),Event.observe($(window),"resize",function(){this._checkHeight()}.bind(this)),this._fixHeaderWidth(),this},_fixHeaderWidth:function(){isIPad()||this._header.setStyle({marginRight:this._container.getWidth()-$(this._resultListId).getWidth()+"px"})},_createResourceItem:function(e){var t;e.hasChildren?(t=new dynamicList.CompositeItem({cssClassName:layoutModule.NODE_CLASS,label:e.label,value:e,openHandlerPattern:".disclosure.icon",closeHandlerPattern:".disclosure.icon",excludeFromSelectionTriggers:[".disclosure.icon"],listOptions:{listTemplateDomId:"tabular_fourColumn_resources_sublist",itemTemplateDomId:"tabular_fourColumn_resources_sublist:leaf",multiSelect:!0}}),t.setLoading=function(e){this.isLoading=e,this.refreshStyle(),repositorySearch.resultsPanel.refresh()}):t=new dynamicList.ListItem({cssClassName:layoutModule.LEAF_CLASS,label:e.label,value:e}),t.processTemplate=function(e){var t=canBeRun(this.getValue())||canBeOpened(this.getValue()),i=t?repositorySearch.resultsPanel.LINK_NAME_PATTERN:repositorySearch.resultsPanel.NAME_PATTERN,o=e.select(i)[0],r=e.select(repositorySearch.resultsPanel.NAME_PATTERN)[0],s=e.select(".resourceDescription")[0];o.update(xssUtil.hardEscape(this.getValue().label));var n=this;new JSTooltip(r,{text:[xssUtil.hardEscape(this.getValue().label),xssUtil.hardEscape(repositorySearch.messages.loading)],templateId:repositorySearch.resultsPanel.RESOURCE_NAME_TOOLTIP_ID,loadTextCallback:function(e){function t(e,t){var i=repositorySearch.model.getFolderSeparator();return e===i?e+t:e+i+t}function i(i,r,s){r=xssUtil.hardEscape(r),o=xssUtil.hardEscape(t(i,s)),e.updateText([r,o])}var o,r=n.getValue().parentFolder,s=repositorySearch.resultsPanel._folderDisplayPathCache[r];if(s)i(s,n.getValue().label,n.getValue().name);else{var a=new repositorySearch.ServerAction(repositorySearch.InfoAction.GET_DISPLAY_PATH,{data:{resourceUri:r,isFolder:!0}});a.onSuccess=function(e){repositorySearch.resultsPanel._folderDisplayPathCache[r]=e,i(e,n.getValue().label,n.getValue().name)},a.onError=repositorySearch.defaultErrorHandler,a.invokeAction()}}});var a=this.getValue().description;s.update(xssUtil.hardEscape(a)),a?new JSTooltip(s,{text:a}):s.jsTooltip&&s.jsTooltip.disable();var l=e.select(".resourceType")[0],d=e.select(".modifiedDate")[0],c=e.select(".createdDate")[0];return l.update(this.getValue().type),d.update(this.getValue().updateDate),new JSTooltip(d,{text:this.getValue().updateDateTime}),c.update(this.getValue().date),new JSTooltip(c,{text:this.getValue().dateTime}),e};var i=t.refreshStyle;return t.refreshStyle=function(){i.call(this);var e=this._getElement();this.getValue().isScheduled&&e.addClassName(layoutModule.SCHEDULED_CLASS),this.isLoading&&e.addClassName(layoutModule.LOADING_CLASS)},t},_initDnD:function(){var e=this.getList();e.setDragStartState=function(e,t,i){dynamicList.List.prototype.setDragStartState.call(this,e,t,i),isMetaHeld(i,!0)&&$(document.body).addClassName(layoutModule.COPY_CLASS).setStyle({cursor:null}),invokeBulkAction(isMetaHeld(i,!0)?"Copy":"Move")},e.setDragEndState=function(e,t,i){repositorySearch.CopyMoveController.cancel(),repositorySearch.foldersPanel.tree.refreshDropTarget(!1),$(document.body).removeClassName(layoutModule.COPY_CLASS),dynamicList.List.prototype.setDragEndState.call(this,e,t,i)}},_intiListEvents:function(){this.getList().observe("item:click",function(e){var t=e.memo.item,i=e.memo.targetEvent,o=t.getValue();this._isLinkEvent(i)&&(canBeRun(o)?invokeRedirectAction("RunResourceAction"):canBeOpened(o)&&invokeRedirectAction("OpenResourceAction")),this._isScheduleIconEvent(i)&&canBeScheduled(o)&&invokeRedirectAction("ScheduleAction")}.bindAsEventListener(this)),this.getList().observe("item:selected",function(e){var t=(e.memo.item,this.getList().getSelectedItems().collect(function(e){return e.getValue()}));repositorySearch.model.setSelectedResources(t),repositorySearch.actionModel.refreshToolbar()}.bindAsEventListener(this)),this.getList().observe("item:unselected",function(e){var t=(e.memo.item,this.getList().getSelectedItems().collect(function(e){return e.getValue()}));repositorySearch.model.setSelectedResources(t),repositorySearch.actionModel.refreshToolbar()}.bindAsEventListener(this)),this.getList().observe("item:mouseup",function(e){}),this.getList().observe("item:open",function(e){var t=e.memo.item,i=t.getValue();i.isLoaded()||(t.setLoading(!0),repositorySearch.fire(repositorySearch.Event.SEARCH_CHILDREN,{resource:i,item:t})),this.refresh()}.bindAsEventListener(this)),this.getList().observe("item:closed",function(e){this.refresh()}.bindAsEventListener(this)),this.getList().observe("key:contextMenu",function(e){var t=e.memo.node,i=getBoxOffsets(t,!0),o={menuLeft:i[0]+100,menuTop:i[1]+20};this.getList().getSelectedItems().length>1?repositorySearch.actionModel.showResourceBulkMenu(e,o):repositorySearch.actionModel.showResourceMenu(e,o),Event.stop(e)}.bindAsEventListener(this)),this.getList().observe("key:escape",function(e){actionModel.hideMenu(),Event.stop(e)})},_isLinkEvent:function(e){var t=Event.element(e);return null!=matchAny(t,[this.LINK_NAME_PATTERN])},_isScheduleIconEvent:function(e){return Event.element(e).match(this.SCHEDULED_PATTERN)},_isDisclosureEvent:function(e){var t=Event.element(e);return null!=matchAny(t,[this.DISCLOSURE_PATTERN])},_refreshEmptyListMessage:function(){var e=$(this.NOTHING_TO_DISPLAY_ID);0===this._list.getItems().length?(e.removeClassName(layoutModule.HIDDEN_CLASS),centerElement(e,{horz:!0,vert:!0})):e.addClassName(layoutModule.HIDDEN_CLASS)},_checkHeight:function(){this.getList()._element.clientHeight<document.body.clientHeight?this._infiniteScroll.onLoad():(this.refresh(),this._infiniteScroll.stopWaiting())},getList:function(){return this._list},removeResources:function(e){var t=e.findAll(function(e){return e.isChild}),i=e.findAll(function(e){return!e.isChild}),o=this.getList().getItems(),r=[],s=[];o.each(function(e){e.isComposite&&s.push(e),i.include(e.getValue())&&r.push(e)}),s.each(function(e){e.getItems()&&e.removeItems(e.getItems().findAll(function(e){return t.include(e.getValue())}))}),this.getList().removeItems(r),this._refreshEmptyListMessage(),this.refresh()},setResources:function(e,t){var i=e.collect(this._createResourceItem);t?(t.setItems(i),t.refresh()):(this._infiniteScroll&&this._infiniteScroll.reset(),this.getList().setItems(i),this.getList().show(),this._refreshEmptyListMessage()),i.length&&this._checkHeight()},addResources:function(e){var t=e.collect(this._createResourceItem);this.getList().addItems(t),this.getList().refresh(),t.length&&this._checkHeight()},isResourceContextMenu:function(e){return this.getList().getItemByEvent(e)},updateResource:function(e){this.getList().getItems().each(function(t){t.getValue().URIString==e.URIString&&(t.setValue(e),t.refresh(),this.getList().isItemSelected(t)&&this.getList().selectItem(t))}.bind(this))},findResource:function(e){var t=this.getList().getItems(),i=t.detect(function(t){return t.getValue().URIString===e});return i?i.getValue():null},refresh:function(){this._fixHeaderWidth(),tooltipModule.cleanUp()}},repositorySearch.filtersPanel={_id:"filtersPanel",_container:void 0,_filtersLists:{},_cookieName:"filtersPopularity",_ignoreFilterEvent:!1,initialize:function(e,t){this._getContainer().update(),e.each(function(e,t){this._getContainer().insert(new Element("ul",{id:e.id,"data-tab-index":5+t,"data-component-type":"list"}));var i=this._createFiltersList(e.id,e);i.show(),this._filtersLists[e.id]=i}.bind(this));for(var i in t)this.select(i,t[i]);return isSupportsTouch()&&(this._touchController=new TouchController(document.getElementById(this._id),$(this._id).up())),this},_refreshScroll:function(){var e=layoutModule.scrolls.get(this._id);e&&e.refresh()},_createItemsList:function(e){var t=e.options,i=0,o=t.collect(function(e){return new dynamicList.ListItem({value:e,cssClassName:layoutModule.LEAF_CLASS,label:repositorySearch.getMessage(e.labelId)})}).partition(function(){return i++,-1===e.showCount||e.showCount>i});return o[1].length>0&&o[0].push(new dynamicList.CompositeItem({value:{isMore:!0},templateDomId:"list_responsive_filters:node",openUp:!0,openHandlerPattern:".more.launcher",closeHandlerPattern:".fewer.launcher",respondOnItemEvents:!1,items:o[1]})),o[0]},_createFiltersList:function(e,t){var i=new dynamicList.List(e,{listTemplateDomId:"list_responsive_filters",itemTemplateDomId:"list_responsive_filters:leaf",items:this._createItemsList(t)});return i.addItems([new dynamicList.CompositeItem({templateDomId:"list_responsive_filters:separator",respondOnItemEvents:!1,value:{isSeparator:!0}})].compact()),i.observe("item:selected",function(e){var t=e.memo.item;t.getValue().isSeparator||t.getValue().isMore||this._ignoreFilterEvent||repositorySearch.fire(repositorySearch.Event.SEARCH_FILTER,{filterId:i.getId(),optionId:t.getValue().id})}.bindAsEventListener(this)),i},select:function(e,t,i){var o=this._filtersLists[e],r=function(e){if(e.getValue().id==t)throw e.isSelected()||(this._ignoreFilterEvent=i,e.select(),this._ignoreFilterEvent=!1),$break;if(e.isComposite){var o=e._getElement();baseList.isItemOpen(o)||baseList.openItem(o),e.getItems()&&e.getItems().each(r)}}.bind(this);o.getItems().each(r)},_getContainer:function(){return this._container||(this._container=$(this._id),this._container.hasClassName(layoutModule.SWIPE_SCROLL_PATTERN)&&(this._container=this._container.down())),this._container}},repositorySearch.filterPath={_containerId:"filterPath",_contentBodySelector:".primary.column>.content>.body",initialize:function(){return this._filterPathList=new dynamicList.List(this._containerId,{listTemplateDomId:"list_control_path",itemTemplateDomId:"list_control_path:step"}),this._filterPathList.observe("item:selected",function(e){var t=e.memo.item;t.getValue().isLast||repositorySearch.fire(repositorySearch.Event.SEARCH_ROLLBACK,{position:t.getValue().position})}),this},setPathItems:function(e){if(e.length>1){var t=e.length-1,i=e.collect(function(e,i){return e.isLast=i==t,new dynamicList.ListItem({label:e.label,value:e})});this._filterPathList.setItems(i),this._filterPathList.show(),$(this._containerId).up().removeClassName("hidden"),$(document.body).select(this._contentBodySelector)[0].addClassName("showingSubHeader")}else this._filterPathList.setItems([]),this._filterPathList.show(),$(this._containerId).up().addClassName("hidden"),$(document.body).select(this._contentBodySelector)[0].removeClassName("showingSubHeader")}},repositorySearch.sortersPanel={_LABEL_TEMPLATE_DOM_ID:"sortPanelLabelTemplate",_containerId:"sortMode",_ignoreSortEvent:!1,sortersList:null,initialize:function(e,t){var i=new dynamicList.ListItem({label:repositorySearch.getMessage("SEARCH_SORT_BY")+":",value:{isLabel:!0},templateDomId:"tabSet_control_horizontal_responsive:label",respondOnItemEvents:!1}),o=e.collect(function(e,t){return new dynamicList.ListItem({label:repositorySearch.getMessage(e.labelId),value:e})});return this.sortersList=new dynamicList.List(this._containerId,{listTemplateDomId:"tabSet_control_horizontal_responsive",itemTemplateDomId:"tabSet_control_horizontal_responsive:tab",items:[i].concat(o)}),this.sortersList.observe(this.sortersList.Event.ITEM_SELECTED,function(e){var t=e.memo.item;t.getValue().isLabel||this._ignoreSortEvent||repositorySearch.fire(repositorySearch.Event.SEARCH_SORT,{sorterId:t.getValue().id})}),this.sortersList.show(),i.disable(),this.select(t),this},select:function(e,t){this.sortersList.getItems().each(function(i){if(i.getValue().id==e&&!i.isSelected())return this._ignoreSortEvent=t,this.sortersList.selectItem(i),void(this._ignoreSortEvent=!1)}.bind(this))},_getContainer:function(){return this._container||(this._container=$(this._containerId)),this._container},_getLabelTemplate:function(){var e=$(this._LABEL_TEMPLATE_DOM_ID).cloneNode(!0);return e.removeAttribute("id"),e}};var ResourcePermissions=function(e){this._resource=e,this._isVisible=!1,this._listId=this.ENTITY_LIST_ID,this._listContainerId=this.LIST_CONTAINER_ID,this._searchBoxId=this.SEARCH_BOX_ID,this.viewBy="USER",this._processTemplate()};ResourcePermissions.addVar("TEMPLATE_DOM_ID","permissions"),ResourcePermissions.addVar("TOOLTIP_TEMPLATE_DOM_ID","orgTooltip"),ResourcePermissions.addVar("LIST_TEMPLATE_ID","tabular_twoColumn_setLeft"),ResourcePermissions.addVar("ITEM_TEMPLATE_ID","tabular_twoColumn_setLeft:leaf"),ResourcePermissions.addVar("WAIT_ITEM_TEMPLATE_ID","tabular_twoColumn_setLeft:loading"),ResourcePermissions.addVar("ENTITY_LIST_ID","permissionsList"),ResourcePermissions.addVar("LIST_CONTAINER_ID","permissionsListContainer"),ResourcePermissions.addVar("SEARCH_BOX_ID","searchPermissionsBox"),ResourcePermissions.addVar("NAME_TOOLTIP_PATTERN",".one"),ResourcePermissions.addVar("NAME_PATTERN",".one>a.launcher"),ResourcePermissions.addVar("PERMISSIONS_PATTERN",".two>select"),ResourcePermissions.addVar("VIEW_BY_TAB_SET_PATTERN","#permissionsViewBy"),ResourcePermissions.addVar("TAB_PATTERN",".tab>p"),ResourcePermissions.addVar("PATH_PATTERN",".path"),ResourcePermissions.addVar("SUBMIT_BUTTON","#permissionsOk"),ResourcePermissions.addVar("APPLAY_BUTTON","#permissionsApply"),ResourcePermissions.addVar("CANCEL_BUTTON","#permissionsCancel"),ResourcePermissions.addVar("BODY_PATTERN","div.body"),ResourcePermissions.addMethod("_processTemplate",function(){this._dom=$(this.TEMPLATE_DOM_ID).cloneNode(!0),this._dom.writeAttribute("id",null),this._dom.down(".body").writeAttribute("id","");var e=this._dom.select(this.PATH_PATTERN)[0];e.update(xssUtil.hardEscape(this._resource.URIString.truncate(50))),e.writeAttribute("title",this._resource.URIString),this._viewByTabSet=this._dom.select(this.VIEW_BY_TAB_SET_PATTERN)[0],this._byUsersButton=this._dom.select(this.TAB_PATTERN)[0],this._byRolesButton=this._dom.select(this.TAB_PATTERN)[1],this._submitButton=this._dom.select(this.SUBMIT_BUTTON)[0],this._applyButton=this._dom.select(this.APPLAY_BUTTON)[0],this._cancelButton=this._dom.select(this.CANCEL_BUTTON)[0],this._byUsersButton.viewType="USER",this._byRolesButton.viewType="ROLE",this._submitButton.writeAttribute("id",null),this._applyButton.writeAttribute("id",null),this._cancelButton.writeAttribute("id",null);var t=this._dom.select("#"+this.ENTITY_LIST_ID)[0],i=this._dom.select("#"+this.LIST_CONTAINER_ID)[0],o=this._dom.select("#"+this.SEARCH_BOX_ID)[0];this._listId=t.writeAttribute("id",null).identify(),this._listContainerId=i.writeAttribute("id",null).identify(),this._searchBoxId=o.writeAttribute("id",null).identify()}),ResourcePermissions.addMethod("_updateValueAndLabel",function(e,t,i,o){var r=e.select(t)[0];return r.writeAttribute("id",null),r.setValue(i),e.select(o)[0].writeAttribute("for",r.identify()),r}),ResourcePermissions.addMethod("_updateContentAndLabel",function(e,t,i,o){var r=e.select(t)[0];return r.writeAttribute("id",null),r.update(i),e.select(o)[0].writeAttribute("for",r.identify()),r}),ResourcePermissions.addMethod("_buttonClickHandler",function(e){var t=e.element();if(!this._waiting){var i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0),o=this._resource.URIString;[this._submitButton,this._applyButton].include(i)&&(this._byUsersButton.addClassName(layoutModule.BUTTON_CLASS),this._byRolesButton.addClassName(layoutModule.BUTTON_CLASS),repositorySearch.fire(repositorySearch.PermissionEvent.UPDATE,{uri:o,entities:this.getChangedEntities(),finishEdit:i==this._submitButton})),[this._byUsersButton,this._byRolesButton].include(i)&&(this.isChanged()?(this._showWarning(),e.stop()):(this._hideWarning(),this.viewBy=i.viewType,repositorySearch.fire(repositorySearch.PermissionEvent.BROWSE,{uri:o,type:this.viewBy}))),[this._cancelButton].include(i)&&this.hide()}}),ResourcePermissions.addMethod("_showWarning",function(){this._dom.select(this.BODY_PATTERN)[0].addClassName(layoutModule.ERROR_CLASS)}),ResourcePermissions.addMethod("_hideWarning",function(){this._dom.select(this.BODY_PATTERN)[0].removeClassName(layoutModule.ERROR_CLASS)}),ResourcePermissions.addMethod("_launcherClickHandler",function(e){var t=e.element();if(!this._waiting){if(matchAny(t,[this.NAME_PATTERN],!0)){var i=t.up("li");if(i&&i.listItem){i.listItem.getValue().navigateToManager()}}}e.stop()}),ResourcePermissions.addMethod("_selectChangeHandler",function(e){var t=e.element();if(e.stop(),!this._waiting){if("select"==t.tagName.toLowerCase()){var i=t.options[t.selectedIndex].value,o=t.up("li");if(o&&o.listItem){var r=o.listItem.getValue();o.listItem.getValue().permission.newPermission=i!=r.permission.getResolvedPermission()?i:void 0,o.listItem.refresh()}}this.isChanged()?(this._byUsersButton.removeClassName(layoutModule.BUTTON_CLASS),this._byRolesButton.removeClassName(layoutModule.BUTTON_CLASS)):(this._byUsersButton.addClassName(layoutModule.BUTTON_CLASS),this._byRolesButton.addClassName(layoutModule.BUTTON_CLASS))}}),ResourcePermissions.addMethod("_selectMouseOverHandler",function(e){matchAny(e.element(),[this.PERMISSIONS_PATTERN],!0)&&e.stop()}),ResourcePermissions.addMethod("_initControls",function(){this.list=new dynamicList.List(this._listId,{listTemplateDomId:this.LIST_TEMPLATE_ID,itemTemplateDomId:this.ITEM_TEMPLATE_ID});var e=$(this._listId).up();isSupportsTouch()&&(this._touchController||(this._touchController=new TouchController($(this._listId),$(this._listId).up(),{forceLayout:!0}))),this._infiniteScroll=new InfiniteScroll({id:e.identify(),contentId:this._listId,scroll:this._touchController||void 0}),this._searchBox=new SearchBox({id:this._searchBoxId});var t=this._resource.URIString;this._infiniteScroll.onLoad=function(){this._waiting||repositorySearch.fire(repositorySearch.PermissionEvent.NEXT,{text:this._searchBox.getText(),uri:t,type:this.viewBy})}.bind(this),this._searchBox.onSearch=function(e){this._waiting||(this.isChanged()?this._showWarning():(this._hideWarning(),repositorySearch.fire(repositorySearch.PermissionEvent.SEARCH,{text:e,uri:t,type:this.viewBy})))}.bind(this)}),ResourcePermissions.addMethod("show",function(){this._isVisible||(document.body.insert(this._dom),this._initControls(),this.list.setItems([]),this.list.show(),orgModule.entityList._createEntityItem=this._createEntityItem,this.viewBy="ROLE",repositorySearch.fire(repositorySearch.PermissionEvent.BROWSE,{initialize:!0,uri:this._resource.URIString,type:this.viewBy,isFolder:this._resource.isFolder()}),this._isVisible=!0,document.getElementById(this._listId).parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.style.height="360px",dialogs.popup.show(this._dom),this._dom.observe("click",this._buttonClickHandler.bindAsEventListener(this)),isSupportsTouch()&&this._viewByTabSet.observe("touchstart",this._buttonClickHandler.bindAsEventListener(this)),this._dom.observe("click",this._launcherClickHandler.bindAsEventListener(this)),this._dom.observe("mouseover",this._selectMouseOverHandler.bindAsEventListener(this)))}),ResourcePermissions.addMethod("showAndWait",function(){this._isVisible||(this._waiting=!0,this.show(),this._waitingItem=new dynamicList.ListItem({templateDomId:this.WAIT_ITEM_TEMPLATE_ID}),this.list.addItems([this._waitingItem]),this.list.refresh(),this.disable())}),ResourcePermissions.addMethod("stopWaiting",function(){this._waiting&&(this._waiting=!1,this.list.removeItems([this._waitingItem]),this.enable())}),ResourcePermissions.addMethod("hide",function(){dialogs.popup.hide(this._dom),this._dom.remove(),this._dom.stopObserving("click"),this._dom.stopObserving("change"),this._dom.stopObserving("mouseover"),isSupportsTouch()&&this._viewByTabSet.stopObserving("touchstart"),repositorySearch.dialogsPool.removePermissionsDialog(this._resource)}),ResourcePermissions.addMethod("enable",function(){this._searchBox.enable(),buttonManager.enable(this._byUsersButton),buttonManager.enable(this._byRolesButton)}),ResourcePermissions.addMethod("disable",function(){this._searchBox.disable(),buttonManager.disable(this._byUsersButton),buttonManager.disable(this._byRolesButton)}),ResourcePermissions.addMethod("_createItem",function(e){var t=new dynamicList.ListItem({label:e.getDisplayName(),value:e}),i=this.NAME_TOOLTIP_PATTERN,o=this.NAME_PATTERN,r=this.PERMISSIONS_PATTERN,s=this.TOOLTIP_TEMPLATE_DOM_ID,n=this;return t.processTemplate=function(e){var t=e.select(i)[0],a=e.select(o)[0],l=e.select(r)[0],d=this.getValue().permission,c=this.getValue().tenantId;if(d.newPermission?a.addClassName(layoutModule.EMPHASIS_CLASS):a.removeClassName(layoutModule.EMPHASIS_CLASS),a.update(xssUtil.hardEscape(this.getValue().getDisplayName())),c&&c.length>0){new JSTooltip(t,{text:xssUtil.hardEscape(c),templateId:s});var h=e.remove;e.remove=function(){tooltipModule.hideJSTooltip(t),tooltipModule.cleanUp(),h.apply(this)}}l.update("");for(var u=0,p=repositorySearch.model.getConfiguration().permissions,m=0;m<p.length;m++){var f=repositorySearch.getMessage(p[m].labelId),g=new Element("option",{value:p[m].name});l.insert(g.update(d.inheritedPermission==p[m].name?xssUtil.hardEscape(f+" *"):xssUtil.hardEscape(f))),d.newPermission?d.newPermission==p[m].name&&(u=m):d.getResolvedPermission()==p[m].name&&(u=m)}return l.observe("change",n._selectChangeHandler.bindAsEventListener(n)),l.selectedIndex=u,this.getValue().permission.isDisabled&&l.writeAttribute("disabled","disabled"),e},t}),ResourcePermissions.addMethod("addEntities",function(e){var t=e.collect(this._createItem.bind(this));this.list.addItems(t),this.list.refresh(),this._infiniteScroll.stopWaiting()}),ResourcePermissions.addMethod("resetList",function(e){var t=jQuery("#"+e);t.find("[js-nonmodal-tabindex]").removeAttr("js-nonmodal-tabindex"),t.find("[js-navtype]").attr("js-navtype",!1),t.find("[tabindex]").removeAttr("tabindex")}),ResourcePermissions.addMethod("scrollReset",function(){var e=this._listId,t=this.resetList;jQuery("#"+this._listContainerId).find(".content").find(".body").on("scroll",_.debounce(function(){t(e)},100))}),ResourcePermissions.addMethod("setEntities",function(e){this.list.setItems([]),this._touchController&&this._touchController.reset(),this.addEntities(e),this.resetList(this._listId),this.scrollReset()}),ResourcePermissions.addMethod("getChangedEntities",function(){var e=this.list.getItems(),t=[];return e.each(function(e){var i=e.getValue();i.permission&&i.permission.newPermission&&t.push(i)}),t}),ResourcePermissions.addMethod("updateEntities",function(e){this.list.getItems().each(function(t){var i=t.getValue(),o=e.detect(function(e){return e.equals(i)});o&&(t.setValue(o),t.refresh())})}),ResourcePermissions.addMethod("isChanged",function(){return this.getChangedEntities().length>0}),repositorySearch.dialogsPool={POOL_NOT_FOUND_EXCEPTION:"PoolNotFoundException",DIALOD_EXIST_EXCEPTION:"DialodExistException",NULL_RESOURCE_EXCEPTION:"NullResourceException",_permissionsDialogPool:{},_propertiesDialogPool:{},_getPool:function(e){var t;if(e==ResourcePermissions&&(t=this._permissionsDialogPool),e==ResourceProperties&&(t=this._propertiesDialogPool),t)return t;throw{name:this.POOL_NOT_FOUND_EXCEPTION,message:"Can't find pool for "+e.toString()}},_createDialog:function(e,t,i){var o=t.URIString,r=this._getPool(e);if(null==t)throw{name:this.NULL_RESOURCE_EXCEPTION,message:"Resource is null."};if(r[o])throw{name:this.DIALOD_EXIST_EXCEPTION,message:e.toString()+" dilaog for resource '"+o+"' arleady exist."};return r[o]=new e(t,i),r[o]},_createOrGetDialog:function(e,t,i){try{return this._createDialog(e,t,i)}catch(i){if(i.name==this.DIALOD_EXIST_EXCEPTION)return this._getDialog(e,t);throw i}},_getDialog:function(e,t){var i=Object.isString(t)?t:t.URIString;return this._getPool(e)[i]},_getAllDialogs:function(e){var t=this._getPool(e),i=[];for(var o in t)t[o]&&i.push(t[o]);return i},_removeDialog:function(e,t){var i=Object.isString(t)?t:t.URIString;this._getPool(e)[i]=void 0},createPermissionsDialog:function(e){return this._createDialog(ResourcePermissions,e)},createPropertiesDialog:function(e){return this._createDialog(ResourceProperties,e)},createOrGetPermissionsDialog:function(e){return this._createOrGetDialog(ResourcePermissions,e)},createOrGetPropertiesDialog:function(e,t){return this._createOrGetDialog(ResourceProperties,e,t)},getAllPermissionsDialogs:function(){return this._getAllDialogs(ResourcePermissions)},getAllPropertiesDialogs:function(){return this._getAllDialogs(ResourceProperties)},getPermissionsDialog:function(e){return this._getDialog(ResourcePermissions,e)},getPropertiesDialog:function(e){return this._getDialog(ResourceProperties,e)},removePermissionsDialog:function(e){return this._removeDialog(ResourcePermissions,e)},removePropertiesDialog:function(e){return this._removeDialog(ResourceProperties,e)}};var ResourceProperties=function(e,t){this._resource=e,this._changedCallback=t.changedCallback,this._showMode=t.showMode,this._processTemplate()}
;ResourceProperties.addVar("TEMPLATE_DOM_ID","propertiesResource"),ResourceProperties.addMethod("_processTemplate",function(){this._dom=$(this.TEMPLATE_DOM_ID).cloneNode(!0),this._dom.writeAttribute("id",null),this._dom.addClassName("_activeResourcePropertiesDialog");var e=this._dom.select(".title")[0];e.update(jQuery(e).html().strip()+": "+xssUtil.hardEscape(this._resource.label).truncate(50)),this._label=this._updateValueAndLabel(this._dom,"input#displayName",this._resource.label,'label[for="displayName"]'),this._description=this._updateContentAndLabel(this._dom,"textarea#description",xssUtil.hardEscape(this._resource.description),'label[for="description"]'),this._path=this._updateValueAndLabel(this._dom,"input#path",xssUtil.hardEscape(this._resource.URIString),'label[for="path"]'),this._showMode&&(this._dom.addClassName("showMode"),this._label.writeAttribute("readonly","readonly"),this._description.writeAttribute("readonly","readonly")),this._updateValueAndLabel(this._dom,"div#resourceID",xssUtil.hardEscape(this._resource.name),'label[for="resourceID"]'),this._updateValueAndLabel(this._dom,"input#type",xssUtil.hardEscape(this._resource.type),'label[for="type"]'),this._updateValueAndLabel(this._dom,"input#createdDate",xssUtil.hardEscape(this._resource.date),'label[for="createdDate"]'),this._updateValueAndLabel(this._dom,"input#userAccess",xssUtil.hardEscape(this._resource.permissionsToString()),'label[for="userAccess"]'),this._submitButton=this._dom.select("button.submit")[0],this._cancelButton=this._dom.select("button.cancel")[0],this._okButton=this._dom.select("button.ok")[0]}),ResourceProperties.addMethod("_updateValueAndLabel",function(e,t,i,o){var r=e.select(t)[0];return r.writeAttribute("id",null),r.writeAttribute("value",i),r.setValue?r.setValue(i):r.update(i),e.select(o)[0].writeAttribute("for",r.identify()),r}),ResourceProperties.addMethod("_updateContentAndLabel",function(e,t,i,o){var r=e.select(t)[0];return r.writeAttribute("id",null),r.update(i),e.select(o)[0].writeAttribute("for",r.identify()),r}),ResourceProperties.addMethod("_buttonClickHandler",function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);if(t==this._submitButton){if(this._showMode)this._hide();else if(this._isDataValid()){if(this._changedCallback){var i=this._resource.clone();i.label=this._label.getValue(),i.description=this._description.getValue(),this._changedCallback(i)}this._hide()}}else t!=this._cancelButton&&t!=this._okButton||this._hide()}),ResourceProperties.addMethod("_isDataValid",function(e){return ValidationModule.validate([{validator:ResourcesUtils.labelValidator,element:this._label},{validator:ResourcesUtils.descriptionValidator,element:this._description}])}),ResourceProperties.addMethod("show",function(e){document.body.insert(this._dom),e&&e.cascade?dialogs.popup.show(this._dom,!1,e):dialogs.popup.show(this._dom),this._dom.observe("click",this._buttonClickHandler.bindAsEventListener(this))}),ResourceProperties.addMethod("_hide",function(){dialogs.popup.hide(this._dom),this._dom.remove(),this._dom.stopObserving("click"),repositorySearch.dialogsPool.removePropertiesDialog(this._resource)}),ResourceProperties.addMethod("isChanged",function(){return this._resource.label!=this._label.getValue()||this._resource.description!=this._description.getValue()}),repositorySearch.showCreateFolderConfirm=function(e){var t,i=$("addFolder"),o=$("addFolderInputName"),r=$("addFolderInputDescription"),s=$("addFolderBtnAdd"),n=$("addFolderBtnCancel"),a=function(e){t=e,dialogs.popup.show(i),o.setValue(repositorySearch.messages["action.create.folder.name"]),accessibilityModule.disable(),setTimeout(function(){o.focus(),o.select()},500)},l=function(e){o.clear(),r.clear(),ValidationModule.hideError(o),ValidationModule.hideError(r),dialogs.popup.hide(i),accessibilityModule.enable(),e.stop()},d=function(){return ValidationModule.validate([{validator:ResourcesUtils.labelValidator,element:o},{validator:ResourcesUtils.descriptionValidator,element:r}])},c=function(e){"disabled"!==s.readAttribute("disabled")&&(new repositorySearch.ServerAction.createFolderAction(repositorySearch.FolderAction.CREATE,{toFolder:t,label:o.getValue(),desc:r.getValue()}).invokeAction(),l(e))};s.observe("click",function(e){d()&&c(e),e.stop()}),n.observe("click",l),repositorySearch.showCreateFolderConfirm=a,a(e)},repositorySearch.DeleteConfirmation={ID_DELETE_DIALOG_CONTAINER:"standardConfirm",ID_DELETE_DIALOG_OK_BUTTON:"deleteResourceOK",ID_DELETE_DIALOG_CANCEL_BUTTON:"deleteResourceCancel"},repositorySearch.showDeleteFolderConfirm=function(e){var t=repositorySearch.getMessage("SEARCH_DELETE_FOLDER_CONFIRM_MSG",{folderUri:e.URI}),i=new repositorySearch.ServerAction.createFolderAction(repositorySearch.FolderAction.DELETE,{folder:e});repositorySearch._showDeleteDialog(t,i)},repositorySearch.showDeleteResourceConfirm=function(e){var t=repositorySearch.getMessage("SEARCH_DELETE_CONFIRM_MSG",{resourceUri:e.URIString}),i=new repositorySearch.ServerAction.createResourceAction(repositorySearch.ResourceAction.DELETE,{resources:[e]});repositorySearch._showDeleteDialog(t,i)},repositorySearch.showBulkDeleteResourcesConfirm=function(e){var t=repositorySearch.getMessage("SEARCH_BULK_DELETE_CONFIRM_MSG",{count:e.length}),i=new repositorySearch.ServerAction.createResourceAction(repositorySearch.ResourceAction.DELETE,{resources:e});repositorySearch._showDeleteDialog(t,i)},repositorySearch._showDeleteDialog=function(e,t){var i=$(repositorySearch.DeleteConfirmation.ID_DELETE_DIALOG_CONTAINER);i.down(".body").update(xssUtil.hardEscape(e)),dialogs.popupConfirm.show(i,!0,{okButtonSelector:"#"+repositorySearch.DeleteConfirmation.ID_DELETE_DIALOG_OK_BUTTON,cancelButtonSelector:"#"+repositorySearch.DeleteConfirmation.ID_DELETE_DIALOG_CANCEL_BUTTON}),jQuery("#"+repositorySearch.DeleteConfirmation.ID_DELETE_DIALOG_OK_BUTTON).on("click",function(){t.invokeAction()})},repositorySearch.showResourceProperties=function(e,t){repositorySearch.dialogsPool.createOrGetPropertiesDialog(e,{showMode:!0}).show(t)},repositorySearch.editResourceProperties=function(e,t){repositorySearch.dialogsPool.createOrGetPropertiesDialog(e,{changedCallback:function(e){new repositorySearch.ServerAction.createResourceAction(repositorySearch.ResourceAction.UPDATE,{resource:e}).invokeAction()}}).show(t)},repositorySearch.showFolderProperties=function(e){repositorySearch.dialogsPool.createOrGetPropertiesDialog(e,{showMode:!0}).show()},repositorySearch.editFolderProperties=function(e){repositorySearch.dialogsPool.createOrGetPropertiesDialog(e,{changedCallback:function(e){new repositorySearch.ServerAction.createFolderAction(repositorySearch.FolderAction.UPDATE,{folder:e}).invokeAction()}}).show()},repositorySearch.editResourcePermissions=function(e){repositorySearch.dialogsPool.createOrGetPermissionsDialog(e).showAndWait()},repositorySearch.editFolderPermissions=function(e){repositorySearch.dialogsPool.createOrGetPermissionsDialog(e).showAndWait()},repositorySearch.showUploadThemeConfirm=function(e,t){var i,o,r=$("uploadTheme"),s=$("themeName"),n=$("themeZip"),a=$("uploadThemeBtnUpload"),l=$("uploadThemeBtnCancel"),d=function(e,t){i=e,o=t,dialogs.popup.show(r),s.removeAttribute("disabled"),s.setValue(repositorySearch.messages.RM_NEW_THEME_NAME),o&&(s.writeAttribute("disabled"),s.setValue(i.name)),s.select(),s.focus()},c=function(e){s.clear(),n.clear(),dialogs.popup.hide(r),e.stop()},h=function(){return ValidationModule.validate([{validator:ResourcesUtils.labelValidator,element:s},{validator:ResourcesUtils.zipFileTypeValidator,element:n}])},u=function(e){var t={};if(t.themeName=s.getValue(),t._eventId="uploadTheme",t._flowExecutionKey=repositorySearch.flowExecutionKey,t.folderUri=i.URI,t.folderUri=i.URI,o){var r=i.URI;t.folderUri=r.slice(0,r.lastIndexOf("/")),t.reuploadAction=o,t._eventId="reuploadTheme"}var a=function(e){var r;if(n=$("themeZip"),e)try{if((r=e.evalJSON())&&"OK"==r.status){if(r.data.themeExist)require(["common/component/dialog/ConfirmationDialog"],function(e){var i=repositorySearch.messages.SEARCH_OVERWRITE_THEME_CONFIRM_MSG,o=new e({text:i});o.on("button:yes",function(){new repositorySearch.ServerAction.createFolderAction(repositorySearch.ThemeAction.REUPLOAD,t).invokeAction(),o.remove()}),o.on("button:no",function(){o.remove()}),o.open()});else if(r.data.isActiveTheme){var s=r.data.themeUri,a=new repositorySearch.ServerAction.createFolderAction(repositorySearch.ThemeAction.SETTHEME,{folderUri:s});a.invokeAction()}}else r&&"ERROR"==r.status?alert(r.data):alert(repositorySearch.messages.RM_UPLOAD_THEME_ERROR)}catch(e){alert(e)}o&&r.data.isActiveTheme||repositorySearch.foldersPanel.refreshFolder(i)};fileSender.upload(n,"searchFlow",t,a),c(e)};a.observe("click",function(e){h()&&u(e),e.stop()}),l.observe("click",c),repositorySearch.showUploadThemeConfirm=d,d(e,t)};var GenerateResource=function(e,t){this._resource=e,this._callback=t.okCallback,this._processTemplate(t);var i=this;repositorySearch.observe("resource:generated",function(){i._hide()})};GenerateResource.addVar("TEMPLATE_DOM_ID","generateResource"),GenerateResource.addVar("TEMPLATE_TITLE_TEXT",!1),GenerateResource.addVar("LABEL_MAX_LEN",94),GenerateResource.addVar("DESC_MAX_LEN",200),GenerateResource.addMethod("_processTemplate",function(e){this._dom=$(this.TEMPLATE_DOM_ID);var t=this._dom.select(".title")[0];this.TEMPLATE_TITLE_TEXT||(GenerateResource.prototype.TEMPLATE_TITLE_TEXT=jQuery(t).html().strip()),t.update(this.TEMPLATE_TITLE_TEXT+" "+xssUtil.hardEscape(this._resource.label.truncate(50)));var i=e.useDefaultLabel?this._resource.label+" "+repositorySearch.messages["dialog.generateResource.defaultNameSuffix"]:"";this._nameInput=this._dom.select("#generateResourceInputName")[0],this._nameInput.setValue(i),this._descriptionInput=this._dom.select("#generateResourceInputDescription")[0],this._descriptionInput.setValue(this._resource.description),this._tree=dynamicTree.createRepositoryTree("generateResourceFoldersTree",{providerId:"repositorySaveReportProvider",rootUri:repositorySearch.model.getRootFolderUri(),organizationId:localContext.rsInitOptions.organizationId,publicFolderUri:localContext.rsInitOptions.publicFolderUri,urlGetNode:"flow.html?_flowId=searchFlow&method=getNode",urlGetChildren:"flow.html?_flowId=searchFlow&method=getChildren"}),this._cancelButton=this._dom.select("#generateResourceBtnCancel")[0],this._okButton=this._dom.select("#generateResourceBtnCreate")[0],this._okAndRunButton=this._dom.select("#generateResourceBtnCreateAndRun")[0]}),GenerateResource.addMethod("_buttonClickHandler",function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);if(t==this._okButton||t==this._okAndRunButton){var i=this._nameInput.getValue(),o=this._descriptionInput.getValue();if(i.length<=this.LABEL_MAX_LEN&&o.length<=this.DESC_MAX_LEN){var r=this._tree.getSelectedNode();r||alert(repositorySearch.messages.ADH_162_NULL_SAVE_REPORT_FOLDER_MESSAGE),r.param.extra&&!r.param.extra.isWritable&&this.showAccessDenied(r.param.uri),this._callback&&this._callback({label:i,description:o,location:r.param.uri,overwrite:!1,run:t==this._okAndRunButton})}else{var s,n;i.length>this.LABEL_MAX_LEN?(s=repositorySearch.messages.ADH_1001_ADHOC_SAVE_REPORT_LABEL_ERROR,n=this.LABEL_MAX_LEN):o.length>this.DESC_MAX_LEN&&(s=repositorySearch.messages.ADH_1001_ADHOC_SAVE_REPORT_DESCRIPTION_ERROR,n=this.DESC_MAX_LEN),s&&alert(s.replace("{0}",n))}}t==this._cancelButton&&this._hide()}),GenerateResource.addMethod("_focusName",function(){this._nameInput.select(),this._nameInput.focus()}),GenerateResource.addMethod("_enableSave",function(e){this._okButton.disabled=!e,this._okAndRunButton.disabled=!e}),GenerateResource.addMethod("show",function(){var e=this;this._tree.showTreePrefetchNodes("/",function(){e._focusName()}),this._dom.observe("click",this._buttonClickHandler.bindAsEventListener(this)),dialogs.popup.show(this._dom),setTimeout(function(){e._focusName()},500)}),GenerateResource.addMethod("showAccessDenied",function(e){var t=repositorySearch.messages.ADH_1001_SERVER_REPOSITORY_ACCESS_DENIED;alert(t.replace("{0}",e))}),GenerateResource.addMethod("_hide",function(){dialogs.popup.hide(this._dom),this._dom.stopObserving("click")}),window.require(["tenantImportExport/export/view/ExportDialogView","tenantImportExport/export/enum/exportTypesEnum"],function(e,t){repositorySearch.exportDialog=new e,repositorySearch.exportDialog.render({type:t.REPOSITORY})}),define("repository.search.components",["repository.search.main","prototype","underscore","utils.common","dynamicTree.utils","tools.infiniteScroll","tenantImportExport/export/view/ExportDialogView","tenantImportExport/export/enum/exportTypesEnum"],function(e){return function(){return e.GenerateResource}}(this)),repositorySearch.Action=function(e){Object.isFunction(e)&&(this.invokeAction=e)},repositorySearch.Action.DEFAULT="default-action",repositorySearch.Action.addMethod("invokeAction",doNothing),repositorySearch.folderActionFactory={CreateFolder:function(e){return new repositorySearch.Action(function(){repositorySearch.showCreateFolderConfirm(e)})},CopyFolder:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.copy(e)})},MoveFolder:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.move(e)})},PasteFolder:function(e){return new repositorySearch.Action(function(){var t,i=e||repositorySearch.model.getContextFolder();repositorySearch.CopyMoveController.object;if(repositorySearch.CopyMoveController.isCopyFolder())t=repositorySearch.FolderAction.COPY;else{if(!repositorySearch.CopyMoveController.isMoveFolder())return;t=repositorySearch.FolderAction.MOVE}new repositorySearch.ServerAction.createFolderAction(t,{toFolder:i,folder:repositorySearch.CopyMoveController.object}).invokeAction()})},PasteResources:function(e){return new repositorySearch.Action(function(){var t,i=e||repositorySearch.model.getContextFolder();i||(i=repositorySearch.model.getSelectedFolder());var o=repositorySearch.CopyMoveController.object,r=repositorySearch.CopyMoveController.isBulkAction()?[].concat(o):[o];if(repositorySearch.CopyMoveController.isCopyResource())t=repositorySearch.ResourceAction.COPY;else{if(!repositorySearch.CopyMoveController.isMoveResource())return;t=repositorySearch.ResourceAction.MOVE}for(var s=0;s<r.length;s++)if(r[s].parentResource){for(var n=r[s].parentResource.URI,a=!1,l=0;l<r.length&&!a;l++)a|=r[l].URI==n;a||r.push(r[s].parentResource)}new repositorySearch.ServerAction.createResourceAction(t,{resources:r,folder:i}).invokeAction()})},DeleteFolder:function(e){return new repositorySearch.Action(function(){actionModel.hideMenu(),repositorySearch.showDeleteFolderConfirm(e)})},ShowFolderProperties:function(e){return new repositorySearch.Action(function(){repositorySearch.showFolderProperties(e)})},EditFolderProperties:function(e){return new repositorySearch.Action(function(){repositorySearch.editFolderProperties(e)})},AssignPermissions:function(e){return new repositorySearch.Action(function(){repositorySearch.editFolderPermissions(e)})},SetActiveThemeFolder:function(e){return new repositorySearch.Action(function(){new repositorySearch.ServerAction.createFolderAction(repositorySearch.ThemeAction.SETTHEME,{folder:e}).invokeAction()})},DownloadTheme:function(e){return new repositorySearch.Action(function(){new repositorySearch.ServerAction.createFolderAction(repositorySearch.ThemeAction.DOWNLOAD_THEME,{folder:e}).initDownload()})},UploadTheme:function(e){return new repositorySearch.Action(function(){repositorySearch.showUploadThemeConfirm(e,!1)})},ReuploadTheme:function(e){return new repositorySearch.Action(function(){repositorySearch.showUploadThemeConfirm(e,!0)})},Export:function(e){return new repositorySearch.Action(function(){repositorySearch.exportDialog.openRepoDialog(e)})}},repositorySearch.resourceActionFactory={Copy:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.copy(e)})},Move:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.move(e)})},Delete:function(e){return new repositorySearch.Action(function(){actionModel.hideMenu(),repositorySearch.showDeleteResourceConfirm(e)})},Export:function(e,t){return new repositorySearch.Action(function(){repositorySearch.exportDialog.openRepoDialog(e)})},ShowProperties:function(e,t){return new repositorySearch.Action(function(){repositorySearch.showResourceProperties(e,t)})},EditProperties:function(e,t){return new repositorySearch.Action(function(){repositorySearch.editResourceProperties(e,t)})},AssignPermissionsToResourceAction:function(e){return new repositorySearch.Action(function(){repositorySearch.editResourcePermissions(e)})},GenerateResourceAction:function(e,t){return new repositorySearch.Action(function(){JRS.CreateReport.selectGenerator(e.URIString)})},ConvertResourceAction:function(e,t){return new repositorySearch.Action(function(){new repositorySearch.ServerAction.createConvertAction(repositorySearch.ResourceAction.CONVERT,{reportUri:e.URIString}).invokeAction()})}},repositorySearch.bulkActionFactory={Run:function(e){return new repositorySearch.Action(function(){e.each(function(e,t){repositorySearch.RedirectAction.createRunResourceAction(e,0!==t).invokeAction()})})},Edit:function(e){return new repositorySearch.Action(function(){e.each(function(e,t){repositorySearch.RedirectAction.createEditResourceAction(e,0!==t).invokeAction()})})},Open:function(e){return new repositorySearch.Action(function(){e.each(function(t,i){repositorySearch.RedirectAction.createOpenResourceAction(t,e.length>1).invokeAction()})})},Copy:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.copy(e)})},Move:function(e){return new repositorySearch.Action(function(){repositorySearch.CopyMoveController.move(e)})},Delete:function(e){return new repositorySearch.Action(function(){actionModel.hideMenu(),1==e.length?repositorySearch.showDeleteResourceConfirm(e[0]):repositorySearch.showBulkDeleteResourcesConfirm(e)})},ShowProperties:function(e){return new repositorySearch.Action(function(){e.each(function(t,i){invokeResourceAction("ShowProperties",t,{cascade:!0,position:i,number:e.length})})})},EditProperties:function(e){return new repositorySearch.Action(function(){e.each(function(t,i){invokeResourceAction("EditProperties",t,{cascade:!0,position:i,number:e.length})})})},Export:function(e){return new repositorySearch.Action(function(){repositorySearch.exportDialog.openRepoDialog(e)})}},repositorySearch.ServerAction=function(e,t){this.actionURL="flow.html?_flowExecutionKey="+repositorySearch.flowExecutionKey+"&_eventId="+e,this.data=Object.toQueryString(t.data)},repositorySearch.ServerAction.addMethod("invokeAction",function(){ajaxTargettedUpdate(this.actionURL,{postData:this.data,callback:function(e){"OK"==e.status?this.onSuccess(e.data):this.onError(e.data)}.bind(this),errorHandler:this._serverErrorHandler,mode:AjaxRequester.prototype.EVAL_JSON})}),repositorySearch.ServerAction.addMethod("initDownload",function(){var e=this.actionURL+"&"+this.data;ajaxIframeDownload(e,{onload:function(){var e=jQuery($("ajax-download-iframe").contentDocument.body).html();try{var t=e.evalJSON();alert(t.data)}catch(e){}}})}),repositorySearch.ServerAction.addMethod("_serverErrorHandler",function(e){return baseErrorHandler(e)}),repositorySearch.ServerAction.addMethod("onSuccess",doNothing),repositorySearch.ServerAction.addMethod("onError",doNothing),repositorySearch.ServerAction.createSearchAction=function(e,t){t.mode=repositorySearch.mode;var i=new repositorySearch.ServerAction(e,{data:t});return i.onSuccess=function(i){e==repositorySearch.SearchAction.NEXT?repositorySearch.fire(repositorySearch.Event.RESULT_NEXT,i):e==repositorySearch.SearchAction.GET_RESOURCE_CHILDREN?repositorySearch.fire(repositorySearch.Event.CHILDREN_LOADED,{inputData:t,responseData:i}):(repositorySearch.fire(repositorySearch.Event.RESULT_CHANGED,i),repositorySearch.fire(repositorySearch.Event.STATE_CHANGED,i),repositorySearch.mode==repositorySearch.Mode.SEARCH&&repositorySearch.fire(repositorySearch.Event.FILTER_PATH_CHANGED,i))},i.onError=function(e){repositorySearch.fire(repositorySearch.Event.RESULT_ERROR,e)},i},repositorySearch.ServerAction.createFolderAction=function(e,t){var i,o,r;repositorySearch.FolderAction.DELETE==e?(i={sourceFolderUri:t.folder.URI},o=repositorySearch.FolderEvent.DELETED,r=repositorySearch.FolderEvent.DELETE_ERROR):repositorySearch.FolderAction.CREATE==e?(i={destFolderUri:t.toFolder.URI,folder:Object.toJSON({URI:"",label:t.label,desc:t.desc})},o=repositorySearch.FolderEvent.CREATED,r=repositorySearch.FolderEvent.CREATE_ERROR):repositorySearch.FolderAction.COPY==e?(i={destFolderUri:t.toFolder.URI,sourceFolderUri:t.folder.URI},o=repositorySearch.FolderEvent.COPIED,r=repositorySearch.FolderEvent.COPY_ERROR):repositorySearch.FolderAction.MOVE==e?(i={destFolderUri:t.toFolder.URI,sourceFolderUri:t.folder.URI},o=repositorySearch.FolderEvent.MOVED,r=repositorySearch.FolderEvent.MOVE_ERROR):repositorySearch.FolderAction.UPDATE==e?(i={folder:Object.toJSON({URI:t.folder.URI,label:t.folder.label,desc:t.folder.description})},o=repositorySearch.FolderEvent.UPDATED,r=repositorySearch.FolderEvent.UPDATE_ERROR):repositorySearch.ThemeAction.SETTHEME==e?(t.folder?i={folderUri:t.folder.URI}:t.folderUri&&(i={folderUri:t.folderUri}),o=repositorySearch.ThemeEvent.UPDATED):repositorySearch.ThemeAction.DOWNLOAD_THEME==e?(i={folderUri:t.folder.URI},r=repositorySearch.ThemeEvent.THEME_ERROR):repositorySearch.ThemeAction.REUPLOAD==e&&(i={themeName:t.themeName,folderUri:t.folderUri},o=repositorySearch.ThemeEvent.REUPLOADED,r=repositorySearch.ThemeEvent.THEME_ERROR),i&&o&&r||new Error("Unsupported folder action.");var s=new repositorySearch.ServerAction(e,{data:i});return s.onSuccess=function(e){repositorySearch.fire(o,{responseData:e,inputData:t})},s.onError=function(e){repositorySearch.fire(r,{responseData:e,inputData:t})},s},repositorySearch.ServerAction.createResourceAction=function(e,t){function i(i,o){dialogs.dependentResources.show(i,{dependenciesBtnOk:function(){new repositorySearch.ServerAction.createResourceAction(e,{resources:o,folder:t.folder}).invokeAction()}},{buttons:["ok","cancel"],dialogTitle:repositorySearch.getMessage("dialog.resources.exist.title"),topMessage:repositorySearch.getMessage("dialog.resources.exist"),bottomMessage:repositorySearch.getMessage("dialog.resources.exist.confirm.skip")})}function o(o){var r;if(repositorySearch.ResourceAction.COPY!=e&&repositorySearch.ResourceAction.MOVE!=e)return o;try{r=JSON.parse(o)}catch(e){return o}if(!r||!r.existingLabels)return o;var s=_.filter(t.resources,function(e){return-1==r.existingLabels.indexOf(e.label)});return 0===s.length?(1==r.existingLabels.length?repositorySearch.getMessage("dialog.resources.one.exists"):repositorySearch.getMessage("dialog.resources.all.exist"))+" "+t.folder.URIString:(i(r.existingLabels,s),null)}var r,s,n;if(repositorySearch.ResourceAction.DELETE==e){var a=ResourcesUtils.getResourceUriAndTypeList(t.resources);r={selectedResources:Object.toJSON(a)},s=repositorySearch.ResourceEvent.DELETED,n=repositorySearch.ResourceEvent.DELETE_ERROR}else if(repositorySearch.ResourceAction.COPY==e){var l=ResourcesUtils.getResourceUris(t.resources);r={selectedResources:Object.toJSON(l),destFolderUri:t.folder.URI},s=repositorySearch.ResourceEvent.COPIED,n=repositorySearch.ResourceEvent.COPY_ERROR}else if(repositorySearch.ResourceAction.MOVE==e){var d=ResourcesUtils.getResourceUris(t.resources);r={selectedResources:Object.toJSON(d),destFolderUri:t.folder.URI},s=repositorySearch.ResourceEvent.MOVED,n=repositorySearch.ResourceEvent.MOVE_ERROR}else repositorySearch.ResourceAction.UPDATE==e&&(r={selectedResource:Object.toJSON(t.resource)},s=repositorySearch.ResourceEvent.UPDATED,n=repositorySearch.ResourceEvent.UPDATE_ERROR);r&&s&&n||new Error("Unsupported resource action.");var c=new repositorySearch.ServerAction(e,{data:r});return c.onSuccess=function(i){repositorySearch.ResourceAction.MOVE==e&&repositorySearch.CopyMoveController.cancel(),repositorySearch.fire(s,{responseData:i,inputData:t})},c.onError=function(e){var i=o(e);i&&repositorySearch.fire(n,{responseData:i,inputData:t})},c},repositorySearch.ServerAction.createPermissionAction=function(e,t){var i=new repositorySearch.ServerAction(e,{data:t}),o=e==repositorySearch.PermissionAction.UPDATE?repositorySearch.PermissionEvent.UPDATED:repositorySearch.PermissionEvent.LOADED;return i.onSuccess=function(i){repositorySearch.fire(o,{responseData:i,inputData:t,doSet:e!=repositorySearch.PermissionAction.NEXT})},i.onError=function(e){repositorySearch.fire(repositorySearch.PermissionEvent.ERROR,e)},i},repositorySearch.ServerAction.createGenerateAction=function(e,t){var i=new repositorySearch.ServerAction(e,{data:{data:Object.toJSON(t)}});return i.actionURL="reportGenerator.html?action="+e,i.onSuccess=function(e){repositorySearch.fire(repositorySearch.ResourceEvent.GENERATED,{responseData:e,inputData:t})},i.onError=function(e){repositorySearch.fire(repositorySearch.ResourceEvent.GENERATE_ERROR,{responseData:e,inputData:t})},i},repositorySearch.ServerAction.createConvertAction=function(e,t){var i=new repositorySearch.ServerAction(e,{data:t});return i.actionURL="dataViewConverter.html?action="+e,i.onSuccess=function(e){repositorySearch.fire(repositorySearch.ResourceEvent.CONVERTED,{responseData:e,inputData:t})},i.onError=function(e){repositorySearch.fire(repositorySearch.ResourceEvent.CONVERT_ERROR,{responseData:e,inputData:t})},i},repositorySearch.RedirectAction=function(e,t){this.DIMMER_TIMEOUT=400,this.type=e,this.flowId=t.flowId,this.url=t.url?t.url:this.flowId?this.FLOW_URL:void 0,this.paramsMap=t.paramsMap||{},this.hash=t.hash?"#"+t.hash:"",this.encode=t.encode,this.type!==repositorySearch.RedirectType.FLOW_REDIRECT&&this.url===this.FLOW_URL&&(this.paramsMap._flowId=this.flowId)},repositorySearch.RedirectAction.addMethod("FLOW_URL","flow.html"),repositorySearch.RedirectAction.addMethod("_serializeParams",function(e,t){if(e){var i="";for(var o in e)Object.isUndefined(o)||(i+="&"+o+"="+(t?encodeURIComponent(e[o]):e[o]));return i&&i.length>0?i.substring(1):""}return""}),repositorySearch.RedirectAction.addMethod("invokeAction",function(){if(this.type===repositorySearch.RedirectType.FLOW_REDIRECT){var e=$("redirectForm");$("flowParams").setValue(this.flowId+"?"+this._serializeParams(this.paramsMap,this.encode));var t=new repositorySearch.ServerAction("isServerAvailable",{data:{}}),i=setTimeout(function(){dialogs.popup.show(ajax.LOADING_ID,!0)},this.DIMMER_TIMEOUT);t.onSuccess=function(t){"Yes"==t.strip()?(++ajax.ajaxRequestCount,dialogs.popup.show(ajax.LOADING_ID,!0),e.submit(),repositorySearch.fire(repositorySearch.Event.FLOW_REDIRECT_RUNNING,t)):(o(),repositorySearch.fire(repositorySearch.Event.REDIRECT_ERROR,t))},t.onError=function(e){o(),repositorySearch.fire(repositorySearch.Event.REDIRECT_ERROR,e)};var o=function(){clearTimeout(i),dialogs.popup.hide(ajax.LOADING_ID)};t.invokeAction()}else if(this.type===repositorySearch.RedirectType.LOCATION_REDIRECT){var r=this.url+(jQuery.isEmptyObject(this.paramsMap)?"":"?"+this._serializeParams(this.paramsMap,this.encode))+this.hash;redirectToUrl(r)}else if(this.type===repositorySearch.RedirectType.WINDOW_REDIRECT){var s=window.open(),n=this._serializeParams(this.paramsMap,this.encode);s.opener=null,s.document.location=this.url+(n?"?"+n:"")+this.hash}}),repositorySearch.runActionFactory={ReportUnit:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.FLOW_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"flow.html",flowId:"viewReportFlow",paramsMap:{_flowId:"viewReportFlow",reportUnit:t?encodeURIComponent(e.URIString):e.URIString,standAlone:!0,ParentFolderUri:t?encodeURIComponent(e.parentFolder):e.parentFolder}})},AdhocReportUnit:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.FLOW_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"flow.html",flowId:"viewAdhocReportFlow",paramsMap:{reportUnit:t?encodeURIComponent(e.URIString):e.URIString,standAlone:!0,ParentFolderUri:t?encodeURIComponent(e.parentFolder):e.parentFolder}})},OlapUnit:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.LOCATION_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"olap/viewOlap.html",paramsMap:{name:t?encodeURIComponent(e.URIString):e.URIString,new:!0,parentFlow:"searchFlow",ParentFolderUri:t?encodeURIComponent(e.parentFolder):e.parentFolder}})},DashboardResource:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.FLOW_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"flow.html",flowId:"dashboardRuntimeFlow",paramsMap:{dashboardResource:t?encodeURIComponent(e.URIString):e.URIString}})},DashboardModelResource:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.LOCATION_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"dashboard/viewer.html#"+encodeURIComponent(e.URIString)})},ReportOptions:function(e,t){var i,o={reportOptionsURI:t?encodeURIComponent(e.URIString):e.URIString,standAlone:!0,ParentFolderUri:t?encodeURIComponent(e.parentFolder):e.parentFolder},r=e.parentResource;r&&r.typeEquals(repositorySearch.ResourceType.ADHOC_REPORT_UNIT)?(i="viewAdhocReportFlow",o.reportUnit=t?encodeURIComponent(r.URIString):r.URIString):i="viewReportFlow";var s=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.FLOW_REDIRECT;return new repositorySearch.RedirectAction(s,{url:"flow.html",flowId:i,paramsMap:o})}},repositorySearch.RedirectAction.createRunResourceAction=function(e,t){e||(e=e||repositorySearch.model.getSelectedResources()[0]);var i=repositorySearch.runActionFactory[e.typeSuffix()];return i?i(e,t):new repositorySearch.Action(function(){alert("Run action for resource type '"+e.resourceType+"' is not implemented!")})},repositorySearch.RedirectAction.createRunResourceInNewTabAction=function(e,t){return repositorySearch.RedirectAction.createRunResourceAction(e,!0)},repositorySearch.editActionFactory={"default-action":function(e,t){return ResourcesUtils.isCustomDataSource(e)?repositorySearch.editActionFactory.JdbcReportDataSource(e,t):new repositorySearch.Action(function(){alert("Edit action for resource type '"+e.resourceType+"' is not implemented!")})},ReportUnit:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"reportUnitFlow",paramsMap:{selectedResource:e.URIString,ParentFolderUri:e.parentFolder}})},AdhocReportUnit:function(e,t){return repositorySearch.editActionFactory.ReportUnit(e,t)},DataDefinerUnit:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"queryBuilderFlow",paramsMap:{uri:e.URIString,ParentFolderUri:e.parentFolder}})},OlapUnit:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"olapUnitFlow",paramsMap:{resource:e.URIString,isEdit:"edit",ParentFolderUri:e.parentFolder}})},DashboardResource:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"dashboardRuntimeFlow",paramsMap:{dashboardResource:e.URIString}})},ReportOptions:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"reportOptionsEditFlow",paramsMap:{reportOptionsURI:e.URIString,ParentFolderUri:e.parentFolder}})},JdbcReportDataSource:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"addDataSourceFlow",paramsMap:{resource:e.URIString,ParentFolderUri:e.parentFolder}})},JndiJdbcReportDataSource:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},CustomReportDataSource:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},BeanReportDataSource:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},VirtualReportDataSource:function(e,t){
return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},HiveDataSourceService:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},CassandraDataSourceService:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},DiagnosticCustomDataSourceService:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},MongoDbDataSourceService:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},AwsReportDataSource:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},AzureSqlReportDataSource:function(e,t){return repositorySearch.editActionFactory.JdbcReportDataSource(e,t)},Query:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"queryFlow",paramsMap:{currentQuery:e.URIString,isEdit:!0,ParentFolderUri:e.parentFolder}})},InputControl:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"addInputControlFlow",paramsMap:{isEdit:!0,resource:e.URIString,ParentFolderUri:e.parentFolder}})},ListOfValues:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"addListOfValuesFlow",paramsMap:{resource:e.URIString,isEdit:"edit",ParentFolderUri:e.parentFolder}})},DataType:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"dataTypeFlow",paramsMap:{resource:e.URIString,isEdit:"edit",ParentFolderUri:e.parentFolder}})},MondrianConnection:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"olapClientConnectionFlow",paramsMap:{selectedResource:e.URIString,isEdit:"edit",ParentFolderUri:e.parentFolder}})},SecureMondrianConnection:function(e,t){return repositorySearch.editActionFactory.MondrianConnection(e,t)},XMLAConnection:function(e,t){return repositorySearch.editActionFactory.MondrianConnection(e,t)},MondrianXMLADefinition:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"mondrianXmlaSourceFlow",paramsMap:{selectedResource:e.URIString,isEdit:"edit",ParentFolderUri:e.parentFolder}})},FileResource:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"addFileResourceFlow",paramsMap:{selectedResource:e.URIString,ParentFolderUri:e.parentFolder}})},SemanticLayerDataSource:function(e,t){return new repositorySearch.RedirectAction(t,{url:"domaindesigner.html",paramsMap:{uri:e.URIString,ParentFolderUri:e.parentFolder}})}},repositorySearch.resourceTypeToDefaultRedirectTypeMap={},repositorySearch.resourceTypeToDefaultRedirectTypeMap[repositorySearch.ResourceType.SEMANTIC_LAYER_DATA_SOURCE]=repositorySearch.RedirectType.LOCATION_REDIRECT,repositorySearch.getDefaultRedirectTypeByResourceType=function(e){var t=repositorySearch.resourceTypeToDefaultRedirectTypeMap[e];return t||(t=repositorySearch.RedirectType.FLOW_REDIRECT),t},repositorySearch.RedirectAction.createEditResourceAction=function(e,t){e||(e=repositorySearch.model.getSelectedResources()[0]);var i;i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.getDefaultRedirectTypeByResourceType(e.resourceType);var o=repositorySearch.editActionFactory[e.typeSuffix()];return o?o(e,i):repositorySearch.editActionFactory[repositorySearch.Action.DEFAULT](e,i)},repositorySearch.openActionFactory={ContentResource:function(e,t){return t===repositorySearch.RedirectType.FLOW_REDIRECT&&(t=repositorySearch.RedirectType.LOCATION_REDIRECT),new repositorySearch.RedirectAction(t,{url:"fileview/fileview"+e.URIString,paramsMap:{}})},DashboardResource:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"dashboardDesignerFlow",paramsMap:{resource:e.URIString,ParentFolderUri:e.parentFolder}})},DashboardModelResource:function(e,t){var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.LOCATION_REDIRECT;return new repositorySearch.RedirectAction(i,{url:"dashboard/designer.html#"+encodeURIComponent(e.URIString)})},DataDefinerUnit:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"queryBuilderFlow",paramsMap:{uri:e.URIString,ParentFolderUri:e.parentFolder}})},AdhocReportUnit:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"adhocFlow",paramsMap:{resource:e.URIString,ParentFolderUri:e.parentFolder}})},AdhocDataView:function(e,t){return new repositorySearch.RedirectAction(t,{flowId:"adhocFlow",paramsMap:{resource:e.URIString,ParentFolderUri:e.parentFolder}})}},repositorySearch.RedirectAction.createOpenResourceAction=function(e,t){e||(e=repositorySearch.model.getSelectedResources()[0]);var i=t?repositorySearch.RedirectType.WINDOW_REDIRECT:repositorySearch.RedirectType.FLOW_REDIRECT,o=repositorySearch.openActionFactory[e.typeSuffix()];return o?o(e,i):new repositorySearch.Action(function(){alert("Open action for resource type '"+e.resourceType+"' is not implemented!")})},repositorySearch.RedirectAction.createRunInBackgroundResourceAction=function(){var e=repositorySearch.model.getSelectedResources()[0],t="";if(e.resourceType.endsWith(".ReportUnit")||e.resourceType.endsWith(".AdhocReportUnit")||e.resourceType.endsWith(".DashboardModelResource")||e.resourceType.endsWith(".ReportOptions"))return e.parentResource&&(t="@@parentReportURI="+e.parentResource.URIString+"@@"),new repositorySearch.RedirectAction(repositorySearch.RedirectType.LOCATION_REDIRECT,{url:JRS.vars.contextPath+"/scheduler/main.html",paramsMap:{reportUnitURI:e.URIString,parentReportUnitURI:e.parentResource?e.parentResource.URIString:"",resourceType:e.resourceType.substring(e.resourceType.lastIndexOf(".")+1)},hash:"runInBackground@"+e.URIString+t,encode:!0})},repositorySearch.RedirectAction.createScheduleAction=function(){var e=repositorySearch.model.getSelectedResources()[0],t="";if(e.resourceType.endsWith(".ReportUnit")||e.resourceType.endsWith(".AdhocReportUnit")||e.resourceType.endsWith(".DashboardModelResource")||e.resourceType.endsWith(".ReportOptions"))return e.parentResource&&(t="@@parentReportURI="+e.parentResource.URIString+"@@"),new repositorySearch.RedirectAction(repositorySearch.RedirectType.LOCATION_REDIRECT,{url:JRS.vars.contextPath+"/scheduler/main.html",paramsMap:{reportUnitURI:e.URIString,resourceType:e.resourceType.substring(1+e.resourceType.lastIndexOf(".")),parentReportUnitURI:e.parentResource?e.parentResource.URIString:""},hash:e.URIString+t,encode:!0})},repositorySearch.createActionFactory={OlapClientConnection:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"olapClientConnectionFlow",paramsMap:{ParentFolderUri:e.URI}})},OlapUnit:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"olapUnitFlow",paramsMap:{ParentFolderUri:e.URI}})},ReportDataSource:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"addDataSourceFlow",paramsMap:{ParentFolderUri:e.URI}})},SemanticLayerDataSource:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.LOCATION_REDIRECT,{url:"domaindesigner.html",paramsMap:{ParentFolderUri:e.URI}})},FileResource:function(e,t){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"addFileResourceFlow",paramsMap:{expectedFileType:t,parentFolder:e.URI}})},ReportUnit:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"reportUnitFlow",paramsMap:{ParentFolderUri:e.URI}})},Query:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"queryFlow",paramsMap:{ParentFolderUri:e.URI}})},InputControl:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"addInputControlFlow",paramsMap:{ParentFolderUri:e.URI}})},DataType:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"dataTypeFlow",paramsMap:{ParentFolderUri:e.URI}})},ListOfValues:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"addListOfValuesFlow",paramsMap:{ParentFolderUri:e.URI}})},XMLAConnection:function(e){return new repositorySearch.RedirectAction(repositorySearch.RedirectType.FLOW_REDIRECT,{flowId:"mondrianXmlaSourceFlow",paramsMap:{ParentFolderUri:e.URI}})}},repositorySearch.RedirectAction.createCreateResourceAction=function(e,t){var i=repositorySearch.model.getContextFolder(),o=repositorySearch.createActionFactory[e];return o?o(i,t):new repositorySearch.Action(function(){alert("Create action for resource type suffix '"+e+"' is not implemented!")})},repositorySearch.confirmAndLeave=function(){return new repositorySearch.Action(function(){return!isPropertiesChanged()&&!isPermissionsChanged()||confirm(repositorySearch.getMessage("RM_CANCEL_EDIT_MESSAGE"))}).invokeAction()},define("component.repository.search",["repository.search.main","repository.search.components","prototype","actionModel.modelGenerator","utils.common","core.ajax"],function(e){return function(){return e.repositorySearch}}(this)),window,define("localContext",function(e){return function(){return e.window}}(this)),dialogs.dependentResources={dependenciesPanel:null,show:function(e,t,i){this.dependenciesPanel=jQuery("#dependencies"),this._$title=this.dependenciesPanel.find(".content .header .title"),i.dialogTitle&&(this._titleBackup=this._$title.html(),this._$title.html(i.dialogTitle)),dialogs.popup.show(this.dependenciesPanel[0]),this._changeMessage(i),this._switchButtons(i);var o=this._initList(e);this.dependenciesPanel.on("click",function(e){var i=jQuery(e.target).closest("button").attr("id"),r=t&&t[i];_.include(["dependenciesBtnSave","dependenciesBtnSaveAs","dependenciesBtnOk","dependenciesBtnCancel"],i)&&(dialogs.dependentResources.hide(),o.setItems([]),e.stopPropagation(),r&&r())})},hide:function(){this.dependenciesPanel&&(this.dependenciesPanel.off("click"),dialogs.popup.hide(this.dependenciesPanel[0]),this.dependenciesPanel=null),this._titleBackup&&this._$title&&(this._$title.html(this._titleBackup),this._titleBackup=null)},_changeMessage:function(e){jQuery("#topMessage").html(e.topMessage),jQuery("#bottomMessage").html(e.bottomMessage)},_initList:function(e){var t=new dynamicList.List("dependenciesList",{listTemplateDomId:"tabular_oneColumn",itemTemplateDomId:"tabular_oneColumn:leaf"}),i=[];return e&&(i=e.collect(function(e){var t=new dynamicList.ListItem({cssClassName:layoutModule.LEAF_CLASS,value:e});return t.processTemplate=function(e){var t,i=e.select(".uri")[0];return t="string"==typeof this.getValue()?this.getValue():this.getValue().uristring?this.getValue().uristring:this.getValue().URIString,i.update(xssUtil.hardEscape(t)),e},t})),t.setItems(i),t.show(),t},_switchButtons:function(e){var t,i={save:jQuery("#dependenciesBtnSave"),saveAs:jQuery("#dependenciesBtnSaveAs"),ok:jQuery("#dependenciesBtnOk"),cancel:jQuery("#dependenciesBtnCancel")};t=e.buttons?e.buttons:e.okOnly?["ok"]:e.canSave?["save","saveAs","cancel"]:["ok","cancel"],_.each(i,function(e,i){t.indexOf(i)<0?e.addClass("hidden"):e.removeClass("hidden")})}},define("components.dependent.dialog",["prototype","components.dialogs","jquery","components.list"],function(e){return function(){return e.dialogs.dependentResources}}(this)),toolbarButtonModule.initialize=function(e){toolbarButtonModule.actionMap=e,jQuery(".toolbar").on("mouseup mouseover mouseout","button",function(e){jQuery(this).prop("disabled")||toolbarButtonModule["mouse"+e.type.substring(5,6).toUpperCase()+e.type.substring(6)+"Handler"](e,this)}),isFirefox()&&jQuery(".toolbar li").each(function(e,t){jQuery(t).css("padding","0 2px")})},toolbarButtonModule.mouseUpHandler=function(e,t){var i=t.className.indexOf("capsule")>=0?toolbarButtonModule.actionMap[t.id]:null;if(i){getAsFunction(i)(e),e.stopPropagation()}},toolbarButtonModule.mouseOverHandler=function(e,t){t.className.indexOf("capsule")>=0&&t.className.indexOf("mutton")>=0&&!buttonManager.isDisabled(t)&&toolbarButtonModule.showButtonMenu(e.originalEvent,t)},toolbarButtonModule.mouseOutHandler=function(e,t){},define("components.toolbar",["jquery","prototype","utils.common","components.toolbarButtons"],function(e){return function(){return e.toolbarButtonModule}}(this));var orgModule={TREE_ID:"orgTree",COOKIE_NAME:"selectedTenant",messages:[],ActionMap:{SEARCH:"search",BROWSE:"browse",NEXT:"next",SELECT_AND_GET_DETAILS:"selectAndGetDetails",SEARCH_AVAILABLE:"searchAvailable",SEARCH_ASSIGNED:"searchAssigned",NEXT_AVAILABLE:"nextAvailable",NEXT_ASSIGNED:"nextAssigned",CREATE:"create",UPDATE:"update",DELETE:"delete",DELETE_ALL:"deleteAll",EXIST:"exist"},Event:{ORG_BROWSE:"org:browse",ENTITY_SEARCH:"entity:search",ENTITY_NEXT:"entity:next",ENTITY_SELECT_AND_GET_DETAILS:"entity:selectAndGetDetails",RESULT_CHANGED:"result:changed",RESULT_NEXT:"result:next",ENTITY_DETAILS_LOADED:"entity:detailsLoaded",SEARCH_AVAILABLE_LOADED:"searchAvailable:loaded",SEARCH_ASSIGNED_LOADED:"searchAssigned:loaded",NEXT_AVAILABLE_LOADED:"nextAvailable:loaded",NEXT_ASSIGNED_LOADED:"nextAssigned:loaded",SERVER_ERROR:"server:error",SERVER_UNAVAILABLE:"server:unavailable",ENTITY_CREATED:"entity:created",ENTITY_UPDATED:"entity:updated",ENTITY_DELETED:"entity:deleted",ENTITIES_DELETED:"entities:deleted"},observe:function(e,t){this._getContainer().observe(e,t)},stopObserving:function(e,t){this._getContainer().stopObserving(e,t)},fire:function(e,t){this._getContainer().fire(e,t)},getMessage:function(e,t){var i=orgModule.messages[e];return i?new Template(i).evaluate(t||{}):""},_comparator:function(e,t){return e>t?1:e<t?-1:0},_getContainer:function(){return this._container||(this._container=document.body),this._container},Configuration:{nameSeparator:"|",userDefaultRole:"ROLE_USER",userNameNotSupportedSymbols:"[|]",roleNameNotSupportedSymbols:"[|]",emailRegExpPattern:"^[\\p{L}\\p{M}\\p{N}._%'-\\@\\,\\;\\s]+$",superuserRole:"ROLE_SUPERUSER",adminRole:"ROLE_ADMINISTRATOR",anonymousRole:"ROLE_ANONYMOUS"}};orgModule.systemRoles=[orgModule.Configuration.userDefaultRole,orgModule.Configuration.superuserRole,orgModule.Configuration.adminRole,orgModule.Configuration.anonymousRole],orgModule.Organization=function(e){if(!e)throw new Error("Can't create Organization from undefined json or node");e.param?(this.id=e.param.id,this.name=e.name,this.uri=e.param.uri,this.treeNode=e):(this.id=e.tenantId||e.id,this.name=e.tenantName,this.alias=e.tenantAlias||e.alias,this.desc=e.tenantDesc,this.uri=e.tenantUri,this.parentId=e.parentId,this.subTenantCount=e.subTenantCount)},orgModule.Organization.addMethod("isRoot",function(e){return"organizations"==this.id}),orgModule.Organization.addMethod("getNameWithTenant",function(){return this.id}),orgModule.Organization.addMethod("getDisplayName",function(){return this.name}),orgModule.Organization.addMethod("equals",function(e){return e&&this.id==e.id}),orgModule.Organization.addMethod("toJSON",function(e){return{tenantId:this.id,tenantName:this.name,tenantAlias:this.alias,tenantDesc:this.desc,parentId:this.parentId,tenantUri:this.uri}}),orgModule.Organization.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.organization),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({tenantId:this.id}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Permission=function(e){this.isInherited=!!e.isInherited,e.permission&&(this.permission=e.permission),e.inheritedPermission&&(this.inheritedPermission=e.inheritedPermission),this.isDisabled=!!e.isDisabled},orgModule.Permission.addMethod("getResolvedPermission",function(){return this.isInherited?this.inheritedPermission:this.permission}),orgModule.Permission.addMethod("toJSON",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.Permission.addMethod("toData",function(){return{permission:this.permission,isInherited:this.isInherited,inheritedPermission:this.inheritedPermission,newPermission:this.newPermission}}),orgModule.User=function(e){e&&(this.userName=e.userName,this.fullName=e.fullName,this.password=e.password||"",this.confirmPassword=e.confirmPassword||"",this.tenantId=e.tenantId,this.email=e.email,this.enabled=e.enabled,this.external=e.external,this.roles=[],e.roles&&e.roles.each(function(e){this.roles.push(new orgModule.Role(e))}.bind(this)),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay)))},orgModule.User.addVar("FLOW_ID","userListFlow"),orgModule.User.addMethod("getDisplayName",function(){return this.userName}),orgModule.User.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.userName+orgModule.Configuration.userNameSeparator+this.tenantId:this.userName}),orgModule.User.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:void 0!==this.userName?encodeURIComponent(this.userName):this.userName,tenantId:void 0!==this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.User.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.user),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.userName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.User.addMethod("equals",function(e){return e&&this.userName==e.userName&&this.tenantId==e.tenantId}),orgModule.User.addMethod("toPermissionData",function(e){return{userName:this.userName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.Role=function(e){e&&(this.roleName=e.roleName,this.external=e.external,this.tenantId=e.tenantId),e.permissionToDisplay&&(this.permission=new orgModule.Permission(e.permissionToDisplay))},orgModule.Role.addVar("FLOW_ID","roleListFlow"),orgModule.Role.addMethod("getDisplayName",function(){return this.roleName}),orgModule.Role.addMethod("getNameWithTenant",function(){return this.tenantId&&!this.tenantId.blank()?this.roleName+orgModule.Configuration.userNameSeparator+this.tenantId:this.roleName}),orgModule.Role.addMethod("getManagerURL",function(){return"flow.html?"+Object.toQueryString({_flowId:this.FLOW_ID,text:void 0!==this.roleName?encodeURIComponent(this.roleName):this.roleName,tenantId:void 0!==this.tenantId?encodeURIComponent(this.tenantId):this.tenantId})}),orgModule.Role.addMethod("navigateToManager",function(){primaryNavModule.navigationPaths.tempNavigateToManager=deepClone(primaryNavModule.navigationPaths.role),primaryNavModule.navigationPaths.tempNavigateToManager.params+="&"+Object.toQueryString({text:this.roleName,tenantId:this.tenantId}),primaryNavModule.navigationOption("tempNavigateToManager")}),orgModule.Role.addMethod("equals",function(e){return e&&this.roleName==e.roleName&&this.tenantId==e.tenantId}),orgModule.Role.addMethod("toPermissionData",function(e){return{roleName:this.roleName,tenantId:this.tenantId,permissionToDisplay:this.permission.toData()}}),orgModule.initTenantsTreeEvents=function(){orgModule.manager.tenantsTree.on("selection:change",function(e){if(!orgModule.manager.lastSelectedOrg||orgModule.manager.lastSelectedOrg.id!==e.id){var t=new orgModule.Organization(e),i=orgModule.properties;orgModule.manager.tenantsTree.setTenant(t),window.localStorage&&localStorage.setItem(orgModule.COOKIE_NAME,JSON.stringify(e)),orgModule.fire(orgModule.Event.ORG_BROWSE,{organization:t,entityEvent:!1}),orgModule.orgManager&&(i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.id,entityEvent:!1})),(orgModule.userManager||orgModule.roleManager)&&(i.hide(),i.unlock())}}),orgModule.manager.tenantsTree.on("import:finished",function(e){var t=orgModule.properties;orgModule.fire(orgModule.Event.ORG_BROWSE,{force:!0,entityEvent:!1}),orgModule.orgManager&&(t.changeDisable(!1,["#"+t._EDIT_BUTTON_ID]),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{refreshAttributes:!0,entityId:e,entityEvent:!1}))})},orgModule.entityList={ID_PATTERN:".ID > a",_listId:"entitiesList",_containerId:"listContainer",_searchBoxId:"secondarySearchBox",initialize:function(e){this.list=new dynamicList.List(this._listId,{listTemplateDomId:e.listTemplateId,itemTemplateDomId:e.itemTemplateId,multiSelect:!0,selectionDefaultsToCursor:!0,comparator:function(e,t){return orgModule._comparator(e.getLabel(),t.getLabel())}}),this._initEvents(),this._infiniteScroll=new InfiniteScroll({id:this._containerId,contentId:this._listId}),this._searchBox=new SearchBox({id:this._searchBoxId}),e.text&&this._searchBox.setText(e.text),this._infiniteScroll.onLoad=function(){orgModule.fire(orgModule.Event.ENTITY_NEXT,{})},this._searchBox.onSearch=function(e){orgModule.fire(orgModule.Event.ENTITY_SEARCH,{text:e})},orgModule.toolbar.initialize(e.toolbarModel),this.toolbar=orgModule.toolbar,this.list.show()},_initEvents:function(){this.list.observe("item:selected",function(e){var t=e.memo.item,i=orgModule.properties;this.lastSelectedName=t.getValue().getNameWithTenant(),orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getValue().id,entityEvent:!0}),i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID])}.bindAsEventListener(this)),this.list.observe("item:unselected",function(e){var t=orgModule.manager.tenantsTree,i=orgModule.properties;i.changeDisable(!1,["#"+i._EDIT_BUTTON_ID]),!i.locked&&t?orgModule.fire(orgModule.Event.ENTITY_SELECT_AND_GET_DETAILS,{entityId:t.getTenant().id,entityEvent:!0,isCtrlHeld:e.memo.isCtrlHeld}):(i.hide(),this.toolbar.refresh())}.bindAsEventListener(this)),this.list.observe("item:beforeSelectOrUnselect",function(e){var t=e.memo.item;e.stopSelectOrUnselect=!invokeClientAction("cancelIfEdit",{entity:t.getValue(),showConfirm:e.memo.showConfirm})}.bindAsEventListener(this))},_createEntityItem:function(e){var t=new dynamicList.ListItem({label:e.getDisplayName(),value:e}),i=this;return t.processTemplate=function(e){return e.select(i.ID_PATTERN)[0].update(xssUtil.hardEscape(this.getValue().getDisplayName())),e},t},getSearchText:function(){return this._searchBox.getText()},setSearchText:function(e){return this._searchBox.setText(e)},getSelectedEntities:function(){return this.list?this.list.getSelectedItems().collect(function(e){return e.getValue()}):[]},setEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this._infiniteScroll.reset(),this.list.setItems(t),this.list.show(),this.toolbar.refresh()},findEntity:function(e){var t=this.list.getItems();return(orgModule.properties.options||orgModule.userManager.options)._.find(t,function(t){return t.getValue().fullName===e})},addEntities:function(e){var t=e.collect(this._createEntityItem.bind(this));this.list.addItems(t),this.list.refresh(),this.toolbar.refresh()},selectEntity:function(e){var t=this.list.getItems(),i=t.detect(function(t){return t.getValue().getNameWithTenant()==e});i&&(i.isSelected()&&i.deselect(),i.select(),this.lastSelectedName=i.getValue().getNameWithTenant())},restoreSelectedEntity:function(e){this.selectEntity(this.lastSelectedName?this.lastSelectedName:e)},deselectAll:function(){this.list.resetSelected()},update:function(e,t){this.list.getItems().findAll(function(t){return t.getValue().getNameWithTenant()==e}).each(function(e){e.setValue(t),e.refresh()})},remove:function(e){var t,i=this.list.getItems();t=isArray(e)?i.findAll(function(t){return e.include(t.getValue().getNameWithTenant())}):i.findAll(function(t){return t.getValue().getNameWithTenant()==e}),this.list.resetSelected(),this.list.removeItems(t)}},orgModule.properties={_EDIT_MODE_CLASS:"editMode",_moveButtonsId:"moveButtons",_id:"properties",_value:null,isEditMode:!1,_NOTHING_TO_DISPLAY_ID:"nothingToDisplay",_ASSIGNED_VIEW_ID:"assignedView",_ASSIGNED_VIEW_LIST_ID:"assignedViewList",_ASSIGNED_ID:"assigned",_AVAILABLE_ID:"available",_ASSIGNED_LIST_ID:"assignedList",_AVAILABLE_LIST_ID:"availableList",_ATTRIBUTES_LIST_ID:"attributesTab",_EDIT_BUTTON_ID:"edit",_SAVE_BUTTON_ID:"save",_CANCEL_BUTTON_ID:"cancel",_DELETE_BUTTON_ID:"delete",_REMOVE_FROM_ASSIGNED_BUTTON_ID:"removeFromAssigned",_ADD_TO_ASSIGNED_BUTTON_ID:"addToAssigned",_BUTTONS_CONTAINER_ID:"propertiesButtons",_MOVE_BUTTONS_CONTAINER_ID:"moveButtons",_DND_CLASS:".draggable",_DROP_CLASS:"wrap",buttonsFunctions:{},initialize:function(e){var t=e.attributesTypesEnum;if(this.options=e,this.locked=!1,this.hide(),this.processTemplate(e),this._toggleButton(),e.attributes){var i=!orgModule.userManager&&orgModule.orgManager?t.TENANT:t.USER,o=e.attributesViewOptionsFactory,r=e.scrollEventTrait,s=e.AttributesViewFacade;this.options._.extend(this,r),this.attributesFacade=new s(o({context:e.attributes.context,container:jQuery("#attributesTab"),type:i}))}this.options.showAssigned&&this.initDnD(),this.initEvents(),this.initButtonsFunctions(),this.options.ConfirmationDialog&&this._initConfirmationDialog()},_initConfirmationDialog:function(){var e=this,t=this.options.i18n;this.confirmationDialog=new this.options.ConfirmationDialog({title:t["attributes.confirm.dialog.title"],text:t["attributes.confirm.cancel.dialog.text"]}),this.confirmationDialog.on("button:yes",function(){e.cancelOnEdit()})},_toggleButton:function(){var e=this.isChanged();this.attributesFacade&&this.attributesFacade.containsUnsavedItems()||e?this.saveButton.removeAttribute("disabled"):this.saveButton.removeClassName("over").setAttribute("disabled","disabled")},show:function(e,t){if(!this.locked){if(this.attributesFacade){var i=this,o=e&&e.isRoot&&e.isRoot(),r=o?this.options._.extend({},e,{id:null}):e;this.attributesFacade.getCurrentView().setContext(r,t).done(function(){i.attributesFacade.render(o)})}$(this._NOTHING_TO_DISPLAY_ID).addClassName(layoutModule.HIDDEN_CLASS),document.body.removeClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=e,this.changeMode(!1)}},hide:function(){if(!this.locked){var e=$(this._NOTHING_TO_DISPLAY_ID);e.removeClassName(layoutModule.HIDDEN_CLASS),centerElement(e,{horz:!0,vert:!0}),document.body.addClassName(layoutModule.NOTHING_TO_DISPLAY_CLASS),this._value=null,this.changeMode(!1)}},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},setDetailsLoadedEntity:function(e){this.detailsLoadedEntity=e},getDetailsLoadedEntity:function(){return this.detailsLoadedEntity},processTemplate:function(e){if(this.editButton=$(this._EDIT_BUTTON_ID),this.saveButton=$(this._SAVE_BUTTON_ID),this.cancelButton=$(this._CANCEL_BUTTON_ID),this.deleteButton=$(this._DELETE_BUTTON_ID),this.options.showAssigned){this.removeFromAssigned=$(this._REMOVE_FROM_ASSIGNED_BUTTON_ID),this.addToAssigned=$(this._ADD_TO_ASSIGNED_BUTTON_ID),this.assignedViewList=new dynamicList.List(this._ASSIGNED_VIEW_LIST_ID,{listTemplateDomId:e.viewAssignedListTemplateDomId,itemTemplateDomId:e.viewAssignedItemTemplateDomId,comparator:this.assignedComparator,allowSelections:!1,selectionDefaultsToCursor:!1});var t={listTemplateDomId:"list_responsive_collapsible_fields",itemTemplateDomId:"list_responsive_collapsible_fields:fields",comparator:this.assignedComparator,dragPattern:this._DND_CLASS,allowSelections:!0,selectionDefaultsToCursor:!0,multiSelect:!0,selectOnMousedown:!0,setCursorOnMouseDown:!0};this.assignedList=new dynamicList.List(this._ASSIGNED_LIST_ID,Object.extend({},t,{allowSelections:!1,selectionDefaultsToCursor:!1})),this.availableList=new dynamicList.List(this._AVAILABLE_LIST_ID,t),e.searchAssigned&&(this.assignedViewSearchBox=new SearchBox({id:$(this._ASSIGNED_VIEW_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedViewSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})}),this.availableSearchBox=new SearchBox({id:$(this._AVAILABLE_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.availableSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:e})},this.assignedSearchBox=new SearchBox({id:$(this._ASSIGNED_ID).select(layoutModule.SEARCH_LOCKUP_PATTERN)[0].identify()}),this.assignedSearchBox.onSearch=function(e){invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:e})},e.searchAssigned&&(this.assignedViewInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_VIEW_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_VIEW_LIST_ID}),this.assignedViewInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}),this.availableInfiniteScroll=new InfiniteScroll({id:$($(this._AVAILABLE_LIST_ID).parentNode).identify(),contentId:this._AVAILABLE_LIST_ID}),this.availableInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_AVAILABLE,{})},this.assignedInfiniteScroll=new InfiniteScroll({id:$($(this._ASSIGNED_LIST_ID).parentNode).identify(),contentId:this._ASSIGNED_LIST_ID}),this.assignedInfiniteScroll.onLoad=function(){invokeServerAction(orgModule.ActionMap.NEXT_ASSIGNED,{})}}},initDnD:function(){Droppables.add($(this._ASSIGNED_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._addToAssigned()}.bind(this)}),Droppables.add($(this._AVAILABLE_LIST_ID).up(),{accept:[this._DROP_CLASS],hoverclass:layoutModule.DROP_TARGET_CLASS,onDrop:function(e,t,i){e.items&&this._removeFromAssigned()}.bind(this)})},initEvents:function(){function e(){(this.assignedList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.removeFromAssigned)}function t(){(this.availableList.getSelectedItems().length>0?buttonManager.enable:buttonManager.disable)(this.addToAssigned)}$(this._BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&this.buttonsFunctions[i.identify()]&&this.buttonsFunctions[i.identify()].call(this),e.stop()}.bindAsEventListener(this)),this.options.showAssigned&&($(this._MOVE_BUTTONS_CONTAINER_ID).observe("click",function(e){var t=e.element(),i=matchAny(t,[layoutModule.BUTTON_PATTERN],!0);i&&(i==this.removeFromAssigned?this._removeFromAssigned():i==this.addToAssigned&&this._addToAssigned()),e.stop()}.bindAsEventListener(this)),this.assignedList.observe("item:selected",e.bindAsEventListener(this)),this.assignedList.observe("item:unselected",e.bindAsEventListener(this)),this.assignedList.observe("item:dblclick",function(e){this._removeFromAssigned()}.bindAsEventListener(this)),this.availableList.observe("item:selected",t.bindAsEventListener(this)),this.availableList.observe("item:unselected",t.bindAsEventListener(this)),this.availableList.observe("item:dblclick",function(e){this._addToAssigned()}.bindAsEventListener(this))),this.attributesFacade&&this.attributesFacade.on("change",this.options._.bind(this._toggleButton,this))},initButtonsFunctions:function(){this.buttonsFunctions[this._EDIT_BUTTON_ID]=function(){this.changeMode(!0)},this.buttonsFunctions[this._SAVE_BUTTON_ID]=function(){var e=this,t=new jQuery.Deferred;this.validate()&&(this.attributesFacade?this.attributesFacade.getCurrentView().saveChildren().done(function(){t.resolve()}).fail(function(){t.reject(),jQuery(".tab[tabid='#attributesTab']").trigger("mouseup")}):t.resolve(),t.done(function(){e.save(e._value)}))},this.buttonsFunctions[this._CANCEL_BUTTON_ID]=function(){this.attributesFacade?this.isChanged()?this.confirmationDialog.open():this.cancelOnEdit():invokeClientAction("cancelIfEdit",{entity:this.getValue()})},this.buttonsFunctions[this._DELETE_BUTTON_ID]=function(){this._deleteEntity()},this.buttonsFunctions[this._REMOVE_FROM_ASSIGNED_BUTTON_ID]=function(){this._removeFromAssigned()},this.buttonsFunctions[this._ADD_TO_ASSIGNED_BUTTON_ID]=function(){this._addFromAssigned()}},cancelOnEdit:function(){var e=this;this.isEditMode&&this.cancel().done(function(){e.unlock(),e.changeMode(!1),e._toggleButton()})},changeMode:function(e){this.isEditMode=e;var t,i,o,r
;if(this.attributesFacade){i=$("attributesTab");var s=!!this._value&&"organizations"===this._value.id;this.detachScrollEvent(this.attributesFacade.getCurrentView().$container.parent()),this.attributesFacade.toggleMode(e,s),e&&this.initScrollEvent(this.attributesFacade.getCurrentView()),t=$$(".tertiary")[0],o=$("propertiesTab"),r=jQuery(".control.tabSet.anchor")}e?($(this._id).addClassName(this._EDIT_MODE_CLASS),t&&(t.down(".selected").removeClassName("selected"),t.down("li",0).addClassName("selected"),t.addClassName("tabbed"),i.addClassName("hidden"),o.removeClassName("hidden"),r.removeClass("attributesAnchor")),this._assigned=[],this._unassigned=[],this.options.showAssigned&&(centerElement($(this._moveButtonsId),{horz:!0}),$(this._moveButtonsId).style.zIndex=1e3,this.assignedList.setItems([]),this.assignedList.show(),this.availableList.setItems([]),this.availableList.show(),buttonManager.disable(this.removeFromAssigned),buttonManager.disable(this.addToAssigned),this.assignedSearchBox.setText(""),this.availableSearchBox.setText(""),invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:this.assignedSearchBox.getText()}),invokeServerAction(orgModule.ActionMap.SEARCH_AVAILABLE,{text:this.availableSearchBox.getText()})),this._editEntity(),this._toggleButton()):($(this._id).removeClassName(this._EDIT_MODE_CLASS),t&&(i.removeClassName("hidden"),o.removeClassName("hidden"),t.removeClassName("tabbed")),this.options.searchAssigned&&this.assignedViewSearchBox&&this.assignedViewSearchBox.setText(""),this.changeDisable(this.canEdit(),["#"+this._EDIT_BUTTON_ID]),this.changeDisable(this.canDelete(),["#"+this._DELETE_BUTTON_ID]),this._showEntity(),this._assigned=[],this._unassigned=[])},canEdit:function(){return!0},canDelete:function(){var e=orgModule.manager.tree&&orgModule.manager.tree.getOrganization();return!(e&&"/"===e.uri&&!orgModule.entityList.getSelectedEntities().length)},setValuesProperty:function(e,t){this._value[e]=t},getValue:function(){return this._value},setProperties:function(e){},isChanged:function(e){},save:function(e){},validate:function(){return!0},assignedComparator:function(e,t){var i=e.getLabel(),o=t.getLabel();return i>o?1:i<o?-1:0},_moveEntities:function(e){var t,i,o,r;e?(t=this._unassigned,o=this.availableList,i=this._assigned,r=this.assignedList):(t=this._assigned,o=this.assignedList,i=this._unassigned,r=this.availableList);var s=o.getSelectedItems(),n=s.collect(function(e){return e.getValue()});i=i.concat(n.collect(function(t){return t.available==e?t:null})).compact(),t=t.reject(function(e){return n.detect(function(t){return e.equals(t)})}),o.removeItems(s),r.addItems(s,!0),r.refresh(),e?(this._unassigned=t,this._assigned=i):(this._assigned=t,this._unassigned=i)},_addToAssigned:function(){this._moveEntities(!0)},_removeFromAssigned:function(){this._moveEntities(!1)},_entitiesToItems:function(e,t){return e=e||[],e.collect(function(e){var i="",o=[],r="orgTooltip";e instanceof orgModule.User?(i=e.userName,e.fullName&&e.fullName.length>0&&(o=[e.fullName]),r=e.tenantId?"fullNameAndOrgTooltip":"fullNameTooltip"):e instanceof orgModule.Role&&(i=e.roleName,r=e.tenantId?"orgTooltip":void 0),e.tenantId&&e.tenantId.length>0&&o.push(e.tenantId),e.available=!!t;var s=new dynamicList.ListItem({label:i,value:e});return this.isEditMode?s.processTemplate=function(e){return o.length>0&&new JSTooltip(e,{text:xssUtil.hardEscape(o),templateId:r}),dynamicList.ListItem.prototype.processTemplate.call(this,e)}:s.processTemplate=function(e){var t=e.select("a")[0];return t.insert(xssUtil.hardEscape(this.getLabel())),t.writeAttribute("href",this.getValue().getManagerURL()),o.length>0&&new JSTooltip(e,{text:xssUtil.hardEscape(o),templateId:r}),e},s}.bind(this))},getAssignedEntities:function(){return this._assigned},getUnassignedEntities:function(){return this._unassigned},setAssignedEntities:function(e){this.assignedViewInfiniteScroll&&this.assignedViewInfiniteScroll.reset(),this.assignedInfiniteScroll&&this.assignedInfiniteScroll.reset();var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.setItems(this._entitiesToItems(i)),t.refresh()},addAssignedEntities:function(e){var t=this.isEditMode?this.assignedList:this.assignedViewList,i=this._filterEntities(e,this._unassigned,this._assigned,this.assignedSearchBox.getText());t.addItems(this._entitiesToItems(i)),t.refresh()},setAvailableEntities:function(e){this.availableInfiniteScroll.reset();var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.setItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},addAvailableEntities:function(e){var t=this._filterEntities(e,this._assigned,this._unassigned,this.availableSearchBox.getText());this.availableList.addItems(this._entitiesToItems(t,!0)),this.availableList.refresh()},_filterEntities:function(e,t,i,o){var r=e.reject(function(e){return t.detect(function(t){return t.equals(e)})});return o=o.toLowerCase(),r=r.concat(i.findAll(function(e){return e.getDisplayName().toLowerCase().include(o)}))},changeReadonly:function(e,t){t.each(function(t){$(this._id).select(t)[0].writeAttribute(layoutModule.READONLY_ATTR_NAME,e?null:layoutModule.READONLY_ATTR_NAME)}.bind(this))},resetValidation:function(e){var t=$(this._id);e.each(function(e){ValidationModule.hideError(t.select(e)[0])}.bind(this))},changeDisable:function(e,t){t.each(function(t){e?buttonManager.enable($(this._id).select(t)[0]):buttonManager.disable($(this._id).select(t)[0])}.bind(this))},_deleteEntity:function(){},_editEntity:function(){},_showEntity:function(){}},orgModule.addDialog={show:function(e){},hide:function(e){}},orgModule.Action=function(e,t){Object.isFunction(e)&&(t=t&&Object.isFunction(t)?t:this.beforeInvoke,this.invokeAction=function(){if(t())return e.apply(this,arguments)})},orgModule.Action.addMethod("invokeAction",doNothing),orgModule.Action.addMethod("beforeInvoke",function(){return!0}),orgModule.ServerAction=function(e,t){this.actionURL="flow.html?_flowExecutionKey="+localContext.flowExecutionKey+"&_eventId="+e,this.data=Object.toQueryString(t),this.onSuccess=doNothing(),this.onError=doNothing()},orgModule.ServerAction.addMethod("invokeAction",function(){this.beforeInvoke()&&ajaxTargettedUpdate(this.actionURL,{postData:this.data,callback:function(e){e.error?this.onError(e.error):this.onSuccess(e.data)}.bind(this),errorHandler:function(e){return e.getResponseHeader("LoginRequested")?(orgModule.fire(orgModule.Event.SERVER_UNAVAILABLE,{}),!0):baseErrorHandler(e)},mode:AjaxRequester.prototype.EVAL_JSON})}),orgModule.ServerAction.addMethod("beforeInvoke",function(){return!0}),orgModule.toolbar={_actionModel:{},initialize:function(e){this._actionModel=e,toolbarButtonModule.initialize(this._toActionMap(this._actionModel)),this.refresh()},refresh:function(){for(var e in this._actionModel){var t=this._actionModel[e].buttonId,i=toFunction(this._actionModel[e].test);toolbarButtonModule.setButtonState($(t),i())}},_toActionMap:function(e){var t={};for(var i in e){var o=e[i];t[o.buttonId]=function(e,t){return function(){var i=getAsFunction(e),o=t,r=localContext&&localContext[e];o&&isArray(o)?i.apply(r?localContext:null,o):i.call(r?localContext:null,o)}}(o.action,o.actionArgs)}return t}},orgModule.createInputRegExValidator=function(e){return{validator:function(t){var i=e.regExp.test(t),o=!i,r=o?"":orgModule.getMessage("unsupportedSymbols",{symbols:e.unsupportedSymbols});return e.isValid=o,{isValid:o,errorMessage:r}},element:e}},orgModule.createBlankValidator=function(e,t,i,o){return{validator:function(e){var i=!e.blank();return{isValid:i,errorMessage:i?"":orgModule.getMessage(t)}},element:e,onValid:i,onInvalid:o}},orgModule.createMaxLengthValidator=function(e,t,i){return{validator:function(o){var r=e.hasAttribute("maxlength")?e.readAttribute("maxlength"):e.maxlength,s=o.length<parseInt(r),n=s?"":orgModule.getMessage(t);return i&&(n=n.replace(i,r)),{isValid:s,errorMessage:n}},element:e}},orgModule.createSameValidator=function(e,t,i){return{validator:function(e){var o=e===t.getValue();return{isValid:o,errorMessage:o?"":orgModule.getMessage(i)}},element:e}},orgModule.createRegExpValidator=function(e,t,i){return{validator:function(e){var o=i.exec(e),r=!o&&0===e.length||o&&e==o[0];return{isValid:r,errorMessage:r?"":orgModule.getMessage(t)}},element:e}},orgModule.truncateOrgName=function(e){return e&&e.length>0?e.truncate(15):""},RegExpRepresenter.addMethod("__parse",function(e){for(var t=$A(),i=1;i<e.length-1;i++){var o=e.charAt(i);"\\"==o&&(o+=e.charAt(++i)),"\\u"==o&&(o+=e.substring(++i,i+4),i+=3),t.push(o)}return t}),RegExpRepresenter.addMethod("getCharacters",function(){var result=$A();return this.expressionTokens.each(function(token){if(token.startsWith("\\u"))result.push(eval('"'+token+'"'));else if(token.startsWith("\\")){var ch=this.charMap[token];result.push(ch||token.substring(1,token.length))}else result.push(token)}.bind(this)),result}),RegExpRepresenter.addMethod("getRepresentedString",function(){for(var e="",t=this.getCharacters(),i=t.length,o=0;o<i;o++){var r=t[o];e+=" "==r||"."==r||","==r?"["+r+"]":r,o<i-1&&(e+=", ")}return e}),define("mng.common",["jquery","underscore","prototype","utils.common","tools.infiniteScroll","components.list","components.dynamicTree","components.toolbar","common/component/dialog/ConfirmationDialog"],function(e){return function(){return e.orgModule}}(this)),define("repository/repositoryMain",["require","!domReady","namespace","component.repository.search","jrs.configs","components.list","underscore","localContext","backbone","components.dependent.dialog","components.toolbar","components.tooltip","tools.infiniteScroll","mng.common"],function(e){"use strict";var t=e("!domReady"),i=(e("namespace"),e("component.repository.search")),o=e("jrs.configs"),r=e("components.list"),s=e("underscore"),n=e("localContext");e("backbone"),e("components.dependent.dialog"),e("components.toolbar"),e("components.tooltip"),e("tools.infiniteScroll"),e("mng.common"),t(function(){s.extend(i.messages,o.repositorySearch.i18n),s.extend(r.messages,o.dynamicList.i18n),s.extend(n,o.repositorySearch.localContext),i.initialize(n)})});