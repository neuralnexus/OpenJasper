(self.webpackChunkjrs_ui=self.webpackChunkjrs_ui||[]).push([[3379],{60744:(e,t,i)=>{"use strict";i.r(t);var n=i(97836),a=i.n(n),o=i(71914),s=i(17620),r=i(41447),l=i(64155),c=i(10165),u=i(72157),d=i.n(u),_=i(33806);const h={STEP1_PAGE_ID:"addResource_query_step1",STEP2_PAGE_ID:"addResource_locateDataSource",STEP3_PAGE_ID:"addResource_query_step3",LABEL_ID:"query.label",RESOURCE_ID_ID:"query.name",DESCRIPTION_ID:"query.description",JUMP_TO_PAGE_ID:"jumpToPage",DONE_BUTTON_ID:"done",NEXT_BUTTON_ID:"next",JUMP_TO_BUTTON_ID:"jumpButton",NEW_DATA_SOURCE_LINK_ID:"newDataSourceLink",LOCAL_DATA_SOURCE_ID:"LOCAL",RESOURCE_URI_INPUT_ID:"resourceUri",QUERY_SQL:"query.sql",_canGenerateId:!0,initialize:function(e){this._step1Page=d()("#"+this.STEP1_PAGE_ID)[0],this._step2Page=d()("#"+this.STEP2_PAGE_ID)[0],this._step3Page=d()("#"+this.STEP3_PAGE_ID)[0],this._step1Page&&(this._form=d()("#"+_.Z.PAGE_BODY_ID).find("form")[0],this._label=document.getElementById(this.LABEL_ID),this._resourceId=document.getElementById(this.RESOURCE_ID_ID),this._description=document.getElementById(this.DESCRIPTION_ID),this._label.validator=s.Z.labelValidator.bind(this),this._resourceId.validator=s.Z.resourceIdValidator.bind(this),this._description.validator=s.Z.descriptionValidator.bind(this)),this._step2Page&&(this._form=d()("#"+_.Z.PAGE_BODY_ID).find("form")[0],this._dataSourceUri=document.getElementById(this.RESOURCE_URI_INPUT_ID),this._dataSourceUri.validator=s.Z.dataSourceValidator.bind(this)),this._step3Page&&(this._form=d()("#"+_.Z.PAGE_BODY_ID).find("form")[0],this._query=document.getElementById(this.QUERY_SQL),this._query.validator=s.Z.queryValidator.bind(this)),this._nextButton=d()("#"+this.NEXT_BUTTON_ID),this._doneButton=d()("#"+this.DONE_BUTTON_ID),this._jumpToPage=d()("#"+this.JUMP_TO_PAGE_ID)[0],this._jumpButton=d()("#"+this.JUMP_TO_BUTTON_ID)[0],this._newDataSourceLink=d()("#"+this.NEW_DATA_SOURCE_LINK_ID)[0],this._localDataSource=d()("#"+this.LOCAL_DATA_SOURCE_ID)[0],this._isEditMode=!!e&&e.isEditMode,r.Z.initialize({resourceInput:"resourceUri",browseButton:"browser_button",newResourceLink:"newDataSourceLink",treeId:"queryTreeRepoLocation",providerId:"dsTreeDataProvider",dialogTitle:s.Z.messages["resource.Query.Title"],selectLeavesOnly:!0}),this._initEvents()},_initEvents:function(){if(this._nextButton.on("click",function(e){this._isDataValid()||e.stopPropagation(),this._localDataSource&&this._localDataSource.checked&&(e.preventDefault(),e.stopPropagation(),this._newDataSourceLink.click())}.bind(this)),this._doneButton.on("click",function(e){this._isDataValid()||e.preventDefault()}.bind(this)),d()(this._form).on("keyup",function(e){var t=e.target;t==this._resourceId&&this._resourceId.getValue()!=s.Z.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),t==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(s.Z.generateResourceId(this._label.getValue())),l.n4K.validate(s.Z.getValidationEntries([this._resourceId])))}.bind(this)),this._newDataSourceLink){var e=this;this._newDataSourceLink.observe("click",function(t){if(e._localDataSource.checked){var i=o.Z.addDataSource?a().clone(o.Z.addDataSource.initOptions):{};i.saveFn=function(t,i){t.type=i.type;var n=document.createElement("input");n.type="hidden",n.name="dataSourceJson",n.value=JSON.stringify(a().extend(i.toJSON(),{name:t.name})),e._form.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="dataSourceType",n.value=i.type,e._form.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="_eventId_saveDatasource",e._form.appendChild(n),e._form.submit()},i.cancelFn=function(){e._form.submit()},i.skipLocation=!0,window.localContext&&window.localContext.initOptions&&window.localContext.initOptions&&(window.localContext.initOptions.dataSourceJson?(i.isEditMode=!0,i.dataSource=window.localContext.initOptions.dataSourceJson,i.dataSourceClientType=window.localContext.initOptions.dataSourceJson.type):window.localContext.initOptions.dataSourceUri&&(i.isEditMode=!0,i.resourceUri=window.localContext.initOptions.dataSourceUri));var n=new c.Z(i);d()("#display").append(n.$el),d()("#selectFromRepository").remove(),n.render()}}.bindAsEventListener(this))}},_isDataValid:function(){var e=!0;return this._label&&(e=e&&l.n4K.validate(s.Z.getValidationEntries([this._label]))),this._resourceId&&(this._resourceId.getValue()!=s.Z.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(s.Z.generateResourceId(this._label.getValue())),e=e&&l.n4K.validate(s.Z.getValidationEntries([this._resourceId])))),this._description&&(e=e&&l.n4K.validate(s.Z.getValidationEntries([this._description]))),this._dataSourceUri&&!this._dataSourceUri.disabled&&(e=e&&l.n4K.validate(s.Z.getValidationEntries([this._dataSourceUri]))),this._query&&(e=e&&l.n4K.validate(s.Z.getValidationEntries([this._query]))),e},jumpTo:function(e){return this._jumpToPage.setValue(e),this._jumpButton.click(),!1}};var E=o.Z.addQuery.localContext.initOptions;a().extend(window.localContext,o.Z.addQuery.localContext),a().extend(s.Z.messages,o.Z.addQuery.resource.messages),h.initialize(E),o.Z.addQuery.buttonFlowControls&&(d()("#steps1_2").on("click",(function(){return h.jumpTo("reportNaming")})),d()("#step3").on("click",(function(){return h.jumpTo("resources")})),d()("#step4").on("click",(function(){return h.jumpTo("dataSource")})),d()("#step5").on("click",(function(){return h.jumpTo("query")})),d()("#step6").on("click",(function(){return h.jumpTo("customization")}))),(0,l.zcy)()&&s.Z.initSwipeScroll()},41447:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var n=i(72157),a=i.n(n),o=i(97836),s=i.n(o),r=i(17620),l=i(32758),c={CONTENT_REPOSITORY:"CONTENT_REPOSITORY",LOCAL:"LOCAL",NONE:"NONE",FILE_SYSTEM:"FILE_SYSTEM",LOCATE_EVENT:"resource:locate",ALLOWED_FILE_RESOURCE_EXTENSIONS:["css","ttf","jpg","jpeg","gif","bmp","png","jar","jrxml","properties","jrtx","xml","agxml","docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html"],initialize:function(e){var t=function(e){return s().isObject(e)?e:a()("#"+e)[0]};this.resourceUri=t(e.resourceInput),this.browseButton=t(e.browseButton),this.filePath=t(e.fileUploadInput),this.fakeFilePath=t(e.fakeFileUploadInput),this.fakeFileInput=t(e.fakeFileUploadInputText),this.newResourceLink=t(e.newResourceLink);try{this._initFileSelector(e)}catch(e){}finally{this._initEvents(e)}return this},_initEvents:function(e){a()(document).on("click","#CONTENT_REPOSITORY, #FILE_SYSTEM, #NONE, #LOCAL",this._clickHandler),"fileResourceTreeDataProvider"===e.providerId&&(a()("#next").on("click",c._nextClickHandler),a()("#filePath").on("change",c._uploadChangeHandler))},_nextClickHandler:function(e){a()("#fileUpload").hasClass("error")&&e.preventDefault()},_uploadChangeHandler:function(e){a()("#fileUpload").removeClass("error");var t=!0;if(a()("#filePath")[0].value){var i=a()("#filePath")[0].value.match(/.*\.([^\.]+)$/);if(i){var n=i[1];s().indexOf(c.ALLOWED_FILE_RESOURCE_EXTENSIONS,n)<0&&(t=!1)}else t=!1}else t=!1;if(!t){var o=r.Z.messages["resource.report.unsupportedFileType.error"]+" "+c.ALLOWED_FILE_RESOURCE_EXTENSIONS.join(", ");a()("#fileUpload").addClass("error").find("span.warning").html(o)}},_clickHandler:function(e){c._updateResourceSelectorState(e.target.id)},_updateResourceSelectorState:function(e){r.Z.switchButtonState(this.filePath,e===this.FILE_SYSTEM),r.Z.switchButtonState(this.fakeFilePath,e===this.FILE_SYSTEM),r.Z.switchButtonState(this.fakeFileInput,e===this.FILE_SYSTEM),r.Z.switchButtonState(this.browseButton,e===this.CONTENT_REPOSITORY),r.Z.switchDisableState(this.resourceUri,e!==this.CONTENT_REPOSITORY);var t=e===this.LOCAL?["disabled","launcher"]:[];this._switchElementClasses(this.newResourceLink,t)},_initFileSelector:function(e){this.fileSelector=new l.Z.FileSelector(s().extend({},e,{uriTextboxId:this.resourceUri,browseButtonId:this.browseButton,title:e.dialogTitle}))},remove:function(e){this.fileSelector.remove()},_switchElementClasses:function(e,t){e&&t&&a()(e).removeClass(t[0]).addClass(t[1])}};const u=c}}]);
//# sourceMappingURL=chunk.3379.js.map