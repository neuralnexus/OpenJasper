(self.webpackChunkjrs_ui=self.webpackChunkjrs_ui||[]).push([[6390],{46390:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ue});var n=i(72157),r=i.n(n),s=i(97836),o=i.n(s),a=i(15892),l=i.n(a),c=i(31371),d={},u={includeAccessEvents:!0,includeAuditEvents:!0,includeMonitoringEvents:!0},p={skipThemes:!0},h={includeServerSettings:!0};d[c.Z.ROOT_TENANT]=o().extend({},u,p),d[c.Z.TENANT]=o().extend({},p),d[c.Z.SERVER_PRO]=o().extend({},u,p,h),d[c.Z.SERVER_CE]=o().extend({},h,{includeAccessEvents:!0});const m="fail",g="skip",f="include";var v=i(12473);function y(e){var t,i=null;return e.firstChild.innerText&&""!==e.firstChild.innerText&&e.body?((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e.firstChild.innerText.replace("\r\n-","\r\n"))):t=e,t.firstChild&&(i=t.firstChild.nodeName.toLowerCase()),i&&"html"!==i&&"#comment"!==i?b("xml"===t.firstChild.nodeName.toLowerCase()?t.firstChild.nextSibling:t.firstChild):{errorCode:"unexpected.error"}}function b(e){var t,i;if(e.children)t=e.children;else{t=[];for(var n=0,r=e.childNodes.length;n<r;n++)null===e.childNodes[n].nodeValue&&t.push(e.childNodes[n])}if(0===t.length&&1===e.childNodes.length)return e.childNodes[0].nodeValue;if(t.length>1&&t[0].nodeName===t[1].nodeName){i=[];for(var s=0,o=t.length;s<o;s++)i[s]=b(t[s])}else{i={};for(var a=0,l=t.length;a<l;a++)i[t[a].nodeName]=b(t[a])}return i}var k=function(e,t,i,n){this.name=o().uniqueId("uploadTarget"),this.form=r()(e),t&&this.form.attr("action",t),i&&this.form.attr("method",i),n&&this.form.attr("enctype",n),this.parceXmlDocToObject=y};k.prototype.submit=function(){return window.FormData?(e=this.form,t=new(r().Deferred),e.submit((function(i){i.preventDefault(),(0,v.Z)({url:e.attr("action"),type:e.attr("method"),data:new FormData(e[0]),cache:!1,contentType:!1,processData:!1,headers:{Accept:"application/json"}}).done((function(e){t.resolve(e)})).fail((function(e){e=e.responseJSON||e||{},o().defaults(e,{errorCode:"error.load.error"}),t.reject(e)})),e.off("submit")})),e.submit(),t):function(e,t){var i=r().Deferred(),n=r()("<iframe style='display:none' name='"+t+"'></iframe>");return e.append(n).attr("target",t),n.on("load",(function(){try{i.resolve(y(this.contentWindow.document))}catch(e){i.reject({errorCode:"error.invalid.response"})}n.remove()})),n.on("abort",(function(){i.reject({errorCode:"error.load.aborted"}),n.remove()})),n.on("error",(function(){i.reject({errorCode:"error.load.error"}),n.remove()})),e.submit(),i}(this.form,this.name);var e,t};const E=k;var Z=i(59772),T=i(81180),x=i(12264),w=T.Z.extend({defaults:{fileName:"",update:!0,skipUserUpdate:!1,mergeOrganization:!1,skipThemes:!0,keyType:"",secretKey:"",secretUri:"",keyAlias:"",invalidKeyError:"",invalidSecureFileContentError:"",brokenDependencies:m},url:"rest_v2/import",validation:{fileName:[{fn:function(e){return!/\.zip$/.test(e)}}]},initialize:function(e,t){this.form=new E(t.form,this.url,"post","multipart/form-data")},parse:function(){return this.attributes},save:function(){var e,t,i=this;return this.isNew()?(e=new(r().Deferred),this.form.submit().done((function(t){i.set("id",t.id),o().isUndefined(t.errorCode)&&o().isUndefined(t.error)?e.resolve(t):e.reject(t)})).fail((function(t){i.trigger("error",t),e.reject(t)}))):(t=this._convertParameters(),e=T.Z.prototype.save.call(this,{parameters:t},{url:this.url+"/"+this.id}).fail(o().bind(this.trigger,this,"error"))),e},cancel:function(){var e=this.url+"/"+this.id;this.destroy({url:e})},reset:function(e,t,i){var n=o().extend({},this.defaults,function(e){return d[e]}(e),t);n.keyAlias=i?i[0].alias:"",this.clear().set(o().extend({},n)),this.id=void 0,r()('input[name ="key-alias"]').length&&(r()('input[name ="key-alias"]')[0].value=x.Z.DEFAULTKEY)},_convertParameters:function(){var e=[];this.get("skipUserUpdate")&&e.push("skip-user-update"),this.get("includeAccessEvents")&&e.push("include-access-events"),this.get("includeAuditEvents")&&e.push("include-audit-events"),this.get("includeMonitoringEvents")&&e.push("include-monitoring-events"),this.get("includeServerSettings")&&e.push("include-server-setting"),this.get("mergeOrganization")&&e.push("merge-organization"),this.get("skipThemes")&&e.push("skip-themes"),this.get("update")&&e.push("update");var t=this.get("keyType");return t&&(e.push("keyType"),t===x.Z.VALUE&&e.push("secret-key"),t===x.Z.FILE&&e.push("secret-uri"),t===x.Z.CUSTOMKEY&&e.push("key-alias")),e}});o().extend(w.prototype,Z.Z.mixin);const C=w;const S=i(33890).Z.extend({url:function(){return"rest_v2/import/"+this.id+"/state"}}),U="import.broken.dependencies",K="import.organizations.not.match";var I=i(62035),D=i(18580),A=i(76144),R=i(77475);const N=R.Z.extend({constructor:function(e){e||(e={}),o().extend(e,{resizable:!0,additionalCssClasses:"merge-tenant-dialog",title:A.Z["import.dialog.merge.tenant.title"],buttons:[{label:A.Z["import.button.continue"],action:"import",primary:!0},{label:D.Z["button.cancel"],action:"cancel",primary:!1}],template:"<p class=\"message\">\n\n    <js-templateNonce></js-templateNonce>\n    {{- i18n['import.dialog.merge.tenant.intro'] }}</p>\n\n<p class=\"message imported-tenant\"><b>{{- i18n['import.dialog.merge.tenant.imported'] }} : </b> {{- fileTenantId}} </p>\n<p class=\"message selected-tenant\"><b>{{- i18n['import.dialog.merge.tenant.selected'] }} : </b> {{- selectedTenantId}} </p>\n\n<p class=\"message\">{{- i18n['import.dialog.merge.tenant.outro'] }} {{- selectedTenantId}}</p>\n"}),R.Z.prototype.constructor.call(this,e),this.on("button:import",o().bind(this.close,this)),this.on("button:cancel",o().bind(this.close,this))},open:function(e){o().extend(e,{i18n:A.Z}),R.Z.prototype.open.call(this,e)}}),j=R.Z.extend({constructor:function(e){e||(e={}),o().extend(e,{resizable:!0,buttons:[{label:A.Z["import.button.include"],action:"include",primary:!0},{label:A.Z["import.button.skip"],action:"skip",primary:!1},{label:D.Z["button.cancel"],action:"cancel",primary:!1}]}),R.Z.prototype.constructor.call(this,e),this.on("button:include",o().bind(this.close,this)),this.on("button:skip",o().bind(this.close,this)),this.on("button:cancel",o().bind(this.close,this))},open:function(e){o().extend(e,{message:A.Z["import.dialog.broken.dependencies.intro"]}),R.Z.prototype.open.call(this,e)}}),F=R.Z.extend({constructor:function(e){e||(e={}),o().extend(e,{resizable:!0,title:A.Z["import.dialog.warnings.title"],additionalCssClasses:"warnings-dialog",buttons:[{label:D.Z["button.close"],action:"close",primary:!1}]}),R.Z.prototype.constructor.call(this,e),this.on("button:close",o().bind(this.close,this))}});var _={};function M(e){var t=e.code,i=e.parameters,n=_[t];return o().template(n[i.length-1].msg)(function(e,t){var i={};return o().each(e,(function(e,n){i[e]=t[n]})),i}(n[i.length-1].parameters,i))}_["import.resource.uri.too.long"]=[{msg:A.Z["import.resource.uri.too.long"],parameters:["resourceURI"]},{msg:A.Z["import.resource.uri.too.long.length"],parameters:["resourceURI","maxURILength"]}],_["import.access.denied"]=[{msg:A.Z["import.access.denied"],parameters:["resourceURI"]}],_["import.resource.not.found"]=[{msg:A.Z["import.resource.not.found"],parameters:["resourceURI"]}],_["import.resource.different.type.already.exists"]=[{msg:A.Z["import.resource.different.type.already.exists"],parameters:["resourceURI"]}],_["import.resource.uri.not.valid"]=[{msg:A.Z["import.resource.uri.not.valid"],parameters:["resourceURI"]}],_["import.resource.data.missing"]=[{msg:A.Z["import.resource.data.missing"],parameters:["resourceURI"]}],_["import.reference.resource.not.found"]=[{msg:A.Z["import.reference.resource.not.found"],parameters:["resourceURI"]},{msg:A.Z["import.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}],_["import.resource.attached.not.exist.org"]=[{msg:A.Z["import.resource.attached.not.exist.org"],parameters:["resourceURI"]}],_["import.folder.attached.not.exist.org"]=[{msg:A.Z["import.folder.attached.not.exist.org"],parameters:["resourceURI"]}],_["import.multi.tenancy.not.supported"]=[{msg:A.Z["import.multi.tenancy.not.supported"],parameters:["organizationId"]}],_["import.skip.resource"]=[{msg:A.Z["import.skip.resource"],parameters:["resourceURI"]}],_["import.report.job.reference.resource.not.found"]=[{msg:A.Z["import.report.job.reference.resource.not.found"],parameters:["resourceURI"]},{msg:A.Z["import.report.job.reference.dependent.resource.not.found"],parameters:["dependentResourceURI","resourceURI"]}];var V=i(63100),L=i(8045);var O=i(61309),z=i(95312),B=i(54339),Y=i(92111),J=i(35826);const P="import.invalid.secretKey",$="import.invalid.secretKey.length",X="import.invalid.secretUri.secretFile",G="import.invalid.secretUri",H="import.decode.failed";var q=i(53861);var W,Q,ee,te=(ee=function(){return q.Z.productTypeIsJrsAmi||q.Z.productTypeIsMpAmi?A.Z["import.decode.failed.aws"]:A.Z["import.decode.failed"]},(Q=H)in(W={})?Object.defineProperty(W,Q,{value:ee,enumerable:!0,configurable:!0,writable:!0}):W[Q]=ee,W);const ie=function(e){var t=te[e];return t?t():A.Z[e]||A.Z["import.error.unexpected"]};var ne=l().View.extend({tagName:"form",className:"import-view",id:"importDataFile",events:{"change input[type='file']":"validateFile","change input.jr-jDefaultKey, input.jr-jKeyValue, input.jr-jKeyFile , input.jr-juniversalKeyValue,  input.jr-jCustomKey":"_onKeyTypeChange","input input.jr-jSecretKey":"_onSecretKeyInput","input input.jr-jSecretUri":"_onSecretFileInput","click button.jr-jRepositoryBrowserButton":"_onRepositoryBrowserButtonClick","click .checkBox label":"_clickOnCheckbox","change .control.select.inline":"_onCustomKeyInput"},computeds:{isKeyUseUniversal:{deps:["keyType"],get:function(e){return e===x.Z.UNIVERSALKEY}},isKeyUseCustom:{deps:["keyType"],get:function(e){return e===x.Z.CUSTOMKEY}},isKeyUseValue:{deps:["keyType"],get:function(e){return e===x.Z.VALUE}},isKeyUseFile:{deps:["keyType"],get:function(e){return e===x.Z.FILE}}},initialize:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.model||(this.model=new C(null,{form:this.el})),this.stateModel=new S,this.customKeyStateModel=new z.Z,this.loadingDialog=new I.Z({content:D.Z["dialog.overlay.loading"]});var i=B.Z.getDialog("item");this.keyFileDialog=t.keyFileDialog||new i({disableListTab:!0,treeBufferSize:parseInt(Y.Z.treeLevelLimit,10),resourcesTypeToSelect:[J.Z.SECURE_FILE]}),this.keyFileDialog.on("close",(function(){if(e.keyFileDialog.selectedResource&&e.keyFileDialog.selectedResource.resourceUri){var t=e.keyFileDialog.selectedResource.resourceUri;e.model.set("secretUri",t),e._clearSecureKeyErrors()}})),this.mergeTenantDialogView=new N,this.dependentResourcesDialogView=new j,this.warningsDialogView=new F,this.notification=new V.Z,this.listenTo(this.stateModel,"change:phase",this._handleImportPhase,this);var n={delay:!1,message:A.Z["import.error.cancelled"]},r={delay:!1,message:A.Z["import.error.unexpected"]};this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.model,"error:notFound",o().bind(this.notification.show,this.notification,n)),this.listenTo(this.stateModel,"error:notFound",o().bind(this.notification.show,this.notification,n)),this.listenTo(this.model,"error:internalServerError",o().bind(this.notification.show,this.notification,r)),this.listenTo(this.stateModel,"error:internalServerError",o().bind(this.notification.show,this.notification,r)),this.listenTo(this.model,"error",o().bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.stateModel,"error",o().bind(this.loadingDialog.close,this.loadingDialog)),this.listenTo(this.mergeTenantDialogView,"button:import",(function(){this.model.set("mergeOrganization",!0),""===this.model.get("keyType")?this.model.set("keyAlias",x.Z.DEFAULTKEY):this.model.get("keyType")===x.Z.UNIVERSALKEY&&this.model.set("keyAlias",x.Z.UNIVERSALKEY),this.doImport()}),this),this.listenTo(this.mergeTenantDialogView,"button:cancel",o().bind(de,this,S.STATE.CANCELLED)),this.listenTo(this.dependentResourcesDialogView,"button:skip",ce(this,g)),this.listenTo(this.dependentResourcesDialogView,"button:include",ce(this,f)),this.listenTo(this.dependentResourcesDialogView,"button:cancel",o().bind(de,this,S.STATE.CANCELLED)),this.epoxifyView()},render:function(e){var t=this;return this.type=e.type,this.model.reset(this.type,{organization:e.tenantId}),this.$el.html(o().template('<input name="organization" class="" type="hidden" data-bind="value:organization"/>\n\n    <js-templateNonce></js-templateNonce>\n\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.file.name\'] }}</span>\n    </legend>\n    <label for="uploadFile">\n        <input name="file" class="upload-file" id="uploadFile" type="file"/>\n    </label>\n</fieldset>\n<fieldset class="group">\n    <legend class="">\n        <span>{{- i18n[\'import.options\'] }}</span>\n    </legend>\n    <ul class="list inputSet">\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="" for="update">{{- i18n[\'import.update\'] }}</label>\n                <input id="update" class="" type="checkbox" value="" name="update" data-bind="checked:update"/>\n            </div>\n            <ul class="list inputSet">\n                <li class="leaf">\n                    <div class="control checkBox">\n                        <label class="wrap" title="">{{- i18n[\'import.skip.user.update\']\n                            }}</label>\n                        <input id="skipUserUpdate" class="" type="checkbox" value="" name="skip-user-update"\n                               data-bind="checked:skipUserUpdate, enabled:update"/>\n                    </div>\n                </li>\n            </ul>\n        </li>\n\n        {{ if (model.includeAuditEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.audit.events\']}}</label>\n                <input id="includeAuditEvents" class="" type="checkbox" name="include-audit-events"\n                       data-bind="checked:includeAuditEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeAccessEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.access.events\']}}</label>\n                <input id="includeAccessEvents" class="" type="checkbox" value="" name="include-access-events"\n                       data-bind="checked:includeAccessEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeMonitoringEvents) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.monitoring.events\'] }}</label>\n                <input id="includeMonitoringEvents" class="" type="checkbox" value="" name="include-monitoring-events"\n                       data-bind="checked:includeMonitoringEvents"/>\n            </div>\n        </li>\n\n        {{ } if (model.includeServerSettings) { }}\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap">{{- i18n[\'import.include.configuration.settings\']}}</label>\n                <input class="" type="checkbox" value="" name="include-server-settings"\n                       data-bind="checked:includeServerSettings"/>\n            </div>\n        </li>\n        {{ } if (typeof model.skipThemes !== "undefined") { }}\n\n        <li class="leaf">\n            <div class="control checkBox">\n                <label class="wrap" title="">{{- i18n[\'import.include.themes\']}}</label>\n                <input type="checkbox" value=""\n                       data-bind="checked:not(skipThemes)"/>\n                <input class="hidden" id="skip-themes" type="checkbox"  value="" name="skip-themes"\n                       data-bind="checked:skipThemes"/>\n            </div>\n        </li>\n        {{ } }}\n    </ul>\n</fieldset>\n\n\x3c!-- Hack for correct sending of multipart/form-data in IE. --\x3e\n\x3c!-- Here is the fix https://blog.yorkxin.org/posts/2014/02/06/ajax-with-formdata-is-broken-on-ie10-ie11/ --\x3e\n<input type="hidden" name="_dontcare">\n<input type="hidden" name="key-alias" value="{{- model.secureKeyTypes.DEFAULTKEY }}">')({i18n:A.Z,i18n2:D.Z,model:o().extend(this.model.toJSON(),{secureKeyTypes:x.Z})})),this.customKeyStateModel.getCustomKeys().done((function(e){if(e&&0===e.length)se(t,!1);else if(e&&e.responseJSON&&e.responseJSON.error)re(t,e);else{t.customKeyElements=e,t.model.set("keyAlias",e[0].alias),se(t,!0);for(var i=0;i<e.length;++i){var n=r()("<option />").attr("value",e[i].alias);n.text(e[i].label?e[i].label:e[i].alias),t.$el.find("#importCustomKey").append(n)}}t.applyEpoxyBindings()})).fail((function(e){re(t,e)})),this},validateFile:function(e){this.model.set("fileName",r()(e.target).val());var t=r()(e.target).parent();this.model.isValid(!0)?t.removeClass("error"):t.addClass("error")},doImport:function(){var e=this,t=new(r().Deferred),i=this;return this.loadingDialog.open(),this.model.isValid(!0)?t=this.model.save().fail((function(t){e._onImportFail(t)})).always((function(e){i.stateModel.set(e)})):t.reject(),t},_onImportFail:function(e){var t=e.errorCode;t===P?this.model.set("invalidKeyError",A.Z["import.invalid.secretKey"]):t===X?this.model.set("invalidSecureFileContentError",A.Z["import.invalid.secretUri.secretFile"]):t===G?this.model.set("invalidSecureFileContentError",A.Z["import.invalid.secretUri"]):t===$&&this.model.set("invalidKeyError",A.Z["import.invalid.secretKey.length"])},_handleImportPhase:function(){var e=this.stateModel.get("phase");e!==S.STATE.INPROGRESS&&this.loadingDialog.close(),e===S.STATE.READY?ae.call(this,"import.finished","success"):e===S.STATE.FAILED?this.stateModel.get("error")&&this.stateModel.get("error").errorCode?ae.call(this,this.stateModel.get("error").errorCode):this.stateModel.get("message")&&ae.call(this,this.stateModel.get("message")):e===S.STATE.CANCELLED?ae.call(this,"import.error.cancelled"):e===S.STATE.PENDING&&le.call(this)},_onRepositoryBrowserButtonClick:function(){this.keyFileDialog.open()},_clearSecureKeyErrors:function(){this.model.set({invalidKeyError:"",invalidSecureFileContentError:""})},_onKeyTypeChange:function(e){var t=e.target.value,i=this.$el.find('input[name ="key-alias"]')[0],n=this.$el.find("#importCustomKey")[0]&&this.$el.find("#importCustomKey")[0].selectedIndex;t==x.Z.CUSTOMKEY?i.value=r()(".control.select.inline").find("option")[n].value:t==x.Z.UNIVERSALKEY?i.value=t:i.value=""==t?x.Z.DEFAULTKEY:"",this.model.set("keyType",t),this._clearSecureKeyErrors()},_onSecretKeyInput:function(e){var t=e.target.value;this.model.set("secretKey",t,{silent:!0}),this._clearSecureKeyErrors()},_onSecretFileInput:function(e){var t=e.target.value;this.model.set("secretUri",t,{silent:!0}),this._clearSecureKeyErrors()},_clickOnCheckbox:function(e){var t=r()(e.target).next();t[0].disabled||(t[0].checked=!t[0].checked,t.trigger("change"))},_onCustomKeyInput:function(e){var t=e.target.selectedIndex,i=r()(".control.select.inline").find("option")[t];this.model.set("keyAlias",i.value,{silent:!0}),this.$el.find('input[name ="key-alias"]')[0].value=i.value},_onModelChange:function(){this.model.isValid(!0)}});function re(e,t){se(e,!1),e.applyEpoxyBindings(),e.notification.show({delay:!1,message:t&&t.responseJSON&&t.responseJSON.message}),e.trigger("error",e,t)}function se(e,t){r()(o().template(O.Z,{i18n:A.Z,i18n2:D.Z,model:o().extend(e.model.toJSON(),{secureKeyTypes:x.Z}),showCustomKey:t,showKeyValue:!0,exportMode:!1})).insertAfter(e.$el.find("fieldset:first"))}function oe(){var e=this.stateModel.get("warnings");return o().map(e,(function(e){return M(e)}))}function ae(e,t){t=t||"warning";var i=oe.call(this);"import.finished"!==e||o().isEmpty(i)||this.warningsDialogView.open({items:i}),this.notification.show({delay:!1,message:ie(e),type:t}),this.trigger("import:finished",this.model.get("organization")),this.model.reset(this.type,{},this.customKeyElements)}function le(){var e=this.stateModel.get("error");e.errorCode===U?this.dependentResourcesDialogView.open({items:e.parameters}):e.errorCode===K&&this.mergeTenantDialogView.open({fileTenantId:e.parameters[0],selectedTenantId:this.model.get("organization")})}function ce(e,t){return function(i){e.model.set("brokenDependencies",t),e.doImport()}}function de(e){this.model.cancel(),this.stateModel.set("phase",e)}o().extend(ne.prototype,L.Z);const ue=ne}}]);
//# sourceMappingURL=chunk.6390.js.map