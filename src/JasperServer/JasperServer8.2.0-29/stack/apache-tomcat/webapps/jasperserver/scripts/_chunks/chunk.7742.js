(self.webpackChunkjrs_ui=self.webpackChunkjrs_ui||[]).push([[7742],{37742:(e,t,i)=>{"use strict";i.r(t);var n=i(8121),a=i.n(n),s=(i(15892),i(97836)),r=i.n(s),o=i(17788),l=i(98223),u=i(33806),d=i(94277);function c(e,t){o.Z.userManager.actionFactory[e](t).invokeAction()}function h(){var e=o.Z.entityList.getSelectedEntities(),t=o.Z.userManager.options.currentUser;return e.length>0&&!!e.detect((function(e){return e.getNameWithTenant()==t}))}function E(){return!o.Z.manager.tenantsTree||null!=o.Z.manager.tenantsTree.getTenant()}function g(){return o.Z.entityList.getSelectedEntities().length>0}function _(){return o.Z.entityList.getSelectedEntities().length>0&&!h()}o.Z.userManager={Event:{USERS_ENABLED:"users:enabled",USERS_DISABLED:"users:disabled"},Action:{ENABLE_ALL:"enableAll",DISABLE_ALL:"disableAll"},initialize:function(e){l.Z.setCurrentContext("admin"),u.Z.resizeOnClient("folders","users","properties");var t=r().extend({},e,window.localContext.userMngInitOptions,{removeContextMenuTreePlugin:!0});function i(e){var t=e.memo.inputData.users;o.Z.properties.isEditMode&&o.Z.properties.changeMode(!1),1==t.length&&o.Z.entityList.selectEntity(t[0].getNameWithTenant())}o.Z.userManager.options=t,o.Z.manager.initialize(t),o.Z.manager.entityJsonToObject=function(e){return new o.Z.User(e)},o.Z.manager.relatedEntityJsonToObject=function(e){return new o.Z.Role(e)},this.userList.initialize({toolbarModel:this.actionModel,text:o.Z.manager.state.text}),o.Z.addDialog.show=function(e){this.addDialog.show(e)}.bind(this),o.Z.addDialog.hide=function(e){this.addDialog.hide(e)}.bind(this),this.properties.initialize(t),this.addDialog.initialize(),o.Z.observe("users:enabled",i.bindAsEventListener(this)),o.Z.observe("users:disabled",i.bindAsEventListener(this)),o.Z.observe("entity:deleted",(function(){o.Z.properties.hide()})),o.Z.observe("entities:deleted",(function(){o.Z.properties.hide()})),o.Z.observe("server:unavailable",function(e){var t=o.Z.manager.tenantsTree,i=t?t.getOrganization().id:null;new o.Z.User({userName:"",tenantId:i}).navigateToManager()}.bindAsEventListener(this)),(0,d.YT)()||o.Z.manager.reloadEntities()},actionModel:{ADD:{buttonId:"addNewUserBtn",action:o.Z.invokeClientAction,actionArgs:"create",test:E},ENABLE:{buttonId:"enableAllUsersBtn",action:c,actionArgs:"enableAllUsers",test:g},DISABLE:{buttonId:"disableAllUsersBtn",action:c,actionArgs:"disableAllUsers",test:function(){return o.Z.entityList.getSelectedEntities().length>0&&!h()}},DELETE:{buttonId:"deleteAllUsersBtn",action:o.Z.invokeClientAction,actionArgs:"deleteAll",test:_}},validators:{}},o.Z.canDeleteAllUsers=_,o.Z.canAddUser=E,o.Z.canEnableAllUsers=g,o.Z.isLoggedInUserSelected=h,o.Z.invokeUserAction=function(e,t){o.Z.userActionFactory[e](t).invokeAction()},o.Z.invokeUserManagerAction=c;const p=o.Z;var m=i(72157),A=i.n(m);p.userActionFactory={enableAll:function(e){var t=e.users,i={userNames:Object.toJSON(t.collect((function(e){return e.getNameWithTenant()})))},n=new p.ServerAction("enableAll",i);return n.onSuccess=function(t){p.fire(p.userManager.Event.USERS_ENABLED,{inputData:e,responseData:t})},n.onError=function(t){p.fire(p.Event.SERVER_ERROR,{inputData:e,responseData:t})},n.beforeInvoke=function(){return p.invokeClientAction("cancelIfEdit",{entity:t[0]})},n},disableAll:function(e){var t=e.users,i={userNames:Object.toJSON(t.collect((function(e){return e.getNameWithTenant()})))},n=new p.ServerAction("disableAll",i);return n.onSuccess=function(t){p.fire(p.userManager.Event.USERS_DISABLED,{inputData:e,responseData:t})},n.onError=function(t){p.fire(p.Event.SERVER_ERROR,{inputData:e,responseData:t})},n.beforeInvoke=function(){return p.invokeClientAction("cancelIfEdit",{entity:t[0]})},n}},p.userManager.actionFactory={enableAllUsers:function(){var e=p.entityList.getSelectedEntities();return new p.Action((function(){p.invokeUserAction(p.userManager.Action.ENABLE_ALL,{users:e})}))},disableAllUsers:function(){var e=p.entityList.getSelectedEntities();return new p.Action((function(){p.invokeUserAction(p.userManager.Action.DISABLE_ALL,{users:e})}))},login:function(e){var t=e.user;return new p.Action((function(){A()("#j_username")[0].setValue(t.getNameWithTenant()),A()("#loginAsForm")[0].submit()}))}};const f=p;var N=i(13609);A().jCryption.encryptKeyWithoutRedundancy=function(e,t,i){if(""===e)return A().isFunction(i)?void i(e):e;for(var n=0;n<e.length;n++)e.charCodeAt(n);for(var a,s,r,o,l,u=[],d=0;d<e.length;)u[d]=e.charCodeAt(d),d++;for(;u.length%t.chunkSize!=0;)u[d++]=0;a=u,o=0,l="",setTimeout((function e(){r=new N.tk,s=0;for(var n=o;n<o+t.chunkSize;++s)r.digits[s]=a[n++],r.digits[s]+=a[n++]<<8;var u=t.barrett.powMod(r,t.e),d=16==t.radix?(0,N.Iy)(u):(0,N.sB)(u,t.radix);if(l+=d+" ",(o+=t.chunkSize)<a.length)setTimeout(e,1);else{var c=l.substring(0,l.length-1);if(!A().isFunction(i))return c;i(c)}}),1)};const T=A();var v={encryptData:function(e,t){e?T.jCryption.getKeys("GetEncryptionKey",(function(i){var n=i,a=[];for(var s in e)a.push(s);v._encryptDataRecursive(e,a,0,n,{},t)})):t()},_encryptDataRecursive:function(e,t,i,n,a,s){if(t&&t.length!=i){var r=encodeURIComponent(e[t[i]]).split("").reverse().join("");T.jCryption.encryptKeyWithoutRedundancy(r,n,(function(r){a[t[i]]=r,t.length==i+1?s(a):v._encryptDataRecursive(e,t,i+1,n,a,s)}))}}};const R=v;var S=i(64155),I=i(42885),b=i(84612),U=i(43852),D=i(52687),w=i(56461);p.userManager.userList={CE_LIST_TEMPLATE_ID:"tabular_twoColumn",CE_ITEM_TEMPLATE_ID:"tabular_twoColumn:leaf",PRO_LIST_TEMPLATE_ID:"tabular_threeColumn",PRO_ITEM_TEMPLATE_ID:"tabular_threeColumn:leaf",USER_ID_PATTERN:".ID > a",USER_NAME_PATTERN:".name",USER_ORGANIZATION_PATTERN:".organization",initialize:function(e){p.entityList.initialize({listTemplateId:(0,d.YT)()?this.PRO_LIST_TEMPLATE_ID:this.CE_LIST_TEMPLATE_ID,itemTemplateId:(0,d.YT)()?this.PRO_ITEM_TEMPLATE_ID:this.CE_ITEM_TEMPLATE_ID,onLoad:function(){p.fire(p.userManager.Event.SEARCH_NEXT,{})},onSearch:function(e){p.fire(p.userManager.Event.SEARCH,{text:e})},toolbarModel:e.toolbarModel,text:e.text}),p.entityList._createEntityItem=function(e){var t=new w.W.ListItem({label:e.userName,value:e});return t.processTemplate=function(e){var t=A()(e).find(p.userManager.userList.USER_ID_PATTERN),i=A()(e).find(p.userManager.userList.USER_NAME_PATTERN);t.html(b.Z.hardEscape(this.getValue().userName)),i.html(b.Z.hardEscape(this.getValue().fullName));var n=this.getValue().tenantId;(0,d.YT)()&&n&&A()(e).find(p.userManager.userList.USER_ORGANIZATION_PATTERN).html(b.Z.hardEscape(n));return e},t}}},p.userManager.properties={USER_NAME_PATTERN:"#userName",USER_ID_PATTERN:"#propUserID",EMAIL_PATTERN:"#email",ENABLE_USER_PATTERN:"#enableUser",EXTERNAL_USER_PATTERN:"#externalUser",PASSWORD_PATTERN:"#password",PASSWORD_CONFIRM_PATTERN:"#confirmPassword",_LOGIN_AS_USER_BUTTON:"#loginAsUser",user:null,initialize:function(e){p.properties.initialize(e._.extend({},e,{viewAssignedListTemplateDomId:"list_type_attributes",viewAssignedItemTemplateDomId:"list_type_attributes:role",searchAssigned:!1,showAssigned:!0,attributes:{context:{urlGETTemplate:"rest_v2/attributes?includeInherited=true&holder=user:{{if (tenantId) { }}/{{-tenantId}}{{ } }}/{{-userName}}&group=custom&excludeGroup=serverSettings",urlPUTTemplate:"rest_v2{{ if (tenantId) { }}/organizations/{{-tenantId}}{{ } }}/users/{{-userName}}/attributes?_embedded=permission"}}}));var t=A()("#"+p.properties._id);this.name=t.find(this.USER_NAME_PATTERN)[0],this.id=t.find(this.USER_ID_PATTERN)[0],this.email=t.find(this.EMAIL_PATTERN)[0],this.enabled=t.find(this.ENABLE_USER_PATTERN)[0],this.external=t.find(this.EXTERNAL_USER_PATTERN)[0],this.pass=t.find(this.PASSWORD_PATTERN)[0],this.confirmPass=t.find(this.PASSWORD_CONFIRM_PATTERN)[0],this.email.blurValidator=p.createRegExpValidator(this.email,"invalidEmail",a()(p.Configuration.emailRegExpPattern)),this.pass.inputValidator=p.createRegExpValidator(this.pass,"passwordIsWeak",a()(p.Configuration.passwordPattern)),this._validators=[this.email.blurValidator,this.pass.inputValidator,p.createSameValidator(this.confirmPass,this.pass,"invalidConfirmPassword")],this._initCustomEvents();var i=e.currentUser;p.properties.setProperties=function(e){var t=p.userManager.properties;t.name.setValue(e.fullName),t.id.setValue(e.userName),t.email.setValue(e.email),t.enabled.checked=e.enabled,t.external.checked=e.external,t.pass.setValue(""),t.confirmPass.setValue(""),e.external?A()(t.external).parents("fieldset").removeClass(u.Z.HIDDEN_CLASS):A()(t.external).parents("fieldset").addClass(u.Z.HIDDEN_CLASS),this.setAssignedEntities(e.roles),e.enabled&&e.getNameWithTenant()!=i?U.Z.enable(t._LOGIN_AS_USER_BUTTON):U.Z.disable(t._LOGIN_AS_USER_BUTTON),e.getNameWithTenant()!==i?U.Z.enable("#"+this._DELETE_BUTTON_ID):U.Z.disable("#"+this._DELETE_BUTTON_ID)},p.properties._deleteEntity=function(){p.invokeClientAction("delete",{entity:this._value})},p.properties._loginAsUser=function(){p.invokeUserManagerAction("login",{user:this._value})},p.properties._editEntity=function(){var e=p.userManager.properties;this._value.external?(A()(e.PASSWORD_PATTERN).parent().addClass(u.Z.HIDDEN_CLASS),A()(e.PASSWORD_CONFIRM_PATTERN).parent().addClass(u.Z.HIDDEN_CLASS)):(A()(e.PASSWORD_PATTERN).parent().removeClass(u.Z.HIDDEN_CLASS),A()(e.PASSWORD_CONFIRM_PATTERN).parent().removeClass(u.Z.HIDDEN_CLASS)),A()(e.PASSWORD_PATTERN).val(""),A()(e.PASSWORD_CONFIRM_PATTERN).val(""),this.resetValidation([e.USER_NAME_PATTERN,e.EMAIL_PATTERN,e.PASSWORD_CONFIRM_PATTERN]),this.changeReadonly(!0,[e.USER_NAME_PATTERN,e.EMAIL_PATTERN]);var t=this._value.getNameWithTenant()!==i;this.changeDisable(t,[e.ENABLE_USER_PATTERN])},p.properties._showEntity=function(){var e=p.userManager.properties;this.resetValidation([e.USER_NAME_PATTERN,e.EMAIL_PATTERN,e.PASSWORD_CONFIRM_PATTERN]),this.changeReadonly(!1,[e.USER_NAME_PATTERN,e.EMAIL_PATTERN]),this.changeDisable(!1,[e.ENABLE_USER_PATTERN])},p.properties.validate=function(){var e=p.userManager.properties;return!!S.n4K.validateLegacy(e._validators)||(D.Z.systemConfirm.show(p.messages.validationErrors,2e3),!1)},p.properties.isChanged=function(){var e=p.userManager.properties,t=this._value,i=e._toUser(),n=p.properties.attributesFacade,a=n&&n.containsUnsavedItems();return this.isEditMode&&(a||t.fullName!=i.fullName||t.email!=i.email||t.enabled!=i.enabled||t.password!=i.password||t.confirmPassword!=i.confirmPassword||this.getAssignedEntities().length>0||this.getUnassignedEntities().length>0)},p.properties.save=function(){var e=p.userManager.properties,t=this;e._toUser((function(e,i){t._value.tenantId&&(e.tenantId=t._value.tenantId,i.tenantId=t._value.tenantId),e.roles=t.getAssignedEntities(),i.roles=t.getAssignedEntities(),p.invokeServerAction("update",{entityName:t._value.getNameWithTenant(),entity:e,unencryptedEntity:i,assigned:t.getAssignedEntities(),unassigned:t.getUnassignedEntities()}),p.properties.changeMode(!1)}))},p.properties.cancel=function(){var e=new(A().Deferred);return this.setProperties(this._value),this.attributesFacade?this.attributesFacade.cancel():e.resolve()}},_initCustomEvents:function(e){var t=A()("#"+p.properties._id),i=A()("#moveButtons, #userEnable"),n=A()("#editRoles").find("#assigned, #available");this.id.regExp=new RegExp(p.Configuration.userNameNotSupportedSymbols),this.id.unsupportedSymbols=new I.Z(p.Configuration.userNameNotSupportedSymbols).getRepresentedString(),t.on("keyup",function(e){var t=e.target;t.inputValidator&&S.n4K.validateLegacy(t.inputValidator),t==this.id&&(S.n4K.validateLegacy([p.createInputRegExValidator(t)]),e.stopPropagation()),p.properties._toggleButton()}.bind(this)),i.on("click",(function(e){p.properties._toggleButton()})),n.on("dblclick",(function(){p.properties._toggleButton()})),A()(this.email).on("blur",(function(e){var t=e.target;if(t.blurValidator){if(!S.n4K.validateLegacy(t.blurValidator))return t.inputValidator=t.blurValidator,t.focus(),!1;t.inputValidator&&(t.inputValidator=null)}})),A()("#"+p.properties._BUTTONS_CONTAINER_ID).on("click",function(e){var t=(0,S.BwZ)(e.target,[u.Z.BUTTON_PATTERN],!0),i=A()(this._LOGIN_AS_USER_BUTTON)[0];t!=i||U.Z.isDisabled(i)||p.properties._loginAsUser()}.bind(this))},_toUser:function(e){if(!e)return new p.User({fullName:A()(this.name).val(),userName:A()(this.id).val(),email:A()(this.email).val(),enabled:this.enabled.checked,external:this.external.checked,password:A()(this.pass).val(),confirmPassword:A()(this.confirmPass).val()});var t=new p.User({fullName:A()(this.name).val(),userName:A()(this.id).val(),email:A()(this.email).val(),enabled:this.enabled.checked,external:this.external.checked,password:"",confirmPassword:""});if(window.isEncryptionOn){var i=this,n={};n[this.pass.id]=this.pass.getValue(),n[this.confirmPass.id]=this.confirmPass.getValue(),R.encryptData(n,(function(n){if(!n)throw new Error("No encrypted data found.");A()("#"+i.pass.id).val(n[i.pass.id]),A()("#"+i.confirmPass.id).val(n[i.confirmPass.id]);var a=new p.User({fullName:i.name.getValue(),userName:i.id.getValue(),email:i.email.getValue(),enabled:i.enabled.checked,external:i.external.checked,password:n[i.pass.id]});e(a,t)}))}else t.password=this.pass.getValue(),e(t,t)}},p.userManager.addDialog={_ADD_USER_ID:"addUser",_ADD_BUTTON_ID:"addUserBtn",_CANCEL_BUTTON_ID:"cancelUserBtn",_FULL_NAME_ID:"addUserFullName",_USER_NAME_ID:"addUserID",_USER_EMAIL_ID:"addUserEmail",_ENABLE_USER_ID:"addUserEnableUser",_PASSWORD_ID:"addUserPassword",_CONFIRM_PASSWORD_ID:"addUserConfirmPassword",_ADD_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addUser=A()("#"+this._ADD_USER_ID)[0],this.addBtn=A()("#"+this._ADD_BUTTON_ID)[0],this.cancelBtn=A()("#"+this._CANCEL_BUTTON_ID)[0],this.fullName=A()("#"+this._FULL_NAME_ID)[0],this.userName=A()("#"+this._USER_NAME_ID)[0],this.userEmail=A()("#"+this._USER_EMAIL_ID)[0],this.enableUser=A()("#"+this._ENABLE_USER_ID)[0],this.password=A()("#"+this._PASSWORD_ID)[0],this.confirmPassword=A()("#"+this._CONFIRM_PASSWORD_ID)[0],this.userName.regExp=new RegExp(p.Configuration.userNameNotSupportedSymbols),this.userName.regExpForReplacement=new RegExp(p.Configuration.userNameNotSupportedSymbols,"g"),this.userName.unsupportedSymbols=new I.Z(p.Configuration.userNameNotSupportedSymbols).getRepresentedString(),this.userName.inputValidator=p.createInputRegExValidator(this.userName),this.userEmail.blurValidator=p.createRegExpValidator(this.userEmail,"invalidEmail",a()(p.Configuration.emailRegExpPattern)),this.password.inputValidator=p.createRegExpValidator(this.password,"passwordIsWeak",a()(p.Configuration.passwordPattern)),this.confirmPassword.blurValidator=p.createSameValidator(this.confirmPassword,this.password,"invalidConfirmPassword"),this._validators=[p.createBlankValidator(this.userName,"userNameIsEmpty"),p.createBlankValidator(this.password,"passwordIsEmpty",(function(e){e.element.inputValidator=null}),(function(e){e.element.inputValidator=e})),this.confirmPassword.blurValidator,this.userEmail.blurValidator,this.password.inputValidator,this.userName.inputValidator],this.addUser.observe("keyup",function(e){var t=e.target;t.inputValidator&&S.n4K.validateLegacy(t.inputValidator),t==this.userName?t.changedByUser||(t.changedByUser=t.getValue()!=t.prevValue):t==this.fullName&&(this.userName.changedByUser||(this.userName.regExp.test(this.fullName.getValue())?this.userName.setValue(t.getValue().replace(this.userName.regExpForReplacement,"_")):this.userName.setValue(t.getValue())),e.stopPropagation())}.bindAsEventListener(this)),[this.userEmail,this.confirmPassword].invoke("observe","blur",(function(e){var t=e.target;if(t.blurValidator){if(!S.n4K.validateLegacy(t.blurValidator))return t.inputValidator=t.blurValidator,!1;t.inputValidator&&(t.inputValidator=null)}})),this.addUser.observe("keydown",function(e){var t=e.target;this.userName==t&&(this.userName.prevValue=this.userName.getValue())}.bindAsEventListener(this)),this.addUser.observe("click",function(e){var t=(0,S.BwZ)(e.target,[u.Z.BUTTON_PATTERN],!0);t==this.addBtn?this._doAdd():t==this.cancelBtn&&this.hide()}.bindAsEventListener(this))},_hideValidationErrors:function(){[this.fullName,this.userName,this.password,this.confirmPassword,this.userEmail].each((function(e){S.n4K.hideError(e,!0),e.changedByUser=!1}))},show:function(e){this.organization=e,this._hideValidationErrors();var t=A()(this.addBtn).find(this._ADD_BUTTON_TITLE_PATTERN)[0];if(t){var i=this.organization&&!this.organization.isRoot()?p.getMessage("addUserTo",{organizationName:p.truncateOrgName(this.organization.id)}):p.getMessage("addUser");t.update(i)}this.addBtn.title=this.organization&&!this.organization.isRoot()?p.getMessage("addUserTo",{organizationName:this.organization.id}):p.getMessage("addUser"),D.Z.popup.show(this.addUser,!0);try{this.fullName.focus()}catch(e){}},hide:function(){D.Z.popup.hide(this.addUser),this.userName.setValue(""),this.fullName.setValue(""),this.userEmail.setValue(""),this.enableUser.checked=!0,this.password.setValue(""),this.confirmPassword.setValue("")},_validate:function(){return S.n4K.validateLegacy(this._validators)},_autoFill:function(){},_doAdd:function(){if(this._validate()){var e,t=this;window.isEncryptionOn&&(e={pswd:this.password.getValue()}),R.encryptData(e,(function(e){var i=t.password.getValue();e&&e.pswd&&(i=e.pswd);var n=p.Configuration.userDefaultRole,a=new p.User({userName:t.userName.getValue(),fullName:t.fullName.getValue(),email:t.userEmail.getValue(),enabled:t.enableUser.checked,password:i,roles:n?[{roleName:n}]:[]});t.organization&&!t.organization.isRoot()&&(a.tenantId=t.organization.id),p.invokeServerAction(p.ActionMap.EXIST,{entity:a,onExist:function(){S.n4K.showError(this.userName,p.messages.userNameIsAlreadyInUse)}.bind(t),onNotExist:function(){S.n4K.hideError(t.userName),p.invokeServerAction(p.ActionMap.CREATE,{entity:a})}.bind(t)})}))}}};const P=p,L=Object.assign(p,f,P);var V=i(71914),M=i(62024),C=i(18580),y=i(37697),Z=i(29338),O=i(44474),B=i(14623),x=i(45663),k=i.n(x),z=i(69623),W=i(36342);const F=k().Controller.extend({initialize:function(e){e=e||{};var t=r().extend({},e,e.designer),i=r().extend({},e,e.viewer);this.designer=(0,z.Z)(t.type,t),this.viewer=new W.Z(i),this.listenTo(this.designer,"change",this._triggerChangeEvent),this.setCurrentView()},render:function(e){return this.getCurrentView().render(e),this},getCurrentView:function(){return this.currentView},cancel:function(){return this.currentView.revertChanges()},containsUnsavedItems:function(){return this.currentView.containsUnsavedItems&&this.currentView.containsUnsavedItems()},setCurrentView:function(e){this.currentView=e||this.viewer},toggleMode:function(e,t){this.getCurrentView().hide(),this.setCurrentView(e?this.designer:this.viewer),this.render(t).getCurrentView().show()},_triggerChangeEvent:function(){this.trigger("change",this.containsUnsavedItems())}});var K=i(55894);i(95952);void 0===L.messages&&(L.messages={}),void 0===L.Configuration&&(L.Configuration={}),r().extend(window.localContext,V.Z.userManagement.localContext),r().extend(L.messages,V.Z.userManagement.orgModule.messages),r().extend(L.Configuration,V.Z.userManagement.orgModule.Configuration),L.userManager.initialize({_:r(),i18n:M.Z,i18n2:C.Z,attributesViewOptionsFactory:O.Z,AttributesViewFacade:F,scrollEventTrait:B.Z,attributesTypesEnum:y.Z,ConfirmationDialog:Z.Z,TenantsTreeView:K.Z})}}]);
//# sourceMappingURL=chunk.7742.js.map