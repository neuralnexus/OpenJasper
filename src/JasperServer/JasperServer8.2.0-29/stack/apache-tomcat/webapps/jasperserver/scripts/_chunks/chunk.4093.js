(self.webpackChunkjrs_ui=self.webpackChunkjrs_ui||[]).push([[4093],{94093:(e,t,i)=>{"use strict";i.r(t);var n=i(97836),o=i.n(n),a=i(17788),r=i(33806),s=i(98223),l=i(94277);function d(){return!a.Z.roleManager.tenantsTree||null!=a.Z.roleManager.tenantsTree.getTenant()}function u(e){return(e=e||a.Z.properties.getValue()).tenantId||a.Z.manager.isUserSuperuser()&&!o().contains(a.Z.systemRoles,e.roleName)}function g(){var e=a.Z.entityList.getSelectedEntities();return e.length>0&&!e.detect((function(e){return!u(e)}))}a.Z.roleManager={Event:{},Action:{},initialize:function(e){r.Z.resizeOnClient("folders","roles","properties"),s.Z.setCurrentContext("admin");var t=o().extend(e,window.localContext.roleMngInitOptions,{removeContextMenuTreePlugin:!0});a.Z.manager.initialize(t),a.Z.manager.entityJsonToObject=function(e){return new a.Z.Role(e)},a.Z.manager.relatedEntityJsonToObject=function(e){return new a.Z.User(e)},this.roleList.initialize({toolbarModel:this.actionModel,text:a.Z.manager.state.text}),a.Z.addDialog.show=function(e){this.addDialog.show(e)}.bind(this),a.Z.addDialog.hide=function(e){this.addDialog.hide(e)}.bind(this),this.properties.initialize(),this.addDialog.initialize(),a.Z.observe("server:unavailable",function(e){var t=a.Z.manager.tree,i=t?t.getOrganization().id:null;new a.Z.Role({roleName:"",tenantId:i}).navigateToManager()}.bindAsEventListener(this)),a.Z.observe("entity:deleted",(function(){a.Z.properties.hide()})),a.Z.observe("entities:deleted",(function(){a.Z.properties.hide()})),(0,l.YT)()||a.Z.manager.reloadEntities()},actionModel:{ADD:{buttonId:"addNewRoleBtn",action:a.Z.invokeClientAction,actionArgs:"create",test:d},DELETE:{buttonId:"deleteAllRolesBtn",action:a.Z.invokeClientAction,actionArgs:"deleteAll",test:g}}},a.Z.canDeleteRole=u,a.Z.canEditRole=function(e){return(e=e||a.Z.properties.getValue()).tenantId||a.Z.manager.isUserSuperuser()},a.Z.canAddRole=d,a.Z.canDeleteAllRoles=g;const h=a.Z;h.roleActionFactory={},h.roleManager.actionFactory={};const E=h;var p=i(56461),_=i(42885),c=i(52687),T=i(64155),N=i(72157),m=i.n(N);h.roleManager.roleList={CE_LIST_TEMPLATE_ID:"tabular_oneColumn:roles",CE_ITEM_TEMPLATE_ID:"tabular_oneColumn:roles:leaf",PRO_LIST_TEMPLATE_ID:"tabular_twoColumn:roles",PRO_ITEM_TEMPLATE_ID:"tabular_twoColumn:roles:leaf",ROLE_ID_PATTERN:".ID",ROLE_ORGANIZATION_PATTERN:".organization",initialize:function(e){h.entityList.initialize({listTemplateId:(0,l.YT)()?this.PRO_LIST_TEMPLATE_ID:this.CE_LIST_TEMPLATE_ID,itemTemplateId:(0,l.YT)()?this.PRO_ITEM_TEMPLATE_ID:this.CE_ITEM_TEMPLATE_ID,toolbarModel:e.toolbarModel,text:e.text}),h.entityList._createEntityItem=function(e){var t=new p.W.ListItem({label:e.roleName,value:e});return t.processTemplate=function(e){m()(e).find(h.roleManager.roleList.ROLE_ID_PATTERN)[0].update(this.getValue().roleName);var t=this.getValue().tenantId;(0,l.YT)()&&t&&m()(e).find(h.roleManager.roleList.ROLE_ORGANIZATION_PATTERN)[0].update(t);return e},t}}},h.roleManager.properties={ROLE_NAME_PATTERN:"#roleName",EXTERNAL_ROLE_PATTERN:"#externalRole",role:null,initialize:function(){h.properties.initialize({viewAssignedListTemplateDomId:"list_responsive_fields",viewAssignedItemTemplateDomId:"list_responsive_fields:leaf",searchAssigned:!0,showAssigned:!0});var e=m()("#"+h.properties._id);this.roleName=e.find(this.ROLE_NAME_PATTERN)[0],this.external=e.find(this.EXTERNAL_ROLE_PATTERN)[0],this.roleName.regExp=new RegExp(h.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new _.Z(h.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=h.createInputRegExValidator(this.roleName),this._validators=[h.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],this._initCustomEvents(),h.properties.setProperties=function(e){var t=h.roleManager.properties;t.roleName.setValue(e.roleName),t.external.checked=e.external,e.external?m()(t.external).parents("fieldset").removeClass(r.Z.HIDDEN_CLASS):m()(t.external).parents("fieldset").addClass(r.Z.HIDDEN_CLASS),h.invokeServerAction(h.ActionMap.SEARCH_ASSIGNED,{text:""})},h.properties._deleteEntity=function(){h.invokeClientAction(h.ActionMap.DELETE,{entity:this._value})},h.properties._editEntity=function(){var e=h.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!0,[e.ROLE_NAME_PATTERN])},h.properties._showEntity=function(){var e=h.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!1,[e.ROLE_NAME_PATTERN])},h.properties.validate=function(){var e=h.roleManager.properties,t=e._toRole(this._value.tenantId);if(t.roleName!=this._value.roleName)return T.n4K.validateLegacy(e._validators)&&h.invokeServerAction(h.ActionMap.EXIST,{entity:t,onExist:function(){T.n4K.showError(e.roleName,h.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){T.n4K.hideError(e.roleName),this.save(t)}.bind(this)});this.save(t)},h.properties.isChanged=function(){var e=h.roleManager.properties,t=this._value,i=e._toRole();return this.isEditMode&&(t.roleName!=i.roleName||this.getAssignedEntities().length>0||this.getUnassignedEntities().length>0)},h.properties.save=function(e){h.invokeServerAction("update",{entityName:this._value.getNameWithTenant(),entity:e,assigned:this.getAssignedEntities(),unassigned:this.getUnassignedEntities()})},h.properties.cancel=function(){var e=new(m().Deferred);return this.setProperties(this._value),e.resolve()},h.properties.canEdit=function(){return null==this._value||h.canEditRole(this._value)},h.properties.canDelete=function(){return null==this._value||h.canDeleteRole(this._value)}},_initCustomEvents:function(e){var t=m()("#"+h.properties._id),i=m()("#moveButtons, #userEnable"),n=m()("#editUsers").find("#assigned, #available");t.on("keyup",function(e){var t=e.target;t==this.roleName&&(T.n4K.validateLegacy([t.inputValidator]),e.stopPropagation()),h.properties._toggleButton()}.bind(this)),i.on("click",(function(e){h.properties._toggleButton()})),n.on("dblclick",(function(){h.properties._toggleButton()}))},_toRole:function(e){var t=m()("#"+h.properties._id),i=new h.Role({roleName:t.find(this.ROLE_NAME_PATTERN).val()});return e&&(i.tenantId=e),i.users=h.properties.getAssignedEntities(),i}},h.roleManager.addDialog={ADD_ROLE_ID:"addRole",ADD_ROLE_BUTTON_ID:"addRoleBtn",CANCEL_ROLE_BUTTON_ID:"cancelAddRoleBtn",ADD_ROLE_NAME_ID:"addRoleName",ADD_ROLE_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addRole=m()("#"+this.ADD_ROLE_ID)[0],this.addBtn=m()("#"+this.ADD_ROLE_BUTTON_ID)[0],this.cancelBtn=m()("#"+this.CANCEL_ROLE_BUTTON_ID)[0],this.roleName=m()("#"+this.ADD_ROLE_NAME_ID)[0],this.roleName.regExp=new RegExp(h.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new _.Z(h.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=h.createInputRegExValidator(this.roleName),this._validators=[h.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],m()(this.addRole).on("keyup",function(e){var t=e.target;t==this.roleName&&(T.n4K.validateLegacy([t.inputValidator]),e.stopPropagation())}.bind(this)),m()(this.addRole).on("click",function(e){var t=(0,T.BwZ)(e.target,[r.Z.BUTTON_PATTERN],!0);t==this.addBtn?this._doAdd():t==this.cancelBtn&&this.hide()}.bind(this))},show:function(e){this.organization=e,T.n4K.hideError(this.roleName);var t=m()(this.addBtn).find(this.ADD_ROLE_BUTTON_TITLE_PATTERN)[0];if(t){var i=this.organization&&!this.organization.isRoot()?h.getMessage("addRoleTo",{organizationName:h.truncateOrgName(this.organization.id)}):h.getMessage("addRole");t.update(i)}this.addBtn.title=this.organization&&!this.organization.isRoot()?h.getMessage("addRoleTo",{organizationName:this.organization.id}):h.getMessage("addRole"),c.Z.popup.show(this.addRole,!0);try{this.roleName.focus()}catch(e){}},hide:function(){c.Z.popup.hide(this.addRole),m()(this.roleName).val("")},_validate:function(){return T.n4K.validateLegacy(this._validators)},_doAdd:function(){if(this._validate()){var e=new h.Role({roleName:m()(this.roleName).val()});this.organization&&!this.organization.isRoot()&&(e.tenantId=this.organization.id),h.invokeServerAction(h.ActionMap.EXIST,{entity:e,onExist:function(){T.n4K.showError(this.roleName,h.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){T.n4K.hideError(this.roleName),h.invokeServerAction(h.ActionMap.CREATE,{entity:e})}.bind(this)})}}};const R=h,A=Object.assign(E,R,h);var v=i(71914),f=i(55894);i(95952);void 0===A.messages&&(A.messages={}),void 0===A.Configuration&&(A.Configuration={}),o().extend(window.localContext,v.Z.roleManagement.localContext),o().extend(A.messages,v.Z.roleManagement.orgModule.messages),o().extend(A.Configuration,v.Z.roleManagement.orgModule.Configuration),A.roleManager.initialize({TenantsTreeView:f.Z})}}]);
//# sourceMappingURL=chunk.4093.js.map