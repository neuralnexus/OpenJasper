{"version":3,"sources":["webpack://jrs-ui/../bi-report/src/bi/report/jive/view/BaseJiveComponentView.js","webpack://jrs-ui/../bi-report/src/bi/report/jive/view/FusionComponentView.js","webpack://jrs-ui/../bi-report/src/bi/report/loader/scriptLoader.js"],"names":["localLogger","logger","Backbone","initialize","options","this","stateModel","report","debug","arguments","getReportId","id","setDataReportId","$el","attr","getReportContainer","$","scale","scaleFactor","model","set","render","renderDeferred","resolve","detachEvents","remove","_applyScaleTransform","$container","origin","transform","browserDetection","filter","css","FusionElement","config","parent","loader","fusionInstance","_init","prototype","scriptPath","self","instData","instanceData","document","getElementById","jrsConfigs","loadScript","then","window","printRequest","FusionCharts","fcConfig","type","width","height","renderAt","dataFormat","dataSource","items","dispose","addEventListener","event","eventArgs","renderer","sender","setChartAttribute","handler","linksOptions","events","click","call","setTransparent","transparent","BaseJiveComponentView","dfd","linkOptions","collection","data","_","toJSON","chart","get","fusionElement","LOAD_TIMEOUT_MILLIS","Number","process","urlCache","url","cache","prefix","scriptProps","cacheKey","result","Promise","reject","script","createElement","props","charset","timeout","Object","keys","forEach","p","src","onScriptError","onerror","onload","clearTimeout","scriptTimeout","setTimeout","Error","head","appendChild"],"mappings":"yKAWIA,E,SAAcC,WAAgB,yBAElC,QAAeC,gBAAqB,CAChCC,WAAY,SAAUC,GAClBC,KAAKC,WAAaF,EAAQE,WAC1BD,KAAKE,OAASH,EAAQG,OACtBP,EAAYQ,MAAM,mBAAoBH,MACtCH,oCAAyCG,KAAMI,YAGnDC,YAAa,WACT,OAAOL,KAAKE,QAAUF,KAAKE,OAAOI,IAGtCC,gBAAiB,SAAUC,EAAKF,GAC5BE,EAAIC,KAAK,gBAAiBH,IAG9BI,mBAAoB,SAAUJ,GAC1B,OAAOK,IAAE,qBAAwBL,EAAK,OAG1CM,MAAO,SAAUC,GACbb,KAAKc,MAAMC,IAAI,cAAeF,IAGlCG,OAAQ,SAAUR,GACd,IAAIS,EAAiB,IAAIN,cAEzB,OADAM,EAAeC,UACRD,GAGXE,aAAc,aAEdC,OAAQ,WACJpB,KAAKmB,eACLtB,gCAAqCG,KAAMI,YAE/CiB,qBAAsB,SAAUC,EAAYT,GACxC,IAAID,EAAQ,SAAWC,EAAc,IAAKU,EAAS,MAAOC,EAAY,CAClE,oBAAqBZ,EACrB,2BAA4BW,EAC5B,iBAAkBX,EAClB,wBAAyBW,EACzB,gBAAiBX,EACjB,uBAAwBW,EACxB,eAAgBX,EAChB,sBAAuBW,EACvB,UAAaX,EACb,mBAAoBW,GAGpBE,cACAD,EAAUE,OAAS,gDAAkDb,EAAc,uBAAyBA,EAAc,iCAE9HS,EAAWK,IAAIH,O,wIChDnBI,EAAgB,SAAUC,GAC1B7B,KAAK6B,OAASA,EACd7B,KAAK8B,OAAS,KACd9B,KAAK+B,OAAS,KACd/B,KAAKgC,eAAiB,KACtBhC,KAAKiC,SAETL,EAAcM,UAAY,CAEtBD,MAAO,WAAY,IAbbE,EAaa,OACTC,EAAOpC,KACPqC,EAAWrC,KAAK6B,OAAOS,aAExBC,SAASC,eAAeH,EAAS/B,MAjBpC6B,EAAa,GAAH,OAAMM,gBAAN,YAHc,2BAIvBC,OAAWP,IAiBSQ,MAAK,WACe,mBAAxBC,OAAOC,cAEdD,OAAOC,eAGX,IAAMC,EAAeF,OAAOE,aAEtBC,EAAW,CACbzC,GAAI+B,EAAS/B,GACb0C,KAAMX,EAASW,KACfC,MAAOZ,EAASY,MAChBC,OAAQb,EAASa,OACjBC,SAAUd,EAASc,SACnBC,WAAYf,EAASe,WACrBC,WAAYhB,EAASgB,YAIzBP,EAAaQ,MAAMP,EAASzC,KAAOwC,EAAaQ,MAAMP,EAASzC,IAAIiD,UACnE,EAAKvB,eAAiB,IAAIc,EAAaC,GACvC,EAAKf,eAAewB,iBAAiB,gBAAgB,SAAUC,EAAOC,GACvC,eAAvBA,EAAUC,UACVF,EAAMG,OAAOC,kBAAkB,gBAAiB,QAGxD,EAAK7B,eAAewB,iBAAiB,6BAA6B,SAAUC,EAAOC,GAC/E,IAAII,EACJ1B,EAAKP,OAAOkC,aAAaC,SAAWF,EAAU1B,EAAKP,OAAOkC,aAAaC,OAAOC,OAC9EH,GAAWA,EAAQI,KAAKlE,KAAMyD,EAAOC,MAEzC,EAAK1B,eAAemC,eAAe9B,EAAS+B,aAC5C,EAAKpC,eAAehB,aAIhCI,OAAQ,WACJpB,KAAKgC,gBAAkBhC,KAAKgC,eAAeuB,YAGnD,QAAec,WAA6B,CACxCrD,OAAQ,SAAUR,GACd,IAAI8D,EAAM,IAAI3D,cAAc4D,EAAcvE,KAAKc,MAAM0D,WAAaxE,KAAKc,MAAM0D,WAAWD,YAAc,KAAME,EAAOC,WAAS1E,KAAKc,MAAM6D,SAAU,CAAEC,MAAOF,UAAQ1E,KAAKC,WAAW4E,IAAI,YAMtL,OALIN,IACAE,EAAKF,YAAcA,GAEvBvE,KAAK8E,cAAgB,IAAIlD,EAAc6C,GACvCH,EAAIpD,UACGoD,GAEXlD,OAAQ,WACJpB,KAAK8E,eAAiB9E,KAAK8E,cAAc1D,SACzCiD,2BAA6CrE,KAAMI,e,8CC7D3D,IAAM2E,EAA0E,IAApDC,OAAOC,MAE7BC,EAAW,GAEJxC,EAAa,SAACyC,GAA4D,6DAAP,GAAO,IAAtDC,aAAsD,aAAxCC,cAAwC,MAA/B,GAA+B,MAA3BC,mBAA2B,MAAb,GAAa,EAC7EC,EAAWF,EAASF,EAG1B,GAAIC,GAASF,EAASK,GAClB,OAAOL,EAASK,GAGpB,IAAMC,EAAS,IAAIC,SAAS,SAACvE,EAASwE,GAClC,IAAMC,EAASpD,SAASqD,cAAc,UAEhCC,EAAQ,OAAH,QACPC,QAAS,QACTC,QAAShB,GACNO,GAGPU,OAAOC,KAAKJ,GAAOK,SAAQ,SAAAC,GAAC,OAAIR,EAAOQ,GAAKN,EAAMM,MAElDR,EAAOS,IAAMjB,EAEb,IAOMkB,EAAgB,WAClBV,EAAOW,QAAU,KACjBX,EAAOY,OAAS,KAChBC,aAAaC,GACbf,EAAM,WAAN,cAGEe,EAAgBC,YAAW,WAC7BL,EAAc,IAAIM,MAAJ,sCAAyCxB,OACxDU,EAAME,SAETJ,EAAOW,QAAUD,EACjBV,EAAOY,OAnBkB,WACrBZ,EAAOW,QAAU,KACjBX,EAAOY,OAAS,KAChBC,aAAaC,GACbvF,KAiBJqB,SAASqE,KAAKC,YAAYlB,MAK9B,OAFAT,EAASK,GAAYC,EAEdA","file":"_chunks/chunk.1381.js","sourcesContent":["/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.\n * Licensed pursuant to commercial TIBCO End User License Agreement.\n */\n\nimport Backbone from 'backbone';\nimport $ from 'jquery';\nimport browserDetection from 'js-sdk/src/common/util/browserDetection';\n\nimport logger from \"js-sdk/src/common/logging/logger\";\n\nlet localLogger = logger.register(\"BaseJiveComponentView\");\n\nexport default Backbone.View.extend({\n    initialize: function (options) {\n        this.stateModel = options.stateModel;\n        this.report = options.report;\n        localLogger.debug('Create jive view', this);\n        Backbone.View.prototype.initialize.apply(this, arguments);\n    },\n    //protected\n    getReportId: function () {\n        return this.report && this.report.id;\n    },\n    //protected\n    setDataReportId: function ($el, id) {\n        $el.attr('data-reportId', id);\n    },\n    //protected\n    getReportContainer: function (id) {\n        return $('[data-reportId = \\'' + id + '\\']');\n    },\n    //optional\n    scale: function (scaleFactor) {\n        this.model.set('scaleFactor', scaleFactor);\n    },\n    // should be overridden; each implementation should return a deferred object\n    render: function ($el) {\n        var renderDeferred = new $.Deferred();\n        renderDeferred.resolve();\n        return renderDeferred;\n    },\n    // should be overridden, optional\n    detachEvents: function () {\n    },\n    remove: function () {\n        this.detachEvents();\n        Backbone.View.prototype.remove.apply(this, arguments);\n    },\n    _applyScaleTransform: function ($container, scaleFactor) {\n        var scale = 'scale(' + scaleFactor + ')', origin = '0 0', transform = {\n            '-webkit-transform': scale,\n            '-webkit-transform-origin': origin,\n            '-moz-transform': scale,\n            '-moz-transform-origin': origin,\n            '-ms-transform': scale,\n            '-ms-transform-origin': origin,\n            '-o-transform': scale,\n            '-o-transform-origin': origin,\n            'transform': scale,\n            'transform-origin': origin\n        };    // transform: scale, analog for IE8 and lower.\n        // transform: scale, analog for IE8 and lower.\n        if (browserDetection.isIE8()) {\n            transform.filter = 'progid:DXImageTransform.Microsoft.Matrix(M11=' + scaleFactor + ', M12=0, M21=0, M22=' + scaleFactor + ', SizingMethod=\\'auto expand\\')';\n        }\n        $container.css(transform);\n    }\n});","/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.\n * Licensed pursuant to commercial TIBCO End User License Agreement.\n */\n\nimport _ from 'underscore';\nimport $ from 'jquery';\nimport BaseJiveComponentView from './BaseJiveComponentView';\nimport jrsConfigs from 'js-sdk/src/jrs.configs';\nimport {loadScript} from '../../loader/scriptLoader';\n\nconst FUSION_CHARTS_SCRIPT_PATH = 'fusion/fusioncharts.js';\n\nconst loadFusionCharts = () => {\n    const scriptPath = `${jrsConfigs.contextPath}/${FUSION_CHARTS_SCRIPT_PATH}`;\n    return loadScript(scriptPath);\n}\n\nvar FusionElement = function (config) {\n    this.config = config;\n    this.parent = null;\n    this.loader = null;\n    this.fusionInstance = null;\n    this._init();\n};\nFusionElement.prototype = {\n    // internal API\n    _init: function () {\n        const self = this;\n        const instData = this.config.instanceData;\n\n        if (!document.getElementById(instData.id)) {\n            loadFusionCharts().then(() => {\n                if (typeof window.printRequest === 'function') {\n                    //FIXME: is this still necessary?\n                    window.printRequest();\n                }\n\n                const FusionCharts = window.FusionCharts;\n\n                const fcConfig = {\n                    id: instData.id,\n                    type: instData.type,\n                    width: instData.width,\n                    height: instData.height,\n                    renderAt: instData.renderAt,\n                    dataFormat: instData.dataFormat,\n                    dataSource: instData.dataSource\n                };\n                //remove instance if it already exists\n                //to avoid memory leaks\n                FusionCharts.items[fcConfig.id] && FusionCharts.items[fcConfig.id].dispose();\n                this.fusionInstance = new FusionCharts(fcConfig);\n                this.fusionInstance.addEventListener('BeforeRender', function (event, eventArgs) {\n                    if (eventArgs.renderer === 'javascript') {\n                        event.sender.setChartAttribute('exportEnabled', '0');\n                    }\n                });\n                this.fusionInstance.addEventListener('JR_Hyperlink_Interception', function (event, eventArgs) {\n                    var handler;\n                    self.config.linksOptions.events && (handler = self.config.linksOptions.events.click);\n                    handler && handler.call(this, event, eventArgs);\n                });\n                this.fusionInstance.setTransparent(instData.transparent);\n                this.fusionInstance.render();\n            });\n        }\n    },\n    remove: function () {\n        this.fusionInstance && this.fusionInstance.dispose();\n    }\n};\nexport default BaseJiveComponentView.extend({\n    render: function ($el) {\n        var dfd = new $.Deferred(), linkOptions = this.model.collection ? this.model.collection.linkOptions : null, data = _.extend(this.model.toJSON(), { chart: _.clone(this.stateModel.get('chart')) });\n        if (linkOptions) {\n            data.linkOptions = linkOptions;\n        }\n        this.fusionElement = new FusionElement(data);\n        dfd.resolve();\n        return dfd;\n    },\n    remove: function () {\n        this.fusionElement && this.fusionElement.remove();\n        BaseJiveComponentView.prototype.remove.apply(this, arguments);\n    }\n});","/*\n * Copyright (C) 2005 - 2022 TIBCO Software Inc. All rights reserved.\n * http://www.jaspersoft.com.\n *\n * Unless you have purchased a commercial license agreement from Jaspersoft,\n * the following license terms apply:\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n/*global document, process */\n\nconst LOAD_TIMEOUT_MILLIS = Number(process.env.SCRIPT_LOAD_TIMEOUT_SEC || 60) * 1000;\n\nconst urlCache = {};\n\nexport const loadScript = (url, {cache = true, prefix = '', scriptProps = {}} = {}) => {\n    const cacheKey = prefix + url;\n\n    // return promise for the cache\n    if (cache && urlCache[cacheKey]) {\n        return urlCache[cacheKey];\n    }\n\n    const result = new Promise(((resolve, reject) => {\n        const script = document.createElement('script');\n\n        const props = {\n            charset: 'utf-8',\n            timeout: LOAD_TIMEOUT_MILLIS,\n            ...scriptProps\n        }\n\n        Object.keys(props).forEach(p => script[p] = props[p]);\n\n        script.src = url;\n\n        const onScriptComplete = function () {\n            script.onerror = null;\n            script.onload = null;\n            clearTimeout(scriptTimeout);\n            resolve();\n        };\n\n        const onScriptError = function (...args) {\n            script.onerror = null;\n            script.onload = null;\n            clearTimeout(scriptTimeout);\n            reject(...args);\n        };\n\n        const scriptTimeout = setTimeout(function () {\n            onScriptError(new Error(`Load timeout for the script ${url}`));\n        }, props.timeout);\n\n        script.onerror = onScriptError\n        script.onload = onScriptComplete;\n\n        document.head.appendChild(script);\n    }))\n\n    urlCache[cacheKey] = result;\n\n    return result;\n}"],"sourceRoot":""}