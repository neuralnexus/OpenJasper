var resourceAnalysisConnection={TYPE_ID:"analysisConnection.type",LABEL_ID:"connectionLabel",RESOURCE_ID_ID:"connectionName",DESCRIPTION_ID:"connectionDescription",RESOURCE_INPUT_ID:"resourceUri",BROWSE_BUTTON_ID:"browser_button",TREE_ID:"folderTreeRepoLocation",FOLDERS_TREE_DATA_PROVIDER_ID:"repositoryExplorerTreeFoldersProvider",XMLA_CATALOG_ID:"xmlaCatalog",XMLA_DATA_SOURCE_ID:"xmlaDatasource",XMLA_CONNECTION_URI_ID:"xmlaConnectionUri",TEST_BUTTON_ID:"testXMLAConnection",NEXT_BUTTON_ID:"next",DONE_BUTTON_ID:"done",CHANGE_TYPE_BUTTON_ID:"changeCombo",_canGenerateId:!0,initialize:function(t){this._form=$(document.body).select("form")[0],this._type=$(this.TYPE_ID),this._label=$(this.LABEL_ID),this._resourceId=$(this.RESOURCE_ID_ID),this._description=$(this.DESCRIPTION_ID);var e=this._type.getValue();"olapXmlaCon"==e&&(this._xmlaCatalog=$(this.XMLA_CATALOG_ID),this._xmlaDataSource=$(this.XMLA_DATA_SOURCE_ID),this._xmlaConnectionUri=$(this.XMLA_CONNECTION_URI_ID)),this._nextButton=$(this.NEXT_BUTTON_ID),this._doneButton=$(this.DONE_BUTTON_ID),this._testButton=$(this.TEST_BUTTON_ID),this._changeTypeButton=$(this.CHANGE_TYPE_BUTTON_ID),this._isEditMode=t.isEditMode,this._label.validator=resource.labelValidator.bind(this),this._resourceId.validator=resource.resourceIdValidator.bind(this),this._description.validator=resource.descriptionValidator.bind(this),"olapXmlaCon"==e&&(this._xmlaCatalog.validator=this._xmlaCatalogValidator.bind(this),this._xmlaDataSource.validator=this._xmlaDataSourceValidator.bind(this),this._xmlaConnectionUri.validator=this._xmlaConnectionUriValidator.bind(this)),this._initResourcePicker(),this._initEvents()},_initResourcePicker:function(){new picker.FileSelector({treeId:this.TREE_ID,providerId:this.FOLDERS_TREE_DATA_PROVIDER_ID,uriTextboxId:this.RESOURCE_INPUT_ID,browseButtonId:this.BROWSE_BUTTON_ID,title:resource.messages["resource.SaveToFolder.Title"]})},_initEvents:function(){this._type.observe("change",function(){this._changeTypeButton.click()}.bindAsEventListener(this));var t=function(t){this._isDataValid()||t.stop()}.bindAsEventListener(this),e=function(t){this._isDataValid()?this.testXMLAConnection():t.stop()}.bindAsEventListener(this);this._nextButton.observe("click",t),this._doneButton.observe("click",t),this._testButton&&this._testButton.observe("click",e),this._form.observe("keyup",function(t){var e=t.element(),i=[this._label,this._resourceId,this._description,this._xmlaCatalog,this._xmlaDataSource,this._xmlaConnectionUri];i.include(e)&&(ValidationModule.validate(resource.getValidationEntries([e])),e==this._resourceId&&this._resourceId.getValue()!=resource.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),e==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(resource.generateResourceId(this._label.getValue())),ValidationModule.validate(resource.getValidationEntries([this._resourceId]))))}.bindAsEventListener(this))},testXMLAConnection:function(){var t=this._testButton,e=jQuery(this._form),i=e.serializeArray();i.push({name:"_eventId_testXMLAConnection",value:""}),ajaxTargettedUpdate(e.attr("action"),{postData:jQuery.param(i),fillLocation:"ajaxbuffer",callback:function(e){var i=jQuery(e).text();try{var s=JSON.parse(i);"OK"==s.status?ValidationModule.showSuccess(t,resource.messages.connectionStatePassed):ValidationModule.showError(t,s.message,s.details)}catch(a){dialogs.systemConfirm.show(i)}},errorHandler:baseErrorHandler,hideLoader:!1})},_isDataValid:function(){var t=[this._label,this._resourceId,this._description],e=this._type.getValue();return"olapXmlaCon"==e&&(t.push(this._xmlaCatalog),t.push(this._xmlaDataSource),t.push(this._xmlaConnectionUri)),ValidationModule.validate(resource.getValidationEntries(t))},_xmlaCatalogValidator:function(t){var e=!0,i="";return t.blank()&&(i=resource.messages.catalogIsEmpty,e=!1),{isValid:e,errorMessage:i}},_xmlaDataSourceValidator:function(t){var e=!0,i="";return t.blank()&&(i=resource.messages.dataSourceIsEmpty,e=!1),{isValid:e,errorMessage:i}},_xmlaConnectionUriValidator:function(t){var e=!0,i="";return t.blank()&&(i=resource.messages.uriIsEmpty,e=!1),{isValid:e,errorMessage:i}}};"undefined"==typeof require&&document.observe("dom:loaded",function(){resourceAnalysisConnection.initialize(localContext.initOptions)});