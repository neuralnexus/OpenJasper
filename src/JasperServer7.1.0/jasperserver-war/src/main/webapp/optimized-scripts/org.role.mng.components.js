orgModule.roleManager.roleList={CE_LIST_TEMPLATE_ID:"tabular_oneColumn:roles",CE_ITEM_TEMPLATE_ID:"tabular_oneColumn:roles:leaf",PRO_LIST_TEMPLATE_ID:"tabular_twoColumn:roles",PRO_ITEM_TEMPLATE_ID:"tabular_twoColumn:roles:leaf",ROLE_ID_PATTERN:".ID",ROLE_ORGANIZATION_PATTERN:".organization",initialize:function(e){orgModule.entityList.initialize({listTemplateId:isProVersion()?this.PRO_LIST_TEMPLATE_ID:this.CE_LIST_TEMPLATE_ID,itemTemplateId:isProVersion()?this.PRO_ITEM_TEMPLATE_ID:this.CE_ITEM_TEMPLATE_ID,toolbarModel:e.toolbarModel,text:e.text}),orgModule.entityList._createEntityItem=function(e){var t=new dynamicList.ListItem({label:e.roleName,value:e});return t.processTemplate=function(e){var t=e.select(orgModule.roleManager.roleList.ROLE_ID_PATTERN)[0];t.update(xssUtil.escape(this.getValue().roleName));var o=this.getValue().tenantId;if(isProVersion()&&o){var i=e.select(orgModule.roleManager.roleList.ROLE_ORGANIZATION_PATTERN)[0];i.update(xssUtil.escape(o))}return e},t}}},orgModule.roleManager.properties={ROLE_NAME_PATTERN:"#roleName",EXTERNAL_ROLE_PATTERN:"#externalRole",role:null,initialize:function(){orgModule.properties.initialize({viewAssignedListTemplateDomId:"list_responsive_fields",viewAssignedItemTemplateDomId:"list_responsive_fields:leaf",searchAssigned:!0,showAssigned:!0});var e=$(orgModule.properties._id);this.roleName=e.select(this.ROLE_NAME_PATTERN)[0],this.external=e.select(this.EXTERNAL_ROLE_PATTERN)[0],this.roleName.regExp=new RegExp(orgModule.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=orgModule.createInputRegExValidator(this.roleName),this._validators=[orgModule.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],this._initCustomEvents(),orgModule.properties.setProperties=function(e){var t=orgModule.roleManager.properties;t.roleName.setValue(e.roleName),t.external.checked=e.external,e.external?t.external.up("fieldset").removeClassName(layoutModule.HIDDEN_CLASS):t.external.up("fieldset").addClassName(layoutModule.HIDDEN_CLASS),invokeServerAction(orgModule.ActionMap.SEARCH_ASSIGNED,{text:""})},orgModule.properties._deleteEntity=function(){invokeClientAction(orgModule.ActionMap.DELETE,{entity:this._value})},orgModule.properties._editEntity=function(){var e=orgModule.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!0,[e.ROLE_NAME_PATTERN])},orgModule.properties._showEntity=function(){var e=orgModule.roleManager.properties;this.resetValidation([e.ROLE_NAME_PATTERN]),this.changeReadonly(!1,[e.ROLE_NAME_PATTERN])},orgModule.properties.validate=function(){var e=orgModule.roleManager.properties,t=e._toRole(this._value.tenantId);return t.roleName!=this._value.roleName?ValidationModule.validateLegacy(e._validators)&&invokeServerAction(orgModule.ActionMap.EXIST,{entity:t,onExist:function(){ValidationModule.showError(e.roleName,orgModule.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){ValidationModule.hideError(e.roleName),this.save(t)}.bind(this)}):void this.save(t)},orgModule.properties.isChanged=function(){var e=orgModule.roleManager.properties,t=this._value,o=e._toRole();return this.isEditMode&&(t.roleName!=o.roleName||this.getAssignedEntities().length>0||this.getUnassignedEntities().length>0)},orgModule.properties.save=function(e){invokeServerAction("update",{entityName:this._value.getNameWithTenant(),entity:e,assigned:this.getAssignedEntities(),unassigned:this.getUnassignedEntities()})},orgModule.properties.cancel=function(){var e=new jQuery.Deferred;return this.setProperties(this._value),e.resolve()},orgModule.properties.canEdit=function(){return null==this._value?!0:canEditRole(this._value)},orgModule.properties.canDelete=function(){return null==this._value?!0:canDeleteRole(this._value)}},_initCustomEvents:function(e){var t=$(orgModule.properties._id),o=jQuery("#moveButtons, #userEnable"),i=jQuery("#editUsers").find("#assigned, #available");t.observe("keyup",function(e){var t=e.element();t==this.roleName&&(ValidationModule.validateLegacy([t.inputValidator]),e.stop()),orgModule.properties._toggleButton()}.bindAsEventListener(this)),o.on("click",function(e){orgModule.properties._toggleButton()}),i.on("dblclick",function(){orgModule.properties._toggleButton()})},_toRole:function(e){var t=$(orgModule.properties._id),o=new orgModule.Role({roleName:t.select(this.ROLE_NAME_PATTERN)[0].getValue()});return e&&(o.tenantId=e),o.users=orgModule.properties.getAssignedEntities(),o}},orgModule.roleManager.addDialog={ADD_ROLE_ID:"addRole",ADD_ROLE_BUTTON_ID:"addRoleBtn",CANCEL_ROLE_BUTTON_ID:"cancelAddRoleBtn",ADD_ROLE_NAME_ID:"addRoleName",ADD_ROLE_BUTTON_TITLE_PATTERN:".wrap",initialize:function(){this.addRole=$(this.ADD_ROLE_ID),this.addBtn=$(this.ADD_ROLE_BUTTON_ID),this.cancelBtn=$(this.CANCEL_ROLE_BUTTON_ID),this.roleName=$(this.ADD_ROLE_NAME_ID),this.roleName.regExp=new RegExp(orgModule.Configuration.roleNameNotSupportedSymbols),this.roleName.unsupportedSymbols=new RegExpRepresenter(orgModule.Configuration.roleNameNotSupportedSymbols).getRepresentedString(),this.roleName.inputValidator=orgModule.createInputRegExValidator(this.roleName),this._validators=[orgModule.createBlankValidator(this.roleName,"roleNameIsEmpty"),this.roleName.inputValidator],this.addRole.observe("keyup",function(e){var t=e.element();t==this.roleName&&(ValidationModule.validateLegacy([t.inputValidator]),e.stop())}.bindAsEventListener(this)),this.addRole.observe("click",function(e){var t=matchAny(e.element(),[layoutModule.BUTTON_PATTERN],!0);t==this.addBtn?this._doAdd():t==this.cancelBtn&&this.hide()}.bindAsEventListener(this))},show:function(e){this.organization=e,ValidationModule.hideError(this.roleName);var t=this.addBtn.select(this.ADD_ROLE_BUTTON_TITLE_PATTERN)[0];if(t){var o=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addRoleTo",{organizationName:orgModule.truncateOrgName(this.organization.id)}):orgModule.getMessage("addRole");t.update(o)}this.addBtn.title=this.organization&&!this.organization.isRoot()?orgModule.getMessage("addRoleTo",{organizationName:this.organization.id}):orgModule.getMessage("addRole"),dialogs.popup.show(this.addRole,!0);try{this.roleName.focus()}catch(i){}},hide:function(){dialogs.popup.hide(this.addRole),this.roleName.setValue("")},_validate:function(){return ValidationModule.validateLegacy(this._validators)},_doAdd:function(){if(this._validate()){var e=new orgModule.Role({roleName:this.roleName.getValue()});this.organization&&!this.organization.isRoot()&&(e.tenantId=this.organization.id),invokeServerAction(orgModule.ActionMap.EXIST,{entity:e,onExist:function(){ValidationModule.showError(this.roleName,orgModule.messages.roleNameIsAlreadyInUse)}.bind(this),onNotExist:function(){ValidationModule.hideError(this.roleName),invokeServerAction(orgModule.ActionMap.CREATE,{entity:e})}.bind(this)})}}};