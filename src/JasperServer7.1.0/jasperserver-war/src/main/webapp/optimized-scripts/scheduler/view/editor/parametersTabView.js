define(["require","controls.options","controls.controller","jquery","underscore","bundle!all","jrs.configs","backbone","text!scheduler/template/editor/parametersTabTemplate.htm"],function(e){"use strict";e("controls.options"),e("controls.controller");var t=e("jquery"),o=e("underscore"),r=e("bundle!all"),n=e("jrs.configs"),i=e("backbone"),s=e("text!scheduler/template/editor/parametersTabTemplate.htm");return o.extend(ControlsBase,n.inputControlsConstants),i.View.extend({initialize:function(e){this.options=o.extend({},e),this.listenTo(this.model,"change:source",this.sourceChange),t(document).on("viewmodel:values:changed",o.bind(this.viewModelValuesChange,this))},render:function(){this.setElement(t(o.template(s,{i18n:r,config:n})))},saveAsDialogButtonSaveClick:function(){var e=this,o=this.reportOptionsDialog.input.getValue(),r=this.model.controlsController.getViewModel().get("selection"),n=o===this.reportOptionsDialog.optionNameToOverwrite;t.when(this.reportOptions.add(this.reportOptions.optionsUrl||this.reportOptions.url,o,r,n)).done(function(){e.reportOptionsDialog.hideWarning();var t=e.reportOptions.getElem().parent();0===t.length&&(t=e.$el.find(".saveCurrentValuesContainer"),t.prepend(e.reportOptions.getElem())),e.reportOptionsDialog.hide(),delete e.reportOptionsDialog.optionNameToOverwrite}).fail(function(r){try{var i=t.parseJSON(r.responseText);"report.options.dialog.confirm.message"===i.errorCode&&!n&&(e.reportOptionsDialog.optionNameToOverwrite=o),e.reportOptionsDialog.showWarning(i.message)}catch(s){}})},sourceChange:function(e,t){var o=t&&t.reportUnitURI,r=this.model.get("source").parameters;if(r){var n=r.parameterValues;for(var i in n)n.hasOwnProperty(i)&&null===n[i]&&delete n[i];this.reportOptions&&(this.reportOptions.url=void 0),this.model.controlsController=new JRS.Controls.Controller({reportUri:o,reportOptionUri:"",preSelectedData:n});var s=this;this.model.controlsController.fetchControlsStructure(n).done(function(){s.trigger("IC_Displayed")}).fail(function(){s.trigger("failedToGet_IC")})}},viewModelValuesChange:function(){this.model.set("source",{reportUnitURI:this.model.get("source").reportUnitURI,parameters:{parameterValues:this.model.controlsController.getViewModel().get("selection")}},{validate:!1,silent:!0})}})});