define(["require","jquery","underscore","bundle!all","backbone","!domReady","jrs.configs","scheduler/util/schedulerUtils","scheduler/model/jobModel","scheduler/view/jobsView","scheduler/view/jobEditorView"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),o=e("bundle!all"),s=e("backbone"),r=e("!domReady"),n=e("jrs.configs"),a=e("scheduler/util/schedulerUtils"),d=e("scheduler/model/jobModel"),c=e("scheduler/view/jobsView"),h=e("scheduler/view/jobEditorView");return r(function(){i.extend(ControlsBase,n.inputControlsConstants)}),s.View.extend({className:"schedulerApp",jobsView:!1,initialize:function(e){this.options=i.extend({},e),this.runInBackgroundMode=0===document.location.hash.indexOf("#runInBackground@"),a.saveCurrentLocation(),this.schedulerStartupParams=a.getParamsFromUri(),this.masterViewMode=!this.schedulerStartupParams.reportUnitURI,this.childViewInitParams={model:new d,runInBackgroundMode:this.runInBackgroundMode,masterViewMode:this.masterViewMode,reportUri:this.schedulerStartupParams.reportUnitURI,parentReportURI:this.schedulerStartupParams.parentReportURI||null},t.ajaxSetup({headers:{"X-Suppress-Basic":!0}}),t(document).on("ajaxError",function(e,t,i,o){(401===t.status||"Unauthorized"===o)&&location.reload()}),this.runInBackgroundMode?this.runNowRequest():this.openJobsListInterface()},prepareJobsView:function(){this.jobsView||(this.jobsView=new c(this.childViewInitParams),this.listenTo(this.jobsView,"createNewJobRequest",this.createNewJobRequest),this.listenTo(this.jobsView,"runNowRequest",this.runNowRequest),this.listenTo(this.jobsView,"backButtonPressed",this.backButtonPressed),this.listenTo(this.jobsView,"editJobPressed",this.openEditJobInterface))},prepareJobEditorView:function(){this.jobEditorView&&this.jobEditorView.remove(),this.jobEditorView=new h(this.childViewInitParams),this.listenTo(this.jobEditorView,"errorEditingJob",this.errorEditingJob),this.listenTo(this.jobEditorView,"cancelJobCreation",this.cancelJobCreation),this.listenTo(this.jobEditorView,"jobHasBeenCreated",this.jobHasBeenCreated)},openJobsListInterface:function(){this.prepareJobsView(),this.$el.empty(),this.jobsView.render(),this.$el.append(this.jobsView.$el),this.jobsView.refresh(),document.title=o["company.name"]+": "+o["report.scheduling.list.title"]},createNewJobRequest:function(){this._openNewJobInterface(!1)},runNowRequest:function(){this._openNewJobInterface(!0)},editJob:function(e){this.openEditJobInterface(e)},_openNewJobInterface:function(e){this.prepareJobEditorView(),this.jobEditorView.setRunNowMode(e),this.$el.empty(),this.jobEditorView.renderCreateNewJobInterface(),this.$el.append(this.jobEditorView.$el),this.jobEditorView.prepareModelForCreatingNewJob(),document.title=o["company.name"]+": "+o["report.scheduling.job.edit.title"]},openEditJobInterface:function(e){this.prepareJobEditorView(),this.$el.empty(),this.jobEditorView.editExistingJob(e),this.$el.append(this.jobEditorView.$el),document.title=o["company.name"]+": "+o["report.scheduling.job.edit.title"]},backButtonPressed:function(){a.getBackToPreviousLocation()},errorEditingJob:function(){this.openJobsListInterface()},cancelJobCreation:function(){this.runInBackgroundMode?a.getBackToPreviousLocation():this.openJobsListInterface()},jobHasBeenCreated:function(){this.runInBackgroundMode?a.getBackToPreviousLocation():this.openJobsListInterface()}})});