define(["require","jquery","underscore","bundle!all","backbone","text!scheduler/template/editor/notificationsTabTemplate.htm"],function(e){"use strict";var t=e("jquery"),a=e("underscore"),s=e("bundle!all"),n=e("backbone"),i=e("text!scheduler/template/editor/notificationsTabTemplate.htm");return n.View.extend({events:{"change [name=to_suc]":"to_suc_Change","change [name=cc_suc]":"cc_suc_Change","change [name=bcc_suc]":"bcc_suc_Change","change [name=subject_suc]":"subject_suc_Change","change [name=message_suc]":"message_suc_Change","change [name=resultSendTypeRadio]":"setResultSendType","change [name=includeHtmlReport]":"setResultSendType","change [name=dontSendEmptyReport]":"dont_send_empty_report_Change","change [name=job_status_to]":"job_status_to_Change","change [name=job_status_subject]":"job_status_subject_Change","change [name=job_status_success_message]":"job_status_success_message_Change","change [name=job_status_failed_message]":"job_status_failed_message_Change","change [name=send_success_notification]":"twoCheckboxes_Change","change [name=send_failure_notification]":"twoCheckboxes_Change","change [name=include_report]":"include_report_Change","change [name=include_stack_trace]":"include_stack_trace_Change"},initialize:function(e){var t=this;this.options=e,this.model.on("change:mailNotification",function(e){var a=e.get("mailNotification");if(a){t.$el.find("[name=to_suc]").val(a.toAddresses.address),t.$el.find("[name=cc_suc]").val(a.ccAddresses.address),t.$el.find("[name=bcc_suc]").val(a.bccAddresses.address),t.$el.find("[name=subject_suc]").val(a.subject),t.$el.find("[name=message_suc]").val(a.messageText),t.message_suc_DisabledEnabled(e);var s=!1,n="";switch(a.resultSendType){case"SEND":s=!1,n="asRepoLinks";break;case"SEND_EMBED":s=!0,n="asAttachedFiles";break;case"SEND_EMBED_ZIP_ALL_OTHERS":s=!0,n="asAttachedZip";break;case"SEND_ATTACHMENT":s=!1,n="asAttachedFiles";break;case"SEND_ATTACHMENT_ZIP_ALL":s=!1,n="asAttachedZip"}t.$el.find("[name=resultSendTypeRadio]").filter("[value="+n+"]").prop("checked",!0),t.asRepoLinks_DisabledEnabled(e),t.$el.find("[name=includeHtmlReport]").prop("checked",s),t.includeHtmlReport_DisabledEnabled(e),t.$el.find("[name=dontSendEmptyReport]").prop("checked",a.skipEmptyReports)}}),this.model.on("change:alert",function(e){var a=e.get("alert");a&&(t.$el.find("[name=job_status_to]").val(a.toAddresses.address),t.$el.find("[name=send_success_notification]").prop("checked",-1!==a.jobState.indexOf("SUCCESS_ONLY")||-1!==a.jobState.indexOf("ALL")),t.$el.find("[name=send_failure_notification]").prop("checked",-1!==a.jobState.indexOf("FAIL_ONLY")||-1!==a.jobState.indexOf("ALL")),t.$el.find("[name=job_status_subject]").val(a.subject),t.$el.find("[name=job_status_success_message]").val(a.messageText),t.$el.find("[name=job_status_failed_message]").val(a.messageTextWhenJobFails),t.$el.find("[name=include_report]").prop("checked",!!a.includingReportJobInfo),t.$el.find("[name=include_stack_trace]").prop("checked",!!a.includingStackTrace))}),this.model.on("change:outputFormats",function(e,a){var s=a.outputFormat.indexOf("HTML")>=0;if(!s){var n=t.model.get("mailNotification");if(n&&n.resultSendType&&("SEND_EMBED"===n.resultSendType||"SEND_EMBED_ZIP_ALL_OTHERS"===n.resultSendType)){var i="SEND",c=e.get("repositoryDestination");return c&&(c.saveToRepository||(i="SEND_ATTACHMENT")),void e.update("mailNotification",{resultSendType:i})}}t.includeHtmlReport_DisabledEnabled(e)}),this.model.on("change:repositoryDestination",function(e,a){var s=a.saveToRepository;if(!s){var n=t.model.get("mailNotification");if(n&&n.resultSendType&&"SEND"===n.resultSendType)return void e.update("mailNotification",{resultSendType:"SEND_ATTACHMENT"})}t.asRepoLinks_DisabledEnabled(e)})},render:function(){this.setElement(t(a.template(i,{i18n:s})))},includeHtmlReport_DisabledEnabled:function(e){var t=!0,a=e.get("mailNotification");a&&"SEND"===a.resultSendType&&(t=!1);var s=e.get("outputFormats");s&&-1===s.outputFormat.indexOf("HTML")&&(t=!1),this.$el.find("[name=includeHtmlReport]").prop("disabled",t?!1:"disabled")},message_suc_DisabledEnabled:function(e){var t=!0,a=e.get("mailNotification");a&&("SEND_EMBED"===a.resultSendType||"SEND_EMBED_ZIP_ALL_OTHERS"===a.resultSendType)&&(t=!1),this.$el.find("[name=message_suc]").prop("disabled",t?!1:"disabled")},asRepoLinks_DisabledEnabled:function(e){var t=!0,a=e.get("repositoryDestination");a&&(a.saveToRepository||(t=!1)),this.$el.find("[name=resultSendTypeRadio][value=asRepoLinks]").prop("disabled",t?!1:"disabled")},to_suc_Change:function(e){this.model.update("mailNotification",{toAddresses:{address:t(e.target).val()}})},cc_suc_Change:function(e){this.model.update("mailNotification",{ccAddresses:{address:t(e.target).val()}})},bcc_suc_Change:function(e){this.model.update("mailNotification",{bccAddresses:{address:t(e.target).val()}})},subject_suc_Change:function(e){this.model.update("mailNotification",{subject:t(e.target).val()})},message_suc_Change:function(e){this.model.update("mailNotification",{messageText:t(e.target).val()})},setResultSendType:function(e){var t=this.$el.find("[name=resultSendTypeRadio]").filter(":checked").val(),a=this.$el.find("[name=includeHtmlReport]").is(":checked"),s="";a?"asRepoLinks"===t?s="SEND":"asAttachedFiles"===t?s="SEND_EMBED":"asAttachedZip"===t&&(s="SEND_EMBED_ZIP_ALL_OTHERS"):"asRepoLinks"===t?s="SEND":"asAttachedFiles"===t?s="SEND_ATTACHMENT":"asAttachedZip"===t&&(s="SEND_ATTACHMENT_ZIP_ALL"),this.model.update("mailNotification",{resultSendType:s})},dont_send_empty_report_Change:function(e){this.model.update("mailNotification",{skipEmptyReports:t(e.target).is(":checked")})},job_status_to_Change:function(e){this.model.update("alert",{toAddresses:{address:t(e.target).val()}})},job_status_subject_Change:function(e){this.model.update("alert",{subject:t(e.target).val()})},twoCheckboxes_Change:function(e){var t=this.$el.find("[name=send_success_notification]").is(":checked"),a=this.$el.find("[name=send_failure_notification]").is(":checked"),s=[];t&&s.push("SUCCESS_ONLY"),a&&s.push("FAIL_ONLY"),0===s.length&&(s=["NONE"]),2===s.length&&(s=["ALL"]),s=s.join("|"),this.model.update("alert",{jobState:s})},job_status_success_message_Change:function(e){this.model.update("alert",{messageText:t(e.target).val()})},job_status_failed_message_Change:function(e){this.model.update("alert",{messageTextWhenJobFails:t(e.target).val()})},include_report_Change:function(e){this.model.update("alert",{includingReportJobInfo:t(e.target).is(":checked")})},include_stack_trace_Change:function(e){this.model.update("alert",{includingStackTrace:t(e.target).is(":checked")})}})});