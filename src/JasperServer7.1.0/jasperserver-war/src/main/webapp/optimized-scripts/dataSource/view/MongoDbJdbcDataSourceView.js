define(["require","underscore","jquery","bundle!all","resource.locate","dataSource/enum/mongoJdbcFileSourceTypes","dataSource/view/CustomDataSourceView","dataSource/model/MongoDbJdbcDataSourceModel","text!dataSource/template/mongoDbJdbcSpecificTemplate.htm","text!dataSource/template/mongoDbJdbcFileLocationSectionTemplate.htm","text!common/templates/components.pickers.htm"],function(e){"use strict";var t=e("underscore"),o=e("jquery"),i=e("bundle!all"),r=e("resource.locate"),n=e("dataSource/enum/mongoJdbcFileSourceTypes"),a=e("dataSource/view/CustomDataSourceView"),c=e("dataSource/model/MongoDbJdbcDataSourceModel"),s=e("text!dataSource/template/mongoDbJdbcSpecificTemplate.htm"),l=e("text!dataSource/template/mongoDbJdbcFileLocationSectionTemplate.htm"),d=e("text!common/templates/components.pickers.htm");return a.extend({PAGE_TITLE_NEW_MESSAGE_CODE:"resource.datasource.mongoJdbc.page.title.new",PAGE_TITLE_EDIT_MESSAGE_CODE:"resource.datasource.mongoJdbc.page.title.edit",modelConstructor:c,browseButton:!1,events:function(){var e=t.extend({},a.prototype.events);return e["change [name=fileSourceType]"]="changeFileSourceType",e["change [name=autoSchemaDefinition]"]="changeAutoSchemaDefinition",e},initialize:function(e){a.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:serverFileName",this.adjustFileSystemConnectButton)},changeFileSourceType:function(){t.defer(t.bind(function(){this.renderFileLocationSection()},this))},changeAutoSchemaDefinition:function(){t.defer(t.bind(function(){this.renderFileLocationSection()},this))},render:function(){return this.$el.empty(),this.renderMongoDbSpecificSection(),this.renderFileLocationSection(),this.renderTimezoneSection(),this.renderTestConnectionSection(),this.$el.find("[name=serverAddress]").focus(),this},validationMethodOnSaveClick:function(e){!this.model.get("parentFolderUri")&&this.model.set("parentFolderUri","/"),!this.model.get("label")&&this.model.set("label",o("[name=dataSourceType] option:selected").text());var r=this;this.model.save({},{dryRun:!0}).fail(function(e){var o=!1;try{o=JSON.parse(e.responseText)}catch(n){}var a=t.isArray(o)?o:[o];t.each(a,function(e){e&&e.errorCode&&e.parameters&&("illegal.parameter.value.error"===e.errorCode&&"resourceReference.uri"===e.parameters[0]?r.fieldIsInvalid(r,"repositoryFileName",i["resource.file.invalid.path"],"name"):"invalid.server.file.system.path"===e.errorCode&&"textDataSource.propertyMap[fileName]"===e.parameters[0]&&r.fieldIsInvalid(r,"serverFileName",i["resource.file.invalid.path"],"name"))})}).done(e)},templateData:function(){var e=t.extend({},n);return this.model.isLocalFileSystemAccessAllowed()||delete e.SERVER_FILE_SYSTEM,t.extend(a.prototype.templateData.apply(this,arguments),{fileSourceTypeOptions:e})},renderMongoDbSpecificSection:function(){this.$el.append(t.template(s,this.templateData()))},renderFileLocationSection:function(){this.renderOrAddAnyBlock(this.$el.find("[name=fileLocationContainer]"),t.template(l,this.templateData())),this.browseButton&&(this.browseButton.remove(),this.browseButton=!1),"repository"!==this.model.get("fileSourceType")||this.model.get("autoSchemaDefinition")||(this.browseButton=r.initialize({i18n:i,template:d,resourceInput:this.$el.find("[name=repositoryFileName]")[0],browseButton:this.$el.find("[name=repositoryBrowserButton]")[0],providerId:"fileResourceBaseTreeDataProvider",dialogTitle:i["resource.Add.Files.Title"],selectLeavesOnly:!0,onChange:t.bind(function(e){this.model.set("repositoryFileName",e),this.model.validate({repositoryFileName:e})},this)}))}})});