define(["require","underscore","jquery","bundle!all","request","bi/repository/model/RepositoryResourceModel","dataSource/saveDialog/BaseSaveDialogView","text!common/templates/standardConfirm.htm","text!dataSource/saveDialog/template/domainSaveDialogTemplate.htm"],function(e){"use strict";var o=e("underscore"),a=e("jquery"),t=e("bundle!all"),n=(e("request"),e("bi/repository/model/RepositoryResourceModel")),i=e("dataSource/saveDialog/BaseSaveDialogView"),s=e("text!common/templates/standardConfirm.htm"),r=e("text!dataSource/saveDialog/template/domainSaveDialogTemplate.htm");return i.extend({saveDialogTemplate:r,constructor:function(e){e||(e={}),this.options=e,i.prototype.constructor.call(this,e)},initialize:function(){this.preSelectedFolder=n.getParentFolderFromUri(this.options.dataSource.uri)||"/",i.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:openInAdHocDesigner",this._onOpenInAdHocDesignerChange)},extendModel:function(e){var a,s,r,l=i.prototype.extendModel.call(this,e),c=this;return l.set("openInAdHocDesigner",!1),a=e.dataSource.label,s=a+" Domain",r=n.generateResourceName(s),l.set("label",s),l.set("name",r),l.validation=o.extend({},n.prototype.validation,{label:[{required:!0,msg:t["resource.datasource.saveDomainDialog.validation.not.empty.label"]},{maxLength:n.settings.LABEL_MAX_LENGTH,msg:t["resource.datasource.saveDomainDialog.validation.too.long.label"]}],name:[{required:!0,msg:t["resource.datasource.saveDomainDialog.validation.not.empty.name"]},{maxLength:n.settings.NAME_MAX_LENGTH,msg:t["resource.datasource.saveDomainDialog.validation.too.long.name"]},{doesNotContainCharacters:n.settings.NAME_NOT_SUPPORTED_SYMBOLS,msg:t["resource.datasource.saveDomainDialog.validation.invalid.chars.name"]}],description:[{required:!1},{maxLength:n.settings.DESCRIPTION_MAX_LENGTH,msg:t["resource.datasource.saveDomainDialog.validation.too.long.description"]}],parentFolderUri:[{fn:function(e){if(!c.options.skipLocation){if(o.isNull(e)||o.isUndefined(e)||o.isString(e)&&""===e)return t["resource.datasource.saveDomainDialog.validation.not.empty.parentFolderIsEmpty"];if("/"!==e.slice(0,1))return t["resource.datasource.saveDomainDialog.validation.folder.not.found"].replace("{0}",e)}}}]}),l},_onOpenInAdHocDesignerChange:function(){var e=this._getLabelForSaveButton();this.changeButtonLabel("save",t[e])},_getLabelForSaveButton:function(e){e=e||this.model;var o="resource.datasource.saveDialog.save";return e.get("openInAdHocDesigner")&&(o="resource.datasource.saveDomainDialog.saveAndOpenDesigner"),o},_onSaveDialogCancelButtonClick:function(){var e=this,t="You are about to cancel the creation of a new domain.<br/>If You wish to create a domain in the future,<br/>You will need to go through the regular Domain Designer.<br/>The data source, however, has successfully been saved.",n=a(s);n.find(".body").html(t),dialogs.popupConfirm.show(n.get(0),!0,{okButtonSelector:"[name=buttonOK]",cancelButtonSelector:"[name=buttonCancel]"}).done(function(){e._closeDialog(),o.isFunction(e.options.success)&&e.options.success()})},performSave:function(){var e=this;this.model.save().done(function(){e._closeDialog(),o.isFunction(e.options.success)&&e.options.success()})}})});