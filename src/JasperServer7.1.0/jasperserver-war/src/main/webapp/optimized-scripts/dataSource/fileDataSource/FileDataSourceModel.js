define(["require","underscore","dataSource/model/CustomDataSourceModel","dataSource/fileDataSource/enum/characterEncodings","dataSource/fileDataSource/enum/fileSourceTypes","jrs.configs","bundle!jasperserver_messages"],function(e){"use strict";var r=e("underscore"),i=e("dataSource/model/CustomDataSourceModel"),t=(e("dataSource/fileDataSource/enum/characterEncodings"),e("dataSource/fileDataSource/enum/fileSourceTypes")),n=e("jrs.configs"),a=e("bundle!jasperserver_messages"),o=i.extend({fileTypes:[],validation:function(){var e={};return r.extend(e,i.prototype.validation,{repositoryFileName:[{fn:function(e,i,t){return"repository"===t.fileSourceType&&(r.isNull(e)||r.isUndefined(e)||r.isString(e)&&""===e)?a["fillParameters.error.mandatoryField"]:null}},{fn:function(e,i,t){return"repository"!==t.fileSourceType||r.isString(e)&&""!==e&&-1!==e.lastIndexOf(".")&&-1!==r.indexOf(this.fileTypes,e.substr(e.lastIndexOf(".")+1))?null:a["resource.file.extension"]}}],serverFileName:[{fn:function(e,i,t){return"serverFileSystem"===t.fileSourceType&&(r.isNull(e)||r.isUndefined(e)||r.isString(e)&&""===e)?a["fillParameters.error.mandatoryField"]:null}}],serverAddress:[{fn:function(e,i,t){return"ftpServer"===t.fileSourceType&&(r.isNull(e)||r.isUndefined(e)||r.isString(e)&&""===e)?a["fillParameters.error.mandatoryField"]:null}}],serverPath:[{fn:function(e,i,t){return"ftpServer"===t.fileSourceType&&(r.isNull(e)||r.isUndefined(e)||r.isString(e)&&""===e)?a["fillParameters.error.mandatoryField"]:null}}],ftpsPort:[{fn:function(e,i,t){return"ftpServer"===t.fileSourceType&&(r.isNull(e)||r.isUndefined(e)||r.isString(e)&&""===e)?a["fillParameters.error.mandatoryField"]:null}}]}),e}(),parse:function(){var e=i.prototype.parse.apply(this,arguments);if(r.isString(e.fileName)){if(-1!==e.fileName.indexOf("repo:")){var n=e.fileName.split(":");e.fileSourceType=t.REPOSITORY.name,e.repositoryFileName=n[1]}else e.fileSourceType=t.SERVER_FILE_SYSTEM.name,e.serverFileName=e.fileName;delete e.fileName}return e.useFirstRowAsHeader="true"===e.useFirstRowAsHeader,e},customFieldsToJSON:function(e,r){return e.fileSourceType===t.REPOSITORY.name?e.fileName="repo:"+e.repositoryFileName+(n.organizationId?"|"+n.organizationId:""):e.fileSourceType===t.SERVER_FILE_SYSTEM.name&&(e.fileName=e.serverFileName),delete e.repositoryFileName,delete e.serverFileName,i.prototype.customFieldsToJSON.call(this,e,r)},resetValidation:function(){this.validation=r.clone(o.prototype.validation)}});return o});