var resourceQuery={STEP1_PAGE_ID:"addResource_query_step1",STEP2_PAGE_ID:"addResource_locateDataSource",STEP3_PAGE_ID:"addResource_query_step3",LABEL_ID:"query.label",RESOURCE_ID_ID:"query.name",DESCRIPTION_ID:"query.description",JUMP_TO_PAGE_ID:"jumpToPage",DONE_BUTTON_ID:"done",NEXT_BUTTON_ID:"next",JUMP_TO_BUTTON_ID:"jumpButton",NEW_DATA_SOURCE_LINK_ID:"newDataSourceLink",LOCAL_DATA_SOURCE_ID:"LOCAL",RESOURCE_URI_INPUT_ID:"resourceUri",QUERY_SQL:"query.sql",_canGenerateId:!0,initialize:function(e){this._step1Page=$(this.STEP1_PAGE_ID),this._step2Page=$(this.STEP2_PAGE_ID),this._step3Page=$(this.STEP3_PAGE_ID),this._step1Page&&(this._form=$(document.body).select("form")[0],this._label=$(this.LABEL_ID),this._resourceId=$(this.RESOURCE_ID_ID),this._description=$(this.DESCRIPTION_ID),this._label.validator=resource.labelValidator.bind(this),this._resourceId.validator=resource.resourceIdValidator.bind(this),this._description.validator=resource.descriptionValidator.bind(this)),this._step2Page&&(this._form=$(document.body).select("form")[0],this._dataSourceUri=$(this.RESOURCE_URI_INPUT_ID),this._dataSourceUri.validator=resource.dataSourceValidator.bind(this)),this._step3Page&&(this._form=$(document.body).select("form")[0],this._query=$(this.QUERY_SQL),this._query.validator=resource.queryValidator.bind(this)),this._nextButton=$(this.NEXT_BUTTON_ID),this._doneButton=$(this.DONE_BUTTON_ID),this._jumpToPage=$(this.JUMP_TO_PAGE_ID),this._jumpButton=$(this.JUMP_TO_BUTTON_ID),this._newDataSourceLink=$(this.NEW_DATA_SOURCE_LINK_ID),this._localDataSource=$(this.LOCAL_DATA_SOURCE_ID),this._isEditMode=e?e.isEditMode:!1,window.resourceLocator&&resourceLocator.initialize({resourceInput:"resourceUri",browseButton:"browser_button",newResourceLink:"newDataSourceLink",treeId:"queryTreeRepoLocation",providerId:"dsTreeDataProvider",dialogTitle:resource.messages["resource.Query.Title"],selectLeavesOnly:!0}),this._initEvents()},_initEvents:function(){if(this._nextButton.observe("click",function(e){this._isDataValid()||e.stop(),this._localDataSource&&this._localDataSource.checked&&(e.stop(),this._newDataSourceLink.click())}.bindAsEventListener(this)),this._doneButton.observe("click",function(e){this._isDataValid()||e.stop()}.bindAsEventListener(this)),this._form.observe("keyup",function(e){var t=e.element();t==this._resourceId&&this._resourceId.getValue()!=resource.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),t==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(resource.generateResourceId(this._label.getValue())),ValidationModule.validate(resource.getValidationEntries([this._resourceId])))}.bindAsEventListener(this)),this._newDataSourceLink){var e=this;this._newDataSourceLink.observe("click",function(t){e._localDataSource.checked&&require(["dataSource/DataSourceController","jrs.configs","jquery","underscore"],function(t,i,o,r){var a=i.addDataSource?r.clone(i.addDataSource.initOptions):{};a.saveFn=function(t,i){t.type=i.type;var o=document.createElement("input");o.type="hidden",o.name="dataSourceJson",o.value=JSON.stringify(i.toJSON()),e._form.appendChild(o),o=document.createElement("input"),o.type="hidden",o.name="dataSourceType",o.value=i.type,e._form.appendChild(o),o=document.createElement("input"),o.type="hidden",o.name="_eventId_saveDatasource",e._form.appendChild(o),e._form.submit()},a.cancelFn=function(){e._form.submit()},a.skipLocation=!0,localContext&&localContext.initOptions&&localContext.initOptions&&(localContext.initOptions.dataSourceJson?(a.isEditMode=!0,a.dataSource=localContext.initOptions.dataSourceJson,a.dataSourceClientType=localContext.initOptions.dataSourceJson.type):localContext.initOptions.dataSourceUri&&(a.isEditMode=!0,a.resourceUri=localContext.initOptions.dataSourceUri));var s=new t(a);o("#display").append(s.$el),o("#selectFromRepository").remove(),s.render()})}.bindAsEventListener(this))}},_isDataValid:function(){var e=!0;return this._label&&(e=e&&ValidationModule.validate(resource.getValidationEntries([this._label]))),this._resourceId&&(this._resourceId.getValue()!=resource.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(resource.generateResourceId(this._label.getValue())),e=e&&ValidationModule.validate(resource.getValidationEntries([this._resourceId])))),this._description&&(e=e&&ValidationModule.validate(resource.getValidationEntries([this._description]))),this._dataSourceUri&&!this._dataSourceUri.disabled&&(e=e&&ValidationModule.validate(resource.getValidationEntries([this._dataSourceUri]))),this._query&&(e=e&&ValidationModule.validate(resource.getValidationEntries([this._query]))),e},jumpTo:function(e){return this._jumpToPage.setValue(e),this._jumpButton.click(),!1}};"undefined"==typeof require&&document.observe("dom:loaded",function(){resourceQuery.initialize(localContext.initOptions)});