define(["require","./jquery.ui.core","./jquery.ui.widget","./jquery.ui.position"],function(t){function i(t,i){var e=(t.attr("aria-describedby")||"").split(/\s+/);e.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",o.trim(e.join(" ")))}function e(t){var i=t.data("ui-tooltip-id"),e=(t.attr("aria-describedby")||"").split(/\s+/),n=o.inArray(i,e);-1!==n&&e.splice(n,1),t.removeData("ui-tooltip-id"),e=o.trim(e.join(" ")),e?t.attr("aria-describedby",e):t.removeAttr("aria-describedby")}t("./jquery.ui.core"),t("./jquery.ui.widget");var o=t("./jquery.ui.position"),n=0;return o.widget("ui.tooltip",{version:"@VERSION",options:{content:function(){var t=o(this).attr("title")||"";return o("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var e=this;return"disabled"===t?(this[i?"_disable":"_enable"](),void(this.options[t]=i)):(this._super(t,i),void("content"===t&&o.each(this.tooltips,function(t,i){e._updateContent(i)})))},_disable:function(){var t=this;o.each(this.tooltips,function(i,e){var n=o.Event("blur");n.target=n.currentTarget=e[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=o(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=o(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,e=o(t?t.target:this.element).closest(this.options.items);e.length&&!e.data("ui-tooltip-id")&&(e.attr("title")&&e.data("ui-tooltip-title",e.attr("title")),e.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&e.parents().each(function(){var t,e=o(this);e.data("ui-tooltip-open")&&(t=o.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),e.attr("title")&&(e.uniqueId(),i.parents[this.id]={element:this,title:e.attr("title")},e.attr("title",""))}),this._updateContent(e,t))},_updateContent:function(t,i){var e,o=this.options.content,n=this,s=i?i.type:null;return"string"==typeof o?this._open(i,t,o):(e=o.call(t[0],function(e){t.data("ui-tooltip-open")&&n._delay(function(){i&&(i.type=s),this._open(i,t,e)})}),void(e&&this._open(i,t,e)))},_open:function(t,e,n){function s(t){u.of=t,a.is(":hidden")||a.position(u)}var a,l,r,u=o.extend({},this.options.position);if(n){if(a=this._find(e),a.length)return void a.find(".ui-tooltip-content").html(n);e.is("[title]")&&(t&&"mouseover"===t.type?e.attr("title",""):e.removeAttr("title")),a=this._tooltip(e),i(e,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:s}),s(t)):a.position(o.extend({of:e},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(s(u.of),clearInterval(r))},o.fx.interval)),this._trigger("open",t,{tooltip:a}),l={keyup:function(t){if(t.keyCode===o.ui.keyCode.ESCAPE){var i=o.Event(t);i.currentTarget=e[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},t&&"mouseover"!==t.type||(l.mouseleave="close"),t&&"focusin"!==t.type||(l.focusout="close"),this._on(!0,e,l)}},close:function(t){var i=this,n=o(t?t.currentTarget:this.element),s=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),e(n),s.stop(!0),this._hide(s,this.options.hide,function(){i._removeTooltip(o(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&o.each(this.parents,function(t,e){o(e.element).attr("title",e.title),delete i.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:s}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,e=o("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return o("<div>").addClass("ui-tooltip-content").appendTo(e),e.appendTo(this.document[0].body),this.tooltips[i]=t,e},_find:function(t){var i=t.data("ui-tooltip-id");return i?o("#"+i):o()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var t=this;o.each(this.tooltips,function(i,e){var n=o.Event("blur");n.target=n.currentTarget=e[0],t.close(n,!0),o("#"+i).remove(),e.data("ui-tooltip-title")&&(e.attr("title",e.data("ui-tooltip-title")),e.removeData("ui-tooltip-title"))})}}),o});