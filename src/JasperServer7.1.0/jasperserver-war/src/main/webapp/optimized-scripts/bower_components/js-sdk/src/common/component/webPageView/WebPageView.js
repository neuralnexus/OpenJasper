define(["require","backbone","underscore","jquery","common/util/browserDetection","css!webPageView"],function(e){"use strict";function i(){-1===(this.url||"").toLowerCase().indexOf("javascript:")&&(this.$iframe.attr("src",this.url),this._iframeSrcSet=!0,this.$el.addClass("loading"),this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this._loadingTimeoutId=setTimeout(r.bind(this.$el.removeClass,this.$el,"loading"),this.timeout))}var t=e("backbone"),r=e("underscore"),s=e("jquery"),n=e("common/util/browserDetection");e("css!webPageView");var o=t.View.extend({tagName:"div",className:"webPageView",constructor:function(e){if(e||(e={}),e.renderTo&&(!s(e.renderTo)[0]||!s(e.renderTo)[0].tagName))throw new Error("WebPageView cannot be rendered to specified container");this.renderTo=e.renderTo,this.url=e.url,this.scrolling=r.isUndefined(e.scrolling)?o.SCROLLING:e.scrolling,this.timeout=r.isUndefined(e.timeout)?o.TIMEOUT:e.timeout,t.View.prototype.constructor.apply(this,arguments)},initialize:function(){this.$iframe=s("<iframe></iframe>").addClass("externalUrlIframe"),this.$el.html(this.$iframe),this.$el.addClass("invisible"),s("body").append(this.$el),this.listenToReadyStateCompete(),this.setScrolling(this.scrolling,{silent:!0}),this.url&&r.isString(this.url)&&(i.call(this),this.renderTo&&this.render(this.renderTo))},listenToReadyStateCompete:function(){var e=this.$iframe[0].contentDocument||this.$iframe[0].contentWindow,i=this;this.$iframe.on("load",function(){clearInterval(i._loadingTimerId),s(this).blur(),s(this).parent().focus(),i.trigger("load")}),e.document&&(e=e.document),this._loadingTimerId=setInterval(function(){"complete"==e.readyState&&(clearInterval(i._loadingTimerId),i.$iframe.blur(),i.$iframe.parent().focus(),i.$el.removeClass("loading"),i.trigger("load"))},300)},render:function(e){if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");if(!e||!s(e)[0]||!s(e)[0].tagName)throw new Error("WebPageView cannot be rendered to specified container");this._iframeSrcSet||i.call(this);var t=this.$el.detach();return t.removeClass("invisible"),s(e).html(t),this._rendered=!0,this.trigger("render",this,s(e)),this},setUrl:function(e,i){this.url=e,this.trigger("change:url",this,this.url),i||this.refresh()},setTimeout:function(e){this.timeout=e,this.trigger("change:timeout",this,this.timeout)},setScrolling:function(e,i){this.scrolling=e,this.$iframe.attr("scrolling",this.scrolling?"yes":"no"),n.isIPad()&&(this.scrolling?this.$el.addClass("touchScroll"):this.$el.removeClass("touchScroll")),i&&i.silent||this.trigger("change:scrolling",this,this.scrolling)},refresh:function(){if(!this._rendered)throw new Error("WebPageView must be rendered to a specific container first");if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");i.call(this),this.trigger("refresh",this,this.url)},remove:function(){this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this._loadingTimerId&&clearTimeout(this._loadingTimerId),this.$iframe.off("load"),this.trigger("remove",this),t.View.prototype.remove.apply(this,arguments)}},{TIMEOUT:2e4,SCROLLING:!0,open:function(e,i){var t,s;try{t=new o(r.isObject(e)?e:{url:e})}catch(n){if(s=n,!i||!r.isFunction(i))throw n}return i&&r.isFunction(i)&&i(s,t),t}});return o});