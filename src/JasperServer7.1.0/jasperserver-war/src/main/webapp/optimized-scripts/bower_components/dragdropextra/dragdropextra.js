Draggable.prototype.startDrag=function(e){this.dragging=!0,this.delta||(this.delta=this.currentDelta()),this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex),this.options.ghosting&&(this._clone=this.element.cloneNode(!0),this.element._originallyAbsolute="absolute"==this.element.getStyle("position"),this.element._originallyAbsolute||Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element));var t=jQuery("body"),i=jQuery(this.element),s=i.offset();if(this._sizes={window:{w:t.outerWidth(!0),h:t.outerHeight(!0)},element:{w:i.outerWidth(),h:i.outerHeight()},mouseOffset:{left:Event.pointerX(e)-s.left,top:Event.pointerY(e)-s.top}},this.options.superghosting){Position.prepare();var o=[Event.pointerX(e),Event.pointerY(e)];body=document.getElementsByTagName("body")[0],me=this.element,this._clone=me.cloneNode(!0),me.parentNode.insertBefore(this._clone,me),me.id="clone_"+me.id,me.hide(),Position.absolutize(me),me.parentNode.removeChild(me),body.appendChild(me),("0px"==me.style.width||"0px"==me.style.height)&&(me.style.width=Element.getWidth(this._clone)+"px",me.style.height=Element.getHeight(this._clone)+"px"),this.originalScrollTop=Element.getHeight(this._clone)/2,this.draw(o),me.show()}if(this.options.scroll)if(this.options.scroll==window){var n=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=n.left,this.originalScrollTop=n.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,e),this.options.starteffect&&this.options.starteffect(this.element)},Draggable.prototype.draw=function(e){"undefined"==typeof this.elemSizeCaptured&&(setTimeout(function(){if(this._sizes){var e=jQuery(this.element);this._sizes.element={w:e.outerWidth(),h:e.outerHeight()}}}.bind(this),100),this.elemSizeCaptured=!0);var t=jQuery(this.element),i=t.offset(),s={left:e[0]-this._sizes.mouseOffset.left,top:e[1]-this._sizes.mouseOffset.top},o=[s.left,s.top];this.options.snap&&(o=Object.isFunction(this.options.snap)?this.options.snap(o[0],o[1],this):Object.isArray(this.options.snap)?o.map(function(e,t){return(e/this.options.snap[t]).round()*this.options.snap[t]}.bind(this)):o.map(function(e){return(e/this.options.snap).round()*this.options.snap}.bind(this))),s={left:o[0],top:o[1]},this.options.constraint&&"horizontal"==this.options.constraint&&(s.top=i.top),this.options.constraint&&"vertical"==this.options.constraint&&(s.left=i.left),this.options.mouseOffset&&(s={left:e[0],top:e[1]}),(0>s.top||0>s.left||s.top+this._sizes.element.h>this._sizes.window.h||s.left+this._sizes.element.w>this._sizes.window.w)&&(0>s.top&&(s.top=0),0>s.left&&(s.left=0),s.top+this._sizes.element.h>this._sizes.window.h&&(s.top=this._sizes.window.h-this._sizes.element.h),s.left+this._sizes.element.w>this._sizes.window.w&&(s.left=this._sizes.window.w-this._sizes.element.w)),t.offset(s),this._sequencer=this._sequencer||0,this._sequencer++,1==this._sequencer&&t.offset(s)},Droppables.isAffected=function(e,t,i){return Position.prepare(),positioned_within=Position.withinIncludingScrolloffsets(i.element,e[0],e[1]),i.element!=t&&(!i._containers||this.isContained(t,i))&&(!i.accept||Element.classNames(t).detect(function(e){return i.accept.include(e)}))&&positioned_within},Draggable.prototype.finishDrag=function(e,t){if(this.dragging=!1,delete this._sequencer,delete this._sizes,this.options.quiet){Position.prepare();var i=[Event.pointerX(e),Event.pointerY(e)];Droppables.show(i,this.element)}this.options.ghosting&&(this.element._originallyAbsolute||Position.relativize(this.element),this.element._originallyAbsolute=void 0,Element.remove(this._clone),this._clone=null),this.options.superghosting&&(body=document.getElementsByTagName("body")[0],Element.remove(this.element),new Draggable(this._clone,this.options));var s=!1;t&&(s=Droppables.fire(e,this.element),s||(s=!1)),s&&this.options.onDropped&&this.options.onDropped(this.element),Draggables.notify("onEnd",this,e);var o=this.options.revert;o&&"function"==typeof o&&(o=o(this.element));var n=this.currentDelta();o&&this.options.reverteffect?(0==s||"failure"!=o)&&this.options.reverteffect(this.element,n[1]-this.delta[1],n[0]-this.delta[0]):this.delta=n,this.options.zindex&&(this.element.style.zIndex=this.originalZ,this._clone&&(this._clone.style.zIndex=this.originalZ)),this.options.endeffect&&this.options.endeffect(this.element),Draggables.deactivate(this),Droppables.reset()};