define(["require","exports","module","backbone","underscore","./view/TooltipPopupView","./model/TooltipPopupModel","./enum/tooltipPlacements","logger","components/utils/Event"],function(t,e){"use strict";var n=t("backbone"),o=t("underscore"),i=t("./view/TooltipPopupView"),p=t("./model/TooltipPopupModel"),s=t("./enum/tooltipPlacements"),l=t("logger").register(e),c=n.$,a=t("components/utils/Event"),r=n.View.extend({events:{mouseenter:"_onShow",mouseleave:"_onHide"},initialize:function(t){t=t||{},this.log=t.log||l;var e=r.readTooltipDataFromDomElement(this.el);o.isEmpty(e)||(r.areSomeKeysEqual(e,t)&&this.log.warn("The same options found both in constructor and in 'data-' atts. Don't use both"),t=o.extend(t,e)),this.popup=new i({placement:t.placement,model:new p({content:r.convertContentToObject({value:t.content,log:this.log})})}),this.$container=c("body")},remove:function(){return this.stopListening(),this.popup.remove(),this},show:function(){var t=r.readTooltipDataFromDomElement(this.el);if(o.isEmpty(t)||(t.placement&&(this.placement=t.placement),t.content&&(this.content=t.content)),this.content){this.popup.model.set({content:this.content}),c.contains(this.$container[0],this.popup.el)||this.$container.append(this.popup.$el);var e=r.calculateTooltipPopupPosition(this.el.getBoundingClientRect(),this.popup.el.getBoundingClientRect(),this.placement);return this.popup.model.set({visible:this.content?!0:!1,placement:this.placement,position:e}),this}},hide:function(){return this.popup.model.set({visible:!1}),this.popup.$el.detach(),this},_onShow:function(){var t=new a({name:"show:tooltip"});this.trigger(t.name,t),t.isDefaultPrevented()||this.show()},_onHide:function(){var t=new a({name:"hide:tooltip"});this.trigger(t.name,t),t.isDefaultPrevented()||this.hide()}},{PLACEMENTS:s,calculateTooltipPopupPosition:function(t,e,n){var o,i,p,l,c,a={left:6,top:6};return n||(n=s.BOTTOM),s.BOTTOM==n||s.TOP==n?(i=t.left+Math.round(t.width/2)-Math.round(e.width/2),o=s.BOTTOM==n?1:-1,l=s.BOTTOM==n?t.height:e.height,p=t.top+o*l+o*a.top):(s.LEFT==n||s.RIGHT==n)&&(p=t.top+Math.round(t.height/2)-Math.round(e.height/2),o=s.RIGHT==n?1:-1,c=s.RIGHT==n?t.width:e.width,i=t.left+o*c+o*a.left),{left:i,top:p}},readTooltipDataFromDomElement:function(t){var e,n=c(t),o=n.data("jrContent"),i=n.data("jrPlacement");return e=o||i?{placement:i,content:o}:{}},areSomeKeysEqual:function(t,e){return o.intersection(Object.keys(t),Object.keys(e)).length>0},convertContentToObject:function(t){t=t||{};var e=t.value||{},n=t.log,i=o.isString(e)&&0===e.length,p=!o.isUndefined(e.label)||!o.isUndefined(e.text),s=o.isObject(e)&&!p;return o.isUndefined(e)||i||s?n&&n.warn("Can't find anything to display in 'content', tooltip won't be shown"):!o.isObject(e)&&o.isString(e)&&(e={text:e}),e}});return r.prototype=o.extend({get placement(){return this.popup.placement},set placement(t){this.popup.placement=t},get content(){return this.popup.model.get("content")},set content(t){this.popup.model.set("content",r.convertContentToObject({value:t,log:this.log}),{validate:!0})}},r.prototype),r});