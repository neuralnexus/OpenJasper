define(["require","./jquery.ui.core","./jquery.ui.mouse","./jquery.ui.widget","./jquery.ui.draggable"],function(e){function t(e,t,i){return e>t&&t+i>e}e("./jquery.ui.core"),e("./jquery.ui.mouse"),e("./jquery.ui.widget");var i=e("./jquery.ui.draggable");return i.widget("ui.droppable",{version:"@VERSION",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,t=this.options,s=t.accept;this.isover=!1,this.isout=!0,this.accept=i.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},i.ui.ddmanager.droppables[t.scope]=i.ui.ddmanager.droppables[t.scope]||[],i.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,t=i.ui.ddmanager.droppables[this.options.scope];e<t.length;e++)t[e]===this&&t.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){"accept"===e&&(this.accept=i.isFunction(t)?t:function(e){return e.is(t)}),i.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var t=i.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=i.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=i.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=i.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(t)))},_drop:function(e,t){var s=t||i.ui.ddmanager.current,o=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=i.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===s.options.scope&&e.accept.call(e.element[0],s.currentItem||s.element)&&i.ui.intersect(s,i.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),i.ui.intersect=function(e,i,s){if(!i.offset)return!1;var o,r,n=(e.positionAbs||e.position.absolute).left,a=(e.positionAbs||e.position.absolute).top,l=n+e.helperProportions.width,p=a+e.helperProportions.height,u=i.offset.left,c=i.offset.top,h=u+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return n>=u&&h>=l&&a>=c&&d>=p;case"intersect":return u<n+e.helperProportions.width/2&&l-e.helperProportions.width/2<h&&c<a+e.helperProportions.height/2&&p-e.helperProportions.height/2<d;case"pointer":return o=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,r=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(r,c,i.proportions().height)&&t(o,u,i.proportions().width);case"touch":return(a>=c&&d>=a||p>=c&&d>=p||c>a&&p>d)&&(n>=u&&h>=n||l>=u&&h>=l||u>n&&l>h);default:return!1}},i.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,t){var s,o,r=i.ui.ddmanager.droppables[e.options.scope]||[],n=t?t.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(s=0;s<r.length;s++)if(!(r[s].options.disabled||e&&!r[s].accept.call(r[s].element[0],e.currentItem||e.element))){for(o=0;o<a.length;o++)if(a[o]===r[s].element[0]){r[s].proportions().height=0;continue e}r[s].visible="none"!==r[s].element.css("display"),r[s].visible&&("mousedown"===n&&r[s]._activate.call(r[s],t),r[s].offset=r[s].element.offset(),r[s].proportions({width:r[s].element[0].offsetWidth,height:r[s].element[0].offsetHeight}))}},drop:function(e,t){var s=!1;return i.each((i.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&i.ui.intersect(e,this,this.options.tolerance)&&(s=this._drop.call(this,t)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),s},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||i.ui.ddmanager.prepareOffsets(e,t)})},drag:function(e,t){e.options.refreshPositions&&i.ui.ddmanager.prepareOffsets(e,t),i.each(i.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,o,r,n=i.ui.intersect(e,this,this.options.tolerance),a=!n&&this.isover?"isout":n&&!this.isover?"isover":null;a&&(this.options.greedy&&(o=this.options.scope,r=this.element.parents(":data(ui-droppable)").filter(function(){return i.data(this,"ui-droppable").options.scope===o}),r.length&&(s=i.data(r[0],"ui-droppable"),s.greedyChild="isover"===a)),s&&"isover"===a&&(s.isover=!1,s.isout=!0,s._out.call(s,t)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,t),s&&"isout"===a&&(s.isout=!1,s.isover=!0,s._over.call(s,t)))}})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||i.ui.ddmanager.prepareOffsets(e,t)}},i});