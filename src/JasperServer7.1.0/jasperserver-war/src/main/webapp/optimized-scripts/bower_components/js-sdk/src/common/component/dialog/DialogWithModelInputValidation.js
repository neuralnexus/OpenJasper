define(["require","jquery","underscore","./Dialog","backbone.validation"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("./Dialog"),r=e("backbone.validation");return n.extend({events:i.extend({"keyup input[type=text], textarea, select":"updateModelProperty","change input[type=text], input:checkbox, textarea, select":"updateModelProperty"},n.prototype.events),initialize:function(){this._bindEvents(),n.prototype.initialize.apply(this,arguments)},_bindEvents:function(){this.on("resize",this._getBaseHeight)},_unbindEvents:function(){this.off("resize",this._getBaseHeight)},updateModelProperty:function(e){var i={},n=t(e.target);"input"===n[0].tagName.toLowerCase()&&"text"===n.attr("type")||"select"===n[0].tagName.toLowerCase()&&"true"!==n.attr("multiple")||"textarea"===n[0].tagName.toLowerCase()?i[n.attr("name")]=t.trim(n.val()):"input"===n[0].tagName.toLowerCase()&&"checkbox"===n.attr("type")&&(i[n.attr("name")]=n.is(":checked")),this.beforeModelPropertySet&&this.beforeModelPropertySet(i),this.model.set(i),this.model.validate(i)},bindValidation:function(){r.bind(this,{valid:this.fieldIsValid,invalid:this.fieldIsInvalid,forceUpdate:!0,selector:"name"})},unbindValidation:function(){r.unbind(this)},fieldIsValid:function(e,t,i){var n=e.$("["+i+'="'+t+'"]').parent();n.removeClass("error"),n.find(".message.warning").text(""),e._updateHeight()},fieldIsInvalid:function(e,t,i,n){var r=e.$("["+n+'="'+t+'"]').parent();r.addClass("error"),r.find(".message.warning").text(i.toString()),e._updateHeight()},validField:function(e){var t=this.$(e).parent();t.removeClass("error"),t.find(".message.warning").text("")},invalidField:function(e,t){var i=this.$(e).parent();i.addClass("error"),i.find(".message.warning").text(t.toString())},clearValidationErrors:function(){this.$("label").removeClass("error"),this.$(".message.warning").text(""),this._updateHeight()},remove:function(){this.unbindValidation(),this._unbindEvents(),n.prototype.remove.apply(this,arguments)},_updateHeight:function(){var e=this._getBaseHeight(this.$el.height()),t=this._getAllErrorsHeight();0!==t?this.$el.height(t+e):this.$el.height(e)},_getBaseHeight:function(e){var t=this._getAllErrorsHeight();return i.isNumber(e)&&i.isUndefined(this._previousHeight)?this._previousHeight=e:i.isObject(e)&&e.timeStamp&&(this._previousHeight=t?this.$el.height()-t:this.$el.height()),this._previousHeight},_getAllErrorsHeight:function(){var e=0;return this.$(".message.warning").each(function(){e+=t(this).height()}),e}})});