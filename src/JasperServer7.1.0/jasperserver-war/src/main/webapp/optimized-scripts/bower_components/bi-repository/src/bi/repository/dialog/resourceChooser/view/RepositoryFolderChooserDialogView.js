define(["require","underscore","bundle!all","common/component/dialog/Dialog","text!../template/repositoryFolderChooserDialogTemplate.htm","bi/repository/repositoryFolderTree/RepositoryFolderTree"],function(e){"use strict";var t=e("underscore"),s=e("bundle!all"),o=e("common/component/dialog/Dialog"),i=e("text!../template/repositoryFolderChooserDialogTemplate.htm"),l=e("bi/repository/repositoryFolderTree/RepositoryFolderTree");return o.extend({constructor:function(e){e||(e={});var r="selectFolder newResizeableDialog";e.additionalCssClasses&&(r+=" "+e.additionalCssClasses),this.foldersTree=l(),o.prototype.constructor.call(this,{modal:!0,resizable:!0,minWidth:400,minHeight:400,additionalCssClasses:r,title:s["repository.content"],content:t.template(i)({i18n:s}),buttons:[{label:s["button.select"],action:"select",primary:!0},{label:s["button.cancel"],action:"cancel",primary:!1}]});var n=this.$contentContainer.find(".control.groupBox .body");n.append(this.foldersTree.render().el)},initialize:function(e){this.listenTo(this.foldersTree,"selection:change",this._selectionListener),this.listenTo(this,"button:select",this._onOkButtonClick),this.listenTo(this,"button:cancel",this._onCancelButtonClick),o.prototype.initialize.apply(this,arguments),this._isOpened=!1,this.selectedResource=null,this._lastSelectedResource=null},open:function(){this._openDialog()},close:function(){this._closeDialog()},remove:function(){this._closeDialog(),this.foldersTree.remove(),o.prototype.remove.apply(this,arguments)},setDefaultSelectedItem:function(e){this._defaultSelectedItem=e},_onOkButtonClick:function(){this.selectedResource&&(this._closeDialog(),this._lastSelectedResource=this.selectedResource)},_onCancelButtonClick:function(){this.selectedResource=null,this._lastSelectedResource&&(this.selectedResource=this._lastSelectedResource),this._closeDialog()},_openDialog:function(){this._isOpened||(o.prototype.open.apply(this,arguments),this._resetTree(),this.disableButton("select"),this._preselectItem(),this._isOpened=!0)},_closeDialog:function(){this._isOpened&&(o.prototype.close.apply(this,arguments),this._isOpened=!1)},_selectionListener:function(e){var s=Object.keys(e),o=e&&(t.isArray(e)||t.isObject(e))&&e[s[0]],i=o?o.uri:void 0,l=o?o.resourceType:void 0;return o||i||l?(this.selectedResource={resourceUri:i},void this.enableButton("select")):void this.disableButton("select")},_resetTree:function(){this.foldersTree.collapse("@fakeRoot",{silent:!0}),this.foldersTree.collapse("/public",{silent:!0}),this.foldersTree.resetSelection()},_preselectItem:function(){var e=!1;if(this._lastSelectedResource?e=this._lastSelectedResource.resourceUri:this._defaultSelectedItem&&(e=this._defaultSelectedItem),e){var t=this.foldersTree.$el.parent();this.foldersTree._selectTreeNode(e,t)}}})});