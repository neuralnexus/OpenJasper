define(["require","./TreePlugin","underscore","common/component/menu/ContextMenu"],function(t){"use strict";var n=t("./TreePlugin"),e=t("underscore"),i=t("common/component/menu/ContextMenu");return n.extend({initialize:function(t){if(this.tree=t.tree,this.actionsMap={},!t)throw new Error("Initialization error. Options required.");this.onTreeContextMenuEvent=t.onTreeContextMenuEvent||function(){},this.getOptionsToSelect=t.getOptionsToSelect||function(){return[]},this.contextMenuEvents=t.contextMenuEvents||function(){return{}},this.getContextMenuOptions=t.getContextMenuOptions||function(){return[]},this.showContextMenuCondition=t.showContextMenuCondition||function(){return!0},this._initEvents(),n.prototype.initialize.apply(this,arguments)},_initEvents:function(){this.listenTo(this.tree,"item:contextmenu",this._onContextMenuEvent)},_onContextMenuEvent:function(t,n){this.onTreeContextMenuEvent(t),this._removeLastContextMenu(),this.showContextMenuCondition(t)&&(this.contextMenu=this._getContextMenu(t),this._initContextMenuEvents(t,n),this._preselectOptions(t),this.contextMenu.show({left:n.pageX,top:n.pageY}),this.lastContextMenu=this.contextMenu)},_getContextMenu:function(t){var n=this.getContextMenuOptions(t);return n.contextMenu||new i(n.options,n.additionalSettings)},_initContextMenuEvents:function(t,n){var i=this.contextMenuEvents(t);i&&e.each(i,function(i,o){this.listenTo(this.contextMenu,o,e.partial(i,t,n))},this)},_preselectOptions:function(t){var n=this.getOptionsToSelect(t)||[];n.length&&e.each(n,function(t){this.contextMenu.select(t)},this)},_removeLastContextMenu:function(){this.lastContextMenu&&(this.stopListening(this.lastContextMenu),this.lastContextMenu.remove())},remove:function(){this.stopListening(),this.contextMenu&&this.contextMenu.remove()}})});