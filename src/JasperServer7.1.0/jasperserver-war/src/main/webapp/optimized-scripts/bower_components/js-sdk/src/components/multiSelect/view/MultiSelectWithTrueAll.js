define(["require","underscore","../dataprovider/DelegatingDataProvider","../dataprovider/SelectedItemsDataProvider","../view/AvailableItemsListWithTrueAll","../view/MultiSelect"],function(e){"use strict";var t=e("underscore"),i=e("../dataprovider/DelegatingDataProvider"),a=e("../dataprovider/SelectedItemsDataProvider"),s=e("../view/AvailableItemsListWithTrueAll"),l=e("../view/MultiSelect"),r=l.extend({_createAvailableItemsList:function(e){return this.availableItemsListDataProvider=e.getData,e.availableItemsList||new s({model:this.availableItemsListModel,getData:e.getData,bufferSize:e.bufferSize,loadFactor:e.loadFactor,chunksTemplate:e.chunksTemplate,scrollTimeout:e.scrollTimeout,trueAll:e.trueAll})},_createSelectedItemsListDataProvider:function(e){return this.selectedListOptions=e?e.selectedListOptions:{},new i},selectionRemoved:function(e){if(this.getTrueAll()){var t;for(var i in e)if(e.hasOwnProperty(i)){t={value:e[i],index:i};break}this.availableItemsList.selectionAdd(t)}else l.prototype.selectionRemoved.call(this,e)},selectionChangeInternal:function(e){var i=this.getTrueAll();if(i){this.selectedItemsDataProvider.setGetData(this.availableItemsListDataProvider),this.selectedItemsDataProvider.setData=null;var s=this;this.selectedItemsList.fetch(function(){s._updateSelectedItemsCountLabel(),s.selectedItemsList.resize()}),this.silent?delete this.silent:this.triggerSelectionChange()}else{var r=new a(this.selectedListOptions);this.selectedItemsDataProvider.setGetData(r.getData),this.selectedItemsDataProvider.setData=t.bind(r.setData,r),l.prototype.selectionChangeInternal.call(this,e)}},triggerSelectionChange:function(){this.trigger("selection:change",this.getValue(),{isTrueAll:this.getTrueAll()})},setTrueAll:function(e,t){t=t||{},t.silent&&(this.silent=!0),delete t.silent,this.availableItemsList.setTrueAll(e,t)},getTrueAll:function(){return this.availableItemsList.getTrueAll()}});return r});