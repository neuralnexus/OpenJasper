define(["require","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(t){"use strict";var e=t("jquery"),s=t("underscore"),i=t("backbone"),o=t("text!./template/tooltipTemplate.htm");return i.View.extend({template:s.template(o),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(t){if(t||(t={}),!t.attachTo||0===e(t.attachTo).length)throw new Error("Tooltip should be attached to an element");if(!t.contentTemplate)throw new Error("Tooltip should have contentTemplate");this._shown=!1,this.$attachTo=e(t.attachTo),this.$attachTo[0].tooltip=this,t.delay&&(this.delay=t.delay),t.offset&&(this.offset=t.offset),t.attribute&&(this.attribute=t.attribute),t.cssClasses&&(this.cssClasses=t.cssClasses),this.contentTemplate=t.contentTemplate,this.i18n=t.i18n||{},!s.isUndefined(t.triggerEvents)&&(this.triggerEvents=t.triggerEvents),this.selector="["+this.attribute+"]",s.bindAll(this,"show","_onMouseMove","_onMouseLeave"),this.$attachTo.on("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.on("mouseleave touchend",this.selector,this._onMouseLeave),i.View.prototype.constructor.apply(this,arguments)},_render:function(t,e,o){if(this._event){t=t instanceof i.Model?t.toJSON():t;var h=s.template(this.contentTemplate)({model:t,i18n:this.i18n,options:e||{}});this.$el.find(".body").empty().append(h),this._showTooltip()}o.resolve()},show:function(t,i){var o=new e.Deferred;return this._timer=setTimeout(s.bind(this._render,this,t,i,o),this.delay),o},_showTooltip:function(){e("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.contentTemplate&&this._timer&&clearTimeout(this._timer),this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var t=this.$el.innerHeight(),s=this.$el.innerWidth(),i=e(window).height(),o=e(window).width(),h=this.offset.y,n=this.offset.x;t+this._event.pageY+this.offset.y+3>=i&&(h=-this.offset.y-t),s+this._event.pageX+this.offset.x+3>=o&&(n=-this.offset.x-s),this.$el.css({top:this._event.pageY+h,left:this._event.pageX+n})},_onMouseMove:function(t){this._event=t},_onMouseLeave:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this._event=null},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.off("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.off("mouseleave touchend",this.selector,this._onMouseLeave),i.View.prototype.remove.apply(this,arguments)}},{attachTo:function(t,e){var s=this;return e||(e={}),e.attachTo=t||"body",new s(e)},detachFrom:function(t){t=e(t)[0],t.tooltip&&t.tooltip.remove()}})});