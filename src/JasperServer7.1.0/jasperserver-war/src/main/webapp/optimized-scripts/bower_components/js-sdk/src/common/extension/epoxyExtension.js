define(["require","backbone.epoxy.original","backbone","common/component/colorPicker/SimpleAttachableColorPicker","underscore"],function(t){function e(t,e){var n=t.data("bind"),i=new RegExp(e+":(\\w*)\\(?(\\w*)?\\)?");return n?c.last(c.compact(n.match(i))):t.data("bindAttribute")}function n(t){return s(t)?t():(h(t)&&(t=c.clone(t),c.each(t,function(e,i){t[i]=n(e)})),t)}var i=t("backbone.epoxy.original"),a=t("backbone"),o=t("common/component/colorPicker/SimpleAttachableColorPicker"),c=t("underscore"),l={optionText:"label",optionValue:"value",optionClass:"className"},r=function(t){return t instanceof a.Collection},d=function(t){return t instanceof a.Model},s=c.isFunction,h=c.isObject;return i.binding.addHandler("optionsWithAdditionalProperties",{init:function(t,e,n,i){this.e=i.optionsEmpty,this.d=i.optionsDefault,this.v=i.value},set:function(t,e){var i=this,a=n(i.e),o=n(i.d),l=n(i.v),d=r(e)?e.models:e,s=d.length,h=!0,u="";s||o||!a?(o&&(d=[o].concat(d)),c.each(d,function(t,e){u+=i.opt(t,s)})):(u+=i.opt(a,s),h=!1),t.html(u).prop("disabled",!h).val(l),t[0].selectedIndex<0&&t.children().length&&(t[0].selectedIndex=0);var v=t.val();i.v&&!c.isEqual(l,v)&&i.v(v)},opt:function(t,e){var n,i=t,a=t,o=t,c=l.optionText,r=l.optionValue,s=l.optionClass;return h(t)&&(i=d(t)?t.get(c):t[c],a=d(t)?t.get(r):t[r],o=d(t)?t.get(s):t[s]),n=o?'class="'+o+'"':"",['<option value="',a,'"',n,">",i,"</option>"].join("")}}),i.binding.addHandler("validationErrorClass",{init:function(t,n,i,a){this.attr=e(t,"validationErrorClass");var o=this.view.model;this._onAttrValidated=function(e,n,i){t[i?"addClass":"removeClass"]("error")},o.on("validate:"+this.attr,this._onAttrValidated)},get:function(t,e,n){return t.val()},set:function(t,e){t.val(e)},clean:function(){this.view.model.off("validate:"+this.attr,this._onAttrValidated)}}),i.binding.addHandler("validationErrorText",{init:function(t,n,i,a){this.attr=e(t,"validationErrorText");var o=this.view.model;this._onAttrValidated=function(e,n,i){t.text(i||"")},o.on("validate:"+this.attr,this._onAttrValidated)},get:function(t,e,n){return t.val()},set:function(t,e){t.val(e)},clean:function(){this.view.model.off("validate:"+this.attr,this._onAttrValidated)}}),i.binding.addFilter("escapeCharacters",{get:function(t){return c.escape(t)},set:function(t){return c.unescape(t)}}),i.binding.addHandler("colorpicker",{init:function(t,n,i,a){var l=!!t.data("showTransparentInput"),r=t.data("label"),d=e(t,"colorpicker");this.attachableColorPicker=new o(t,{top:5,left:5},{label:r,showTransparentInput:l}),this.callback=function(t){i[d](t)},this.attachableColorPicker.on("color:selected",c.bind(this.callback,this))},get:function(t,e,n){return t.val()},set:function(t,e){var n=t.find(".colorIndicator");this.attachableColorPicker.highlightColor(e),n.css("background-color",e)},clean:function(){this.attachableColorPicker.off("color:selected",c.bind(this.callback,this)),this.attachableColorPicker.remove()}}),i.binding.addHandler("radioDiv",{init:function(t,n,i,a){var o=e(t,"radioDiv");this.callback=function(){var e=t.data("value");i[o](e)},t.on("click",c.bind(this.callback,this))},get:function(t,e,n){return t.data("value")},set:function(t,e){var n=t.siblings("div[data-bind*='radioDiv:']");t.data("value")===e&&(t.addClass("checked"),t.children(".radioChild").addClass("checked"),n.removeClass("checked"),n.children(".radioChild").removeClass("checked"))}}),i.binding.addHandler("checkboxDiv",{init:function(t,n,i,a){var o=e(t,"checkboxDiv");this.callback=function(){i[o](!i[o]())},t.on("click",c.bind(this.callback,this))},get:function(t,e,n){return t.data("value")},set:function(t,e){e?(t.addClass("checked"),t.children(".checkboxChild").addClass("checked")):(t.removeClass("checked"),t.children(".checkboxChild").removeClass("checked"))}}),i.binding.addHandler("slide",function(t,e){t[e?"slideDown":"slideUp"]({complete:function(){!e&&t.hide()}})}),i.binding.addHandler("selectionRange",{get:function(t,e,n){return{selectionRange:{start:t[0].selectionStart,end:t[0].selectionEnd}}},set:function(t,e){t.is(":visible")&&(t[0].setSelectionRange(e.start,e.end),t.focus())}}),i.binding.addFilter("prependText",function(t,e){return"'"===e.charAt(0)&&"'"===e.charAt(e.length-1)&&(e=e.slice(1,e.length-1)),e+" "+(c.isUndefined(t)?"":t)}),i});