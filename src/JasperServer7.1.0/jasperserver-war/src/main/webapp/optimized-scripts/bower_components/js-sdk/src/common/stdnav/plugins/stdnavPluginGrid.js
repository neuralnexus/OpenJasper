define(["require","exports","module","jquery","underscore","logger","stdnav"],function(e,i,t){"use strict";var n=e("jquery"),s=(e("underscore"),e("logger").register(t)),r=e("stdnav"),l=0,o=function(){l++,this.serial=l};n.extend(o.prototype,{zinit:function(e){return s.debug("stdnavPluginGrid.init("+e+")\n"),this},activate:function(){this.behavior={focusin:[this,r.basicFocusIn,{maxdepth:2,subfocusclass:"gridcell"}],focusout:[this,r.ghostFocusOut,null],subfocusin:[this,this._onSubfocusIn,null],left:[this,this._onLeft,null],right:[this,this._onRight,null],up:[this,this._onUp,null],down:[this,this._onDown,null],hoverin:[this,this._onHover,null],inherit:!0,inheritable:!0},r.registerNavtype(this.navtype,this.behavior,this.navtype_tags)},deactivate:function(){r.unregisterNavtype(this.navtype,this.behavior)},_findSubfocus:function(e){var i=n(e).closest(".grid"),t=i.find(".subfocus");return void 0!==t?n(t[0]):void 0},_fixSubfocus:function(e){var i,t;if(e.hasClass("grid"))if(i=e.children(".gridrow").children(".gridcell .ghostfocus"),i.length>0)t=i[0];else{var s=e.children(".gridrow");if(s.length>0){var r=n(s[0]).children(".gridcell");t=r.length>0?r[0]:s[0]}else t=e}else e.hasClass("gridrow")?(i=e.children(".gridcell .ghostfocus"),t=i[0]):e.hasClass("gridcell")&&(t=e);return t},_onSubfocusIn:function(e){if(n(e).hasClass("gridcell")===!1){var i=this._fixSubfocus(n(e));r.setSubfocus(i,!1)}},_onLeft:function(e){var i=this._findSubfocus(e),t=n(!1);return i.hasClass("gridcell")&&(t=i.prev(".gridcell")),1===t.length&&r.setSubfocus(t),!1},_onRight:function(e){var i=this._findSubfocus(e),t=n(!1);return i.hasClass("gridcell")&&(t=i.next(".gridcell")),1===t.length&&r.setSubfocus(t),!1},_onUp:function(e){var i=this._findSubfocus(e),t=n(!1),s=n(!1),l=n(!1);if(i.hasClass("gridcell")&&(t=i.closest(".gridrow"),1===t.length&&(s=t.prev(".gridrow")),1===s.length)){var o=i,u=-1;do u++,o=n(o.prev(".gridcell")[0]);while(o.length>0);for(l=n(s.find(".gridcell")[0]);u>0;)o=l.next(".gridcell"),o.length>0&&(l=n(o[0])),u--}return 1===l.length&&r.setSubfocus(l),!1},_onDown:function(e){var i=this._findSubfocus(e),t=n(!1),s=n(!1),l=n(!1);if(i.hasClass("gridcell")&&(t=i.closest(".gridrow"),t.length>0&&(s=t.next(".gridrow")),s.length>0)){var o=i,u=-1;do u++,o=n(o.prev(".gridcell")[0]);while(o.length>0);for(l=n(s.find(".gridcell")[0]);u>0;)o=l.next(".gridcell"),o.length>0&&(l=n(o[0])),u--}return 1===l.length&&r.setSubfocus(l),!1}}),n.extend(o.prototype,{navtype:"grid",navtype_tags:[]});var u=new o;return u});