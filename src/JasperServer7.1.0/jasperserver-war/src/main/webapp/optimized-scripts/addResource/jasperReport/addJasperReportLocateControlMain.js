var resource={messages:{},resourceLabelMaxLength:100,resourceIdMaxLength:100,resourceDescriptionMaxLength:250,PROPAGATE_EVENT:"propagateEvent",STEP_DISPLAY_ID:"stepDisplay",FLOW_CONTROLS_ID:"flowControls",initSwipeScroll:function(){var e=$(resource.STEP_DISPLAY_ID);e&&new TouchController(e.up(),e.up(1),{})},submitForm:function(e,t,r){if(t){var i=buildActionUrl(t);r&&r(),$(e).writeAttribute("method","post").writeAttribute("action",i),$(e).submit()}},registerClickHandlers:function(e,t,r){if(resource._bodyClickEventHandlers)return void(r?Array.prototype.unshift:Array.prototype.push).apply(resource._bodyClickEventHandlers,e);resource._bodyClickEventHandlers=e;var i=t||"body";$$(i)[0].observe("click",function(e){resource._bodyClickEventHandlers&&resource._bodyClickEventHandlers.each(function(t){var r=t(e);if(r)throw r!==resource.PROPAGATE_EVENT&&Event.stop(e),$break})})},TreeWrapper:function(e){var t=this;if(this._treeId=e.treeId,this._resourceUriInput=$(e.resourceUriInput||"resourceUri"),this._uri=this._resourceUriInput&&this._resourceUriInput.getValue()||e.uri||"/",!e.providerId)throw"There is no tree provider set for tree #{id}".interpolate({id:this._treeId});var r=["providerId","rootUri","organizationId","publicFolderUri","urlGetNode","urlGetChildren"].inject({},function(t,r){return null!==e[r]&&(t[r]=e[r]),t});return this._tree=new dynamicTree.createRepositoryTree(this._treeId,r),this._tree.observe("tree:loaded",function(){t._tree.openAndSelectNode($(t._resourceUriInput).getValue())}),this._tree.observe("leaf:selected",function(e){t._uri=e.memo.node.param.uri,t._resourceUriInput.setValue(t._uri)}),this._tree.observe("node:selected",function(){t._resourceUriInput.setValue(t._uri="")}),{getTreeId:function(){return t._treeId},getTree:function(){return t._tree},selectFolder:function(e){t._tree.openAndSelectNode(e)},getSelectedFolderUri:function(){return t._uri}}},switchButtonState:function(e,t){buttonManager[t?"enable":"disable"].call(buttonManager,e)},switchDisableState:function(e,t){(e=$(e))&&e[t?"disable":"enable"].call(e)},generateResourceId:function(e){if(localContext&&localContext.initOptions&&localContext.initOptions.resourceIdNotSupportedSymbols)return e.replace(new RegExp(localContext.initOptions.resourceIdNotSupportedSymbols,"g"),"_");throw"There is no resourceIdNotSupportedSymbols property in init options."},testResourceId:function(e){if(localContext&&localContext.initOptions&&localContext.initOptions.resourceIdNotSupportedSymbols)return new RegExp(localContext.initOptions.resourceIdNotSupportedSymbols,"g").test(e);throw"There is no resourceIdNotSupportedSymbols property in init options."},labelValidator:function(e){var t=!0,r="";return e.blank()?(r=resource.messages.labelIsEmpty,t=!1):e.length>resource.resourceLabelMaxLength&&(r=resource.messages.labelToLong,t=!1),{isValid:t,errorMessage:r}},getLabelValidationEntry:function(e){return{element:e,validators:[{method:"mandatory",messages:{mandatory:resource.messages.labelIsEmpty}},{method:"minMaxLength",messages:{tooLong:resource.messages.labelToLong},options:{maxLength:resource.resourceLabelMaxLength}}]}},getIdValidationEntry:function(e){return{element:e,validators:[{method:"resourceIdChars",messages:resource.messages},{method:"mandatory",messages:{mandatory:resource.messages.resourceIdIsEmpty}},{method:"minMaxLength",messages:{tooLong:resource.messages.resourceIdToLong},options:{maxLength:resource.resourceIdMaxLength}}]}},resourceIdValidator:function(e){var t=!0,r="";return this._isEditMode||(e.blank()?(r=resource.messages.resourceIdIsEmpty,t=!1):e.length>resource.resourceIdMaxLength?(r=resource.messages.resourceIdToLong,t=!1):resource.testResourceId(e)&&(r=resource.messages.resourceIdInvalidChars,t=!1)),{isValid:t,errorMessage:r}},getDescriptionValidationEntry:function(e){return{element:e,validators:[{method:"minMaxLength",messages:{tooLong:resource.messages.descriptionToLong},options:{maxLength:resource.resourceDescriptionMaxLength}}]}},descriptionValidator:function(e){var t=!0,r="";return e.length>resource.resourceDescriptionMaxLength&&(r=resource.messages.descriptionToLong,t=!1),{isValid:t,errorMessage:r}},dataSourceValidator:function(e){var t=!0,r="";return""===e.trim()&&(r=resource.messages.dataSourceInvalid,t=!1),{isValid:t,errorMessage:r}},queryValidator:function(e){var t=!0,r="";return""===e.trim()&&(r=resource.messages.queryInvalid,t=!1),{isValid:t,errorMessage:r}},getValidationEntries:function(e){return e.collect(function(e){return e.validationEntry?e.validationEntry:{validator:e.validator,element:e}})}};"undefined"==typeof require&&isIPad()&&document.observe("dom:loaded",resource.initSwipeScroll.bind(resource)),define("resource.base",["prototype","utils.common","core.layout"],function(e){return function(){var t;return t||e.resource}}(this));var dynamicTree={trees:{},nodes:{},treeNodeEdited:null,editaborted:!1,activeTreeId:null,Tree:function(e,t){this.id=e,t?(this.setRootNode(t.root),this.bShowRoot=!!t.bShowRoot,this.handleNodeOnDblclick=void 0!==t.handleNodeOnDblclick?t.handleNodeOnDblclick:!0,this.multiSelectEnabled=!!t.multiSelectEnabled,this.showAllNodesOnStartup=!!t.showAllNodesOnStartup,this.treeClassName=t.treeClassName?t.treeClassName:"",this.dragPattern=t.dragPattern,this.dragClasses=t.dragClasses,this.dropClasses=t.dropClasses,this.selectOnMousedown=t.selectOnMousedown,this.regionID=t.regionID,this.scroll=t.scroll,this.templateDomId=t.templateDomId?t.templateDomId:this.DEFAULT_TREE_TEMPLATE_ID):(this.templateDomId=this.DEFAULT_TREE_TEMPLATE_ID,this.handleNodeOnDblclick=!0),this.stateObject={},this.sortNodes=!0,this.sorters=[this.sortByOrder,this.sortByName],this.selectedNodes=[],this.TREE_NN_ITEMS_SELECTED="#{count} items selected",dynamicTree.trees[this.id]=this,this._createFromTemplate(),this.refreshStyle(),this._registerEvents(),this._registerCustomScroll()},getNextId:function(){var e=1;return function(){return e++}}(),getActiveTree:function(){return dynamicTree.trees[dynamicTree.activeTreeId]},getTreeNode:function(e){return dynamicTree.nodes[e]},getStorageVal:function(e){var t=JSON.parse(window.localStorage.getItem("dynamicTree"))||{};return t[e]||null},setStorageVal:function(e,t){var r=window.localStorage,i=JSON.parse(r.getItem("dynamicTree"))||{};i[e]=t;try{r.setItem("dynamicTree",JSON.stringify(i))}catch(d){window.console&&console.log(d)}},_templateHash:{}};dynamicTree.Tree.addVar("DEFAULT_TREE_TEMPLATE_ID","list_responsive_collapsible"),dynamicTree.Tree.addVar("HIDE_ROOT_CLASS_NAME","hideRoot"),dynamicTree.Tree.addMethod("getId",function(){return this.id}),dynamicTree.Tree.addMethod("_getElement",function(){return this._element||(this._element=$(this.id)),this._element}),dynamicTree.Tree.addMethod("_createFromTemplate",function(){this._getElement()&&(this._getElement().insert({after:this._getTemplateElement(this._getElement())}),this._getElement().remove(),this._element=null,this._getElement().update())}),dynamicTree.Tree.addMethod("_registerCustomScroll",function(){if(!this.scroll&&this._getElement()){var e=this._getElement().up(layoutModule.SWIPE_SCROLL_PATTERN);if(e){var t=layoutModule.scrolls.get(e.identify());t&&(this.scroll=t)}}}),dynamicTree.Tree.addMethod("setRootNode",function(e){this.rootNode=e,this.rootNode&&(this.rootNode.treeId=this.id)}),dynamicTree.Tree.addMethod("getRootNode",function(){return this.rootNode}),dynamicTree.Tree.addMethod("refreshStyle",function(){var e=this._getElement();e.templateClassName&&(e.className=e.templateClassName),this.treeClassName&&e.addClassName(this.treeClassName),this.bShowRoot?e.removeClassName(this.HIDE_ROOT_CLASS_NAME):e.addClassName(this.HIDE_ROOT_CLASS_NAME)}),dynamicTree.Tree.addMethod("resetSelected",function(){this._prevSelectedNodes=this.selectedNodes.clone(),this.selectedNodes=[]}),dynamicTree.Tree.addMethod("revertSelection",function(e){var t=this._prevSelectedNodes.clone();t=t.concat(this.selectedNodes),this.selectedNodes=this._prevSelectedNodes.clone();for(var r=0;r<t.length;r++)t[r].refreshStyle()}),dynamicTree.Tree.addMethod("getSelectedNode",function(){return 0===this.selectedNodes.length?null:this.selectedNodes[0]}),dynamicTree.Tree.addMethod("addNodeToSelected",function(e){this.selectedNodes.push(e),this._prevSelectedNodes=this.selectedNodes.clone()}),dynamicTree.Tree.addMethod("removeNodeFromSelected",function(e){for(var t=0;t<this.selectedNodes.length;t++)if(this.selectedNodes[t]==e)return this._prevSelectedNodes=this.selectedNodes.clone(),void this.selectedNodes.splice(t,1)}),dynamicTree.Tree.addMethod("isNodeSelected",function(e){var t=this.selectedNodes&&this.selectedNodes.length;if(t)for(var r=0;t>r;r++)if(this.selectedNodes[r]==e)return!0;return!1}),dynamicTree.Tree.addMethod("resortSubtree",function(e){if(e){e.resortChilds();for(var t=0;t<e.childs.length;t++)this.resortSubtree(e.childs[t])}}),dynamicTree.Tree.addMethod("resortTree",function(){this.sortNodes&&this.resortSubtree(this.rootNode)}),dynamicTree.Tree.addMethod("readStates",function(){var e=dynamicTree.getStorageVal("tree"+this.id);if(e)for(var t in e)this.stateObject[t]=e[t]}),dynamicTree.Tree.addMethod("getState",function(e){var t,r=this.stateObject;return r[e]?(t=r[e],(null===t||""===t)&&(t=dynamicTree.TreeNode.State.CLOSED),t):dynamicTree.TreeNode.State.CLOSED}),dynamicTree.Tree.addMethod("writeStates",function(e,t){var r={},i=this.stateObject;for(var d in i)r[d]=i[d];i[e]=t,null!=t&&(r[e]=t),dynamicTree.setStorageVal("tree"+this.id,r)}),dynamicTree.Tree.addMethod("resetStates",function(){this.stateObject={},dynamicTree.setStorageVal("tree"+this.id,"")}),dynamicTree.Tree.addMethod("comparer",function(e,t){var r,i;if(this.sorters&&this.sorters.length)for(r=0;r<this.sorters.length;r++)if(i=this.sorters[r](e,t),0!==i)return i;return 0}),dynamicTree.Tree.addMethod("renderTree",function(){this.readStates(),this.stopWaiting(),this.refreshStyle();var e=this._getElement();this.rootNode&&(this.writeStates(this.rootNode.id,dynamicTree.TreeNode.State.OPEN),this.rootNode.showNode(),this.rootNode.render(e),this.refreshScroll())}),dynamicTree.Tree.addMethod("refreshScroll",function(e){e?setTimeout(function(){this.scroll&&this.scroll.refresh()}.bind(this),e):this.scroll&&this.scroll.refresh()}),dynamicTree.Tree.addMethod("binarySearchOfNode",function(e,t){for(var r=0,i=e.length-1;i>=r;){var d=Math.round((r+i)/2),n=e[d];if(this.comparer(n,t)<0)r=d+1;else{if(!(this.comparer(n,t)>0))return d;i=d-1}}return-(r+1)}),dynamicTree.Tree.addMethod("_deselectAllNodes",function(e){if(this.selectedNodes.length>0){var t=this.selectedNodes.clone();this.resetSelected();for(var r=0;r<t.length;r++)t[r].refreshStyle();if(e){var i=dynamicTree.trees[this.id];i.fireUnSelectAllEvent(e)}}}),dynamicTree.Tree.addMethod("_selectOrEditNode",function(e,t,r,i,d,n){var s,o,a,l=t.isSelected()&&d,c=this.multiSelectEnabled&&t.isSelected()&&r&&!l,h=t.isSelected()&&dynamicTree.treeNodeEdited!==t&&!this.multiSelectEnabled&&!r&&!l,u=null!=dynamicTree.treeNodeEdited&&(f||c),m=this.multiSelectEnabled&&!t.isSelected()&&i&&isNotNullORUndefined(this._lastSelectedNode)&&this._lastSelectedNode.parent===t.parent,T=this.multiSelectEnabled&&t.isSelected()&&i&&isNotNullORUndefined(this._lastSelectedNode)&&this._lastSelectedNode.parent===t.parent,f=!this.multiSelectEnabled&&!t.isSelected()||this.multiSelectEnabled&&!r&&!t.isSelected(),p=!t.isSelected()||f&&this.selectedNodes.length>1;if(i&&this._lastSelectedNode||(this._lastSelectedNode=t),c&&t.deselect(e),f&&this._deselectAllNodes(e),h)return void t.edit(e);if(u&&dynamicTree.treeNodeEdited.doEndEdit(e),m||T){a=t.parent;var E=a.childs.indexOf(this._lastSelectedNode),_=a.childs.indexOf(t);s=Math.min(E,_),o=Math.max(E,_)}if(m)if(s>-1)for(var g=s;o>=g;g++)a.childs[g].select(e);else a.childs[o].select(e);else if(T){for(var g=0;s>g;g++)a.childs[g].deselect(e);for(var g=o+1;g<a.childs.length;g++)a.childs[g].deselect(e)}else p&&t.select(e,t.nofocus,n)}),dynamicTree.Tree.addMethod("_deselectOthers",function(e,t,r,i,d){var n=this.multiSelectEnabled&&this.selectedNodes.length>1&&t.isSelected()&&!(r||i||d);n&&this.selectedNodes.findAll(function(e){return e!=t}.bind(this)).invoke("deselect",e)}),dynamicTree.Tree.addMethod("_selectNextNode",function(e,t){function r(e){return e=e.parent,e?e.nextSibling?e.nextSibling:r(e):null}var i=e.isOpen()&&e.getFirstChild()||e.nextSibling||r(e);i&&e.deselect()&&i.select(t)}),dynamicTree.Tree.addMethod("_selectPreviousNode",function(e,t){function r(e){return!(e.isOpen()&&e.hasChilds())&&e||r(e.getLastChild())}var i=e.prevSibling&&r(e.prevSibling)||e.parent;i&&e.deselect()&&i.select(t)}),dynamicTree.Tree.addMethod("_selectInwards",function(e,t){var r=e.isOpen()&&e.getFirstChild();r?e.deselect()&&r.select(t):e.handleNode(t)}),dynamicTree.Tree.addMethod("_selectOutwards",function(e,t){if(!e.isHiddenRootNode()){var r=e.isOpen()?null:e.parent;r?e.deselect()&&r.select(t):e.handleNode(t)}}),dynamicTree.Tree.addMethod("sortByOrder",function(e,t){var r=e.orderNumber,i=t.orderNumber;return null==r&&null==i?0:null==r?1:null==i?-1:r-i}),dynamicTree.Tree.addMethod("sortByName",function(e,t){var r=e.name.toLowerCase(),i=t.name.toLowerCase();return r>i?1:i>r?-1:0}),dynamicTree.Tree.addVar("TREE_WAIT_TEMPLATE_DOM_ID","list_responsive_collapsible:loading"),dynamicTree.Tree.addMethod("wait",function(){$(this.id).update($(this.TREE_WAIT_TEMPLATE_DOM_ID).cloneNode(!0))}),dynamicTree.Tree.addMethod("stopWaiting",function(){$(this.id).update("")}),dynamicTree.Tree.addMethod("_getTemplateElement",function(e){var t=this.templateDomId,r=$(t).cloneNode(!0);return r.writeAttribute("id",this.getId()),r.templateId=t,r.templateClassName=r.className,cloneCustomAttributes(e,r),r}),define("dynamicTree.tree",["prototype","dragdrop.extra","touchcontroller","utils.common","core.layout"],function(e){return function(){var t;return t||e.dynamicTree}}(this)),dynamicTree.TreeNode=function(e){this.id=dynamicTree.getNextId(),this.treeId=null,this.name=null!=e.name?e.name:this.DEFAULT_NAME,this.param=null!=e.param?e.param:{},this.orderNumber=null!=e.orderNumber?e.orderNumber:null,this.childs=[],this.parent=null,this.Types={Folder:new dynamicTree.TreeNode.Type(this.FOLDER_TYPE_NAME)},this.isloaded=!1,this.delayedRendering=!0,this.haschilds=!1,this.editable=!1,this.isWaiting=!1,this.hidden=!1,this.isDropTarget=!1,dynamicTree.nodes[this.id]=this},dynamicTree.TreeNode.Type=function(e,t){this.name=e,t&&(this.cssClassName=t.cssClassName,this.templateDomId=t.templateDomId)},dynamicTree.TreeNode.State={OPEN:"open",CLOSED:"closed"},dynamicTree.TreeNode.addVar("FOLDER_TYPE_NAME","com.jaspersoft.jasperserver.api.metadata.common.domain.Folder"),dynamicTree.TreeNode.addVar("DEFAULT_NAME","unset name"),dynamicTree.TreeNode.addVar("NODE_ID_PREFIX","node"),dynamicTree.TreeNode.addVar("SUB_NODE_ID_SUFFIX","sub"),dynamicTree.TreeNode.addVar("HANDLER_ID_PREFIX","handler"),dynamicTree.TreeNode.addVar("NODE_CLASS_NAME","node").addVar("LEAF_CLASS_NAME","leaf").addVar("OPEN_CLASS_NAME","open").addVar("CLOSED_CLASS_NAME","closed").addVar("SELECTED_CLASS_NAME","selected").addVar("LOADING_CLASS_NAME","loading").addVar("ROOTS_CLASS_NAME","roots"),dynamicTree.TreeNode.addVar("nodeHeaderTemplateDomId","list_responsive_collapsible:leaf"),dynamicTree.TreeNode.addVar("nodeFooterTemplateDomId","list_responsive_collapsible"),dynamicTree.TreeNode.addVar("nodeInputTemplateDomId","list_responsive_collapsible:input"),dynamicTree.TreeNode.addVar("isSelectable",!1),dynamicTree.TreeNode.addMethod("getTreeId",function(){return this.treeId||this.parent&&this.parent.getTreeId()}),dynamicTree.TreeNode.addMethod("getState",function(){return dynamicTree.trees[this.getTreeId()].getState(this.id)}),dynamicTree.TreeNode.addMethod("isParent",function(){return this.param.type==this.Types.Folder.name}),dynamicTree.TreeNode.addMethod("addChild",function(e){if(this.isParent()){var t=this.childs[this.childs.length-1];t&&(t.nextSibling=e,e.prevSibling=t),this.childs.push(e),e.parent=this,this.resortChilds(),this.delayedRendering||(e.showNode(),e.render(this._getChildrenElement(),e.nextSibling))}}),dynamicTree.TreeNode.addMethod("removeChild",function(e){for(var t=0;t<this.childs.length;t++)if(this.childs[t]==e){this.childs.splice(t,1);break}if(e.deselect(),!this.delayedRendering){var r=e._getElement();r&&r.remove()}}),dynamicTree.TreeNode.addMethod("resortChilds",function(){var e=this.getTreeId(),t=dynamicTree.trees[e];if(t&&t.sortNodes&&isArray(this.childs)){this.childs.sort(function(e,r){return t.comparer(e,r)});for(var r=this.childs.length;r--;){var i=this.childs[r];i.prevSibling=this.childs[r-1],i.nextSibling=this.childs[r+1]}}}),dynamicTree.TreeNode.addMethod("resetChilds",function(){this.childs=[]}),dynamicTree.TreeNode.addMethod("setHasChilds",function(e){this.haschilds=e}),dynamicTree.TreeNode.addMethod("hasChilds",function(){return this.haschilds?!0:this.getChildCount()>0}),dynamicTree.TreeNode.addMethod("getChildCount",function(){return this.childs.length}),dynamicTree.TreeNode.addMethod("getFirstChild",function(){return this.hasChilds()?this.childs[0]:null}),dynamicTree.TreeNode.addMethod("getLastChild",function(){return this.hasChilds()?this.childs[this.childs.length-1]:null}),dynamicTree.TreeNode.addMethod("_getElement",function(e){return this._element||(this._element=$(this.NODE_ID_PREFIX+this.id)),this._element}),dynamicTree.TreeNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0];e.cleanWhitespace();var t=e.childNodes[e.childNodes.length-1];return"#text"!==t.nodeName&&(t=document.createTextNode(""),e.appendChild(t)),t}),dynamicTree.TreeNode.addMethod("_getTitleInputElement",function(){return $(this._getElement().getElementsByTagName("input")[0])}),dynamicTree.TreeNode.addMethod("_getChildrenElement",function(){return this._childrenElement||(this._childrenElement=$(this.NODE_ID_PREFIX+this.id+this.SUB_NODE_ID_SUFFIX)),this._childrenElement}),dynamicTree.TreeNode.addMethod("isOpen",function(){return this.getState()===dynamicTree.TreeNode.State.OPEN}),dynamicTree.TreeNode.addMethod("changeName",function(e){this.name=e,this._getTitle().data=this.name}),dynamicTree.TreeNode.addMethod("getType",function(){for(var e in this.Types)if(this.param.type===this.Types[e].name)return this.Types[e]}),dynamicTree.TreeNode.addMethod("refreshStyle",function(e){if(e=$(e)||this._getElement()){e.templateClassName&&(e.className=e.templateClassName),this.isParent()?(e.addClassName(this.NODE_CLASS_NAME).removeClassName(this.LEAF_CLASS_NAME),this.isWaiting||(this.isOpen()?e.addClassName(this.OPEN_CLASS_NAME).removeClassName(this.CLOSED_CLASS_NAME):e.addClassName(this.CLOSED_CLASS_NAME).removeClassName(this.OPEN_CLASS_NAME))):e.addClassName(this.LEAF_CLASS_NAME).removeClassName(this.NODE_CLASS_NAME),this.isWaiting?e.addClassName(this.LOADING_CLASS_NAME):e.removeClassName(this.LOADING_CLASS_NAME),this.isSelected()?e.addClassName(this.SELECTED_CLASS_NAME):e.removeClassName(this.SELECTED_CLASS_NAME),this.hidden?e.addClassName(layoutModule.HIDDEN_CLASS):e.removeClassName(layoutModule.HIDDEN_CLASS),this.param.cssClass&&e.addClassName(this.param.cssClass);var t=this.getType();t&&t.cssClassName&&e.addClassName(t.cssClassName);var r=e.down();this.isDropTarget&&r&&r.addClassName(layoutModule.DROP_TARGET_CLASS),!this.isDropTarget&&r&&r.removeClassName(layoutModule.DROP_TARGET_CLASS)}}),dynamicTree.TreeNode.addMethod("_createNode",function(){var e=this.id,t=dynamicTree.trees[this.getTreeId()],r=this._getHeaderTemplateElement();r.id=this.NODE_ID_PREFIX+e,r.tabIndex=-1,this.refreshStyle(r),this.treeId=t.id,r.treeNode=this;var i=r.childElements()[0];i.insert(xssUtil.escape(this.name,{softHTMLEscape:!0,whiteList:["a"]})),null!=this.tooltip&&this.tooltip.length>0&&(i.title=this.tooltip),i.childElements().each(function(t,r){0===r&&(t.id=this.HANDLER_ID_PREFIX+e);var i=this.iconTooltip;i&&(t.title=isArray(i)?i[r]:i)}.bind(this)),this._element=r}),dynamicTree.TreeNode.addMethod("_createNodeChildren",function(){var e=this._getFooterTemplateElement();e.id=this.NODE_ID_PREFIX+this.id+this.SUB_NODE_ID_SUFFIX,this._childrenElement=e}),dynamicTree.TreeNode.addMethod("showNode",function(e){var t=dynamicTree.trees[this.getTreeId()];if(this._createNode(),this.isParent()){var r=this.isOpen()||t.showAllNodesOnStartup;if(r){this._createNodeChildren();for(var i=0;i<this.getChildCount();i++)this.childs[i].showNode(this._getChildrenElement());this.delayedRendering=!1,t.fireOpenEvent(this)}}this.render(e)}),dynamicTree.TreeNode.addMethod("render",function(e,t){if(!Object.isUndefined(e)){var r=$(e);r&&(this._getChildrenElement()&&this._getElement().insert(this._getChildrenElement()),t?r.insert(this._getElement(),{before:t._getElement()}):r.insert(this._getElement()))}}),dynamicTree.TreeNode.addMethod("_renderChildren",function(){var e=this._getElement();e&&this._getChildrenElement()&&e.insert(this._getChildrenElement())}),dynamicTree.TreeNode.addMethod("refreshNode",function(){if(this.refreshStyle(),this.isParent()&&this.isOpen()&&this.isloaded){this.delayedRendering?(this._createNodeChildren(),this._renderChildren()):this._getChildrenElement().update("");for(var e=0;e<this.getChildCount();e++)this.childs[e].showNode(this._getChildrenElement());this.delayedRendering=!1}var t=dynamicTree.trees[this.getTreeId()];t.refreshScroll()}),dynamicTree.TreeNode.addMethod("wait",function(){this.isWaiting=!0,this.refreshStyle()}),dynamicTree.TreeNode.addMethod("stopWaiting",function(){this.isWaiting=!1,this.refreshStyle()}),dynamicTree.TreeNode.addMethod("isHiddenRootNode",function(){var e=dynamicTree.trees[this.getTreeId()];return e.rootNode==this&&!e.bShowRoot}),dynamicTree.TreeNode.addMethod("deselect",function(e){var t=dynamicTree.trees[this.getTreeId()];return t&&this.isSelected()?(t.removeNodeFromSelected(this),this.refreshStyle(),e&&t.fireUnSelectEvent(this,e),!0):!1}),dynamicTree.TreeNode.addMethod("select",function(e,t,r){if(r=r||{},!t&&this.focus(),this.isSelected())return!1;var i=dynamicTree.trees[this.getTreeId()];return i.addNodeToSelected(this),this.refreshStyle(),!r.silent&&i.fireSelectEvent(this,e),!0}),dynamicTree.TreeNode.addMethod("focus",function(){var e=this;!isIPad()&&this._getElement()&&setTimeout(function(){e._getElement().focus()},100)}),dynamicTree.TreeNode.addMethod("isSelected",function(){var e=dynamicTree.trees[this.getTreeId()];return e&&e.isNodeSelected(this)}),dynamicTree.TreeNode.addMethod("_removeTitle",function(){var e=this._getTitle();e.data="",$(e.parentNode).cleanWhitespace()}),dynamicTree.TreeNode.addMethod("edit",function(e){if(this.editable){if(dynamicTree.treeNodeEdited==this)return;dynamicTree.treeNodeEdited=this;var t=this.name,r=$(this._getTitle().parentNode),i=this._getInputTemplateElement();this._getTitle().data="",r.cleanWhitespace(),r.insert(i),i.value=xssUtil.unescape(this.name),i.focus(),i.select(e),i.onclick=function(e){cancelEventBubbling(e)},i.ondblclick=function(e){cancelEventBubbling(e)},i.onmousedown=function(e){cancelEventBubbling(e)},i.onmouseup=function(e){cancelEventBubbling(e)},i.onkeydown=function(e){var r=window.event?window.event:e;13==r.keyCode?(i.onblur=null,this.doEndEdit(r)):27==r.keyCode&&(i.onblur=null,i.value=t,this.doEndEdit(r))}.bindAsEventListener(this),i.onblur=function(e){this.doEndEdit(e)}.bindAsEventListener(this),dynamicTree.trees[this.getTreeId()].fireStartEditEvent(this,i)}}),dynamicTree.TreeNode.addMethod("doEndEdit",function(e){this.editEnded(),dynamicTree.trees[this.getTreeId()].fireEndEditEvent(this)}),dynamicTree.TreeNode.addMethod("editEnded",function(){var e=dynamicTree.trees[this.getTreeId()];if(null!=dynamicTree.treeNodeEdited){var t=this._getTitleInputElement(),r=($(t.parentNode),t.value);if(r==dynamicTree.treeNodeEdited.name)return t.remove(),this._getTitle().data=dynamicTree.treeNodeEdited.name,void(dynamicTree.treeNodeEdited=null);e.fireEditEvent(dynamicTree.treeNodeEdited,r),dynamicTree.editaborted||(dynamicTree.treeNodeEdited.name=r,t.remove(),this._getTitle().data=r),dynamicTree.treeNodeEdited=null}}),dynamicTree.TreeNode.addMethod("scroll",function(e){var t=dynamicTree.trees[this.getTreeId()].rootNode._getElement(),r=e?$(e):$(t.parentNode),i=this._getElement();if(r){var d=r.clientHeight,n=r.clientWidth,s=r.scrollTop,o=r.scrollLeft,a=i.cumulativeOffset().top-r.cumulativeOffset().top,l=i.offsetLeft,c=i.clientHeight,h=i.clientWidth;a>s+d?r.scrollTop=a-(d/2-c/2):s>a+c&&(r.scrollTop=a-(d/2-c/2)),l>o+n?r.scrollLeft=l-(n/2-h/2):o>l+h&&(r.scrollTop=l-(n/2-h/2))}}),dynamicTree.TreeNode.addMethod("handleNode",function(e){if(this.isParent()){var t=dynamicTree.trees[this.getTreeId()];this.isOpen()?t.writeStates(this.id,dynamicTree.TreeNode.State.CLOSED):(t.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),t.fireOpenEvent(this,e)),this.refreshNode()}}),dynamicTree.TreeNode.addMethod("openNode",function(e){if(this.isParent()){var t=dynamicTree.trees[this.getTreeId()];this.isOpen()||(t.writeStates(this.id,dynamicTree.TreeNode.State.OPEN),t.fireOpenEvent(this,e)),this.refreshNode()}}),dynamicTree.TreeNode.addMethod("_getHeaderTemplateElement",function(){var e=this.getType(),t=e&&e.templateDomId?e.templateDomId:this.nodeHeaderTemplateDomId,r=$(t).cloneNode(!0);return r.templateId=t,r.templateClassName=r.className,r}),dynamicTree.TreeNode.addMethod("_getFooterTemplateElement",function(){var e=this.nodeFooterTemplateDomId,t=$(e).cloneNode(!0);return t.templateId=e,t.update(""),t}),dynamicTree.TreeNode.addMethod("_getInputTemplateElement",function(){var e=this.nodeInputTemplateDomId,t=$(e).cloneNode(!0);return t.templateId=e,t}),define("dynamicTree.treenode",["prototype","underscore","dynamicTree.tree"],function(e){return function(){var t;return t||e.dynamicTree}}(this)),dynamicTree.Tree.addVar("NODE_PATTERN",".node").addVar("NODE_WRAPPER_PATTERN",".node > .wrap").addVar("NODE_ICON_PATTERN",".node > .wrap .icon").addVar("NODE_CUSTOM_PATTERNS",[]),dynamicTree.Tree.addVar("LEAF_PATTERN",".leaf").addVar("LEAF_WRAPPER_PATTERN",".leaf > .wrap").addVar("LEAF_ICON_PATTERN",".leaf > .wrap .icon").addVar("LEAF_CUSTOM_PATTERNS",[]),dynamicTree.Tree.addVar("EXPANDING_TIME",1e3),dynamicTree.Tree.addVar("draggables",[]),dynamicTree.Tree.addMethod("getTreeNodeByEvent",function(e){var t=Event.element(e);return this.getTreeNodeByElement(t)}),dynamicTree.Tree.addMethod("getTreeNodeByElement",function(e){for(;e&&e.readAttribute&&e.readAttribute("id")!==this.id;){var t=e.treeNode;if(t&&t.getTreeId()===this.getId())return t;e=$(e.parentNode)}return null}),dynamicTree.Tree.addMethod("isNodeEvent",function(e){var t=matchMeOrUp(e.element().parentNode,"LI");return t&&t.hasClassName(layoutModule.NODE_CLASS)}),dynamicTree.Tree.addMethod("isLeafEvent",function(e){var t=matchMeOrUp(e.element().parentNode,"LI");return t&&t.hasClassName(layoutModule.LEAF_CLASS)}),dynamicTree.Tree.addMethod("isIconEvent",function(e){return e.element().hasClassName(layoutModule.ICON_CLASS)}),dynamicTree.Tree.addMethod("_registerEvents",function(){this._cleanUpListeners(),this._registerClickEvents(),this._registerCustomEvents(),this._registerKeyEvents(),this._registerMouseEvents()}),dynamicTree.Tree.addMethod("_cleanUpListeners",function(){var e=this._getElement();e.stopObserving("click"),e.stopObserving("dblclick"),isSupportsTouch()?(e.stopObserving("touchstart"),e.stopObserving("drag:touchstart"),e.stopObserving("touchend")):(e.stopObserving("mousedown"),e.stopObserving("drag:mousedown"),e.stopObserving("mouseup")),e.stopObserving("mouseover"),e.stopObserving("mouseout")}),dynamicTree.Tree.addMethod("_registerClickEvents",function(){var e=this._getElement();e.observe("click",function(t){var r=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(r){var i=this.isIconEvent(t),d=this.isNodeEvent(t),n=this.isLeafEvent(t);d?(i&&e.fire("nodeIcon:click",{targetEvent:t,node:r}),e.fire("node:click",{targetEvent:t,node:r})):n&&(i&&e.fire("nodeIcon:click",{targetEvent:t,node:r}),e.fire("leaf:click",{targetEvent:t,node:r})),!isIPad()&&d&&i&&r.handleNode(t)}}.bindAsEventListener(this)),e.observe("dblclick",function(t){var r=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(r){var i=this.isIconEvent(t),d=this.isNodeEvent(t),n=this.isLeafEvent(t);d?(i&&e.fire("nodeIcon:dblclick",{targetEvent:t,node:r}),e.fire("node:dblclick",{targetEvent:t,node:r})):n&&(i&&e.fire("leafIcon:dblclick",{targetEvent:t,node:r}),e.fire("leaf:dblclick",{targetEvent:t,node:r})),this.handleNodeOnDblclick&&(d||n)&&!i&&r.handleNode(t)}}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("_registerMouseEvents",function(){var e=this._getElement();e.observe(isSupportsTouch()?"touchstart":"mousedown",function(t){var r=t.element(),i=matchMeOrUp(r,layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(i){t.treeEvent=!0;var d=this.isIconEvent(t),n=this.isNodeEvent(t),s=this.isLeafEvent(t);if(isSupportsTouch())if(JRS.vars.ajax_in_progress)alert("please wait");else if(this.twofingers=!1,2==t.touches.length&&(this.twofingers=!0,this._selectOrEditNode(t,i,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),i.isSelected()||designerBase&&designerBase.isInSelection(i))){var o=jQuery(r).parents("li:first");return void(o.hasClass("selected")&&document.fire(layoutModule.ELEMENT_CONTEXTMENU,{targetEvent:t,node:r}))}isSupportsTouch()&&JRS.vars.ajax_in_progress||(!this.selectOnMousedown||isSupportsTouch()&&1!=t.touches.length||this._selectOrEditNode(t,i,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),n?(d&&e.fire("nodeIcon:mousedown",{targetEvent:t,node:i}),e.fire("node:mousedown",{targetEvent:t,node:i})):s&&(d&&e.fire("leafIcon:mousedown",{targetEvent:t,node:i}),e.fire("leaf:mousedown",{targetEvent:t,node:i})))}}.bindAsEventListener(this)),e.observe(isSupportsTouch()?"drag:touchstart":"drag:mousedown",function(t){var r=t.memo.targetEvent,i=matchMeOrUp(r.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(r);if(i){r.treeEvent=!0;var d=this.isIconEvent(r),n=this.isNodeEvent(r),s=this.isLeafEvent(r);this.selectOnMousedown&&!isRightClick(r)&&this._selectOrEditNode(r,i,isMetaHeld(r),isShiftHeld(r),isRightClick(r)),n?(d&&e.fire("nodeIcon.drag:mousedown",{targetEvent:r,node:i}),e.fire("node.drag:mousedown",{targetEvent:r,node:i})):s&&(d&&e.fire("leafIcon.drag:mousedown",{targetEvent:r,node:i}),e.fire("leaf.drag:mousedown",{targetEvent:r,node:i}))}}.bindAsEventListener(this)),e.observe(isSupportsTouch()?"touchend":"mouseup",function(t){var r=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);if(r){t.treeEvent=!0;var i=this.isIconEvent(t),d=this.isNodeEvent(t),n=this.isLeafEvent(t);if(this.twofingers&&(t.isEmulatedRightClick=!0),isSupportsTouch()&&!this.twofingers&&(this.clickid==r.id&&!JRS.vars.ajax_in_progress&&t.timeStamp-this.clicktime<700&&(d?(i&&e.fire("nodeIcon:dblclick",{targetEvent:t,node:r}),e.fire("node:dblclick",{targetEvent:t,node:r})):n&&(i&&e.fire("leafIcon:dblclick",{targetEvent:t,node:r}),e.fire("leaf:dblclick",{targetEvent:t,node:r})),this.handleNodeOnDblclick&&(d||n)&&!i&&r.handleNode(t)),this.clicktime=t.timeStamp,this.clickid=r.id),!isSupportsTouch()||!JRS.vars.ajax_in_progress){this.selectOnMousedown||TouchController.element_scrolled||isSupportsTouch()&&1!=t.changedTouches.length||this._selectOrEditNode(t,r,isMetaHeld(t),isShiftHeld(t),isRightClick(t)),this._deselectOthers(t,r,isMetaHeld(t),isShiftHeld(t),isRightClick(t));d?(i&&e.fire("nodeIcon:mouseup",{targetEvent:t,node:r}),e.fire("node:mouseup",{targetEvent:t,node:r})):n&&(i&&e.fire("leafIcon:mouseup",{targetEvent:t,node:r}),e.fire("leaf:mouseup",{targetEvent:t,node:r})),isSupportsTouch()&&d&&i&&!TouchController.element_scrolled&&r.handleNode(t)}}}.bindAsEventListener(this)),"createTouch"in document||(e.observe("mouseover",function(t){var r=t.element(),i=matchMeOrUp(r,layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);i&&(Draggables.dragging&&(clearTimeout(this.timeout_id),this.timeout_id=setTimeout(function(e){i.openNode(e)},this.EXPANDING_TIME)),this.createDraggableIfNeeded(t,i),!isIE7()&&e.fire("tree:mouseover",{targetEvent:t,node:i
}))}.bindAsEventListener(this)),isIE7()||e.observe("mouseout",function(t){var r=matchMeOrUp(t.element(),layoutModule.BUTTON_PATTERN)&&this.getTreeNodeByEvent(t);r&&e.fire("tree:mouseout",{targetEvent:t,node:r})}.bindAsEventListener(this))),Droppables.add(e,{accept:this.dropClasses,onDrop:function(e){this.elementDropped=e}.bind(this)})}),dynamicTree.Tree.addMethod("_registerKeyEvents",function(){var e=this._getElement();e.observe("key:down",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectNextNode(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:up",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectPreviousNode(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:right",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectInwards(t,e.memo.targetEvent)}.bindAsEventListener(this)),e.observe("key:left",function(e){var t=this.getTreeNodeByEvent(e);dynamicTree.treeNodeEdited!==t&&t&&this._selectOutwards(t,e.memo.targetEvent)}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("_registerCustomEvents",function(){var e=this._getElement();e.observe("mousedown",function(t){dynamicTree.activeTreeId&&dynamicTree.activeTreeId===this.getId()||(e.fire("tree:blur",{targetEvent:t,tree:dynamicTree.getActiveTree()}),dynamicTree.activeTreeId=this.getId(),e.fire("tree:focus",{targetEvent:t,tree:dynamicTree.getActiveTree()}))}.bindAsEventListener(this)),e.observe("mouseover",function(t){var r=this.getTreeNodeByEvent(t);r||e.fire("tree:mouseover",{targetEvent:t,tree:this})}.bindAsEventListener(this)),e.observe("mouseout",function(t){var r=this.getTreeNodeByEvent(t);r||e.fire("tree:mouseout",{targetEvent:t,tree:this})}.bindAsEventListener(this))}),dynamicTree.Tree.addMethod("fireOpenEvent",function(e,t){var r=this._getElement();r.fire("node:open",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireSelectEvent",function(e,t){var r=this._getElement();r.fire(e.isParent()?"node:selected":"leaf:selected",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireUnSelectEvent",function(e,t){var r=this._getElement();r.fire(e.isParent()?"node:unselected":"leaf:unselected",{node:e,targetEvent:t})}),dynamicTree.Tree.addMethod("fireUnSelectAllEvent",function(e){var t=this._getElement();t.fire("items:unselected",{targetEvent:e})}),dynamicTree.Tree.addMethod("fireEditEvent",function(e,t){var r=this._getElement();r.fire(e.isParent()?"node:edit":"leaf:edit",{node:e,newValue:t})}),dynamicTree.Tree.addMethod("fireStartEditEvent",function(e,t){var r=this._getElement();r.fire(e.isParent()?"node:startEdit":"leaf:startEdit",{node:e,input:t})}),dynamicTree.Tree.addMethod("fireEndEditEvent",function(e){var t=this._getElement();t.fire(e.isParent()?"node:endEdit":"leaf:endEdit",{node:e})}),dynamicTree.Tree.addMethod("observe",function(e,t){this._getElement().observe(e,t)}),dynamicTree.Tree.addMethod("stopObserving",function(e,t){this._getElement().stopObserving(e,t)}),dynamicTree.Tree.addMethod("createDraggableIfNeeded",function(e,t){var r=e?e.element():t._getElement().down(this.dragPattern),i=this.draggables[r.identify()];if(this.dragPattern&&!i){var d=matchAny(r,[this.dragPattern],!0);if(d&&r.className.toLowerCase().indexOf("icon")<0&&!this.draggables[d.identify()])return this.draggables[d.identify()]=new Draggable(r,{superghosting:!0,mouseOffset:!0,delay:isIE()||isSupportsTouch()?200:0,onStart:this.setDragStartState.bind(this,t),onEnd:this.setDragEndState.bind(this,t)}),this.draggables[d.identify()]}return null}),dynamicTree.Tree.addMethod("setDragStartState",function(e,t,r){var i=e._getElement().templateClassName;i&&t.element.addClassName(i),t.element.setStyle({width:null,height:null}),t.element.addClassName(layoutModule.DRAGGING_CLASS).addClassName(this.getId()),this.dragClasses&&t.element.addClassName(this.dragClasses),this.selectedNodes.length>1&&t.element.update(new Template(this.TREE_NN_ITEMS_SELECTED).evaluate({count:this.selectedNodes.length})),t.element.node=e,t.element.nodes=this.selectedNodes,t.options.scroll=this._getElement(),t.options.scrollSensitivity=layoutModule.SCROLL_SENSITIVITY,Draggables.dragging=this.regionID||!0}),dynamicTree.Tree.addMethod("setDragEndState",function(e,t,r){delete Draggables.dragging}),define("dynamicTree.events",["prototype","dynamicTree.tree"],function(e){return function(){var t;return t||e.dynamicTree}}(this)),dynamicTree.TreeSupport=function(e,t){if(dynamicTree.Tree.call(this,e,t),this.providerId=t.providerId,this.hideLoader=t.hideLoader,this.rootUri=Object.isUndefined(t.rootUri)?"/":t.rootUri,this.nodeClass=t.nodeClass&&Object.isFunction(t.nodeClass)?t.nodeClass:dynamicTree.TreeNode,t.rootObjectModifier&&(this.modifyRootObject=t.rootObjectModifier),this.resetStatesOnShow=Object.isUndefined(t.resetStatesOnShow)||t.resetStatesOnShow,this.inInit=!0,this.ajaxBufferId="ajaxbuffer",this.nodeTextId="treeNodeText",this.urlGetNode=t.urlGetNode?t.urlGetNode:this._getFlowUrl("getNode"),this.urlGetChildren=t.urlGetChildren?t.urlGetChildren:this._getFlowUrl("getChildren"),this.urlGetMultipleChildren=t.urlGetMultipleChildren?t.urlGetMultipleChildren:this._getFlowUrl("getMultipleChildren"),this.urlGetMessage=t.urlGetMessage?t.urlGetMessage:this._getFlowUrl("getMessage"),this.additionalParams=t.additionalParams?t.additionalParams:{},null==this.TREE_NN_ITEMS_SELECTED){var r=function(e){this.TREE_NN_ITEMS_SELECTED=e}.bind(this);this.getMessage("TREE_NN_ITEMS_SELECTED",r,null)}this._initOpenListener()},dynamicTree.TreeSupport.prototype=deepClone(dynamicTree.Tree.prototype),dynamicTree.TreeSupport.addMethod("_initOpenListener",function(){this.observe("node:open",function(e){var t=e.memo.node;t&&!t.isloaded&&this.getTreeNodeChildren(t)}.bindAsEventListener(this))}),dynamicTree.TreeSupport.addMethod("stopObserving",function(e,t){this._getElement().stopObserving(e,t),"node:open"!==e||t||this._initOpenListener()}),dynamicTree.TreeSupport.addMethod("_getFlowUrl",function(e){return __jrsConfigs__.contextPath+"/flow.html?_flowId=treeFlow&method="+e}),dynamicTree.TreeSupport.addMethod("showTree",function(e,t,r,i){var d=this.urlGetNode+"&provider="+this.providerId+"&uri="+this.rootUri+"&depth="+e;i&&(d+="&forceHtmlEscape=true"),d+="&"+this._evaluateAdditionalParams(),this._showTree(d,t,r)}),dynamicTree.TreeSupport.addMethod("_evaluateAdditionalParams",function(){var e=this.additionalParams;return _.isFunction(e)&&(e=e.call(null)),_.isObject(e)?Object.toQueryString(e):null}),dynamicTree.TreeSupport.addMethod("showTreePrefetchNodes",function(e,t,r){var i=this.urlGetNode+"&provider="+this.providerId+"&uri="+this.rootUri;e&&(i+="&prefetch="+encodeURIComponent(e)),i+="&"+this._evaluateAdditionalParams(),this._showTree(i,t,r)}),dynamicTree.TreeSupport.addMethod("_showTree",function(e,t,r){var i=this;this.inInit=!0,this.wait();var d=function(e,t,r){return function(){return e.showTreeCallback(t,r)}}(this,t,r),n=function(){var e=!1;return i.httpErrorHandler&&(e=i.httpErrorHandler.apply(window,arguments)),e===!1&&(e=baseErrorHandler.apply(window,arguments)),e};ajaxTargettedUpdate(e,{fillLocation:this.ajaxBufferId,callback:d,errorHandler:n,hideLoader:this.hideLoader})}),dynamicTree.TreeSupport.addMethod("showTreeCallback",function(e,t){var r=document.getElementById(this.nodeTextId);if(null==r)return void(t?t():this.fireServerErrorEvent());var i=xssUtil.unescape(jQuery(r).text()),d=i.evalJSON();this.modifyRootObject&&(d=this.modifyRootObject(d,!1)),r=document.getElementById(this.ajaxBufferId),r.innerHTML="",this.setRootNode(this.processNode(d)),this.resortTree(),this.resetStatesOnShow&&this.resetStates(),this.renderTree(),this.inInit=!1,e?e():this.fireTreeLoadedEvent({tree:this})}),dynamicTree.TreeSupport.addMethod("processNode",function(e){var t={};t.id=e.id,t.type=e.type,t.uri=e.uri,t.extra=deepClone(e.extra),e.cssClass&&(t.cssClass=e.cssClass);var r=this.nodeClass,i=new r({name:unescapeBackslash(e.label),param:t,orderNumber:e.order});e.tooltip&&(i.tooltip=e.tooltip);var d=e.children;if(null!=d){var n=d.length;if(0===n)i.setHasChilds(!1);else for(var s=0;n>s;s++){var o=d[s];if(o){var a=this.processNode(o);i.addChild(a)}}i.isloaded=!0}return i}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildren",function(e,t,r){var i=e.param.uri,d=function(e,t,r,i){return function(){return e.getTreeNodeChildrenCallback(t,r,i)}}(this,e.id,t,r),n=function(t){(500==t.status||t.getResponseHeader("JasperServerError"))&&e.stopWaiting(),baseErrorHandler(t)};ajaxTargettedUpdate(this.urlGetChildren+"&provider="+this.providerId+"&uri="+encodeURIComponent(encodeURIComponent(i))+"&"+this._evaluateAdditionalParams(),{fillLocation:this.ajaxBufferId,callback:d,errorHandler:n,hideLoader:this.hideLoader}),this.inInit||e.wait()}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenCallback",function(e,t,r){var i=document.getElementById(this.nodeTextId);if(null==i)return void(r?r():this.fireServerErrorEvent());var d=xssUtil.unescape(jQuery(i).text()).evalJSON(),n=dynamicTree.nodes[e];this.modifyRootObject&&(d=this.modifyRootObject(d,!0,n)),i=document.getElementById(this.ajaxBufferId),i.innerHTML="",n.resetChilds(),n.stopWaiting();var s=d.length;if(0===s)n.setHasChilds(!1);else{var o=n.getTreeId(),a=o?dynamicTree.trees[o]:null,l=a?a.sortNodes:null;a&&(a.sortNodes=!1);for(var c=0;s>c;c++){var h=this.processNode(d[c]);n.addChild(h)}a&&(a.sortNodes=l,n.resortChilds())}n.isloaded=!0,n.refreshNode(),t?t(n.childs):this.fireChildrenLoadedEvent(n.childs)}),dynamicTree.TreeSupport.addMethod("getTreeMultipleNodesChildren",function(e,t,r){var i,d="",n=[];if(e&&e.length)for(i=0;i<e.length;i++)i>0&&(d+=","),d+=encodeURIComponent(encodeURIComponent(e[i].param.uri)),n[i]=e[i].id;if(d.length){var s=function(e,t,r,i){return function(){return e.getTreeMultipleNodesChildrenCallback(t,r,i)}}(this,n,t,r);if(ajaxTargettedUpdate(this.urlGetMultipleChildren+"&provider="+this.providerId,{fillLocation:this.ajaxBufferId,callback:s,postData:"uris="+d,errorHandler:baseErrorHandler,hideLoader:this.hideLoader}),!this.inInit)for(i=0;i<e.length;i++)e[i].wait()}}),dynamicTree.TreeSupport.addMethod("getTreeMultipleNodesChildrenCallback",function(e,t,r){var i=document.getElementById(this.nodeTextId);if(null==i)return void(r?r():this.fireServerErrorEvent());var d=xssUtil.unescape(jQuery(i).text()).evalJSON();i=document.getElementById(this.ajaxBufferId),i.innerHTML="",t?t(e,d):(this.setMultipleNodesChilden(e,d),this.fireMultipleChildrenLoadedEvent(e,d))}),dynamicTree.TreeSupport.addMethod("setMultipleNodesChilden",function(e,t,r){if(e&&t)for(var i=0;i<t.length;i++){for(var d=t[i],n=d.children,s=null,o=0;o<e.length;o++){var a=dynamicTree.nodes[e[o]];if(a.param.uri==d.parentUri){s=a;break}}if(s){s.resetChilds(),s.stopWaiting();var l=n.length;if(0===l)s.setHasChilds(!1);else{var c=s.getTreeId(),h=c?dynamicTree.trees[c]:null,u=h?h.sortNodes:null;h&&(h.sortNodes=!1);for(var m=0;l>m;m++){var T=this.processNode(n[m]);s.addChild(T)}h&&(h.sortNodes=u,s.resortChilds())}s.isloaded=!0,r||s.refreshNode()}}}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenPrefetched",function(e,t,r,i,d,n,s){var o=e.param.uri,a=this.urlGetNode+"&provider="+this.providerId+"&uri="+o,l="";t&&(l="&prefetch="+t),d&&(a+="&depth="+d);var c=function(e,t,r,i,d,n){return function(){return e.getTreeNodeChildrenPrefetchedCallback(t,r,i,d,n)}}(this,e.id,r,i,n,s);ajaxTargettedUpdate(a,{fillLocation:this.ajaxBufferId,callback:c,postData:l,errorHandler:baseErrorHandler,hideLoader:this.hideLoader}),this.inInit||e.wait()}),dynamicTree.TreeSupport.addMethod("getTreeNodeChildrenPrefetchedCallback",function(e,t,r,i,d){var n=document.getElementById(this.nodeTextId);if(null==n)return void(r?r():this.fireServerErrorEvent());var s=xssUtil.unescape(jQuery(n).text()).evalJSON();n=document.getElementById(this.ajaxBufferId),n.innerHTML="";var o=dynamicTree.nodes[e];if(o.resetChilds(),o.stopWaiting(),s.children){var a=o.getTreeId(),l=a?dynamicTree.trees[a]:null,c=l?l.sortNodes:null;l&&(l.sortNodes=!1);for(var h=0;h<s.children.length;h++){var u=this.processNode(s.children[h]);o.addChild(u)}l&&(l.sortNodes=c,i||o.resortChilds())}o.isloaded=!0,d||o.refreshNode(),t?t():this.fireChildredPrefetchedLoadedEvent(o.childs)}),dynamicTree.TreeSupport.addMethod("openAndSelectNode",function(e,t,r,i){var d=function(e){var t=dynamicTree.trees[e.getTreeId()];e.parent&&t&&t.rootNode!=e.parent&&t.getState(e.parent.id)==dynamicTree.TreeNode.State.CLOSED&&e.parent.handleNode(),e&&jQuery("#dataChooserSource").length&&(e.nofocus=!0),t._selectOrEditNode(void 0,e,!1,!1,!1,i)};this.processNodePath(e,d,r);var n=this.getSelectedNode();n&&n.scroll(),t&&t()}),dynamicTree.TreeSupport.addMethod("processNodePath",function(e,t,r){var i=this.getRootNode();if("/"===e)t(i);else{var d,n=e.split("/");for(d=0;d<n.length;d++)if(n[d]){var s=i;if(i=this.findNodeChildByMetaName(i,n[d]),!i){if(!r)return;if(i=this.findNodeFirstNodeChildByAlphabeticalOrder(s),!i)return}t(i)}}}),dynamicTree.TreeSupport.addMethod("findLastLoadedNode",function(e){var t={node:null},r=function(e){return function(t){e.node=t}}(t);return this.processNodePath(e,r),t.node}),dynamicTree.TreeSupport.addMethod("findNodeChildByMetaName",function(e,t){if(e.hasChilds())for(var r=0;r<e.childs.length;r++)if(e.childs[r].param.id==t)return e.childs[r];return null}),dynamicTree.TreeSupport.addMethod("findNodeFirstNodeChildByAlphabeticalOrder",function(e){var t=null,r=null;if(e.childs.length>0){t=e.childs[0].param.id,r=0;for(var i=null,d=null,n=1;n<e.childs.length;n++){i=e.childs[n].param.id,d=n;for(var s=i.length<t.length?i.length:t.length,o=0;s>o;o++){if(i.charCodeAt(o)<t.charCodeAt(o)){t=i,r=d;break}if(i.charCodeAt(o)>t.charCodeAt(o))break}}return e.childs[r]}return null}),dynamicTree.TreeSupport.addMethod("findNodeById",function(e,t){return function r(e,t){if(!t||!e)return null;if(t.param.id===e)return t;if(t.hasChilds())for(var i=0;i<t.childs.length;++i){var d=r(e,t.childs[i]);if(d)return d}return null}(e,t?t:this.getRootNode())}),dynamicTree.TreeSupport.addMethod("hasVisibleFolders",function(e){if(this.bShowRoot)return!0;var t=e.children;if(t)for(var r=0;r<t.length;r++){var i=e.children[r].children;if(i&&i.length>0)return!0}return!1}),dynamicTree.TreeSupport.addMethod("getMessage",function(e,t,r){var i=this.urlGetMessage+"&messageId="+e,d=function(e,t,r){return function(){return e.getMessageCallback(t,r)}}(this,t,r);ajaxTargettedUpdate(i,{fillLocation:this.ajaxBufferId,callback:d,errorHandler:baseErrorHandler,hideLoader:this.hideLoader})}),dynamicTree.TreeSupport.addMethod("getMessageCallback",function(e,t){var r=document.getElementById(this.ajaxBufferId);if(null==r)return void(t&&t());var i=trim(r.innerHTML);r.innerHTML="",e&&e(i)}),dynamicTree.TreeSupport.addMethod("fireServerErrorEvent",function(){this._getElement().fire("server:error",{})}),dynamicTree.TreeSupport.addMethod("fireTreeLoadedEvent",function(e){this._getElement().fire("tree:loaded",{tree:e})}),dynamicTree.TreeSupport.addMethod("fireChildrenLoadedEvent",function(e){this._getElement().fire("children:loaded",{nodes:e})}),dynamicTree.TreeSupport.addMethod("fireMultipleChildrenLoadedEvent",function(e,t){this._getElement().fire("multipleChildren:loaded",{parentNodeIds:e,metaNodes:t})}),dynamicTree.TreeSupport.addMethod("fireChildredPrefetchedLoadedEvent",function(e){this._getElement().fire("childredPrefetched:loaded",{nodes:e})}),define("components.dynamicTree",["prototype","dynamicTree.tree","dynamicTree.treenode","dynamicTree.events","core.ajax"],function(e){return function(){var t;return t||e.dynamicTree}}(this)),dynamicTree.RepositoryFolder=function(e){dynamicTree.TreeNode.call(this,e),this.Types={Folder:new dynamicTree.TreeNode.Type("com.jaspersoft.jasperserver.api.metadata.common.domain.Folder"),SuperRoot:new dynamicTree.TreeNode.Type("superroot"),Root:new dynamicTree.TreeNode.Type("root")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_folders:folders",this.param.extra&&this.param.extra.isActiveThemeFolder&&(this.param.cssClass=this.ACTIVE_THEME_CLASS)},dynamicTree.TreeNode&&(dynamicTree.RepositoryFolder.prototype=deepClone(dynamicTree.TreeNode.prototype)),dynamicTree.RepositoryFolder.addVar("ACTIVE_THEME_CLASS","activeTheme"),dynamicTree.RepositoryFolder.addMethod("isParent",function(){return this.param.type==this.Types.Folder.name||this.param.type==this.Types.SuperRoot.name||this.param.type==this.Types.Root.name}),dynamicTree.RepositoryFolder.addMethod("isSuperRoot",function(){return this.param.type==this.Types.SuperRoot.name}),dynamicTree.RepositoryFolder.addMethod("isPublic",function(){return"public"===this.param.id}),dynamicTree.createRepositoryTree=function(e,t){var r=null!=t.organizationId&&""!==t.organizationId;null==t.bShowRoot&&(t.bShowRoot=!r),t.nodeClass||(t.nodeClass=dynamicTree.RepositoryFolder),t.templateDomId="list_responsive_collapsible_folders";var i=new dynamicTree.TreeSupport(e,t);if(i.organizationId=t.organizationId,i.publicFolderUri=t.publicFolderUri,i.orgMode=r,i.modifyRootObject=function(e,t,r){var i;if(t){i=[];for(var d=0;d<e.length;d++)e[d].uri==this.publicFolderUri&&r&&"/"!=r.param.uri||i.push(e[d])}else if(this.orgMode&&null!=e.children){for(var n,s=e.children,o=[],d=0;d<s.length;d++)s[d].uri==this.publicFolderUri?n=s[d]:o.push(s[d]);e.children=o,i={type:"superroot",label:"",extra:{}},i.children=[e,n]}else i=e;return i},i.getRootNode=function(){var e=this.rootNode;return e.isSuperRoot()?e.childs[0].isPublic()?e.childs[1]:e.childs[0]:e},i.findNodeChildByMetaName=function(e,t){if(e.isSuperRoot()){var r,d;if(e.childs[0].isPublic()?(r=e.childs[0],d=e.childs[1]):(r=e.childs[1],d=e.childs[0]),"public"===t)return r;e=d}if(e.hasChilds())for(var n=0;n<e.childs.length;n++)if(e.childs[n].param.id==t)return e.childs[n];return"public"==t&&e.parent&&e.parent.isSuperRoot()?i.findNodeChildByMetaName(e.parent,t):null},isIPad()){var d=$(e);i.touchController=new TouchController(d,d.up(1),{absolute:!0})}return i},define("dynamicTree.utils",["components.dynamicTree","touchcontroller","dynamicTree.treenode"],function(e){return function(){var t;return t||e.dynamicTree}}(this));var picker={};picker.FileSelector=function(e){this._disabled=void 0!==e.disabled?e.disabled:!1,this._uriTextbox=$(e.uriTextboxId),this._browseButtonId=$(e.browseButtonId),this._onChange=e.onChange||!1,this._options=e,this._disabled?(buttonManager.disable(this._uriTextbox),buttonManager.disable(this._browseButtonId)):(this._id=e.id,this._suffix=e.suffix?e.suffix:(new Date).getTime(),this._treeDomId=e.treeId,this._selectLeavesOnly=void 0!==e.selectLeavesOnly?e.selectLeavesOnly:!1,this._selectedUri=$F(this._uriTextbox),this._process(e),this._assignHandlers(),this._refreshButtonsState())},picker.FileSelector.addVar("DEFAULT_TEMPLATE_DOM_ID","selectFromRepository"),picker.FileSelector.addVar("DEFAULT_TREE_ID","selectFromRepoTree"),picker.FileSelector.addVar("OK_BUTTON_ID","selectFromRepoBtnSelect"),picker.FileSelector.addVar("CANCEL_BUTTON_ID","selectFromRepoBtnCancel"),picker.FileSelector.addVar("TITLE_PATTERN","div.title"),picker.FileSelector.addMethod("_process",function(e){!this._id&&(this._id=this.DEFAULT_TEMPLATE_DOM_ID),!$(this._id)&&this._options.template&&this._options.i18n?(this._dom=jQuery(_.template(this._options.template,{i18n:this._options.i18n})),this._dom=this._dom[0]):this._dom=$(this._id).cloneNode(!0),this._dom.writeAttribute("id",this._id+this._suffix),this._okButton=this._dom.select("#"+this.OK_BUTTON_ID)[0],this._okButton.writeAttribute("id",this.OK_BUTTON_ID+this._suffix),this._cancelButton=this._dom.select("#"+this.CANCEL_BUTTON_ID)[0],this._cancelButton.writeAttribute("id",this.CANCEL_BUTTON_ID+this._suffix),!this._treeDomId&&(this._treeDomId=this.DEFAULT_TREE_ID),this._treeDom=this._dom.select("#"+this._treeDomId)[0],this._treeDom.writeAttribute("id",this._treeDomId+this._suffix),this._visible=!1,e.title&&this._dom.select(this.TITLE_PATTERN)[0].update(e.title),this._onOk=e.onOk,this._onCancel=e.onCancel,jQuery(document.body).append(this._dom);var t,r=this._dom.down(layoutModule.SWIPE_SCROLL_PATTERN);r&&(t=layoutModule.createScroller(r));var i=Object.extend({providerId:e.providerId,scroll:t},e.treeOptions);this._tree=dynamicTree.createRepositoryTree(this._treeDomId+this._suffix,i),this._selectedUri&&this._selectedUri.length>0?this._tree.showTreePrefetchNodes(this._selectedUri):this._tree.showTree(1)}),picker.FileSelector.addMethod("_assignHandlers",function(){this._dom.observe("click",this._dialogClickHandler.bindAsEventListener(this)),["node:dblclick","leaf:dblclick"].each(function(e){this._tree.observe(e,this._treeClickHandler.bindAsEventListener(this))},this),["node:click","leaf:click","node:selected","leaf:selected"].each(function(e){this._tree.observe(e,this._refreshButtonsState.bindAsEventListener(this))},this),["childredPrefetched:loaded","tree:loaded"].each(function(e){this._tree.observe(e,this._treeLoadHandler.bindAsEventListener(this))},this),this._browseButtonId.observe("click",this._browseClickHandler.bindAsEventListener(this))}),picker.FileSelector.addMethod("_canClickOk",function(e){return this._tree.getSelectedNode()&&(this._selectLeavesOnly?this._tree.getSelectedNode().param.type!==this._tree.getSelectedNode().FOLDER_TYPE_NAME:!0)}),picker.FileSelector.addMethod("_dialogClickHandler",function(e){var t=e.element();if(matchAny(t,["#"+this.OK_BUTTON_ID+this._suffix],!0)){e.stop();var r=this._tree.getSelectedNode().param.uri;this._uriTextbox.setValue(r),this._onChange&&this._onChange(r),this._hide(),this._onOk&&this._onOk()}else matchAny(t,["#"+this.CANCEL_BUTTON_ID+this._suffix],!0)&&(e.stop(),this._hide(),this._onCancel&&this._onCancel())}),picker.FileSelector.addMethod("_treeClickHandler",function(e){if(this._canClickOk()){var t=this._tree.getSelectedNode().param.uri;this._uriTextbox.setValue(t),this._onChange&&this._onChange(t),this._hide(),this._onOk&&this._onOk()}}),picker.FileSelector.addMethod("_treeLoadHandler",function(e){this._visible&&this._selectedUri&&this._tree.openAndSelectNode(this._selectedUri)}),picker.FileSelector.addMethod("_browseClickHandler",function(e){e.stop(),this._show()}),picker.FileSelector.addMethod("_refreshButtonsState",function(){this._canClickOk()?buttonManager.enable(this._okButton):buttonManager.disable(this._okButton)}),picker.FileSelector.addMethod("_hide",function(){dialogs.popup.hide(this._dom),this._visible=!1}),picker.FileSelector.addMethod("_show",function(){this._selectedUri=$F(this._uriTextbox),this._selectedUri&&this._selectedUri.length>0?this._tree.showTreePrefetchNodes(this._selectedUri):this._tree.showTree(1),dialogs.popup.show(this._dom,!0),this._visible=!0,this._selectedUri&&this._tree.openAndSelectNode(this._selectedUri),this._refreshButtonsState()}),picker.FileSelector.addMethod("remove",function(){jQuery(this._dom).remove()}),define("components.pickers",["utils.common","components.dialogs","core.layout","core.events.bis","prototype","jquery","dynamicTree.utils"],function(e){return function(){var t;return t||e.picker}}(this));var resourceLocator={CONTENT_REPOSITORY:"CONTENT_REPOSITORY",LOCAL:"LOCAL",NONE:"NONE",FILE_SYSTEM:"FILE_SYSTEM",LOCATE_EVENT:"resource:locate",ALLOWED_FILE_RESOURCE_EXTENSIONS:["css","ttf","jpg","jpeg","gif","bmp","png","jar","jrxml","properties","jrtx","xml","agxml","docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html"],initialize:function(e){var t=function(e){return _.isObject(e)?e:$(e)};this.resourceUri=t(e.resourceInput),this.browseButton=t(e.browseButton),this.filePath=t(e.fileUploadInput),this.fakeFilePath=t(e.fakeFileUploadInput),this.fakeFileInput=t(e.fakeFileUploadInputText),this.newResourceLink=t(e.newResourceLink);try{this._initFileSelector(e)}catch(r){}finally{this._initEvents(e)}return this},_initEvents:function(e){jQuery(document).on("click","#CONTENT_REPOSITORY, #FILE_SYSTEM, #NONE, #LOCAL",this._clickHandler),"fileResourceTreeDataProvider"===e.providerId&&(jQuery("#next").on("click",resourceLocator._nextClickHandler),jQuery("#filePath").on("change",resourceLocator._uploadChangeHandler))},_nextClickHandler:function(e){jQuery("#fileUpload").hasClass("error")&&e.preventDefault()},_uploadChangeHandler:function(e){jQuery("#fileUpload").removeClass("error");var t=!0,r=jQuery("#filePath")[0].value;if(r){var i=jQuery("#filePath")[0].value.match(/.*\.([^\.]+)$/);if(i){var d=i[1];_.indexOf(resourceLocator.ALLOWED_FILE_RESOURCE_EXTENSIONS,d)<0&&(t=!1)}else t=!1}else t=!1;if(!t){var n=resource.messages["resource.report.unsupportedFileType.error"]+" "+resourceLocator.ALLOWED_FILE_RESOURCE_EXTENSIONS.join(", ");jQuery("#fileUpload").addClass("error").find("span.warning").html(n)}},_clickHandler:function(e){resourceLocator._updateResourceSelectorState(e.target.id)},_updateResourceSelectorState:function(e){resource.switchButtonState(this.filePath,e===this.FILE_SYSTEM),resource.switchButtonState(this.fakeFilePath,e===this.FILE_SYSTEM),resource.switchButtonState(this.fakeFileInput,e===this.FILE_SYSTEM),resource.switchButtonState(this.browseButton,e===this.CONTENT_REPOSITORY),resource.switchDisableState(this.resourceUri,e!==this.CONTENT_REPOSITORY);var t=e===this.LOCAL?["disabled","launcher"]:["launcher","disabled"];this._switchElementClasses(this.newResourceLink,t)},_initFileSelector:function(e){this.fileSelector=new picker.FileSelector(_.extend({},e,{uriTextboxId:this.resourceUri,browseButtonId:this.browseButton,title:e.dialogTitle}))},remove:function(e){this.fileSelector.remove()},_switchElementClasses:function(e,t){e&&t&&e.removeClassName(t[0]).addClassName(t[1])}};define("resource.locate",["resource.base","jquery","components.pickers"],function(e){return function(){var t;return t||e.resourceLocator}}(this));var inputControl={messages:[],initialize:function(){this.form=$$("input[name=_flowExecutionKey]")[0].up("form"),this.defineRadio=$("LOCAL"),this.resourceUriInput=$("resourceUri");try{this.resourcePicker(),this.updateButtonsState()}finally{this.initEvents()}},resourcePicker:function(){resourceLocator.initialize({resourceInput:"resourceUri",browseButton:"browser_button",treeId:"inputControlTreeRepoLocation",providerId:"inputControlResourceTreeDataProvider",dialogTitle:inputControl.messages["InputControlLocate.Title"],selectLeavesOnly:!0})},initEvents:function(){this.form&&new Form.Observer(this.form,.3,function(){this.updateButtonsState()}.bind(this))},updateButtonsState:function(){this.resourceUriInput.getValue().blank()&&"LOCAL"!==this.defineRadio.getValue()?buttonManager.disable("next"):buttonManager.enable("next")}};"undefined"==typeof require&&document.observe("dom:loaded",function(){inputControl.initialize(localContext.initOptions)}),define("resource.inputControl.locate",["resource.locate","core.events.bis","prototype"],function(e){return function(){var t;return t||e.inputControl}}(this)),define("addResource/jasperReport/addJasperReportLocateControlMain",["require","!domReady","resource.inputControl.locate","underscore","jrs.configs","resource.base"],function(e){"use strict";var t=e("!domReady"),r=e("resource.inputControl.locate"),i=e("underscore"),d=e("jrs.configs"),n=e("resource.base");t(function(){i.extend(r.messages,d.addJasperReport.inputControl.messages),r.initialize(),isIPad()&&n.initSwipeScroll()})});