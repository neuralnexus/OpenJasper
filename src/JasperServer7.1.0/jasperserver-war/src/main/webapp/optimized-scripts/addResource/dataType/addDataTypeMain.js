var resource={messages:{},resourceLabelMaxLength:100,resourceIdMaxLength:100,resourceDescriptionMaxLength:250,PROPAGATE_EVENT:"propagateEvent",STEP_DISPLAY_ID:"stepDisplay",FLOW_CONTROLS_ID:"flowControls",initSwipeScroll:function(){var e=$(resource.STEP_DISPLAY_ID);e&&new TouchController(e.up(),e.up(1),{})},submitForm:function(e,t,r){if(t){var i=buildActionUrl(t);r&&r(),$(e).writeAttribute("method","post").writeAttribute("action",i),$(e).submit()}},registerClickHandlers:function(e,t,r){if(resource._bodyClickEventHandlers)return void(r?Array.prototype.unshift:Array.prototype.push).apply(resource._bodyClickEventHandlers,e);resource._bodyClickEventHandlers=e;var i=t||"body";$$(i)[0].observe("click",function(e){resource._bodyClickEventHandlers&&resource._bodyClickEventHandlers.each(function(t){var r=t(e);if(r)throw r!==resource.PROPAGATE_EVENT&&Event.stop(e),$break})})},TreeWrapper:function(e){var t=this;if(this._treeId=e.treeId,this._resourceUriInput=$(e.resourceUriInput||"resourceUri"),this._uri=this._resourceUriInput&&this._resourceUriInput.getValue()||e.uri||"/",!e.providerId)throw"There is no tree provider set for tree #{id}".interpolate({id:this._treeId});var r=["providerId","rootUri","organizationId","publicFolderUri","urlGetNode","urlGetChildren"].inject({},function(t,r){return null!==e[r]&&(t[r]=e[r]),t});return this._tree=new dynamicTree.createRepositoryTree(this._treeId,r),this._tree.observe("tree:loaded",function(){t._tree.openAndSelectNode($(t._resourceUriInput).getValue())}),this._tree.observe("leaf:selected",function(e){t._uri=e.memo.node.param.uri,t._resourceUriInput.setValue(t._uri)}),this._tree.observe("node:selected",function(){t._resourceUriInput.setValue(t._uri="")}),{getTreeId:function(){return t._treeId},getTree:function(){return t._tree},selectFolder:function(e){t._tree.openAndSelectNode(e)},getSelectedFolderUri:function(){return t._uri}}},switchButtonState:function(e,t){buttonManager[t?"enable":"disable"].call(buttonManager,e)},switchDisableState:function(e,t){(e=$(e))&&e[t?"disable":"enable"].call(e)},generateResourceId:function(e){if(localContext&&localContext.initOptions&&localContext.initOptions.resourceIdNotSupportedSymbols)return e.replace(new RegExp(localContext.initOptions.resourceIdNotSupportedSymbols,"g"),"_");throw"There is no resourceIdNotSupportedSymbols property in init options."},testResourceId:function(e){if(localContext&&localContext.initOptions&&localContext.initOptions.resourceIdNotSupportedSymbols)return new RegExp(localContext.initOptions.resourceIdNotSupportedSymbols,"g").test(e);throw"There is no resourceIdNotSupportedSymbols property in init options."},labelValidator:function(e){var t=!0,r="";return e.blank()?(r=resource.messages.labelIsEmpty,t=!1):e.length>resource.resourceLabelMaxLength&&(r=resource.messages.labelToLong,t=!1),{isValid:t,errorMessage:r}},getLabelValidationEntry:function(e){return{element:e,validators:[{method:"mandatory",messages:{mandatory:resource.messages.labelIsEmpty}},{method:"minMaxLength",messages:{tooLong:resource.messages.labelToLong},options:{maxLength:resource.resourceLabelMaxLength}}]}},getIdValidationEntry:function(e){return{element:e,validators:[{method:"resourceIdChars",messages:resource.messages},{method:"mandatory",messages:{mandatory:resource.messages.resourceIdIsEmpty}},{method:"minMaxLength",messages:{tooLong:resource.messages.resourceIdToLong},options:{maxLength:resource.resourceIdMaxLength}}]}},resourceIdValidator:function(e){var t=!0,r="";return this._isEditMode||(e.blank()?(r=resource.messages.resourceIdIsEmpty,t=!1):e.length>resource.resourceIdMaxLength?(r=resource.messages.resourceIdToLong,t=!1):resource.testResourceId(e)&&(r=resource.messages.resourceIdInvalidChars,t=!1)),{isValid:t,errorMessage:r}},getDescriptionValidationEntry:function(e){return{element:e,validators:[{method:"minMaxLength",messages:{tooLong:resource.messages.descriptionToLong},options:{maxLength:resource.resourceDescriptionMaxLength}}]}},descriptionValidator:function(e){var t=!0,r="";return e.length>resource.resourceDescriptionMaxLength&&(r=resource.messages.descriptionToLong,t=!1),{isValid:t,errorMessage:r}},dataSourceValidator:function(e){var t=!0,r="";return""===e.trim()&&(r=resource.messages.dataSourceInvalid,t=!1),{isValid:t,errorMessage:r}},queryValidator:function(e){var t=!0,r="";return""===e.trim()&&(r=resource.messages.queryInvalid,t=!1),{isValid:t,errorMessage:r}},getValidationEntries:function(e){return e.collect(function(e){return e.validationEntry?e.validationEntry:{validator:e.validator,element:e}})}};"undefined"==typeof require&&isIPad()&&document.observe("dom:loaded",resource.initSwipeScroll.bind(resource)),define("resource.base",["prototype","utils.common","core.layout"],function(e){return function(){var t;return t||e.resource}}(this));var resourceDataType={PAGE_ID:"addResource_dataType",DATA_TYPE_ID:"dataType.dataTypeType",LABEL_ID:"dataType.label",RESOURCE_ID_ID:"dataType.name",DESCRIPTION_ID:"dataType.description",SAVE_BUTTON_ID:"done",CHANGE_TYPE_BUTTON_ID:"changeCombo",_canGenerateId:!0,initialize:function(e){this._form=$(this.PAGE_ID).select("form")[0],this._dataType=$(this.DATA_TYPE_ID),this._label=$(this.LABEL_ID),this._resourceId=$(this.RESOURCE_ID_ID),this._description=$(this.DESCRIPTION_ID),this._saveButton=$(this.SAVE_BUTTON_ID),this._changeTypeButton=$(this.CHANGE_TYPE_BUTTON_ID),this._isEditMode=e.isEditMode,this._label.validator=resource.labelValidator.bind(this),this._resourceId.validator=resource.resourceIdValidator.bind(this),this._description.validator=resource.descriptionValidator.bind(this),this._initEvents()},_initEvents:function(){this._dataType.observe("change",function(){this._changeTypeButton.click()}.bindAsEventListener(this)),this._saveButton.observe("click",function(e){this._isDataValid()||e.stop()}.bindAsEventListener(this)),this._form.observe("keyup",function(e){var t=e.element(),r=[this._label,this._resourceId,this._description];r.include(t)&&(ValidationModule.validate(resource.getValidationEntries([t])),t==this._resourceId&&this._resourceId.getValue()!=resource.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),t==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(resource.generateResourceId(this._label.getValue())),ValidationModule.validate(resource.getValidationEntries([this._resourceId]))))}.bindAsEventListener(this))},_isDataValid:function(){var e=[this._label,this._resourceId,this._description];return ValidationModule.validate(resource.getValidationEntries(e))}};"undefined"==typeof require&&document.observe("dom:loaded",function(){resourceDataType.initialize(localContext.initOptions)}),define("resource.dataType",["resource.base","prototype","utils.common"],function(e){return function(){var t;return t||e.resourceDataType}}(this)),define("components.calendarInput",["require","jquery","underscore","settings!dateTimeSettings","utils.common","config/dateAndTimeSettings"],function(e){"use strict";var t=e("jquery"),r=e("underscore"),i=e("settings!dateTimeSettings");e("utils.common"),e("config/dateAndTimeSettings");var n=function(e){this.container=null,"undefined"!=typeof e.container&&(this.container="undefined"==typeof e.container.jquery?t(e.container):e.container),this.name=e.name,this.id=e.name.replace(".","_"),this.value=e.value,this.onChange=e.onchange||null,this.isReadOnly="undefined"==typeof e.readOnly?!1:e.readOnly,this.hasDate="undefined"!=typeof e.date&&""!==e.date&&"true"===e.date,this.hasTime="undefined"!=typeof e.time&&""!==e.time&&"true"===e.time,this.pickerOptions=r.extend({},this.defaultPickerOptions),this.hasDate&&r.extend(this.pickerOptions,i.datepicker),this.hasTime&&r.extend(this.pickerOptions,i.timepicker),"undefined"!=typeof e.picker&&r.isObject(e.picker)&&r.extend(this.pickerOptions,e.picker),this.field=null};return n.prototype.defaultPickerOptions={showOn:"button",buttonText:"",changeYear:!0,changeMonth:!0,showButtonPanel:!0,onChangeMonthYear:null,beforeShow:t.datepicker.movePickerRelativelyToTriggerIcon},n.prototype.create=function(){var e=t("<input type='text'/>").attr({name:this.name,id:this.id,value:this.value});if(e.on("mousedown",cancelEventBubbling),this.onChange&&e.on("change",this.onChange),this.isReadOnly&&e.attr("disabled","disabled"),this.field=e,this.container.append(this.field),!this.isReadOnly){var r=this.hasDate?"date":"";r+=this.hasTime?"time":"",r+="picker",t.fn[r].call(e,this.pickerOptions).next().addClass("button").addClass("picker"),e[0].getValue=function(){return t(this).val()}}},n}),define("addResource/dataType/addDataTypeMain",["require","!domReady","resource.dataType","underscore","jquery","jrs.configs","resource.base","components.calendarInput","utils.common"],function(e){"use strict";function t(){return n.indexOf([3,4,5],s.addDataType.type)>-1}var r=e("!domReady"),i=e("resource.dataType"),n=e("underscore"),o=e("jquery"),s=e("jrs.configs"),a=e("resource.base"),d=e("components.calendarInput");e("utils.common"),r(function(){var e=s.addDataType.localContext.initOptions;if(n.extend(window.localContext,s.addDataType.localContext),n.extend(a.messages,s.addDataType.resource.messages),t()){var r=new d(s.addDataType.minValueText);r.container=o("label.minPicker"),r.create();var u=new d(s.addDataType.maxValueText);u.container=o("label.maxPicker"),u.create()}i.initialize(e),isIPad()&&a.initSwipeScroll(),o("body").addClass("jr")})});