define(["require","./enum/links","./enum/relations","underscore","jquery","./transport/request","./util/helper","logger"],function(e){"use strict";function r(e,r){return f.debug(e,r),r}function n(e){return o.find(s,function(r){return r.rel===e.rel&&r.name===e.name})}function t(e,r,n,t){this.isLoggerEnabled=r,this.logLevel=n,this.scripts=t,this.baseUrl=e?e:"",this.xdm().then(function(e){u.rpc(e)})}var s=e("./enum/links").links,i=e("./enum/relations"),o=e("underscore"),l=e("jquery"),u=e("./transport/request"),a=e("./util/helper"),f=e("logger").register("Root");return o.extend(t.prototype,{xdm:function(){var e,r=new l.Deferred,t=n({rel:i.XDM});return t&&(e=this.baseUrl+t.href),r.resolve(e),r.promise()},settings:function(){var e=new l.Deferred,r=n({rel:i.SETTINGS}),t=this;return r?u({url:this.baseUrl+r.href},function(r){var n=a.serverSettings(r);n.contextPath=t.baseUrl,n.isXdm=!0,"undefined"!=typeof __jrsConfigs__?o.extend(__jrsConfigs__,n):window.__jrsConfigs__=n,e.resolve(n)}):e.resolve(new Error("Can't get server settings")),e.promise()},requirejs:function(){var e=new l.Deferred,t=n({rel:i.REQUIREJS,name:"jrs"});if(s){var f,c=this.scripts?this.scripts:"scripts",g=t.href.replace("{scripts}",this.scripts),h=this.baseUrl+"/",d=o.partial(r,"Script loader configs for JRS: "),p=this;f=u({url:this.baseUrl+g,dataType:"text"}).then(a.loaderConfig).then(function(e){var r=e.baseUrl?e.baseUrl:c;return e.baseUrl=h+r,e.config&&e.config.logger&&(e.config.logger.enabled=p.isLoggerEnabled,e.config.logger.level=p.logLevel),e}).then(d),l.when(f).then(function(e){return e},e.reject).then(e.resolve)}else e.reject(new Error("Can't get RequireJS configs"));return e.promise()}}),t});