define(["require","underscore","jquery","backbone.validation","bundle!AttributeBundle","common/util/i18nMessage","backbone.epoxy","attributes/enum/permissionMasksEnum"],function(t){var e=t("underscore"),i=t("jquery"),n=t("backbone.validation"),r=t("bundle!AttributeBundle"),a=t("common/util/i18nMessage").extend({bundle:r}),s=t("backbone.epoxy"),o=t("attributes/enum/permissionMasksEnum"),u=255,d=2e3,l=s.Model.extend({defaults:{id:void 0,name:void 0,value:"",description:"",inherited:!1,permissionMask:1,secure:!1},constructor:function(){this._initModelWithPermissionDefaults&&this._initModelWithPermissionDefaults(),s.Model.apply(this,arguments)},initialize:function(){this.get("id")||this.setId(),this.validateSameNames=!1,this.setState("originalState"),this.setState("confirmedState")},url:function(){var t=encodeURIComponent(this.id).replace(/'/g,"%27");return this.collection.url(this.isNew()?"":t)},validation:{name:[{required:!0,msg:new a("attributes.error.attribute.name.empty")},{maxLength:u,msg:new a("attributes.error.attribute.name.too.long",u)},{doesNotContainSymbols:"\\\\/",msg:new a("attributes.error.attribute.name.invalid")},{fn:function(){if(this.attr){for(var t,i,n,r=this.attr.length,s=0;r>s;s++){if(n=this.attr[s],e.defaults(n,this.defaults),i=this.holder===n.holder&&this.get("inherited")===n.inherited){t="attributes.error.attribute.name.already.exist";break}if(n.inherited&&n.permissionMask===o.READ_ONLY){t="attributes.error.attribute.name.already.exist.at.higher.level";break}}return this.attr=null,this.holder=null,t&&new a(t)}}},{fn:function(){return this.validateIfSecure?new a("attributes.error.attribute.secure.renaming.not.allowed"):void 0}}],value:[{maxLength:d,msg:new a("attributes.error.attribute.value.too.long",d)},{fn:function(){return this.validateIfSecure?(this.validateIfSecure=!1," "):void 0}}],description:[{maxLength:u,msg:new a("attributes.error.attribute.description.too.long",u)}]},setId:function(){var t=this.get("name"),e=this.get("id");t!==e&&this.set("id",t)},toggleSameNamesValidation:function(){this.validateSameNames=!this.validateSameNames},resetField:function(t){this.set(t,this.defaults[t])},reset:function(t,e){var i={};return e=this.getState(e),i[t]=e[t],this.set(t?i:e),this},isRenamed:function(){return this.get("name")!==this.get("id")},isOriginallyInherited:function(){return this.originalState.inherited},isOverridden:function(){return!this.compareAttribute("inherited")},compareAttribute:function(t){return this.originalState[t]===this.confirmedState[t]},setState:function(t,i){i=i||this.attributes,this[t||"originalState"]=e.clone(i)},getState:function(t){return this[t||"originalState"]},trimAttrs:function(t,n){e.each(t,function(t){var e=this.get(t);this.set(t,i.trim(e),n)},this)},toJSON:function(t){t=t||{};var i=s.Model.prototype.toJSON.apply(this,arguments);return t.omitValue&&this.validateSecureValue()&&e.omit(i,"value")||i},confirmState:function(t){this.stateConfirmed=t||!0},isStateConfirmed:function(){return this.stateConfirmed},validateSecureValue:function(){var t=e.isEmpty(this.get("value")),i=this.get("secure"),n=this.isNew()||this.isOverridden();return!n&&i&&t}});return e.extend(l.prototype,n.mixin),l});