JRS.Controls=function(e,t,i){function n(e){this.set({selection:e})}function a(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}function s(e,t){if(!e)return null;for(var i={},n=0;n<e.length;n++){var a=e[n];if(a.selected&&(i[n]=a.value,t))break}return i}var l;require(["common/util/parse/date"],function(e){l=e});var r,o,u,d,c,h,m;return require(["components/singleSelect/view/SingleSelect","components/multiSelect/view/MultiSelect","components/singleSelect/dataprovider/CacheableDataProvider","components/multiSelect/dataprovider/DataProviderWithLabelHash","components/singleSelect/dataprovider/SearcheableDataProvider","components/multiSelect/mixin/resizableMultiSelectTrait","components/dateAndTime/DateAndTimePicker"],function(e,t,i,n,a,s,l){r=e,o=t,u=i,d=n,c=a,h=s,m=l}),t.extend(i,{Bool:i.BaseControl.extend({update:function(e){var t=this.getElem(),i=t.find("input");"true"==e?i.prop("checked",!0):i.removeAttr("checked")},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=null==e.target.getValue()?"false":"true";this.set({selection:t})},this))}}),SingleValueText:i.BaseControl.extend({update:function(e){var t=e==ControlsBase.NULL_SUBSTITUTION_VALUE?ControlsBase.NULL_SUBSTITUTION_LABEL:e,i=this.getElem();i&&(i.find("input").attr("value",t),i.find("input").val(t))},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=e.target.value,i=t==ControlsBase.NULL_SUBSTITUTION_LABEL?ControlsBase.NULL_SUBSTITUTION_VALUE:t;this.set({selection:i})},this))}}),SingleValueNumber:i.BaseControl.extend({update:function(e){this.getElem().find("input").attr("value",e),this.getElem().find("input").val(e)},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){this.set({selection:e.target.value})},this))}}),SingleValueDate:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedDateToIsoDate(t)},set:function(e,t){e.values&&(e.values=l.isoDateToLocalizedDate(e.values)),i.BaseControl.prototype.set.call(this,e,t)},setupCalendar:function(){var i=this.getElem().find("input");this.picker=new m({el:i,showOn:"button",dateFormat:JRS.i18n.bundledCalendarFormat,disabled:i[0].disabled,onSelect:t.bind(n,this)}),i.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(a(t.target.value)),n.call(this,e(t.target).val())},this)),i.after("&nbsp;");var s=this.getElem().find("button");s.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleValueDatetime:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},getInput:function(){var e=this.getElem();return e.find("input")},destroyCalendar:function(){var e=this.getInput();e.off(),this.picker&&this.picker.remove()},setupCalendar:function(){var i=this.getElem(),s=this.getInput();this.destroyCalendar(),this.picker=new m({el:s[0],showOn:"button",dateFormat:JRS.i18n.bundledCalendarFormat,timeFormat:JRS.i18n.bundledCalendarTimeFormat,disabled:s[0].disabled,onSelect:t.bind(n,this)}),s.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(a(t.target.value)),n.call(this,e(t.target).val())},this)),s.after("&nbsp;");var l=i.find("button");l.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedTimestampToIsoTimestamp(t)},set:function(e,t){e.values&&(e.values=l.isoTimestampToLocalizedTimestamp(e.values)),e.values||e.selection||this.setupCalendar(),i.BaseControl.prototype.set.call(this,e,t)},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleValueTime:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},getInput:function(){var e=this.getElem();return e.find("input")},destroyCalendar:function(){var e=this.getInput();e.off(),this.picker&&this.picker.remove()},setupCalendar:function(){var i=this.getElem(),s=this.getInput();this.destroyCalendar(),this.picker=new m({el:s[0],showOn:"button",timeFormat:JRS.i18n.bundledCalendarTimeFormat,disabled:s[0].disabled,onClose:t.bind(n,this)}),s.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(a(t.target.value)),n.call(this,e(t.target).val())},this)),s.after("&nbsp;");var l=i.find("button");l.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedTimeToIsoTime(t)},set:function(e,t){e.values&&(e.values=l.isoTimeToLocalizedTime(e.values)),e.values||e.selection||this.setupCalendar(),i.BaseControl.prototype.set.call(this,e,t)},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleSelect:i.BaseControl.extend({baseRender:function(n){this.singleSelect||(this.dataProvider=new u,this.singleSelect=new r({getData:this.dataProvider.getData}).setDisabled(n.readOnly)),n&&t.extend(this,n);var a=i.TemplateEngine.createTemplate(this.type);if(a){this.singleSelect.undelegateEvents();var s=e(a(this));this.singleSelect.render().renderData(),s.find(".ssPlaceholder").append(this.singleSelect.el),this.setElem(s),this.singleSelect.delegateEvents()}},update:function(e){this.dataProvider.setData(e);var t=this;this.singleSelect.fetch(function(){t.singleSelect.setValue(s(e,!0),{silent:!0})})},bindCustomEventListeners:function(){this.singleSelect.off("selection:change").on("selection:change",function(e){this.set({selection:e})},this)}}),MultiSelect:i.BaseControl.extend({baseRender:function(n){var a=this;this.multiSelect||(this.dataProvider=new d,this.multiSelect=new o({getData:new c({getData:this.dataProvider.getData}).getData,selectedListOptions:{formatLabel:function(e){return a.dataProvider.getDataLabelHash()[e]}},resizable:!0}),this.multiSelect.setDisabled(n.readOnly),this._resize=t.debounce(t.bind(this.multiSelect.resize,this.multiSelect),500)),n&&t.extend(this,n);var s=i.TemplateEngine.createTemplate(this.type);if(s){this.multiSelect.undelegateEvents();var l=e(s(this));this.multiSelect.render().renderData(),l.find(".msPlaceholder").append(this.multiSelect.el),this.setElem(l),this.multiSelect.delegateEvents()}},update:function(e){this.dataProvider.setData(e);var t=this;this.multiSelect.fetch(function(){var i=s(e);t.multiSelect.setValue(i,{silent:!0}),t._resize()})},bindCustomEventListeners:function(){this.multiSelect.off("selection:change").on("selection:change",function(e){this.set({selection:e})},this)},get:function(e){var i=this[e];return"selection"==e&&t.isEmpty(i)?[ControlsBase.NOTHING_SUBSTITUTION_VALUE]:i},makeResizable:function(){var e=this.multiSelect.$el.find(".jr-mSizer");e.length&&e.detach().insertAfter(this.getElem().find(".resizeOverlay"))}}),SingleSelectRadio:i.BaseControl.extend({update:function(n){var a=((new Date).getTime(),this.getElem().find("ul")[0]),s=t.map(n,function(e){var i=t.clone(e);return i.readOnly=this.readOnly,i.name=this.getOptionName(),i.uuid=t.uniqueId(this.id),i},this),l=this.getTemplateSection("data");i.Utils.setInnerHtml(a,l,{data:s}),a.innerHTML+="&nbsp;",e(a).find("li").length<5&&this.getElem()[0].clientHeight<125?(this.getElem().find(".jr-mSizer").addClass("hidden"),this.getElem().find(".inputSet").removeClass("sizable").attr("style",!1)):this.resizable&&(this.getElem().find(".jr-mSizer").removeClass("hidden"),this.getElem().find(".inputSet").addClass("sizable"))},getOptionName:function(){return this.id+"_option"},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=e.target.value,i=this;setTimeout(function(){i.set({selection:t})})},this))},makeResizable:function(){this.resizable=!0;var e=this.getElem().find("ul"),t=this.getElem().find(".jr-mSizer").removeClass("hidden");t.addClass("ui-resizable-s"),e.resizable({handles:{s:t}})}}),MultiSelectCheckbox:i.BaseControl.extend({update:function(n){var a=t.map(n,function(e){var i=t.clone(e);return i.readOnly=this.readOnly,i.uuid=t.uniqueId(this.id),i},this),s=this.getElem().find("ul")[0],l=this.getTemplateSection("data");i.Utils.setInnerHtml(s,l,{data:a}),e(s).find("li").length<5&&this.getElem()[0].clientHeight<125?(this.getElem().find(".jr-mSizer").addClass("hidden"),this.getElem().find(".inputSet").removeClass("sizable").attr("style",!1)):this.resizable&&(this.getElem().find(".jr-mSizer").removeClass("hidden"),this.getElem().find(".inputSet").addClass("sizable"))},getSelection:function(){var i=this.getElem().find(":checkbox").filter(":checked");return t.map(i,function(t){return e(t).val()})},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=this.getSelection(),i=this;setTimeout(function(){i.set({selection:t})})},this)),this.getElem().on("click","a",t.bind(function(i){var n=this.getElem().find("input"),a=e(i.target)[0].name;"multiSelectAll"===a||"multiSelectNone"===a?t.each(n,function(e){e.checked="multiSelectAll"===a}):"multiSelectInverse"===a&&t.each(n,function(e){e.checked=!e.checked}),this.getElem().find("input").change()},this))},get:function(e){var i=this[e];return"selection"==e&&t.isEmpty(i)?[ControlsBase.NOTHING_SUBSTITUTION_VALUE]:i},makeResizable:function(){this.resizable=!0;var e=this.getElem().find("ul"),t=this.getElem().find(".jr-mSizer").removeClass("hidden");t.addClass("ui-resizable-s"),e.resizable({handles:{s:t}})}})})}(jQuery,_,JRS.Controls);