function invokeServerAction(e,t){var n=orgModule.serverActionFactory[e];if(!n)throw new Error("No server action found for action name '"+e+"'");var i=n.call(orgModule.serverActionFactory,t);i.invokeAction()}function invokeClientAction(e,t){var n=orgModule.clientActionFactory[e];if(n){var i=n.call(orgModule.clientActionFactory,t);return i.invokeAction()}throw new Error("No client action found for action name '"+e+"'")}orgModule.confirmAndLeave=function(){var e=orgModule.entityList.getSelectedEntities();return orgModule.properties.attributesFacade?!0:invokeClientAction("cancelIfEdit",{entity:e[0],entityEvent:!1})},orgModule.manager={initialize:function(e){this.options=e,this.state=e.state,_.extend(this.state,{id:this.state.tenantId}),isProVersion()&&(this.tenantsTree=new e.TenantsTreeView({container:"#folders .body",currentUser:e.currentUser,removeContextMenuTreePlugin:e.removeContextMenuTreePlugin,selectedTenant:this.state,comparator:function(e,t){return orgModule._comparator(e.tenantName,t.tenantName)}}),orgModule.initTenantsTreeEvents(),this.tenantsTree.render()),orgModule.observe("org:browse",function(e){var t;this.tenantsTree&&(t=this.tenantsTree.getTenant());var n=e.memo.entityEvent,i=e.memo.force;if(i||!this.lastSelectedOrg||this.lastSelectedOrg.id!=t.id){var o=orgModule.entityList.getSelectedEntities();invokeClientAction("cancelIfEdit",{entity:o[0]||t,entityEvent:n})?(invokeServerAction(orgModule.ActionMap.BROWSE,{tenantId:t?t.id:null}),this.lastSelectedOrg=t):this.lastSelectedOrg&&this.tenantsTree.selectTenant(this.lastSelectedOrg.id)}}.bindAsEventListener(this)),orgModule.observe("entity:search",function(e){var t,n=orgModule.entityList.getSelectedEntities(),i=e.memo.text;this.tenantsTree&&(t=this.tenantsTree.getTenant()),invokeClientAction("cancelIfEdit",{entity:n[0]||t})?(invokeServerAction(orgModule.ActionMap.SEARCH,{text:i}),this.lastSearchText=i):0===i.length&&this.lastSearchText&&0!==this.lastSearchText.length&&orgModule.entityList.setSearchText(this.lastSearchText)}.bindAsEventListener(this)),orgModule.observe("entity:next",function(e){invokeServerAction(orgModule.ActionMap.NEXT,{})}.bindAsEventListener(this)),orgModule.observe("entity:selectAndGetDetails",function(e){var t=e.memo.entityEvent,n=e.memo.isCtrlHeld,i=e.memo.cancelIfEdit,o=orgModule.entityList.getSelectedEntities(),r=Boolean(e.memo.refreshAttributes);if(o.length>1)orgModule.properties.hide();else{var s,a=o[0];if(s=a&&t?a.getNameWithTenant():(!t||n||i)&&e.memo.entityId,!a&&(orgModule.userManager||!orgModule.userManager&&orgModule.roleManager)&&n)return void orgModule.properties.hide();s&&invokeServerAction(orgModule.ActionMap.SELECT_AND_GET_DETAILS,{refreshAttributes:r,entity:s})}}.bindAsEventListener(this)),orgModule.observe("result:changed",function(t){var n=t.memo.responseData;orgModule.entityList.setEntities(n.entities.collect(this.entityJsonToObject)),e.defaultEntity&&orgModule.entityList.restoreSelectedEntity(e.defaultEntity)}.bindAsEventListener(this)),orgModule.observe("result:next",function(e){var t=e.memo.responseData;t.entities.length>0&&orgModule.entityList.addEntities(t.entities.collect(this.entityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("entity:detailsLoaded",function(e){var t=this.entityJsonToObject(e.memo.responseData),n=orgModule.properties,i=e.memo.inputData.refreshAttributes;orgModule.entityList.update(t.getNameWithTenant(),t),n.setDetailsLoadedEntity(t),n.show(t,i),!n.locked&&n.setProperties(t),orgModule.entityList.toolbar.refresh(),n.unlock()}.bindAsEventListener(this)),orgModule.observe("searchAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("searchAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&orgModule.properties.setAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAvailable:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAvailableEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("nextAssigned:loaded",function(e){var t=e.memo.responseData;t&&t.entities&&t.entities.length>0&&orgModule.properties.addAssignedEntities(t.entities.collect(this.relatedEntityJsonToObject))}.bindAsEventListener(this)),orgModule.observe("server:error",function(e){var t=e.memo.responseData;t&&alert(t.message+"\n\n"+t.description?t.description:"")}),orgModule.observe("entity:created",function(e){orgModule.addDialog.hide();var t=e.memo.inputData.entity;if(t){var n=this.entityJsonToObject(t.evalJSON());orgModule.entityList.addEntities([n]),orgModule.entityList.deselectAll(),orgModule.entityList.selectEntity(n.getNameWithTenant())}}.bindAsEventListener(this)),orgModule.observe("entity:updated",function(e){var t=this,n=e.memo.inputData.entityName,i=e.memo.responseData;i.roles||(i=e.memo.unencryptedEntity),i||(i=e.memo.inputData.entity);var o=orgModule.properties.attributesFacade||{},r=o.designer&&o.designer.saveDfD;orgModule.properties.isEditMode&&(r?r.done(function(){orgModule.properties.changeMode(!1)}):orgModule.properties.changeMode(!1)),i&&(r?r.done(function(){t.updateEntityList(i,n)}):this.updateEntityList(i,n))}.bindAsEventListener(this)),orgModule.observe("entity:deleted",function(e){var t=e.memo.inputData.entity;orgModule.entityList.remove(t)}.bindAsEventListener(this)),orgModule.observe("entities:deleted",function(e){var t=e.memo.inputData.entities;t&&orgModule.entityList.remove(t.evalJSON())}.bindAsEventListener(this))},updateEntityList:function(e,t){var n=this.entityJsonToObject(e.evalJSON?e.evalJSON():e);orgModule.entityList.update(t,n),orgModule.entityList.selectEntity(n.getNameWithTenant?n.getNameWithTenant():t)},entityJsonToObject:function(e){},relatedEntityJsonToObject:function(e){},reloadEntities:function(){orgModule.fire(orgModule.Event.ORG_BROWSE,{})},isUserSuperuser:function(){var e=isProVersion()?orgModule.Configuration.superuserRole:orgModule.Configuration.adminRole,t=this.options.currentUserRoles;return null!=t.detect(function(t){return t.roleName==e&&!t.tenantId})}};